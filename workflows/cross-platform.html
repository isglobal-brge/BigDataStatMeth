<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Cross-Platform Workflows – BigDataStatMeth</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-969ddfa49e00a70eb3423444dbc81f6c.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d0f1cdce0779274a5ec1152cd33adb41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-d6747531eee53fd58085a197f3afc013.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-d0f1cdce0779274a5ec1152cd33adb41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../assets/css/custom.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/images/logo.png" alt="" class="navbar-logo light-content">
    <img src="../assets/images/logo.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">BigDataStatMeth</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fundamentals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Fundamentals</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fundamentals">    
        <li>
    <a class="dropdown-item" href="../fundamentals/big-data-problem.html">
 <span class="dropdown-text">The Big Data Problem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/understanding-hdf5.html">
 <span class="dropdown-text">Understanding HDF5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/blockwise-computing.html">
 <span class="dropdown-text">Block-Wise Computing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/linear-algebra.html">
 <span class="dropdown-text">Linear Algebra Essentials</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../tutorials/getting-started.html">
 <span class="dropdown-text">Getting Started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/working-hdf5-matrices.html">
 <span class="dropdown-text">Working with HDF5 Matrices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/first-analysis.html">
 <span class="dropdown-text">Your First Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-workflows" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Workflows</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-workflows">    
        <li>
    <a class="dropdown-item" href="../workflows/implementing-pca.html">
 <span class="dropdown-text">Implementing PCA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workflows/implementing-cca.html">
 <span class="dropdown-text">Implementing CCA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workflows/cross-platform.html">
 <span class="dropdown-text">Cross-Platform Workflows</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-developing-methods" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Developing Methods</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-developing-methods">    
        <li>
    <a class="dropdown-item" href="../developing-methods/cca-r-implementation.html">
 <span class="dropdown-text">CCA in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../developing-methods/cca-cpp-implementation.html">
 <span class="dropdown-text">CCA in C++</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-api-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">API Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-api-reference">    
        <li>
    <a class="dropdown-item" href="../api-reference/r/index.html">
 <span class="dropdown-text">R Functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api-reference/cpp/index.html">
 <span class="dropdown-text">C++ API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../technical/performance.html"> 
<span class="menu-text">Technical</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/isglobal-brge/BigDataStatMeth"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://cran.r-project.org/package=BigDataStatMeth"> 
<span class="menu-text">CRAN</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../workflows/implementing-pca.html">Complete Examples</a></li><li class="breadcrumb-item"><a href="../workflows/cross-platform.html">Cross-Platform Workflows</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Complete Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workflows/implementing-pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Implementing PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workflows/implementing-cca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Implementing CCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workflows/cross-platform.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Cross-Platform Workflows</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a>
  <ul class="collapse">
  <li><a href="#what-youll-learn" id="toc-what-youll-learn" class="nav-link" data-scroll-target="#what-youll-learn"><span class="header-section-number">1.1</span> What You’ll Learn</a></li>
  </ul></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites"><span class="header-section-number">2</span> Prerequisites</a>
  <ul class="collapse">
  <li><a href="#python-setup-for-r-users" id="toc-python-setup-for-r-users" class="nav-link" data-scroll-target="#python-setup-for-r-users"><span class="header-section-number">2.1</span> Python Setup for R Users</a></li>
  <li><a href="#load-r-packages" id="toc-load-r-packages" class="nav-link" data-scroll-target="#load-r-packages"><span class="header-section-number">2.2</span> Load R Packages</a></li>
  </ul></li>
  <li><a href="#the-cross-platform-scenario" id="toc-the-cross-platform-scenario" class="nav-link" data-scroll-target="#the-cross-platform-scenario"><span class="header-section-number">3</span> The Cross-Platform Scenario</a></li>
  <li><a href="#step-1-analysis-in-r" id="toc-step-1-analysis-in-r" class="nav-link" data-scroll-target="#step-1-analysis-in-r"><span class="header-section-number">4</span> Step 1: Analysis in R</a>
  <ul class="collapse">
  <li><a href="#create-example-data" id="toc-create-example-data" class="nav-link" data-scroll-target="#create-example-data"><span class="header-section-number">4.1</span> Create Example Data</a></li>
  <li><a href="#store-data-in-hdf5" id="toc-store-data-in-hdf5" class="nav-link" data-scroll-target="#store-data-in-hdf5"><span class="header-section-number">4.2</span> Store Data in HDF5</a></li>
  <li><a href="#add-metadata-using-rhdf5" id="toc-add-metadata-using-rhdf5" class="nav-link" data-scroll-target="#add-metadata-using-rhdf5"><span class="header-section-number">4.3</span> Add Metadata Using rhdf5</a></li>
  <li><a href="#perform-pca" id="toc-perform-pca" class="nav-link" data-scroll-target="#perform-pca"><span class="header-section-number">4.4</span> Perform PCA</a></li>
  </ul></li>
  <li><a href="#step-2-visualization-and-ml-in-python" id="toc-step-2-visualization-and-ml-in-python" class="nav-link" data-scroll-target="#step-2-visualization-and-ml-in-python"><span class="header-section-number">5</span> Step 2: Visualization and ML in Python</a>
  <ul class="collapse">
  <li><a href="#access-hdf5-from-python" id="toc-access-hdf5-from-python" class="nav-link" data-scroll-target="#access-hdf5-from-python"><span class="header-section-number">5.1</span> Access HDF5 from Python</a></li>
  <li><a href="#create-visualizations" id="toc-create-visualizations" class="nav-link" data-scroll-target="#create-visualizations"><span class="header-section-number">5.2</span> Create Visualizations</a></li>
  <li><a href="#train-classifier-on-pcs" id="toc-train-classifier-on-pcs" class="nav-link" data-scroll-target="#train-classifier-on-pcs"><span class="header-section-number">5.3</span> Train Classifier on PCs</a></li>
  </ul></li>
  <li><a href="#step-3-custom-algorithm-in-c" id="toc-step-3-custom-algorithm-in-c" class="nav-link" data-scroll-target="#step-3-custom-algorithm-in-c"><span class="header-section-number">6</span> Step 3: Custom Algorithm in C++</a>
  <ul class="collapse">
  <li><a href="#implement-new-sample-projection" id="toc-implement-new-sample-projection" class="nav-link" data-scroll-target="#implement-new-sample-projection"><span class="header-section-number">6.1</span> Implement New Sample Projection</a></li>
  <li><a href="#compile-and-use" id="toc-compile-and-use" class="nav-link" data-scroll-target="#compile-and-use"><span class="header-section-number">6.2</span> Compile and Use</a></li>
  </ul></li>
  <li><a href="#workflow-summary" id="toc-workflow-summary" class="nav-link" data-scroll-target="#workflow-summary"><span class="header-section-number">7</span> Workflow Summary</a>
  <ul class="collapse">
  <li><a href="#data-flow-diagram" id="toc-data-flow-diagram" class="nav-link" data-scroll-target="#data-flow-diagram"><span class="header-section-number">7.1</span> Data Flow Diagram</a></li>
  <li><a href="#language-selection-guide" id="toc-language-selection-guide" class="nav-link" data-scroll-target="#language-selection-guide"><span class="header-section-number">7.2</span> Language Selection Guide</a></li>
  </ul></li>
  <li><a href="#interactive-exercise" id="toc-interactive-exercise" class="nav-link" data-scroll-target="#interactive-exercise"><span class="header-section-number">8</span> Interactive Exercise</a>
  <ul class="collapse">
  <li><a href="#practice-multi-language-integration" id="toc-practice-multi-language-integration" class="nav-link" data-scroll-target="#practice-multi-language-integration"><span class="header-section-number">8.1</span> Practice: Multi-Language Integration</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">9</span> Key Takeaways</a>
  <ul class="collapse">
  <li><a href="#essential-concepts" id="toc-essential-concepts" class="nav-link" data-scroll-target="#essential-concepts"><span class="header-section-number">9.1</span> Essential Concepts</a></li>
  <li><a href="#when-to-build-cross-platform-workflows" id="toc-when-to-build-cross-platform-workflows" class="nav-link" data-scroll-target="#when-to-build-cross-platform-workflows"><span class="header-section-number">9.2</span> When to Build Cross-Platform Workflows</a></li>
  </ul></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">10</span> Next Steps</a></li>
  <li><a href="#cleanup" id="toc-cleanup" class="nav-link" data-scroll-target="#cleanup"><span class="header-section-number">11</span> Cleanup</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/edit/main/workflows/cross-platform.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../workflows/implementing-pca.html">Complete Examples</a></li><li class="breadcrumb-item"><a href="../workflows/cross-platform.html">Cross-Platform Workflows</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Cross-Platform Workflows</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Using BigDataStatMeth Across R, Python, and C++</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>Modern data science rarely happens in a single language. You might perform initial analysis in R, switch to Python for machine learning, then implement production algorithms in C++. BigDataStatMeth supports this multi-language reality through HDF5’s universal format - one file, multiple platforms, no conversion overhead.</p>
<p>This workflow demonstrates how to use BigDataStatMeth results across R, Python, and C++. You’ll perform PCA in R using BigDataStatMeth, access results in Python for visualization with scikit-learn, and implement a custom analysis in C++ using the BigDataStatMeth library. The HDF5 file acts as the common currency, enabling seamless platform transitions without data duplication or format conversion.</p>
<section id="what-youll-learn" class="level3 learning-objectives" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="what-youll-learn"><span class="header-section-number">1.1</span> What You’ll Learn</h3>
<p>By the end of this workflow, you will:</p>
<ul>
<li>Perform analyses in R and access results in Python</li>
<li>Use h5py in Python to read BigDataStatMeth HDF5 files</li>
<li>Implement custom algorithms in C++ using BigDataStatMeth headers</li>
<li>Understand HDF5 as a cross-platform data exchange format</li>
<li>Navigate file structures consistently across languages</li>
<li>Combine R statistical analysis with Python visualization</li>
<li>Extend BigDataStatMeth functionality in C++</li>
<li>Choose the right language for each analysis step</li>
</ul>
</section>
<hr>
</section>
<section id="prerequisites" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="prerequisites"><span class="header-section-number">2</span> Prerequisites</h2>
<section id="python-setup-for-r-users" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="python-setup-for-r-users"><span class="header-section-number">2.1</span> Python Setup for R Users</h3>
<p>This workflow uses Python from R through the <code>reticulate</code> package. If you haven’t used Python with R before, follow these steps:</p>
<p><strong>Install reticulate and configure Python:</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install reticulate if needed</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"reticulate"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"reticulate"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if Python is available</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">py_config</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>python:         /Users/mailos/.virtualenvs/r-reticulate/bin/python
libpython:      /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/config-3.9-darwin/libpython3.9.dylib
pythonhome:     /Users/mailos/.virtualenvs/r-reticulate:/Users/mailos/.virtualenvs/r-reticulate
version:        3.9.6 (default, Apr 30 2025, 02:07:17)  [Clang 17.0.0 (clang-1700.0.13.5)]
numpy:          /Users/mailos/.virtualenvs/r-reticulate/lib/python3.9/site-packages/numpy
numpy_version:  2.0.2</code></pre>
</div>
</div>
<p><strong>Install h5py Python package:</strong></p>
<p>The first time you run this workflow, you’ll need to install h5py (Python’s HDF5 library):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install h5py in your Python environment</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">py_module_available</span>(<span class="st">"h5py"</span>)) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">py_install</span>(<span class="st">"h5py"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Also install other packages we'll use</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"numpy"</span>, <span class="st">"pandas"</span>, <span class="st">"matplotlib"</span>, <span class="st">"scikit-learn"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> required_packages) {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">py_module_available</span>(pkg)) {</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">py_install</span>(pkg)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using virtual environment '/Users/mailos/.virtualenvs/r-reticulate' ...</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Python Environment Notes
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>If you get “ModuleNotFoundError: No module named ‘h5py’”:</strong></p>
<p>Run <code>py_install("h5py")</code> in R. Reticulate will install it in the appropriate Python environment.</p>
<p><strong>Note:</strong> The package for scikit-learn is installed with <code>py_install("scikit-learn")</code> but imported in Python as <code>import sklearn</code>.</p>
<p><strong>Virtual environments:</strong></p>
<p>Reticulate automatically creates and manages a Python virtual environment for R. You don’t need to manually create one unless you want specific Python version control.</p>
<p><strong>Checking installation:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify h5py is available</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">py_module_available</span>(<span class="st">"h5py"</span>)  <span class="co"># Should return TRUE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>If you continue having issues, check your Python configuration with <code>py_config()</code> and ensure you have Python 3.7+ installed.</p>
</div>
</div>
</section>
<section id="load-r-packages" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="load-r-packages"><span class="header-section-number">2.2</span> Load R Packages</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
</section>
<section id="the-cross-platform-scenario" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-cross-platform-scenario"><span class="header-section-number">3</span> The Cross-Platform Scenario</h2>
<p>We’ll implement a realistic multi-language workflow:</p>
<p><strong>Step 1 (R):</strong> Perform PCA on genomic data using BigDataStatMeth<br>
<strong>Step 2 (Python):</strong> Load results, create advanced visualizations, train classifiers<br>
<strong>Step 3 (C++):</strong> Implement custom projection algorithm for new samples</p>
<p>This mirrors real workflows where different languages excel at different tasks: - R for statistical analysis and data preparation - Python for machine learning and modern visualization libraries - C++ for performance-critical custom algorithms</p>
<hr>
</section>
<section id="step-1-analysis-in-r" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="step-1-analysis-in-r"><span class="header-section-number">4</span> Step 1: Analysis in R</h2>
<section id="create-example-data" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="create-example-data"><span class="header-section-number">4.1</span> Create Example Data</h3>
<p>We’ll create synthetic genomic data with population structure:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>n_snps <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create genotypes with population structure</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>genotypes <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, n_samples <span class="sc">*</span> n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>)),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> n_samples,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> n_snps</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add sample and SNP names</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>sample_ids <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"SAMPLE_"</span>, <span class="fu">sprintf</span>(<span class="st">"%04d"</span>, <span class="dv">1</span><span class="sc">:</span>n_samples))</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>snp_ids <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"rs"</span>, <span class="fu">sprintf</span>(<span class="st">"%07d"</span>, <span class="dv">1</span><span class="sc">:</span>n_snps))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(genotypes) <span class="ot">&lt;-</span> sample_ids</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(genotypes) <span class="ot">&lt;-</span> snp_ids</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample metadata</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>sample_metadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_id =</span> sample_ids,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">population =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"EUR"</span>, <span class="st">"AFR"</span>, <span class="st">"EAS"</span>, <span class="st">"SAS"</span>, <span class="st">"AMR"</span>), <span class="at">each =</span> n_samples<span class="sc">/</span><span class="dv">5</span>),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">sample</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">80</span>, n_samples, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Data created</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data created</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Genotypes:"</span>, <span class="fu">nrow</span>(genotypes), <span class="st">"samples ×"</span>, <span class="fu">ncol</span>(genotypes), <span class="st">"SNPs</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Genotypes: 1000 samples × 5000 SNPs</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Populations:"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(<span class="fu">table</span>(sample_metadata<span class="sc">$</span>population)), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Populations: AFR, AMR, EAS, EUR, SAS </code></pre>
</div>
</div>
</section>
<section id="store-data-in-hdf5" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="store-data-in-hdf5"><span class="header-section-number">4.2</span> Store Data in HDF5</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create HDF5 file</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>cross_platform_file <span class="ot">&lt;-</span> <span class="st">"cross_platform_analysis.hdf5"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Store genotype data</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> cross_platform_file,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> genotypes,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"data"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">TRUE</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fn
[1] "cross_platform_analysis.hdf5"

$ds
[1] "data/genotypes"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Genotypes stored in HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Genotypes stored in HDF5</code></pre>
</div>
</div>
</section>
<section id="add-metadata-using-rhdf5" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="add-metadata-using-rhdf5"><span class="header-section-number">4.3</span> Add Metadata Using rhdf5</h3>
<p>For metadata (mixed data types like population labels, age), use <code>rhdf5</code> directly:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save metadata to HDF5 using rhdf5</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create metadata group</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">h5createGroup</span>(cross_platform_file, <span class="st">"metadata"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Write metadata (rhdf5 handles mixed types automatically)</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">h5write</span>(sample_metadata, cross_platform_file, <span class="st">"metadata/samples"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Metadata stored in HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Metadata stored in HDF5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify file structure</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(cross_platform_file)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      group                name       otype   dclass
0                         /                data   H5I_GROUP         
1                     /data .genotypes_dimnames   H5I_GROUP         
2 /data/.genotypes_dimnames                   1 H5I_DATASET COMPOUND
3 /data/.genotypes_dimnames                   2 H5I_DATASET COMPOUND
4                     /data           genotypes H5I_DATASET  INTEGER
5                         /            metadata   H5I_GROUP         
6                 /metadata             samples H5I_DATASET COMPOUND
          dim
0            
1            
2        1000
3        5000
4 1000 x 5000
5            
6        1000</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to Use rhdf5 vs BigDataStatMeth
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Use BigDataStatMeth functions</strong> (<code>bdCreate_hdf5_matrix</code>) for: - Numeric matrices (genotypes, expression, methylation) - Data that will be used in BigDataStatMeth analyses</p>
<p><strong>Use rhdf5 directly</strong> for: - Metadata with mixed types (characters, factors, integers) - Annotations and sample information - Flexible data structures not used in matrix computations</p>
<p>BigDataStatMeth focuses on matrix operations, while rhdf5 provides general HDF5 I/O.</p>
</div>
</div>
</section>
<section id="perform-pca" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="perform-pca"><span class="header-section-number">4.4</span> Perform PCA</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">bdPCA_hdf5</span>( <span class="at">filename =</span> cross_platform_file, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group =</span> <span class="st">"data"</span>, <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">k =</span> <span class="dv">4</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">bcenter =</span> <span class="cn">TRUE</span>, <span class="at">bscale =</span> <span class="cn">FALSE</span>, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ncomponents =</span> <span class="dv">20</span>, <span class="at">threads =</span> <span class="dv">4</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span> )</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PCA complete in R</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>PCA complete in R</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Results location:"</span>, pca_result<span class="sc">$</span>group, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Results location: </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show what was created</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(cross_platform_file)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        group                name       otype   dclass
0                           /        NORMALIZED_T   H5I_GROUP         
1               /NORMALIZED_T                data   H5I_GROUP         
2          /NORMALIZED_T/data           genotypes H5I_DATASET    FLOAT
3          /NORMALIZED_T/data             mean_sd   H5I_GROUP         
4  /NORMALIZED_T/data/mean_sd      mean.genotypes H5I_DATASET    FLOAT
5  /NORMALIZED_T/data/mean_sd        sd.genotypes H5I_DATASET    FLOAT
6                           /                 PCA   H5I_GROUP         
7                        /PCA           genotypes   H5I_GROUP         
8              /PCA/genotypes          components H5I_DATASET    FLOAT
9              /PCA/genotypes              cumvar H5I_DATASET    FLOAT
10             /PCA/genotypes         ind.contrib H5I_DATASET    FLOAT
11             /PCA/genotypes           ind.coord H5I_DATASET    FLOAT
12             /PCA/genotypes            ind.cos2 H5I_DATASET    FLOAT
13             /PCA/genotypes            ind.dist H5I_DATASET    FLOAT
14             /PCA/genotypes              lambda H5I_DATASET    FLOAT
15             /PCA/genotypes           var.coord H5I_DATASET    FLOAT
16             /PCA/genotypes            var.cos2 H5I_DATASET    FLOAT
17             /PCA/genotypes            variance H5I_DATASET    FLOAT
18                          /                 SVD   H5I_GROUP         
19                       /SVD           genotypes   H5I_GROUP         
20             /SVD/genotypes                   d H5I_DATASET    FLOAT
21             /SVD/genotypes                   u H5I_DATASET    FLOAT
22             /SVD/genotypes                   v H5I_DATASET    FLOAT
23                          /                data   H5I_GROUP         
24                      /data .genotypes_dimnames   H5I_GROUP         
25  /data/.genotypes_dimnames                   1 H5I_DATASET COMPOUND
26  /data/.genotypes_dimnames                   2 H5I_DATASET COMPOUND
27                      /data           genotypes H5I_DATASET  INTEGER
28                          /            metadata   H5I_GROUP         
29                  /metadata             samples H5I_DATASET COMPOUND
30                          /         predictions H5I_DATASET   STRING
           dim
0             
1             
2  1000 x 5000
3             
4     5000 x 1
5     5000 x 1
6             
7             
8  1000 x 1000
9     1000 x 1
10 1000 x 1000
11 1000 x 1000
12 1000 x 1000
13    1000 x 1
14    1000 x 1
15 1000 x 5000
16 1000 x 5000
17    1000 x 1
18            
19            
20    1 x 1000
21 1000 x 1000
22 5000 x 1000
23            
24            
25        1000
26        5000
27 1000 x 5000
28            
29        1000
30         200</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="step-2-visualization-and-ml-in-python" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="step-2-visualization-and-ml-in-python"><span class="header-section-number">5</span> Step 2: Visualization and ML in Python</h2>
<section id="access-hdf5-from-python" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="access-hdf5-from-python"><span class="header-section-number">5.1</span> Access HDF5 from Python</h3>
<p>Switch to Python to access the same HDF5 file. We’ll use the <code>reticulate</code> package to run Python code from R:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open HDF5 file in read/write mode</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> h5py.File(<span class="st">'cross_platform_analysis.hdf5'</span>, <span class="st">'r+'</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co"># List contents</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"HDF5 file structure:"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>HDF5 file structure:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_structure(name, obj):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>f.visititems(print_structure)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>NORMALIZED_T
NORMALIZED_T/data
NORMALIZED_T/data/genotypes
NORMALIZED_T/data/mean_sd
NORMALIZED_T/data/mean_sd/mean.genotypes
NORMALIZED_T/data/mean_sd/sd.genotypes
PCA
PCA/genotypes
PCA/genotypes/components
PCA/genotypes/cumvar
PCA/genotypes/ind.contrib
PCA/genotypes/ind.coord
PCA/genotypes/ind.cos2
PCA/genotypes/ind.dist
PCA/genotypes/lambda
PCA/genotypes/var.coord
PCA/genotypes/var.cos2
PCA/genotypes/variance
SVD
SVD/genotypes
SVD/genotypes/d
SVD/genotypes/u
SVD/genotypes/v
data
data/.genotypes_dimnames
data/.genotypes_dimnames/1
data/.genotypes_dimnames/2
data/genotypes
metadata
metadata/samples</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load PCA components</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> f[<span class="st">'PCA/genotypes/components'</span>][:]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>variance_explained <span class="op">=</span> f[<span class="st">'PCA/genotypes/variance'</span>][:]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure variance_explained is 1D array</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>variance_explained <span class="op">=</span> np.array(variance_explained).flatten()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load metadata</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>metadata_raw <span class="op">=</span> f[<span class="st">'metadata/samples'</span>]</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> pd.DataFrame({</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sample_id'</span>: metadata_raw[<span class="st">'sample_id'</span>][:],</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'population'</span>: metadata_raw[<span class="st">'population'</span>][:],</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: metadata_raw[<span class="st">'age'</span>][:]</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Decode byte strings to regular strings</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'sample_id'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'sample_id'</span>]]</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'population'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'population'</span>]]</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">✓ Data loaded in Python"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
✓ Data loaded in Python</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Components shape: </span><span class="sc">{</span>components<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Components shape: (1000, 1000)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Metadata shape: </span><span class="sc">{</span>metadata<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Metadata shape: (1000, 3)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Populations: </span><span class="sc">{</span>metadata[<span class="st">'population'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Populations: ['EUR' 'AFR' 'EAS' 'SAS' 'AMR']</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Decoding String Data in Python
</div>
</div>
<div class="callout-body-container callout-body">
<p>HDF5 stores strings as bytes. When reading in Python, decode them:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Byte strings need decoding</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'sample_id'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'sample_id'</span>]]</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'population'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'population'</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This converts byte strings like <code>b'SAMPLE_0001'</code> to regular strings <code>'SAMPLE_0001'</code>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Using Python Directly (Without Reticulate)
</div>
</div>
<div class="callout-body-container callout-body">
<p>This workflow uses Python from R through <code>reticulate</code> for convenience in a single document. However, you can work with the HDF5 file using Python independently:</p>
<p><strong>Option 1: Standalone Python script</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save your Python code to analyze_hdf5.py</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Run from terminal</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> analyze_hdf5.py</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Option 2: Interactive Python session</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch Python directly</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then work with HDF5</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> import <span class="ex">h5py</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> f <span class="ex">=</span> h5py.File<span class="er">(</span><span class="st">'cross_platform_analysis.hdf5'</span><span class="ex">,</span> <span class="st">'r'</span><span class="kw">)</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> components <span class="ex">=</span> f<span class="pp">[</span><span class="st">'PCA/genotypes/components'</span><span class="pp">][</span><span class="ss">:</span><span class="pp">]</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># ... continue analysis</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Option 3: Jupyter notebook</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In Jupyter notebook</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> h5py.File(<span class="st">'cross_platform_analysis.hdf5'</span>, <span class="st">'r'</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ... analysis code</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The HDF5 file format is the same regardless of how you access it. Choose reticulate for integrated R/Python workflows, or use Python standalone when that fits your development environment better. The key advantage is that the same HDF5 file works seamlessly in both contexts without any conversion.</p>
</div>
</div>
</section>
<section id="create-visualizations" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="create-visualizations"><span class="header-section-number">5.2</span> Create Visualizations</h3>
<p>Generate publication-quality plots in Python:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 2x2 subplot figure</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">12</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for populations</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>pop_colors <span class="op">=</span> {</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'EUR'</span>: <span class="st">'#1f77b4'</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AFR'</span>: <span class="st">'#ff7f0e'</span>, </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'EAS'</span>: <span class="st">'#2ca02c'</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SAS'</span>: <span class="st">'#d62728'</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AMR'</span>: <span class="st">'#9467bd'</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: PC1 vs PC2 by population</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> pop_colors.keys():</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> metadata[<span class="st">'population'</span>] <span class="op">==</span> pop</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    ax.scatter(components[mask, <span class="dv">0</span>], components[mask, <span class="dv">1</span>], </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>               c<span class="op">=</span>pop_colors[pop], label<span class="op">=</span>pop, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'PC1'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'PC2'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'PCA: Populations in PC1-PC2 Space'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: Scree plot</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>n_components <span class="op">=</span> <span class="bu">len</span>(variance_explained)</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>ax.bar(<span class="bu">range</span>(<span class="dv">1</span>, n_components <span class="op">+</span> <span class="dv">1</span>), variance_explained <span class="op">*</span> <span class="dv">100</span>, </span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>       color<span class="op">=</span><span class="st">'steelblue'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Principal Component'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Variance Explained (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Scree Plot'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3: PC1 by age (colored by population)</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> pop_colors.keys():</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> metadata[<span class="st">'population'</span>] <span class="op">==</span> pop</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>    ax.scatter(metadata.loc[mask, <span class="st">'age'</span>], components[mask, <span class="dv">0</span>],</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>               c<span class="op">=</span>pop_colors[pop], label<span class="op">=</span>pop, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Age'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'PC1'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'PC1 vs Age by Population'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 4: Cumulative variance</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>cumvar <span class="op">=</span> np.cumsum(variance_explained) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>ax.plot(<span class="bu">range</span>(<span class="dv">1</span>, n_components <span class="op">+</span> <span class="dv">1</span>), cumvar, </span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, color<span class="op">=</span><span class="st">'darkred'</span>)</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">80</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'80% threshold'</span>)</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Number of Components'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Cumulative Variance Explained (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Cumulative Variance Explained'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'pca_python_visualization.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cross-platform_files/figure-html/python-plots-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Plots created and saved"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Plots created and saved</code></pre>
</div>
</div>
</section>
<section id="train-classifier-on-pcs" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="train-classifier-on-pcs"><span class="header-section-number">5.3</span> Train Classifier on PCs</h3>
<p>Use principal components as features for population classification:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required libraries</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reload data (variables don't persist between Python chunks)</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> h5py.File(<span class="st">'cross_platform_analysis.hdf5'</span>, <span class="st">'r+'</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> f[<span class="st">'PCA/genotypes/components'</span>][:]</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>metadata_raw <span class="op">=</span> f[<span class="st">'metadata/samples'</span>]</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> pd.DataFrame({</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sample_id'</span>: metadata_raw[<span class="st">'sample_id'</span>][:],</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'population'</span>: metadata_raw[<span class="st">'population'</span>][:],</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: metadata_raw[<span class="st">'age'</span>][:]</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'population'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'population'</span>]]</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> components[:, :<span class="dv">10</span>]  <span class="co"># Use first 10 PCs</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> metadata[<span class="st">'population'</span>].values</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Split train/test</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Random Forest</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(random_state=42)</pre></div> </div></div></div></div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rf.predict(X_test)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_test, y_pred)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">✓ Random Forest trained"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
✓ Random Forest trained</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Accuracy: 0.210</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification Report:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

         AFR       0.19      0.20      0.20        40
         AMR       0.14      0.15      0.14        40
         EAS       0.24      0.30      0.26        40
         EUR       0.21      0.15      0.18        40
         SAS       0.29      0.25      0.27        40

    accuracy                           0.21       200
   macro avg       0.21      0.21      0.21       200
weighted avg       0.21      0.21      0.21       200</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save predictions back to HDF5 (file remains open for later use)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'predictions'</span> <span class="kw">in</span> f:</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> f[<span class="st">'predictions'</span>]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>f.create_dataset(<span class="st">'predictions'</span>, data<span class="op">=</span>y_pred.astype(<span class="st">'S10'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;HDF5 dataset "predictions": shape (200,), type "|S10"&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">✓ Predictions saved to HDF5"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
✓ Predictions saved to HDF5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ HDF5 file closed, ready for R/C++ access"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ HDF5 file closed, ready for R/C++ access</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close HDF5 file to allow R to access it</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Python HDF5 file closed"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Python HDF5 file closed</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="step-3-custom-algorithm-in-c" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="step-3-custom-algorithm-in-c"><span class="header-section-number">6</span> Step 3: Custom Algorithm in C++</h2>
<section id="implement-new-sample-projection" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="implement-new-sample-projection"><span class="header-section-number">6.1</span> Implement New Sample Projection</h3>
<p>Create a C++ function to project new samples onto existing PC space:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb63"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">// File: project_samples.cpp</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"BigDataStatMeth.hpp"</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> BigDataStatMeth<span class="op">;</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>NumericMatrix projectNewSamples<span class="op">(</span><span class="bu">std::</span>string filename<span class="op">,</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="bu">std::</span>string new_data_path<span class="op">,</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="bu">std::</span>string pc_path<span class="op">,</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="dt">int</span> n_components<span class="op">)</span> <span class="op">{</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    hdf5Dataset<span class="op">*</span> dsData <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    hdf5Dataset<span class="op">*</span> dsPC <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Open datasets</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>        dsData <span class="op">=</span> <span class="kw">new</span> hdf5Dataset<span class="op">(</span>filename<span class="op">,</span> new_data_path<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>        dsData<span class="op">-&gt;</span>openDataset<span class="op">();</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>        dsPC <span class="op">=</span> <span class="kw">new</span> hdf5Dataset<span class="op">(</span>filename<span class="op">,</span> pc_path<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>        dsPC<span class="op">-&gt;</span>openDataset<span class="op">();</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> n_samples <span class="op">=</span> dsData<span class="op">-&gt;</span>nrows<span class="op">();</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> n_features <span class="op">=</span> dsData<span class="op">-&gt;</span>ncols<span class="op">();</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Read new sample data</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> new_data<span class="op">(</span>n_samples <span class="op">*</span> n_features<span class="op">);</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>        dsData<span class="op">-&gt;</span>readDatasetBlock<span class="op">(</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">},</span> <span class="op">{(</span><span class="dt">hsize_t</span><span class="op">)</span>n_samples<span class="op">,</span> <span class="op">(</span><span class="dt">hsize_t</span><span class="op">)</span>n_features<span class="op">},</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> new_data<span class="op">.</span>data<span class="op">()</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Read PC loadings</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> pc_loadings<span class="op">(</span>n_features <span class="op">*</span> n_components<span class="op">);</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>        dsPC<span class="op">-&gt;</span>readDatasetBlock<span class="op">(</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">},</span> <span class="op">{(</span><span class="dt">hsize_t</span><span class="op">)</span>n_features<span class="op">,</span> <span class="op">(</span><span class="dt">hsize_t</span><span class="op">)</span>n_components<span class="op">},</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> pc_loadings<span class="op">.</span>data<span class="op">()</span></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Project: scores = data %*% loadings</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>        NumericMatrix scores<span class="op">(</span>n_samples<span class="op">,</span> n_components<span class="op">);</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n_samples<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> n_components<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>                <span class="dt">double</span> sum <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> n_features<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>                    sum <span class="op">+=</span> new_data<span class="op">[</span>i <span class="op">*</span> n_features <span class="op">+</span> k<span class="op">]</span> <span class="op">*</span> </span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>                           pc_loadings<span class="op">[</span>k <span class="op">*</span> n_components <span class="op">+</span> j<span class="op">];</span></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>                scores<span class="op">(</span>i<span class="op">,</span> j<span class="op">)</span> <span class="op">=</span> sum<span class="op">;</span></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Cleanup</span></span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">delete</span> dsData<span class="op">;</span></span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">delete</span> dsPC<span class="op">;</span></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> scores<span class="op">;</span></span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span><span class="op">(</span><span class="bu">std::</span>exception<span class="op">&amp;</span> ex<span class="op">)</span> <span class="op">{</span></span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>dsData<span class="op">)</span> <span class="kw">delete</span> dsData<span class="op">;</span></span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>dsPC<span class="op">)</span> <span class="kw">delete</span> dsPC<span class="op">;</span></span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a>        Rcpp<span class="op">::</span>stop<span class="op">(</span><span class="st">"Error in projectNewSamples: "</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>ex<span class="op">.</span>what<span class="op">()));</span></span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="compile-and-use" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="compile-and-use"><span class="header-section-number">6.2</span> Compile and Use</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set include path for BigDataStatMeth headers</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">PKG_CXXFLAGS =</span> <span class="fu">paste0</span>(</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-I"</span>, <span class="fu">system.file</span>(<span class="st">"include"</span>, <span class="at">package =</span> <span class="st">"BigDataStatMeth"</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: To compile the C++ code above, save it to project_samples.cpp</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Then run: sourceCpp("project_samples.cpp")</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co"># For this demo, we'll simulate the process</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new samples to project</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>new_genotypes <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">50</span> <span class="sc">*</span> n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>)),</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">50</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> n_snps</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to HDF5 file</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> cross_platform_file,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> new_genotypes,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"new_data"</span>,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">FALSE</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fn
[1] "cross_platform_analysis.hdf5"

$ds
[1] "new_data/genotypes"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"New sample data added to HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>New sample data added to HDF5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Ready for C++ projection (compile project_samples.cpp first)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Ready for C++ projection (compile project_samples.cpp first)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># After compiling project_samples.cpp:</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># new_scores &lt;- projectNewSamples(</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   filename = cross_platform_file,</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   new_data_path = "new_data/genotypes",</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   pc_path = "PCA/genotypes/rotation",</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   n_components = 10</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
</section>
<section id="workflow-summary" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="workflow-summary"><span class="header-section-number">7</span> Workflow Summary</h2>
<section id="data-flow-diagram" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="data-flow-diagram"><span class="header-section-number">7.1</span> Data Flow Diagram</h3>
<pre><code>R (BigDataStatMeth)
  ↓ Creates
HDF5 File
  ├─ /data/genotypes          [Created by R]
  ├─ /metadata/samples        [Created by R with rhdf5]
  ├─ /PCA/genotypes/*         [Created by R]
  ↓ Read by
Python (h5py)
  ├─ Loads components
  ├─ Creates visualizations
  ├─ Trains ML models
  ↓ Writes
  ├─ /predictions             [Created by Python]
  ↓ Read by
C++ (BigDataStatMeth.hpp)
  ├─ Projects new samples
  └─ Returns to R</code></pre>
</section>
<section id="language-selection-guide" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="language-selection-guide"><span class="header-section-number">7.2</span> Language Selection Guide</h3>
<p><strong>Use R when:</strong> - Performing standard statistical analyses - Initial data exploration - Using BigDataStatMeth functions - Working with data frames and factors</p>
<p><strong>Use Python when:</strong> - Need modern ML libraries (scikit-learn, TensorFlow) - Creating publication plots (matplotlib, seaborn) - Integrating with Python-only tools - Collaborating with Python-focused teams</p>
<p><strong>Use C++ when:</strong> - Performance is critical - Implementing custom algorithms - Need fine-grained memory control - Building production systems</p>
<p><strong>The key:</strong> HDF5 lets you use the best tool for each task without conversion overhead.</p>
<hr>
</section>
</section>
<section id="interactive-exercise" class="level2 exercise" data-number="8">
<h2 class="exercise anchored" data-number="8" data-anchor-id="interactive-exercise"><span class="header-section-number">8</span> Interactive Exercise</h2>
<section id="practice-multi-language-integration" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="practice-multi-language-integration"><span class="header-section-number">8.1</span> Practice: Multi-Language Integration</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 1: Add more metadata</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Store additional sample annotations in HDF5</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Access them from Python for plotting</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 2: Python preprocessing</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement outlier detection in Python</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Save outlier flags back to HDF5</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use flags in R for filtering</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 3: C++ feature engineering</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create C++ function to compute SNP statistics</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Store results in HDF5</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize in Python</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 4: Compare performance</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement same algorithm in R, Python, C++</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Time each version</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="co"># When is C++ worth the complexity?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Reflection Questions
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>1. Platform Choices:</strong> - When does multi-language workflow add value vs.&nbsp;complexity? - Could you do everything in one language? - What are the maintenance costs?</p>
<p><strong>2. HDF5 Benefits:</strong> - How does HDF5 compare to CSV/RDS/pickle for cross-platform work? - When would you NOT use HDF5? - What about data versioning?</p>
<p><strong>3. Performance Trade-offs:</strong> - Python ML vs R caret—does it matter? - When is C++ optimization worth development time? - How do you profile multi-language workflows?</p>
<p><strong>4. Collaboration:</strong> - Team has R and Python users—best practices? - How to ensure reproducibility across platforms? - Documentation strategies?</p>
<p><strong>5. Debugging:</strong> - Error in Python step—how do you debug? - HDF5 file corrupted—recovery strategies? - Version compatibility issues?</p>
</div>
</div>
<hr>
</section>
</section>
<section id="key-takeaways" class="level2 key-concept" data-number="9">
<h2 class="key-concept anchored" data-number="9" data-anchor-id="key-takeaways"><span class="header-section-number">9</span> Key Takeaways</h2>
<p>Let’s consolidate what you’ve learned about cross-platform workflows with BigDataStatMeth.</p>
<section id="essential-concepts" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="essential-concepts"><span class="header-section-number">9.1</span> Essential Concepts</h3>
<p><strong>HDF5 is the universal data currency across platforms.</strong> One HDF5 file works identically in R, Python, C++, MATLAB, Julia, and command-line tools. You never export to CSV, save to RDS, pickle for Python, then convert back—the HDF5 file is the single source of truth. BigDataStatMeth creates HDF5 files that any platform can read, and results added by Python or C++ are immediately available back in R. This eliminates conversion overhead and version mismatches that plague multi-language workflows.</p>
<p><strong>Each language has natural strengths worth leveraging.</strong> R excels at statistical analysis and data manipulation with data frames. Python dominates machine learning with scikit-learn and deep learning with PyTorch. C++ provides performance for custom algorithms and production deployment. Rather than forcing everything into one language, use each where it shines. The HDF5 format makes this practical—you’re not punished for switching languages because there’s no conversion penalty.</p>
<p><strong>Mixed data types require different tools.</strong> BigDataStatMeth functions like <code>bdCreate_hdf5_matrix()</code> are optimized for numeric matrices used in computations. For metadata with mixed types (character labels, factors, mixed numeric/character columns), use <code>rhdf5</code> directly with <code>h5write()</code>. This distinction is important—trying to store a data frame with <code>bdCreate_hdf5_matrix()</code> will fail or produce unexpected results. Use the right tool for the data type.</p>
<p><strong>Python string decoding is a common gotcha.</strong> HDF5 stores strings as bytes, and Python’s h5py returns them as byte strings like <code>b'EUR'</code>. You must decode them to regular strings: <code>s.decode('utf-8')</code>. This is especially important for metadata like population labels or sample IDs that you’ll use for grouping or filtering. If your Python plots show <code>b'EUR'</code> instead of <code>EUR</code> in legends, you forgot to decode.</p>
<p><strong>Reticulate bridges R and Python seamlessly.</strong> You don’t need to save data from R, exit, run Python script, then reload in R. Reticulate runs Python directly from R, with automatic data conversion for simple types. For complex workflows, Python writes results to HDF5, then R reads them—but for interactive analysis, you can run Python chunks in the same R session. The <code>py_install()</code> function handles Python package installation without leaving R. However, you can also use Python independently if that fits your workflow better.</p>
<p><strong>C++ optimization requires clear performance justification.</strong> Writing C++ code takes longer than R or Python, debugging is harder, and maintenance is more complex. Only move to C++ when profiling shows a bottleneck that C++ would solve. For this workflow, the projection algorithm could run in R—C++ is shown for educational purposes. In production, if you’re projecting millions of samples thousands of times, C++ pays off. For one-time analysis, R is faster development-to-result.</p>
</section>
<section id="when-to-build-cross-platform-workflows" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="when-to-build-cross-platform-workflows"><span class="header-section-number">9.2</span> When to Build Cross-Platform Workflows</h3>
<p>Understanding when multi-language workflows add value versus when they add unnecessary complexity guides effective development.</p>
<p>✅ <strong>Use cross-platform workflows when:</strong></p>
<ul>
<li><p><strong>Team has multi-language expertise</strong> - If some members prefer R, others Python, and you have C++ developers, letting each use their strength increases productivity. Fighting this by forcing everyone into one language reduces efficiency.</p></li>
<li><p><strong>Different steps need different tools</strong> - Statistical analysis naturally fits R, deep learning needs Python (PyTorch/TensorFlow), and real-time inference needs C++. Using the best tool for each step produces better results than forcing everything into one language’s ecosystem.</p></li>
<li><p><strong>Performance bottlenecks are specific</strong> - If 95% of your workflow runs fine in R but 5% is a computational bottleneck, rewrite that 5% in C++ rather than the entire pipeline. Cross-platform workflows enable surgical optimization.</p></li>
<li><p><strong>Interfacing with external systems</strong> - If your organization’s ML infrastructure is Python but your statisticians use R, HDF5 bridges the gap. You can’t change the external systems, so you adapt your workflow to interface cleanly.</p></li>
<li><p><strong>Leveraging specialized libraries</strong> - If the perfect algorithm for your problem exists in Python (scikit-learn) but your data pipeline is in R, use both. Reimplementing complex algorithms to stay in one language wastes time and introduces bugs.</p></li>
</ul>
<p>✅ <strong>Stick to single language when:</strong></p>
<ul>
<li><p><strong>One language does everything adequately</strong> - If R’s randomForest does what you need, don’t switch to Python’s scikit-learn just because you can. Simplicity has value—fewer dependencies, easier maintenance, clearer workflow.</p></li>
<li><p><strong>Team is mono-lingual</strong> - If everyone knows R but nobody knows Python, adding Python creates training burden and maintenance problems. The “right” language is the one your team can actually use and maintain.</p></li>
<li><p><strong>Analysis is exploratory and one-off</strong> - For quick exploratory analyses you’ll run once, stay in whatever you started with. The overhead of setting up multi-language workflow exceeds the benefit for one-time scripts.</p></li>
<li><p><strong>Reproducibility is critical</strong> - Multi-language workflows have more failure points (Python version, package conflicts, compiler issues). If this analysis will be cited in papers or used in regulatory submissions, minimize complexity.</p></li>
<li><p><strong>Performance is adequate</strong> - If R takes 10 minutes and C++ would take 2 minutes, but you run it monthly, don’t optimize. Save development time for frequent bottlenecks.</p></li>
</ul>
<p>The key principle: use multiple languages when the benefits (performance, specialized tools, team expertise) clearly outweigh the costs (complexity, maintenance, debugging difficulty). HDF5 makes multi-language workflows practical, but practical doesn’t always mean necessary.</p>
<hr>
</section>
</section>
<section id="next-steps" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">10</span> Next Steps</h2>
<p><strong>Explore language-specific resources:</strong></p>
<ul>
<li><a href="../developing-methods/cca-r-implementation.html">R implementation details</a></li>
<li><a href="../developing-methods/cca-cpp-implementation.html">C++ implementation guide</a></li>
</ul>
<p><strong>Extend this workflow:</strong></p>
<ul>
<li>Add quality control steps in each language</li>
<li>Implement parallel processing in C++</li>
<li>Create interactive visualizations with Python’s plotly</li>
<li>Build Shiny app in R consuming Python ML results</li>
</ul>
<p><strong>Advanced topics:</strong></p>
<ul>
<li>Apache Arrow for even faster cross-language data sharing</li>
<li>Docker containers for reproducible multi-language environments</li>
<li>Workflow managers (Snakemake, Nextflow) for complex pipelines</li>
<li>Testing strategies for multi-language code</li>
</ul>
<hr>
</section>
<section id="cleanup" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="cleanup"><span class="header-section-number">11</span> Cleanup</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close HDF5 connections</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Python file already closed before C++ step</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cross_platform_analysis.hdf5 contains complete workflow</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessible from R, Python, and C++ without conversion</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/isglobal-brge\.github\.io\/BigDataStatMeth\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb74" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Cross-Platform Workflows"</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Using BigDataStatMeth Across R, Python, and C++"</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>Modern data science rarely happens in a single language. You might perform initial analysis in R, switch to Python for machine learning, then implement production algorithms in C++. BigDataStatMeth supports this multi-language reality through HDF5's universal format - one file, multiple platforms, no conversion overhead.</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>This workflow demonstrates how to use BigDataStatMeth results across R, Python, and C++. You'll perform PCA in R using BigDataStatMeth, access results in Python for visualization with scikit-learn, and implement a custom analysis in C++ using the BigDataStatMeth library. The HDF5 file acts as the common currency, enabling seamless platform transitions without data duplication or format conversion.</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>::: learning-objectives</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="fu">### What You'll Learn</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>By the end of this workflow, you will:</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Perform analyses in R and access results in Python</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use h5py in Python to read BigDataStatMeth HDF5 files</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Implement custom algorithms in C++ using BigDataStatMeth headers</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand HDF5 as a cross-platform data exchange format</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Navigate file structures consistently across languages</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Combine R statistical analysis with Python visualization</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Extend BigDataStatMeth functionality in C++</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Choose the right language for each analysis step</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prerequisites</span></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python Setup for R Users</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>This workflow uses Python from R through the <span class="in">`reticulate`</span> package. If you haven't used Python with R before, follow these steps:</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>**Install reticulate and configure Python:**</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup-python, eval=TRUE}</span></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Install reticulate if needed</span></span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"reticulate"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"reticulate"</span>)</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if Python is available</span></span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a><span class="fu">py_config</span>()</span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a>**Install h5py Python package:**</span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a>The first time you run this workflow, you'll need to install h5py (Python's HDF5 library):</span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r install-h5py, eval=TRUE}</span></span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Install h5py in your Python environment</span></span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">py_module_available</span>(<span class="st">"h5py"</span>)) {</span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">py_install</span>(<span class="st">"h5py"</span>)</span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-59"><a href="#cb74-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Also install other packages we'll use</span></span>
<span id="cb74-60"><a href="#cb74-60" aria-hidden="true" tabindex="-1"></a>required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"numpy"</span>, <span class="st">"pandas"</span>, <span class="st">"matplotlib"</span>, <span class="st">"scikit-learn"</span>)</span>
<span id="cb74-61"><a href="#cb74-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> required_packages) {</span>
<span id="cb74-62"><a href="#cb74-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">py_module_available</span>(pkg)) {</span>
<span id="cb74-63"><a href="#cb74-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">py_install</span>(pkg)</span>
<span id="cb74-64"><a href="#cb74-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-65"><a href="#cb74-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-66"><a href="#cb74-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-67"><a href="#cb74-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-68"><a href="#cb74-68" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb74-69"><a href="#cb74-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Python Environment Notes</span></span>
<span id="cb74-70"><a href="#cb74-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-71"><a href="#cb74-71" aria-hidden="true" tabindex="-1"></a>**If you get "ModuleNotFoundError: No module named 'h5py'":**</span>
<span id="cb74-72"><a href="#cb74-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-73"><a href="#cb74-73" aria-hidden="true" tabindex="-1"></a>Run <span class="in">`py_install("h5py")`</span> in R. Reticulate will install it in the appropriate Python environment.</span>
<span id="cb74-74"><a href="#cb74-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-75"><a href="#cb74-75" aria-hidden="true" tabindex="-1"></a>**Note:** The package for scikit-learn is installed with <span class="in">`py_install("scikit-learn")`</span> but imported in Python as <span class="in">`import sklearn`</span>.</span>
<span id="cb74-76"><a href="#cb74-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-77"><a href="#cb74-77" aria-hidden="true" tabindex="-1"></a>**Virtual environments:**</span>
<span id="cb74-78"><a href="#cb74-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-79"><a href="#cb74-79" aria-hidden="true" tabindex="-1"></a>Reticulate automatically creates and manages a Python virtual environment for R. You don't need to manually create one unless you want specific Python version control.</span>
<span id="cb74-80"><a href="#cb74-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-81"><a href="#cb74-81" aria-hidden="true" tabindex="-1"></a>**Checking installation:**</span>
<span id="cb74-82"><a href="#cb74-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-83"><a href="#cb74-83" aria-hidden="true" tabindex="-1"></a><span class="in">``` r</span></span>
<span id="cb74-84"><a href="#cb74-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify h5py is available</span></span>
<span id="cb74-85"><a href="#cb74-85" aria-hidden="true" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">py_module_available</span>(<span class="st">"h5py"</span>)  <span class="co"># Should return TRUE</span></span>
<span id="cb74-86"><a href="#cb74-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-87"><a href="#cb74-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-88"><a href="#cb74-88" aria-hidden="true" tabindex="-1"></a>If you continue having issues, check your Python configuration with <span class="in">`py_config()`</span> and ensure you have Python 3.7+ installed.</span>
<span id="cb74-89"><a href="#cb74-89" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb74-90"><a href="#cb74-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-91"><a href="#cb74-91" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load R Packages</span></span>
<span id="cb74-92"><a href="#cb74-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-93"><a href="#cb74-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup-packages, eval=TRUE}</span></span>
<span id="cb74-94"><a href="#cb74-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb74-95"><a href="#cb74-95" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb74-96"><a href="#cb74-96" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb74-97"><a href="#cb74-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-98"><a href="#cb74-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-99"><a href="#cb74-99" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-100"><a href="#cb74-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-101"><a href="#cb74-101" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Cross-Platform Scenario</span></span>
<span id="cb74-102"><a href="#cb74-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-103"><a href="#cb74-103" aria-hidden="true" tabindex="-1"></a>We'll implement a realistic multi-language workflow:</span>
<span id="cb74-104"><a href="#cb74-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-105"><a href="#cb74-105" aria-hidden="true" tabindex="-1"></a>**Step 1 (R):** Perform PCA on genomic data using BigDataStatMeth\</span>
<span id="cb74-106"><a href="#cb74-106" aria-hidden="true" tabindex="-1"></a>**Step 2 (Python):** Load results, create advanced visualizations, train classifiers\</span>
<span id="cb74-107"><a href="#cb74-107" aria-hidden="true" tabindex="-1"></a>**Step 3 (C++):** Implement custom projection algorithm for new samples</span>
<span id="cb74-108"><a href="#cb74-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-109"><a href="#cb74-109" aria-hidden="true" tabindex="-1"></a>This mirrors real workflows where different languages excel at different tasks: - R for statistical analysis and data preparation - Python for machine learning and modern visualization libraries - C++ for performance-critical custom algorithms</span>
<span id="cb74-110"><a href="#cb74-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-111"><a href="#cb74-111" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-112"><a href="#cb74-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-113"><a href="#cb74-113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1: Analysis in R</span></span>
<span id="cb74-114"><a href="#cb74-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-115"><a href="#cb74-115" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create Example Data</span></span>
<span id="cb74-116"><a href="#cb74-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-117"><a href="#cb74-117" aria-hidden="true" tabindex="-1"></a>We'll create synthetic genomic data with population structure:</span>
<span id="cb74-118"><a href="#cb74-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-119"><a href="#cb74-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-data, eval=TRUE}</span></span>
<span id="cb74-120"><a href="#cb74-120" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb74-121"><a href="#cb74-121" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb74-122"><a href="#cb74-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-123"><a href="#cb74-123" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb74-124"><a href="#cb74-124" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb74-125"><a href="#cb74-125" aria-hidden="true" tabindex="-1"></a>n_snps <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb74-126"><a href="#cb74-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-127"><a href="#cb74-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Create genotypes with population structure</span></span>
<span id="cb74-128"><a href="#cb74-128" aria-hidden="true" tabindex="-1"></a>genotypes <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb74-129"><a href="#cb74-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, n_samples <span class="sc">*</span> n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>)),</span>
<span id="cb74-130"><a href="#cb74-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> n_samples,</span>
<span id="cb74-131"><a href="#cb74-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> n_snps</span>
<span id="cb74-132"><a href="#cb74-132" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-133"><a href="#cb74-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-134"><a href="#cb74-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Add sample and SNP names</span></span>
<span id="cb74-135"><a href="#cb74-135" aria-hidden="true" tabindex="-1"></a>sample_ids <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"SAMPLE_"</span>, <span class="fu">sprintf</span>(<span class="st">"%04d"</span>, <span class="dv">1</span><span class="sc">:</span>n_samples))</span>
<span id="cb74-136"><a href="#cb74-136" aria-hidden="true" tabindex="-1"></a>snp_ids <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"rs"</span>, <span class="fu">sprintf</span>(<span class="st">"%07d"</span>, <span class="dv">1</span><span class="sc">:</span>n_snps))</span>
<span id="cb74-137"><a href="#cb74-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-138"><a href="#cb74-138" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(genotypes) <span class="ot">&lt;-</span> sample_ids</span>
<span id="cb74-139"><a href="#cb74-139" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(genotypes) <span class="ot">&lt;-</span> snp_ids</span>
<span id="cb74-140"><a href="#cb74-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-141"><a href="#cb74-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample metadata</span></span>
<span id="cb74-142"><a href="#cb74-142" aria-hidden="true" tabindex="-1"></a>sample_metadata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb74-143"><a href="#cb74-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_id =</span> sample_ids,</span>
<span id="cb74-144"><a href="#cb74-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">population =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"EUR"</span>, <span class="st">"AFR"</span>, <span class="st">"EAS"</span>, <span class="st">"SAS"</span>, <span class="st">"AMR"</span>), <span class="at">each =</span> n_samples<span class="sc">/</span><span class="dv">5</span>),</span>
<span id="cb74-145"><a href="#cb74-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">sample</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">80</span>, n_samples, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb74-146"><a href="#cb74-146" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb74-147"><a href="#cb74-147" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-148"><a href="#cb74-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-149"><a href="#cb74-149" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Data created</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-150"><a href="#cb74-150" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Genotypes:"</span>, <span class="fu">nrow</span>(genotypes), <span class="st">"samples ×"</span>, <span class="fu">ncol</span>(genotypes), <span class="st">"SNPs</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-151"><a href="#cb74-151" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Populations:"</span>, <span class="fu">paste</span>(<span class="fu">names</span>(<span class="fu">table</span>(sample_metadata<span class="sc">$</span>population)), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-152"><a href="#cb74-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-153"><a href="#cb74-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-154"><a href="#cb74-154" aria-hidden="true" tabindex="-1"></a><span class="fu">### Store Data in HDF5</span></span>
<span id="cb74-155"><a href="#cb74-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-156"><a href="#cb74-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r store-hdf5, eval=TRUE}</span></span>
<span id="cb74-157"><a href="#cb74-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Create HDF5 file</span></span>
<span id="cb74-158"><a href="#cb74-158" aria-hidden="true" tabindex="-1"></a>cross_platform_file <span class="ot">&lt;-</span> <span class="st">"cross_platform_analysis.hdf5"</span></span>
<span id="cb74-159"><a href="#cb74-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-160"><a href="#cb74-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Store genotype data</span></span>
<span id="cb74-161"><a href="#cb74-161" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb74-162"><a href="#cb74-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> cross_platform_file,</span>
<span id="cb74-163"><a href="#cb74-163" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> genotypes,</span>
<span id="cb74-164"><a href="#cb74-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"data"</span>,</span>
<span id="cb74-165"><a href="#cb74-165" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb74-166"><a href="#cb74-166" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">TRUE</span></span>
<span id="cb74-167"><a href="#cb74-167" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-168"><a href="#cb74-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-169"><a href="#cb74-169" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Genotypes stored in HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-170"><a href="#cb74-170" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-171"><a href="#cb74-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-172"><a href="#cb74-172" aria-hidden="true" tabindex="-1"></a><span class="fu">### Add Metadata Using rhdf5</span></span>
<span id="cb74-173"><a href="#cb74-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-174"><a href="#cb74-174" aria-hidden="true" tabindex="-1"></a>For metadata (mixed data types like population labels, age), use <span class="in">`rhdf5`</span> directly:</span>
<span id="cb74-175"><a href="#cb74-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-176"><a href="#cb74-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r store-metadata, eval=TRUE}</span></span>
<span id="cb74-177"><a href="#cb74-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Save metadata to HDF5 using rhdf5</span></span>
<span id="cb74-178"><a href="#cb74-178" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb74-179"><a href="#cb74-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-180"><a href="#cb74-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Create metadata group</span></span>
<span id="cb74-181"><a href="#cb74-181" aria-hidden="true" tabindex="-1"></a><span class="fu">h5createGroup</span>(cross_platform_file, <span class="st">"metadata"</span>)</span>
<span id="cb74-182"><a href="#cb74-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-183"><a href="#cb74-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Write metadata (rhdf5 handles mixed types automatically)</span></span>
<span id="cb74-184"><a href="#cb74-184" aria-hidden="true" tabindex="-1"></a><span class="fu">h5write</span>(sample_metadata, cross_platform_file, <span class="st">"metadata/samples"</span>)</span>
<span id="cb74-185"><a href="#cb74-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-186"><a href="#cb74-186" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Metadata stored in HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-187"><a href="#cb74-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-188"><a href="#cb74-188" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify file structure</span></span>
<span id="cb74-189"><a href="#cb74-189" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(cross_platform_file)</span>
<span id="cb74-190"><a href="#cb74-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-191"><a href="#cb74-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-192"><a href="#cb74-192" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb74-193"><a href="#cb74-193" aria-hidden="true" tabindex="-1"></a><span class="fu">## When to Use rhdf5 vs BigDataStatMeth</span></span>
<span id="cb74-194"><a href="#cb74-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-195"><a href="#cb74-195" aria-hidden="true" tabindex="-1"></a>**Use BigDataStatMeth functions** (<span class="in">`bdCreate_hdf5_matrix`</span>) for: - Numeric matrices (genotypes, expression, methylation) - Data that will be used in BigDataStatMeth analyses</span>
<span id="cb74-196"><a href="#cb74-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-197"><a href="#cb74-197" aria-hidden="true" tabindex="-1"></a>**Use rhdf5 directly** for: - Metadata with mixed types (characters, factors, integers) - Annotations and sample information - Flexible data structures not used in matrix computations</span>
<span id="cb74-198"><a href="#cb74-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-199"><a href="#cb74-199" aria-hidden="true" tabindex="-1"></a>BigDataStatMeth focuses on matrix operations, while rhdf5 provides general HDF5 I/O.</span>
<span id="cb74-200"><a href="#cb74-200" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb74-201"><a href="#cb74-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-202"><a href="#cb74-202" aria-hidden="true" tabindex="-1"></a><span class="fu">### Perform PCA</span></span>
<span id="cb74-203"><a href="#cb74-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-204"><a href="#cb74-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r run-pca, eval=TRUE}</span></span>
<span id="cb74-205"><a href="#cb74-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb74-206"><a href="#cb74-206" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">bdPCA_hdf5</span>( <span class="at">filename =</span> cross_platform_file, </span>
<span id="cb74-207"><a href="#cb74-207" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group =</span> <span class="st">"data"</span>, <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb74-208"><a href="#cb74-208" aria-hidden="true" tabindex="-1"></a>                          <span class="at">k =</span> <span class="dv">4</span>, <span class="at">q =</span> <span class="dv">1</span>, <span class="at">bcenter =</span> <span class="cn">TRUE</span>, <span class="at">bscale =</span> <span class="cn">FALSE</span>, </span>
<span id="cb74-209"><a href="#cb74-209" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ncomponents =</span> <span class="dv">20</span>, <span class="at">threads =</span> <span class="dv">4</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span> )</span>
<span id="cb74-210"><a href="#cb74-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-211"><a href="#cb74-211" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PCA complete in R</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-212"><a href="#cb74-212" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Results location:"</span>, pca_result<span class="sc">$</span>group, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-213"><a href="#cb74-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-214"><a href="#cb74-214" aria-hidden="true" tabindex="-1"></a><span class="co"># Show what was created</span></span>
<span id="cb74-215"><a href="#cb74-215" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(cross_platform_file)</span>
<span id="cb74-216"><a href="#cb74-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-217"><a href="#cb74-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-218"><a href="#cb74-218" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-219"><a href="#cb74-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-220"><a href="#cb74-220" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2: Visualization and ML in Python</span></span>
<span id="cb74-221"><a href="#cb74-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-222"><a href="#cb74-222" aria-hidden="true" tabindex="-1"></a><span class="fu">### Access HDF5 from Python</span></span>
<span id="cb74-223"><a href="#cb74-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-224"><a href="#cb74-224" aria-hidden="true" tabindex="-1"></a>Switch to Python to access the same HDF5 file. We'll use the <span class="in">`reticulate`</span> package to run Python code from R:</span>
<span id="cb74-225"><a href="#cb74-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-226"><a href="#cb74-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{python python-load, eval=TRUE}</span></span>
<span id="cb74-227"><a href="#cb74-227" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb74-228"><a href="#cb74-228" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb74-229"><a href="#cb74-229" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb74-230"><a href="#cb74-230" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb74-231"><a href="#cb74-231" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb74-232"><a href="#cb74-232" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb74-233"><a href="#cb74-233" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report</span>
<span id="cb74-234"><a href="#cb74-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-235"><a href="#cb74-235" aria-hidden="true" tabindex="-1"></a><span class="co"># Open HDF5 file in read/write mode</span></span>
<span id="cb74-236"><a href="#cb74-236" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> h5py.File(<span class="st">'cross_platform_analysis.hdf5'</span>, <span class="st">'r+'</span>)</span>
<span id="cb74-237"><a href="#cb74-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-238"><a href="#cb74-238" aria-hidden="true" tabindex="-1"></a><span class="co"># List contents</span></span>
<span id="cb74-239"><a href="#cb74-239" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"HDF5 file structure:"</span>)</span>
<span id="cb74-240"><a href="#cb74-240" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_structure(name, obj):</span>
<span id="cb74-241"><a href="#cb74-241" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(name)</span>
<span id="cb74-242"><a href="#cb74-242" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-243"><a href="#cb74-243" aria-hidden="true" tabindex="-1"></a>f.visititems(print_structure)</span>
<span id="cb74-244"><a href="#cb74-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-245"><a href="#cb74-245" aria-hidden="true" tabindex="-1"></a><span class="co"># Load PCA components</span></span>
<span id="cb74-246"><a href="#cb74-246" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> f[<span class="st">'PCA/genotypes/components'</span>][:]</span>
<span id="cb74-247"><a href="#cb74-247" aria-hidden="true" tabindex="-1"></a>variance_explained <span class="op">=</span> f[<span class="st">'PCA/genotypes/variance'</span>][:]</span>
<span id="cb74-248"><a href="#cb74-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-249"><a href="#cb74-249" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure variance_explained is 1D array</span></span>
<span id="cb74-250"><a href="#cb74-250" aria-hidden="true" tabindex="-1"></a>variance_explained <span class="op">=</span> np.array(variance_explained).flatten()</span>
<span id="cb74-251"><a href="#cb74-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-252"><a href="#cb74-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Load metadata</span></span>
<span id="cb74-253"><a href="#cb74-253" aria-hidden="true" tabindex="-1"></a>metadata_raw <span class="op">=</span> f[<span class="st">'metadata/samples'</span>]</span>
<span id="cb74-254"><a href="#cb74-254" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> pd.DataFrame({</span>
<span id="cb74-255"><a href="#cb74-255" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sample_id'</span>: metadata_raw[<span class="st">'sample_id'</span>][:],</span>
<span id="cb74-256"><a href="#cb74-256" aria-hidden="true" tabindex="-1"></a>    <span class="st">'population'</span>: metadata_raw[<span class="st">'population'</span>][:],</span>
<span id="cb74-257"><a href="#cb74-257" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: metadata_raw[<span class="st">'age'</span>][:]</span>
<span id="cb74-258"><a href="#cb74-258" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb74-259"><a href="#cb74-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-260"><a href="#cb74-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Decode byte strings to regular strings</span></span>
<span id="cb74-261"><a href="#cb74-261" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'sample_id'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb74-262"><a href="#cb74-262" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'sample_id'</span>]]</span>
<span id="cb74-263"><a href="#cb74-263" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'population'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb74-264"><a href="#cb74-264" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'population'</span>]]</span>
<span id="cb74-265"><a href="#cb74-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-266"><a href="#cb74-266" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">✓ Data loaded in Python"</span>)</span>
<span id="cb74-267"><a href="#cb74-267" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Components shape: </span><span class="sc">{</span>components<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb74-268"><a href="#cb74-268" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Metadata shape: </span><span class="sc">{</span>metadata<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb74-269"><a href="#cb74-269" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Populations: </span><span class="sc">{</span>metadata[<span class="st">'population'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb74-270"><a href="#cb74-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-271"><a href="#cb74-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-272"><a href="#cb74-272" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb74-273"><a href="#cb74-273" aria-hidden="true" tabindex="-1"></a><span class="fu">## Decoding String Data in Python</span></span>
<span id="cb74-274"><a href="#cb74-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-275"><a href="#cb74-275" aria-hidden="true" tabindex="-1"></a>HDF5 stores strings as bytes. When reading in Python, decode them:</span>
<span id="cb74-276"><a href="#cb74-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-277"><a href="#cb74-277" aria-hidden="true" tabindex="-1"></a><span class="in">``` python</span></span>
<span id="cb74-278"><a href="#cb74-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Byte strings need decoding</span></span>
<span id="cb74-279"><a href="#cb74-279" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'sample_id'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb74-280"><a href="#cb74-280" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'sample_id'</span>]]</span>
<span id="cb74-281"><a href="#cb74-281" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'population'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb74-282"><a href="#cb74-282" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'population'</span>]]</span>
<span id="cb74-283"><a href="#cb74-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-284"><a href="#cb74-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-285"><a href="#cb74-285" aria-hidden="true" tabindex="-1"></a>This converts byte strings like <span class="in">`b'SAMPLE_0001'`</span> to regular strings <span class="in">`'SAMPLE_0001'`</span>.</span>
<span id="cb74-286"><a href="#cb74-286" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb74-287"><a href="#cb74-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-288"><a href="#cb74-288" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb74-289"><a href="#cb74-289" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using Python Directly (Without Reticulate)</span></span>
<span id="cb74-290"><a href="#cb74-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-291"><a href="#cb74-291" aria-hidden="true" tabindex="-1"></a>This workflow uses Python from R through <span class="in">`reticulate`</span> for convenience in a single document. However, you can work with the HDF5 file using Python independently:</span>
<span id="cb74-292"><a href="#cb74-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-293"><a href="#cb74-293" aria-hidden="true" tabindex="-1"></a>**Option 1: Standalone Python script**</span>
<span id="cb74-294"><a href="#cb74-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-295"><a href="#cb74-295" aria-hidden="true" tabindex="-1"></a><span class="in">``` bash</span></span>
<span id="cb74-296"><a href="#cb74-296" aria-hidden="true" tabindex="-1"></a><span class="co"># Save your Python code to analyze_hdf5.py</span></span>
<span id="cb74-297"><a href="#cb74-297" aria-hidden="true" tabindex="-1"></a><span class="co"># Run from terminal</span></span>
<span id="cb74-298"><a href="#cb74-298" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> analyze_hdf5.py</span>
<span id="cb74-299"><a href="#cb74-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-300"><a href="#cb74-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-301"><a href="#cb74-301" aria-hidden="true" tabindex="-1"></a>**Option 2: Interactive Python session**</span>
<span id="cb74-302"><a href="#cb74-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-303"><a href="#cb74-303" aria-hidden="true" tabindex="-1"></a><span class="in">``` bash</span></span>
<span id="cb74-304"><a href="#cb74-304" aria-hidden="true" tabindex="-1"></a><span class="co"># Launch Python directly</span></span>
<span id="cb74-305"><a href="#cb74-305" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span></span>
<span id="cb74-306"><a href="#cb74-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-307"><a href="#cb74-307" aria-hidden="true" tabindex="-1"></a><span class="co"># Then work with HDF5</span></span>
<span id="cb74-308"><a href="#cb74-308" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> import <span class="ex">h5py</span></span>
<span id="cb74-309"><a href="#cb74-309" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> f <span class="ex">=</span> h5py.File<span class="er">(</span><span class="st">'cross_platform_analysis.hdf5'</span><span class="ex">,</span> <span class="st">'r'</span><span class="kw">)</span></span>
<span id="cb74-310"><a href="#cb74-310" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> components <span class="ex">=</span> f<span class="pp">[</span><span class="st">'PCA/genotypes/components'</span><span class="pp">][</span><span class="ss">:</span><span class="pp">]</span></span>
<span id="cb74-311"><a href="#cb74-311" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># ... continue analysis</span></span>
<span id="cb74-312"><a href="#cb74-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-313"><a href="#cb74-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-314"><a href="#cb74-314" aria-hidden="true" tabindex="-1"></a>**Option 3: Jupyter notebook**</span>
<span id="cb74-315"><a href="#cb74-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-316"><a href="#cb74-316" aria-hidden="true" tabindex="-1"></a><span class="in">``` python</span></span>
<span id="cb74-317"><a href="#cb74-317" aria-hidden="true" tabindex="-1"></a><span class="co"># In Jupyter notebook</span></span>
<span id="cb74-318"><a href="#cb74-318" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb74-319"><a href="#cb74-319" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> h5py.File(<span class="st">'cross_platform_analysis.hdf5'</span>, <span class="st">'r'</span>)</span>
<span id="cb74-320"><a href="#cb74-320" aria-hidden="true" tabindex="-1"></a><span class="co"># ... analysis code</span></span>
<span id="cb74-321"><a href="#cb74-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-322"><a href="#cb74-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-323"><a href="#cb74-323" aria-hidden="true" tabindex="-1"></a>The HDF5 file format is the same regardless of how you access it. Choose reticulate for integrated R/Python workflows, or use Python standalone when that fits your development environment better. The key advantage is that the same HDF5 file works seamlessly in both contexts without any conversion.</span>
<span id="cb74-324"><a href="#cb74-324" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb74-325"><a href="#cb74-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-326"><a href="#cb74-326" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create Visualizations</span></span>
<span id="cb74-327"><a href="#cb74-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-328"><a href="#cb74-328" aria-hidden="true" tabindex="-1"></a>Generate publication-quality plots in Python:</span>
<span id="cb74-329"><a href="#cb74-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-330"><a href="#cb74-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{python python-plots, eval=TRUE}</span></span>
<span id="cb74-331"><a href="#cb74-331" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb74-332"><a href="#cb74-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-333"><a href="#cb74-333" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 2x2 subplot figure</span></span>
<span id="cb74-334"><a href="#cb74-334" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">12</span>))</span>
<span id="cb74-335"><a href="#cb74-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-336"><a href="#cb74-336" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for populations</span></span>
<span id="cb74-337"><a href="#cb74-337" aria-hidden="true" tabindex="-1"></a>pop_colors <span class="op">=</span> {</span>
<span id="cb74-338"><a href="#cb74-338" aria-hidden="true" tabindex="-1"></a>    <span class="st">'EUR'</span>: <span class="st">'#1f77b4'</span>,</span>
<span id="cb74-339"><a href="#cb74-339" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AFR'</span>: <span class="st">'#ff7f0e'</span>, </span>
<span id="cb74-340"><a href="#cb74-340" aria-hidden="true" tabindex="-1"></a>    <span class="st">'EAS'</span>: <span class="st">'#2ca02c'</span>,</span>
<span id="cb74-341"><a href="#cb74-341" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SAS'</span>: <span class="st">'#d62728'</span>,</span>
<span id="cb74-342"><a href="#cb74-342" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AMR'</span>: <span class="st">'#9467bd'</span></span>
<span id="cb74-343"><a href="#cb74-343" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-344"><a href="#cb74-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-345"><a href="#cb74-345" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: PC1 vs PC2 by population</span></span>
<span id="cb74-346"><a href="#cb74-346" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb74-347"><a href="#cb74-347" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> pop_colors.keys():</span>
<span id="cb74-348"><a href="#cb74-348" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> metadata[<span class="st">'population'</span>] <span class="op">==</span> pop</span>
<span id="cb74-349"><a href="#cb74-349" aria-hidden="true" tabindex="-1"></a>    ax.scatter(components[mask, <span class="dv">0</span>], components[mask, <span class="dv">1</span>], </span>
<span id="cb74-350"><a href="#cb74-350" aria-hidden="true" tabindex="-1"></a>               c<span class="op">=</span>pop_colors[pop], label<span class="op">=</span>pop, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb74-351"><a href="#cb74-351" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'PC1'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-352"><a href="#cb74-352" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'PC2'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-353"><a href="#cb74-353" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'PCA: Populations in PC1-PC2 Space'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb74-354"><a href="#cb74-354" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb74-355"><a href="#cb74-355" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb74-356"><a href="#cb74-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-357"><a href="#cb74-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: Scree plot</span></span>
<span id="cb74-358"><a href="#cb74-358" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb74-359"><a href="#cb74-359" aria-hidden="true" tabindex="-1"></a>n_components <span class="op">=</span> <span class="bu">len</span>(variance_explained)</span>
<span id="cb74-360"><a href="#cb74-360" aria-hidden="true" tabindex="-1"></a>ax.bar(<span class="bu">range</span>(<span class="dv">1</span>, n_components <span class="op">+</span> <span class="dv">1</span>), variance_explained <span class="op">*</span> <span class="dv">100</span>, </span>
<span id="cb74-361"><a href="#cb74-361" aria-hidden="true" tabindex="-1"></a>       color<span class="op">=</span><span class="st">'steelblue'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb74-362"><a href="#cb74-362" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Principal Component'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-363"><a href="#cb74-363" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Variance Explained (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-364"><a href="#cb74-364" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Scree Plot'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb74-365"><a href="#cb74-365" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb74-366"><a href="#cb74-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-367"><a href="#cb74-367" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3: PC1 by age (colored by population)</span></span>
<span id="cb74-368"><a href="#cb74-368" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb74-369"><a href="#cb74-369" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pop <span class="kw">in</span> pop_colors.keys():</span>
<span id="cb74-370"><a href="#cb74-370" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> metadata[<span class="st">'population'</span>] <span class="op">==</span> pop</span>
<span id="cb74-371"><a href="#cb74-371" aria-hidden="true" tabindex="-1"></a>    ax.scatter(metadata.loc[mask, <span class="st">'age'</span>], components[mask, <span class="dv">0</span>],</span>
<span id="cb74-372"><a href="#cb74-372" aria-hidden="true" tabindex="-1"></a>               c<span class="op">=</span>pop_colors[pop], label<span class="op">=</span>pop, alpha<span class="op">=</span><span class="fl">0.6</span>, s<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb74-373"><a href="#cb74-373" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Age'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-374"><a href="#cb74-374" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'PC1'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-375"><a href="#cb74-375" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'PC1 vs Age by Population'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb74-376"><a href="#cb74-376" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb74-377"><a href="#cb74-377" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb74-378"><a href="#cb74-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-379"><a href="#cb74-379" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 4: Cumulative variance</span></span>
<span id="cb74-380"><a href="#cb74-380" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb74-381"><a href="#cb74-381" aria-hidden="true" tabindex="-1"></a>cumvar <span class="op">=</span> np.cumsum(variance_explained) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb74-382"><a href="#cb74-382" aria-hidden="true" tabindex="-1"></a>ax.plot(<span class="bu">range</span>(<span class="dv">1</span>, n_components <span class="op">+</span> <span class="dv">1</span>), cumvar, </span>
<span id="cb74-383"><a href="#cb74-383" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">'o'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">6</span>, color<span class="op">=</span><span class="st">'darkred'</span>)</span>
<span id="cb74-384"><a href="#cb74-384" aria-hidden="true" tabindex="-1"></a>ax.axhline(y<span class="op">=</span><span class="dv">80</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'80% threshold'</span>)</span>
<span id="cb74-385"><a href="#cb74-385" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Number of Components'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-386"><a href="#cb74-386" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Cumulative Variance Explained (%)'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb74-387"><a href="#cb74-387" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Cumulative Variance Explained'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb74-388"><a href="#cb74-388" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb74-389"><a href="#cb74-389" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb74-390"><a href="#cb74-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-391"><a href="#cb74-391" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb74-392"><a href="#cb74-392" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'pca_python_visualization.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb74-393"><a href="#cb74-393" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb74-394"><a href="#cb74-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-395"><a href="#cb74-395" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Plots created and saved"</span>)</span>
<span id="cb74-396"><a href="#cb74-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-397"><a href="#cb74-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-398"><a href="#cb74-398" aria-hidden="true" tabindex="-1"></a><span class="fu">### Train Classifier on PCs</span></span>
<span id="cb74-399"><a href="#cb74-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-400"><a href="#cb74-400" aria-hidden="true" tabindex="-1"></a>Use principal components as features for population classification:</span>
<span id="cb74-401"><a href="#cb74-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-402"><a href="#cb74-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{python python-ml, eval=TRUE}</span></span>
<span id="cb74-403"><a href="#cb74-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Import required libraries</span></span>
<span id="cb74-404"><a href="#cb74-404" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> h5py</span>
<span id="cb74-405"><a href="#cb74-405" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb74-406"><a href="#cb74-406" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb74-407"><a href="#cb74-407" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb74-408"><a href="#cb74-408" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb74-409"><a href="#cb74-409" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score</span>
<span id="cb74-410"><a href="#cb74-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-411"><a href="#cb74-411" aria-hidden="true" tabindex="-1"></a><span class="co"># Reload data (variables don't persist between Python chunks)</span></span>
<span id="cb74-412"><a href="#cb74-412" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> h5py.File(<span class="st">'cross_platform_analysis.hdf5'</span>, <span class="st">'r+'</span>)</span>
<span id="cb74-413"><a href="#cb74-413" aria-hidden="true" tabindex="-1"></a>components <span class="op">=</span> f[<span class="st">'PCA/genotypes/components'</span>][:]</span>
<span id="cb74-414"><a href="#cb74-414" aria-hidden="true" tabindex="-1"></a>metadata_raw <span class="op">=</span> f[<span class="st">'metadata/samples'</span>]</span>
<span id="cb74-415"><a href="#cb74-415" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> pd.DataFrame({</span>
<span id="cb74-416"><a href="#cb74-416" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sample_id'</span>: metadata_raw[<span class="st">'sample_id'</span>][:],</span>
<span id="cb74-417"><a href="#cb74-417" aria-hidden="true" tabindex="-1"></a>    <span class="st">'population'</span>: metadata_raw[<span class="st">'population'</span>][:],</span>
<span id="cb74-418"><a href="#cb74-418" aria-hidden="true" tabindex="-1"></a>    <span class="st">'age'</span>: metadata_raw[<span class="st">'age'</span>][:]</span>
<span id="cb74-419"><a href="#cb74-419" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb74-420"><a href="#cb74-420" aria-hidden="true" tabindex="-1"></a>metadata[<span class="st">'population'</span>] <span class="op">=</span> [s.decode(<span class="st">'utf-8'</span>) <span class="cf">if</span> <span class="bu">isinstance</span>(s, <span class="bu">bytes</span>) <span class="cf">else</span> s </span>
<span id="cb74-421"><a href="#cb74-421" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">for</span> s <span class="kw">in</span> metadata[<span class="st">'population'</span>]]</span>
<span id="cb74-422"><a href="#cb74-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-423"><a href="#cb74-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb74-424"><a href="#cb74-424" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> components[:, :<span class="dv">10</span>]  <span class="co"># Use first 10 PCs</span></span>
<span id="cb74-425"><a href="#cb74-425" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> metadata[<span class="st">'population'</span>].values</span>
<span id="cb74-426"><a href="#cb74-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-427"><a href="#cb74-427" aria-hidden="true" tabindex="-1"></a><span class="co"># Split train/test</span></span>
<span id="cb74-428"><a href="#cb74-428" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb74-429"><a href="#cb74-429" aria-hidden="true" tabindex="-1"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb74-430"><a href="#cb74-430" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-431"><a href="#cb74-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-432"><a href="#cb74-432" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Random Forest</span></span>
<span id="cb74-433"><a href="#cb74-433" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb74-434"><a href="#cb74-434" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span>
<span id="cb74-435"><a href="#cb74-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-436"><a href="#cb74-436" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb74-437"><a href="#cb74-437" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rf.predict(X_test)</span>
<span id="cb74-438"><a href="#cb74-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-439"><a href="#cb74-439" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate</span></span>
<span id="cb74-440"><a href="#cb74-440" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(y_test, y_pred)</span>
<span id="cb74-441"><a href="#cb74-441" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">✓ Random Forest trained"</span>)</span>
<span id="cb74-442"><a href="#cb74-442" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb74-443"><a href="#cb74-443" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:"</span>)</span>
<span id="cb74-444"><a href="#cb74-444" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred))</span>
<span id="cb74-445"><a href="#cb74-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-446"><a href="#cb74-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Save predictions back to HDF5 (file remains open for later use)</span></span>
<span id="cb74-447"><a href="#cb74-447" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'predictions'</span> <span class="kw">in</span> f:</span>
<span id="cb74-448"><a href="#cb74-448" aria-hidden="true" tabindex="-1"></a>    <span class="kw">del</span> f[<span class="st">'predictions'</span>]</span>
<span id="cb74-449"><a href="#cb74-449" aria-hidden="true" tabindex="-1"></a>f.create_dataset(<span class="st">'predictions'</span>, data<span class="op">=</span>y_pred.astype(<span class="st">'S10'</span>))</span>
<span id="cb74-450"><a href="#cb74-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-451"><a href="#cb74-451" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">✓ Predictions saved to HDF5"</span>)</span>
<span id="cb74-452"><a href="#cb74-452" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb74-453"><a href="#cb74-453" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ HDF5 file closed, ready for R/C++ access"</span>)</span>
<span id="cb74-454"><a href="#cb74-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-455"><a href="#cb74-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-456"><a href="#cb74-456" aria-hidden="true" tabindex="-1"></a><span class="in">```{python close-python-file, eval=TRUE}</span></span>
<span id="cb74-457"><a href="#cb74-457" aria-hidden="true" tabindex="-1"></a><span class="co"># Close HDF5 file to allow R to access it</span></span>
<span id="cb74-458"><a href="#cb74-458" aria-hidden="true" tabindex="-1"></a>f.close()</span>
<span id="cb74-459"><a href="#cb74-459" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Python HDF5 file closed"</span>)</span>
<span id="cb74-460"><a href="#cb74-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-461"><a href="#cb74-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-462"><a href="#cb74-462" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-463"><a href="#cb74-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-464"><a href="#cb74-464" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3: Custom Algorithm in C++</span></span>
<span id="cb74-465"><a href="#cb74-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-466"><a href="#cb74-466" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implement New Sample Projection</span></span>
<span id="cb74-467"><a href="#cb74-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-468"><a href="#cb74-468" aria-hidden="true" tabindex="-1"></a>Create a C++ function to project new samples onto existing PC space:</span>
<span id="cb74-469"><a href="#cb74-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-470"><a href="#cb74-470" aria-hidden="true" tabindex="-1"></a><span class="in">``` cpp</span></span>
<span id="cb74-471"><a href="#cb74-471" aria-hidden="true" tabindex="-1"></a><span class="co">// File: project_samples.cpp</span></span>
<span id="cb74-472"><a href="#cb74-472" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb74-473"><a href="#cb74-473" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"BigDataStatMeth.hpp"</span></span>
<span id="cb74-474"><a href="#cb74-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-475"><a href="#cb74-475" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb74-476"><a href="#cb74-476" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> BigDataStatMeth<span class="op">;</span></span>
<span id="cb74-477"><a href="#cb74-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-478"><a href="#cb74-478" aria-hidden="true" tabindex="-1"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb74-479"><a href="#cb74-479" aria-hidden="true" tabindex="-1"></a>NumericMatrix projectNewSamples<span class="op">(</span><span class="bu">std::</span>string filename<span class="op">,</span></span>
<span id="cb74-480"><a href="#cb74-480" aria-hidden="true" tabindex="-1"></a>                                 <span class="bu">std::</span>string new_data_path<span class="op">,</span></span>
<span id="cb74-481"><a href="#cb74-481" aria-hidden="true" tabindex="-1"></a>                                 <span class="bu">std::</span>string pc_path<span class="op">,</span></span>
<span id="cb74-482"><a href="#cb74-482" aria-hidden="true" tabindex="-1"></a>                                 <span class="dt">int</span> n_components<span class="op">)</span> <span class="op">{</span></span>
<span id="cb74-483"><a href="#cb74-483" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-484"><a href="#cb74-484" aria-hidden="true" tabindex="-1"></a>    hdf5Dataset<span class="op">*</span> dsData <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb74-485"><a href="#cb74-485" aria-hidden="true" tabindex="-1"></a>    hdf5Dataset<span class="op">*</span> dsPC <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span>
<span id="cb74-486"><a href="#cb74-486" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-487"><a href="#cb74-487" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb74-488"><a href="#cb74-488" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Open datasets</span></span>
<span id="cb74-489"><a href="#cb74-489" aria-hidden="true" tabindex="-1"></a>        dsData <span class="op">=</span> <span class="kw">new</span> hdf5Dataset<span class="op">(</span>filename<span class="op">,</span> new_data_path<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb74-490"><a href="#cb74-490" aria-hidden="true" tabindex="-1"></a>        dsData<span class="op">-&gt;</span>openDataset<span class="op">();</span></span>
<span id="cb74-491"><a href="#cb74-491" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-492"><a href="#cb74-492" aria-hidden="true" tabindex="-1"></a>        dsPC <span class="op">=</span> <span class="kw">new</span> hdf5Dataset<span class="op">(</span>filename<span class="op">,</span> pc_path<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span>
<span id="cb74-493"><a href="#cb74-493" aria-hidden="true" tabindex="-1"></a>        dsPC<span class="op">-&gt;</span>openDataset<span class="op">();</span></span>
<span id="cb74-494"><a href="#cb74-494" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-495"><a href="#cb74-495" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> n_samples <span class="op">=</span> dsData<span class="op">-&gt;</span>nrows<span class="op">();</span></span>
<span id="cb74-496"><a href="#cb74-496" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> n_features <span class="op">=</span> dsData<span class="op">-&gt;</span>ncols<span class="op">();</span></span>
<span id="cb74-497"><a href="#cb74-497" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-498"><a href="#cb74-498" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Read new sample data</span></span>
<span id="cb74-499"><a href="#cb74-499" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> new_data<span class="op">(</span>n_samples <span class="op">*</span> n_features<span class="op">);</span></span>
<span id="cb74-500"><a href="#cb74-500" aria-hidden="true" tabindex="-1"></a>        dsData<span class="op">-&gt;</span>readDatasetBlock<span class="op">(</span></span>
<span id="cb74-501"><a href="#cb74-501" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">},</span> <span class="op">{(</span><span class="dt">hsize_t</span><span class="op">)</span>n_samples<span class="op">,</span> <span class="op">(</span><span class="dt">hsize_t</span><span class="op">)</span>n_features<span class="op">},</span></span>
<span id="cb74-502"><a href="#cb74-502" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> new_data<span class="op">.</span>data<span class="op">()</span></span>
<span id="cb74-503"><a href="#cb74-503" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb74-504"><a href="#cb74-504" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-505"><a href="#cb74-505" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Read PC loadings</span></span>
<span id="cb74-506"><a href="#cb74-506" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> pc_loadings<span class="op">(</span>n_features <span class="op">*</span> n_components<span class="op">);</span></span>
<span id="cb74-507"><a href="#cb74-507" aria-hidden="true" tabindex="-1"></a>        dsPC<span class="op">-&gt;</span>readDatasetBlock<span class="op">(</span></span>
<span id="cb74-508"><a href="#cb74-508" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">},</span> <span class="op">{(</span><span class="dt">hsize_t</span><span class="op">)</span>n_features<span class="op">,</span> <span class="op">(</span><span class="dt">hsize_t</span><span class="op">)</span>n_components<span class="op">},</span></span>
<span id="cb74-509"><a href="#cb74-509" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> pc_loadings<span class="op">.</span>data<span class="op">()</span></span>
<span id="cb74-510"><a href="#cb74-510" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb74-511"><a href="#cb74-511" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-512"><a href="#cb74-512" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Project: scores = data %*% loadings</span></span>
<span id="cb74-513"><a href="#cb74-513" aria-hidden="true" tabindex="-1"></a>        NumericMatrix scores<span class="op">(</span>n_samples<span class="op">,</span> n_components<span class="op">);</span></span>
<span id="cb74-514"><a href="#cb74-514" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-515"><a href="#cb74-515" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n_samples<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb74-516"><a href="#cb74-516" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> n_components<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb74-517"><a href="#cb74-517" aria-hidden="true" tabindex="-1"></a>                <span class="dt">double</span> sum <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb74-518"><a href="#cb74-518" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> n_features<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb74-519"><a href="#cb74-519" aria-hidden="true" tabindex="-1"></a>                    sum <span class="op">+=</span> new_data<span class="op">[</span>i <span class="op">*</span> n_features <span class="op">+</span> k<span class="op">]</span> <span class="op">*</span> </span>
<span id="cb74-520"><a href="#cb74-520" aria-hidden="true" tabindex="-1"></a>                           pc_loadings<span class="op">[</span>k <span class="op">*</span> n_components <span class="op">+</span> j<span class="op">];</span></span>
<span id="cb74-521"><a href="#cb74-521" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb74-522"><a href="#cb74-522" aria-hidden="true" tabindex="-1"></a>                scores<span class="op">(</span>i<span class="op">,</span> j<span class="op">)</span> <span class="op">=</span> sum<span class="op">;</span></span>
<span id="cb74-523"><a href="#cb74-523" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb74-524"><a href="#cb74-524" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb74-525"><a href="#cb74-525" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-526"><a href="#cb74-526" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Cleanup</span></span>
<span id="cb74-527"><a href="#cb74-527" aria-hidden="true" tabindex="-1"></a>        <span class="kw">delete</span> dsData<span class="op">;</span></span>
<span id="cb74-528"><a href="#cb74-528" aria-hidden="true" tabindex="-1"></a>        <span class="kw">delete</span> dsPC<span class="op">;</span></span>
<span id="cb74-529"><a href="#cb74-529" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-530"><a href="#cb74-530" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> scores<span class="op">;</span></span>
<span id="cb74-531"><a href="#cb74-531" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb74-532"><a href="#cb74-532" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">catch</span><span class="op">(</span><span class="bu">std::</span>exception<span class="op">&amp;</span> ex<span class="op">)</span> <span class="op">{</span></span>
<span id="cb74-533"><a href="#cb74-533" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>dsData<span class="op">)</span> <span class="kw">delete</span> dsData<span class="op">;</span></span>
<span id="cb74-534"><a href="#cb74-534" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>dsPC<span class="op">)</span> <span class="kw">delete</span> dsPC<span class="op">;</span></span>
<span id="cb74-535"><a href="#cb74-535" aria-hidden="true" tabindex="-1"></a>        Rcpp<span class="op">::</span>stop<span class="op">(</span><span class="st">"Error in projectNewSamples: "</span> <span class="op">+</span> <span class="bu">std::</span>string<span class="op">(</span>ex<span class="op">.</span>what<span class="op">()));</span></span>
<span id="cb74-536"><a href="#cb74-536" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb74-537"><a href="#cb74-537" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb74-538"><a href="#cb74-538" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-539"><a href="#cb74-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-540"><a href="#cb74-540" aria-hidden="true" tabindex="-1"></a><span class="fu">### Compile and Use</span></span>
<span id="cb74-541"><a href="#cb74-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-542"><a href="#cb74-542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r compile-cpp, eval=TRUE}</span></span>
<span id="cb74-543"><a href="#cb74-543" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rcpp)</span>
<span id="cb74-544"><a href="#cb74-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-545"><a href="#cb74-545" aria-hidden="true" tabindex="-1"></a><span class="co"># Set include path for BigDataStatMeth headers</span></span>
<span id="cb74-546"><a href="#cb74-546" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">PKG_CXXFLAGS =</span> <span class="fu">paste0</span>(</span>
<span id="cb74-547"><a href="#cb74-547" aria-hidden="true" tabindex="-1"></a>  <span class="st">"-I"</span>, <span class="fu">system.file</span>(<span class="st">"include"</span>, <span class="at">package =</span> <span class="st">"BigDataStatMeth"</span>)</span>
<span id="cb74-548"><a href="#cb74-548" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb74-549"><a href="#cb74-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-550"><a href="#cb74-550" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: To compile the C++ code above, save it to project_samples.cpp</span></span>
<span id="cb74-551"><a href="#cb74-551" aria-hidden="true" tabindex="-1"></a><span class="co"># Then run: sourceCpp("project_samples.cpp")</span></span>
<span id="cb74-552"><a href="#cb74-552" aria-hidden="true" tabindex="-1"></a><span class="co"># For this demo, we'll simulate the process</span></span>
<span id="cb74-553"><a href="#cb74-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-554"><a href="#cb74-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new samples to project</span></span>
<span id="cb74-555"><a href="#cb74-555" aria-hidden="true" tabindex="-1"></a>new_genotypes <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb74-556"><a href="#cb74-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">50</span> <span class="sc">*</span> n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>)),</span>
<span id="cb74-557"><a href="#cb74-557" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">50</span>,</span>
<span id="cb74-558"><a href="#cb74-558" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> n_snps</span>
<span id="cb74-559"><a href="#cb74-559" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-560"><a href="#cb74-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-561"><a href="#cb74-561" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to HDF5 file</span></span>
<span id="cb74-562"><a href="#cb74-562" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb74-563"><a href="#cb74-563" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> cross_platform_file,</span>
<span id="cb74-564"><a href="#cb74-564" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> new_genotypes,</span>
<span id="cb74-565"><a href="#cb74-565" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"new_data"</span>,</span>
<span id="cb74-566"><a href="#cb74-566" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb74-567"><a href="#cb74-567" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">FALSE</span></span>
<span id="cb74-568"><a href="#cb74-568" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-569"><a href="#cb74-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-570"><a href="#cb74-570" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"New sample data added to HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-571"><a href="#cb74-571" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Ready for C++ projection (compile project_samples.cpp first)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb74-572"><a href="#cb74-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-573"><a href="#cb74-573" aria-hidden="true" tabindex="-1"></a><span class="co"># After compiling project_samples.cpp:</span></span>
<span id="cb74-574"><a href="#cb74-574" aria-hidden="true" tabindex="-1"></a><span class="co"># new_scores &lt;- projectNewSamples(</span></span>
<span id="cb74-575"><a href="#cb74-575" aria-hidden="true" tabindex="-1"></a><span class="co">#   filename = cross_platform_file,</span></span>
<span id="cb74-576"><a href="#cb74-576" aria-hidden="true" tabindex="-1"></a><span class="co">#   new_data_path = "new_data/genotypes",</span></span>
<span id="cb74-577"><a href="#cb74-577" aria-hidden="true" tabindex="-1"></a><span class="co">#   pc_path = "PCA/genotypes/rotation",</span></span>
<span id="cb74-578"><a href="#cb74-578" aria-hidden="true" tabindex="-1"></a><span class="co">#   n_components = 10</span></span>
<span id="cb74-579"><a href="#cb74-579" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb74-580"><a href="#cb74-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-581"><a href="#cb74-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-582"><a href="#cb74-582" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-583"><a href="#cb74-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-584"><a href="#cb74-584" aria-hidden="true" tabindex="-1"></a><span class="fu">## Workflow Summary</span></span>
<span id="cb74-585"><a href="#cb74-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-586"><a href="#cb74-586" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Flow Diagram</span></span>
<span id="cb74-587"><a href="#cb74-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-588"><a href="#cb74-588" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb74-589"><a href="#cb74-589" aria-hidden="true" tabindex="-1"></a><span class="in">R (BigDataStatMeth)</span></span>
<span id="cb74-590"><a href="#cb74-590" aria-hidden="true" tabindex="-1"></a><span class="in">  ↓ Creates</span></span>
<span id="cb74-591"><a href="#cb74-591" aria-hidden="true" tabindex="-1"></a><span class="in">HDF5 File</span></span>
<span id="cb74-592"><a href="#cb74-592" aria-hidden="true" tabindex="-1"></a><span class="in">  ├─ /data/genotypes          [Created by R]</span></span>
<span id="cb74-593"><a href="#cb74-593" aria-hidden="true" tabindex="-1"></a><span class="in">  ├─ /metadata/samples        [Created by R with rhdf5]</span></span>
<span id="cb74-594"><a href="#cb74-594" aria-hidden="true" tabindex="-1"></a><span class="in">  ├─ /PCA/genotypes/*         [Created by R]</span></span>
<span id="cb74-595"><a href="#cb74-595" aria-hidden="true" tabindex="-1"></a><span class="in">  ↓ Read by</span></span>
<span id="cb74-596"><a href="#cb74-596" aria-hidden="true" tabindex="-1"></a><span class="in">Python (h5py)</span></span>
<span id="cb74-597"><a href="#cb74-597" aria-hidden="true" tabindex="-1"></a><span class="in">  ├─ Loads components</span></span>
<span id="cb74-598"><a href="#cb74-598" aria-hidden="true" tabindex="-1"></a><span class="in">  ├─ Creates visualizations</span></span>
<span id="cb74-599"><a href="#cb74-599" aria-hidden="true" tabindex="-1"></a><span class="in">  ├─ Trains ML models</span></span>
<span id="cb74-600"><a href="#cb74-600" aria-hidden="true" tabindex="-1"></a><span class="in">  ↓ Writes</span></span>
<span id="cb74-601"><a href="#cb74-601" aria-hidden="true" tabindex="-1"></a><span class="in">  ├─ /predictions             [Created by Python]</span></span>
<span id="cb74-602"><a href="#cb74-602" aria-hidden="true" tabindex="-1"></a><span class="in">  ↓ Read by</span></span>
<span id="cb74-603"><a href="#cb74-603" aria-hidden="true" tabindex="-1"></a><span class="in">C++ (BigDataStatMeth.hpp)</span></span>
<span id="cb74-604"><a href="#cb74-604" aria-hidden="true" tabindex="-1"></a><span class="in">  ├─ Projects new samples</span></span>
<span id="cb74-605"><a href="#cb74-605" aria-hidden="true" tabindex="-1"></a><span class="in">  └─ Returns to R</span></span>
<span id="cb74-606"><a href="#cb74-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-607"><a href="#cb74-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-608"><a href="#cb74-608" aria-hidden="true" tabindex="-1"></a><span class="fu">### Language Selection Guide</span></span>
<span id="cb74-609"><a href="#cb74-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-610"><a href="#cb74-610" aria-hidden="true" tabindex="-1"></a>**Use R when:** - Performing standard statistical analyses - Initial data exploration - Using BigDataStatMeth functions - Working with data frames and factors</span>
<span id="cb74-611"><a href="#cb74-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-612"><a href="#cb74-612" aria-hidden="true" tabindex="-1"></a>**Use Python when:** - Need modern ML libraries (scikit-learn, TensorFlow) - Creating publication plots (matplotlib, seaborn) - Integrating with Python-only tools - Collaborating with Python-focused teams</span>
<span id="cb74-613"><a href="#cb74-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-614"><a href="#cb74-614" aria-hidden="true" tabindex="-1"></a>**Use C++ when:** - Performance is critical - Implementing custom algorithms - Need fine-grained memory control - Building production systems</span>
<span id="cb74-615"><a href="#cb74-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-616"><a href="#cb74-616" aria-hidden="true" tabindex="-1"></a>**The key:** HDF5 lets you use the best tool for each task without conversion overhead.</span>
<span id="cb74-617"><a href="#cb74-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-618"><a href="#cb74-618" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-619"><a href="#cb74-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-620"><a href="#cb74-620" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactive Exercise {.exercise}</span></span>
<span id="cb74-621"><a href="#cb74-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-622"><a href="#cb74-622" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practice: Multi-Language Integration</span></span>
<span id="cb74-623"><a href="#cb74-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-626"><a href="#cb74-626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb74-627"><a href="#cb74-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb74-628"><a href="#cb74-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-629"><a href="#cb74-629" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 1: Add more metadata</span></span>
<span id="cb74-630"><a href="#cb74-630" aria-hidden="true" tabindex="-1"></a><span class="co"># Store additional sample annotations in HDF5</span></span>
<span id="cb74-631"><a href="#cb74-631" aria-hidden="true" tabindex="-1"></a><span class="co"># Access them from Python for plotting</span></span>
<span id="cb74-632"><a href="#cb74-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-633"><a href="#cb74-633" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 2: Python preprocessing</span></span>
<span id="cb74-634"><a href="#cb74-634" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement outlier detection in Python</span></span>
<span id="cb74-635"><a href="#cb74-635" aria-hidden="true" tabindex="-1"></a><span class="co"># Save outlier flags back to HDF5</span></span>
<span id="cb74-636"><a href="#cb74-636" aria-hidden="true" tabindex="-1"></a><span class="co"># Use flags in R for filtering</span></span>
<span id="cb74-637"><a href="#cb74-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-638"><a href="#cb74-638" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 3: C++ feature engineering</span></span>
<span id="cb74-639"><a href="#cb74-639" aria-hidden="true" tabindex="-1"></a><span class="co"># Create C++ function to compute SNP statistics</span></span>
<span id="cb74-640"><a href="#cb74-640" aria-hidden="true" tabindex="-1"></a><span class="co"># Store results in HDF5</span></span>
<span id="cb74-641"><a href="#cb74-641" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize in Python</span></span>
<span id="cb74-642"><a href="#cb74-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-643"><a href="#cb74-643" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 4: Compare performance</span></span>
<span id="cb74-644"><a href="#cb74-644" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement same algorithm in R, Python, C++</span></span>
<span id="cb74-645"><a href="#cb74-645" aria-hidden="true" tabindex="-1"></a><span class="co"># Time each version</span></span>
<span id="cb74-646"><a href="#cb74-646" aria-hidden="true" tabindex="-1"></a><span class="co"># When is C++ worth the complexity?</span></span>
<span id="cb74-647"><a href="#cb74-647" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb74-648"><a href="#cb74-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-649"><a href="#cb74-649" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb74-650"><a href="#cb74-650" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reflection Questions</span></span>
<span id="cb74-651"><a href="#cb74-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-652"><a href="#cb74-652" aria-hidden="true" tabindex="-1"></a>**1. Platform Choices:** - When does multi-language workflow add value vs. complexity? - Could you do everything in one language? - What are the maintenance costs?</span>
<span id="cb74-653"><a href="#cb74-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-654"><a href="#cb74-654" aria-hidden="true" tabindex="-1"></a>**2. HDF5 Benefits:** - How does HDF5 compare to CSV/RDS/pickle for cross-platform work? - When would you NOT use HDF5? - What about data versioning?</span>
<span id="cb74-655"><a href="#cb74-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-656"><a href="#cb74-656" aria-hidden="true" tabindex="-1"></a>**3. Performance Trade-offs:** - Python ML vs R caret—does it matter? - When is C++ optimization worth development time? - How do you profile multi-language workflows?</span>
<span id="cb74-657"><a href="#cb74-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-658"><a href="#cb74-658" aria-hidden="true" tabindex="-1"></a>**4. Collaboration:** - Team has R and Python users—best practices? - How to ensure reproducibility across platforms? - Documentation strategies?</span>
<span id="cb74-659"><a href="#cb74-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-660"><a href="#cb74-660" aria-hidden="true" tabindex="-1"></a>**5. Debugging:** - Error in Python step—how do you debug? - HDF5 file corrupted—recovery strategies? - Version compatibility issues?</span>
<span id="cb74-661"><a href="#cb74-661" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb74-662"><a href="#cb74-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-663"><a href="#cb74-663" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-664"><a href="#cb74-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-665"><a href="#cb74-665" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Takeaways {.key-concept}</span></span>
<span id="cb74-666"><a href="#cb74-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-667"><a href="#cb74-667" aria-hidden="true" tabindex="-1"></a>Let's consolidate what you've learned about cross-platform workflows with BigDataStatMeth.</span>
<span id="cb74-668"><a href="#cb74-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-669"><a href="#cb74-669" aria-hidden="true" tabindex="-1"></a><span class="fu">### Essential Concepts</span></span>
<span id="cb74-670"><a href="#cb74-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-671"><a href="#cb74-671" aria-hidden="true" tabindex="-1"></a>**HDF5 is the universal data currency across platforms.** One HDF5 file works identically in R, Python, C++, MATLAB, Julia, and command-line tools. You never export to CSV, save to RDS, pickle for Python, then convert back—the HDF5 file is the single source of truth. BigDataStatMeth creates HDF5 files that any platform can read, and results added by Python or C++ are immediately available back in R. This eliminates conversion overhead and version mismatches that plague multi-language workflows.</span>
<span id="cb74-672"><a href="#cb74-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-673"><a href="#cb74-673" aria-hidden="true" tabindex="-1"></a>**Each language has natural strengths worth leveraging.** R excels at statistical analysis and data manipulation with data frames. Python dominates machine learning with scikit-learn and deep learning with PyTorch. C++ provides performance for custom algorithms and production deployment. Rather than forcing everything into one language, use each where it shines. The HDF5 format makes this practical—you're not punished for switching languages because there's no conversion penalty.</span>
<span id="cb74-674"><a href="#cb74-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-675"><a href="#cb74-675" aria-hidden="true" tabindex="-1"></a>**Mixed data types require different tools.** BigDataStatMeth functions like <span class="in">`bdCreate_hdf5_matrix()`</span> are optimized for numeric matrices used in computations. For metadata with mixed types (character labels, factors, mixed numeric/character columns), use <span class="in">`rhdf5`</span> directly with <span class="in">`h5write()`</span>. This distinction is important—trying to store a data frame with <span class="in">`bdCreate_hdf5_matrix()`</span> will fail or produce unexpected results. Use the right tool for the data type.</span>
<span id="cb74-676"><a href="#cb74-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-677"><a href="#cb74-677" aria-hidden="true" tabindex="-1"></a>**Python string decoding is a common gotcha.** HDF5 stores strings as bytes, and Python's h5py returns them as byte strings like <span class="in">`b'EUR'`</span>. You must decode them to regular strings: <span class="in">`s.decode('utf-8')`</span>. This is especially important for metadata like population labels or sample IDs that you'll use for grouping or filtering. If your Python plots show <span class="in">`b'EUR'`</span> instead of <span class="in">`EUR`</span> in legends, you forgot to decode.</span>
<span id="cb74-678"><a href="#cb74-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-679"><a href="#cb74-679" aria-hidden="true" tabindex="-1"></a>**Reticulate bridges R and Python seamlessly.** You don't need to save data from R, exit, run Python script, then reload in R. Reticulate runs Python directly from R, with automatic data conversion for simple types. For complex workflows, Python writes results to HDF5, then R reads them—but for interactive analysis, you can run Python chunks in the same R session. The <span class="in">`py_install()`</span> function handles Python package installation without leaving R. However, you can also use Python independently if that fits your workflow better.</span>
<span id="cb74-680"><a href="#cb74-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-681"><a href="#cb74-681" aria-hidden="true" tabindex="-1"></a>**C++ optimization requires clear performance justification.** Writing C++ code takes longer than R or Python, debugging is harder, and maintenance is more complex. Only move to C++ when profiling shows a bottleneck that C++ would solve. For this workflow, the projection algorithm could run in R—C++ is shown for educational purposes. In production, if you're projecting millions of samples thousands of times, C++ pays off. For one-time analysis, R is faster development-to-result.</span>
<span id="cb74-682"><a href="#cb74-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-683"><a href="#cb74-683" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to Build Cross-Platform Workflows</span></span>
<span id="cb74-684"><a href="#cb74-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-685"><a href="#cb74-685" aria-hidden="true" tabindex="-1"></a>Understanding when multi-language workflows add value versus when they add unnecessary complexity guides effective development.</span>
<span id="cb74-686"><a href="#cb74-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-687"><a href="#cb74-687" aria-hidden="true" tabindex="-1"></a>✅ **Use cross-platform workflows when:**</span>
<span id="cb74-688"><a href="#cb74-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-689"><a href="#cb74-689" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Team has multi-language expertise** - If some members prefer R, others Python, and you have C++ developers, letting each use their strength increases productivity. Fighting this by forcing everyone into one language reduces efficiency.</span>
<span id="cb74-690"><a href="#cb74-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-691"><a href="#cb74-691" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Different steps need different tools** - Statistical analysis naturally fits R, deep learning needs Python (PyTorch/TensorFlow), and real-time inference needs C++. Using the best tool for each step produces better results than forcing everything into one language's ecosystem.</span>
<span id="cb74-692"><a href="#cb74-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-693"><a href="#cb74-693" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Performance bottlenecks are specific** - If 95% of your workflow runs fine in R but 5% is a computational bottleneck, rewrite that 5% in C++ rather than the entire pipeline. Cross-platform workflows enable surgical optimization.</span>
<span id="cb74-694"><a href="#cb74-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-695"><a href="#cb74-695" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Interfacing with external systems** - If your organization's ML infrastructure is Python but your statisticians use R, HDF5 bridges the gap. You can't change the external systems, so you adapt your workflow to interface cleanly.</span>
<span id="cb74-696"><a href="#cb74-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-697"><a href="#cb74-697" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Leveraging specialized libraries** - If the perfect algorithm for your problem exists in Python (scikit-learn) but your data pipeline is in R, use both. Reimplementing complex algorithms to stay in one language wastes time and introduces bugs.</span>
<span id="cb74-698"><a href="#cb74-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-699"><a href="#cb74-699" aria-hidden="true" tabindex="-1"></a>✅ **Stick to single language when:**</span>
<span id="cb74-700"><a href="#cb74-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-701"><a href="#cb74-701" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**One language does everything adequately** - If R's randomForest does what you need, don't switch to Python's scikit-learn just because you can. Simplicity has value—fewer dependencies, easier maintenance, clearer workflow.</span>
<span id="cb74-702"><a href="#cb74-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-703"><a href="#cb74-703" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Team is mono-lingual** - If everyone knows R but nobody knows Python, adding Python creates training burden and maintenance problems. The "right" language is the one your team can actually use and maintain.</span>
<span id="cb74-704"><a href="#cb74-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-705"><a href="#cb74-705" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Analysis is exploratory and one-off** - For quick exploratory analyses you'll run once, stay in whatever you started with. The overhead of setting up multi-language workflow exceeds the benefit for one-time scripts.</span>
<span id="cb74-706"><a href="#cb74-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-707"><a href="#cb74-707" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Reproducibility is critical** - Multi-language workflows have more failure points (Python version, package conflicts, compiler issues). If this analysis will be cited in papers or used in regulatory submissions, minimize complexity.</span>
<span id="cb74-708"><a href="#cb74-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-709"><a href="#cb74-709" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Performance is adequate** - If R takes 10 minutes and C++ would take 2 minutes, but you run it monthly, don't optimize. Save development time for frequent bottlenecks.</span>
<span id="cb74-710"><a href="#cb74-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-711"><a href="#cb74-711" aria-hidden="true" tabindex="-1"></a>The key principle: use multiple languages when the benefits (performance, specialized tools, team expertise) clearly outweigh the costs (complexity, maintenance, debugging difficulty). HDF5 makes multi-language workflows practical, but practical doesn't always mean necessary.</span>
<span id="cb74-712"><a href="#cb74-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-713"><a href="#cb74-713" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-714"><a href="#cb74-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-715"><a href="#cb74-715" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next Steps</span></span>
<span id="cb74-716"><a href="#cb74-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-717"><a href="#cb74-717" aria-hidden="true" tabindex="-1"></a>**Explore language-specific resources:**</span>
<span id="cb74-718"><a href="#cb74-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-719"><a href="#cb74-719" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">R implementation details</span><span class="co">](../developing-methods/cca-r-implementation.qmd)</span></span>
<span id="cb74-720"><a href="#cb74-720" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">C++ implementation guide</span><span class="co">](../developing-methods/cca-cpp-implementation.qmd)</span></span>
<span id="cb74-721"><a href="#cb74-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-722"><a href="#cb74-722" aria-hidden="true" tabindex="-1"></a>**Extend this workflow:**</span>
<span id="cb74-723"><a href="#cb74-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-724"><a href="#cb74-724" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Add quality control steps in each language</span>
<span id="cb74-725"><a href="#cb74-725" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Implement parallel processing in C++</span>
<span id="cb74-726"><a href="#cb74-726" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create interactive visualizations with Python's plotly</span>
<span id="cb74-727"><a href="#cb74-727" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Build Shiny app in R consuming Python ML results</span>
<span id="cb74-728"><a href="#cb74-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-729"><a href="#cb74-729" aria-hidden="true" tabindex="-1"></a>**Advanced topics:**</span>
<span id="cb74-730"><a href="#cb74-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-731"><a href="#cb74-731" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Apache Arrow for even faster cross-language data sharing</span>
<span id="cb74-732"><a href="#cb74-732" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Docker containers for reproducible multi-language environments</span>
<span id="cb74-733"><a href="#cb74-733" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Workflow managers (Snakemake, Nextflow) for complex pipelines</span>
<span id="cb74-734"><a href="#cb74-734" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Testing strategies for multi-language code</span>
<span id="cb74-735"><a href="#cb74-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-736"><a href="#cb74-736" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb74-737"><a href="#cb74-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-738"><a href="#cb74-738" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cleanup</span></span>
<span id="cb74-739"><a href="#cb74-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-740"><a href="#cb74-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cleanup, eval=TRUE}</span></span>
<span id="cb74-741"><a href="#cb74-741" aria-hidden="true" tabindex="-1"></a><span class="co"># Close HDF5 connections</span></span>
<span id="cb74-742"><a href="#cb74-742" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb74-743"><a href="#cb74-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-744"><a href="#cb74-744" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Python file already closed before C++ step</span></span>
<span id="cb74-745"><a href="#cb74-745" aria-hidden="true" tabindex="-1"></a><span class="co"># cross_platform_analysis.hdf5 contains complete workflow</span></span>
<span id="cb74-746"><a href="#cb74-746" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessible from R, Python, and C++ without conversion</span></span>
<span id="cb74-747"><a href="#cb74-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 BigDataStatMeth - ISGlobal BRGE</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/edit/main/workflows/cross-platform.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/isglobal-brge/BigDataStatMeth">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
 License: GPL-3
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>