<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing CCA – BigDataStatMeth</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-969ddfa49e00a70eb3423444dbc81f6c.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d0f1cdce0779274a5ec1152cd33adb41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-d6747531eee53fd58085a197f3afc013.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-d0f1cdce0779274a5ec1152cd33adb41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../assets/css/custom.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/images/logo.png" alt="" class="navbar-logo light-content">
    <img src="../assets/images/logo.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">BigDataStatMeth</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fundamentals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Fundamentals</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fundamentals">    
        <li>
    <a class="dropdown-item" href="../fundamentals/big-data-problem.html">
 <span class="dropdown-text">The Big Data Problem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/understanding-hdf5.html">
 <span class="dropdown-text">Understanding HDF5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/blockwise-computing.html">
 <span class="dropdown-text">Block-Wise Computing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/linear-algebra.html">
 <span class="dropdown-text">Linear Algebra Essentials</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../tutorials/getting-started.html">
 <span class="dropdown-text">Getting Started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/working-hdf5-matrices.html">
 <span class="dropdown-text">Working with HDF5 Matrices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/first-analysis.html">
 <span class="dropdown-text">Your First Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-workflows" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Workflows</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-workflows">    
        <li>
    <a class="dropdown-item" href="../workflows/implementing-pca.html">
 <span class="dropdown-text">Implementing PCA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workflows/implementing-cca.html">
 <span class="dropdown-text">Implementing CCA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workflows/cross-platform.html">
 <span class="dropdown-text">Cross-Platform Workflows</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-developing-methods" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Developing Methods</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-developing-methods">    
        <li>
    <a class="dropdown-item" href="../developing-methods/cca-r-implementation.html">
 <span class="dropdown-text">CCA in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../developing-methods/cca-cpp-implementation.html">
 <span class="dropdown-text">CCA in C++</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-api-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">API Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-api-reference">    
        <li>
    <a class="dropdown-item" href="../api-reference/r/index.html">
 <span class="dropdown-text">R Functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api-reference/cpp/index.html">
 <span class="dropdown-text">C++ API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../technical/performance.html"> 
<span class="menu-text">Technical</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/isglobal-brge/BigDataStatMeth"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://cran.r-project.org/package=BigDataStatMeth"> 
<span class="menu-text">CRAN</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../workflows/implementing-pca.html">Complete Examples</a></li><li class="breadcrumb-item"><a href="../workflows/implementing-cca.html">Implementing CCA</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Complete Examples</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workflows/implementing-pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Implementing PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workflows/implementing-cca.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing CCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../workflows/cross-platform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross-Platform Workflows</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a>
  <ul class="collapse">
  <li><a href="#what-youll-learn" id="toc-what-youll-learn" class="nav-link" data-scroll-target="#what-youll-learn"><span class="header-section-number">1.1</span> What You’ll Learn</a></li>
  </ul></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites"><span class="header-section-number">2</span> Prerequisites</a>
  <ul class="collapse">
  <li><a href="#install-and-load-packages" id="toc-install-and-load-packages" class="nav-link" data-scroll-target="#install-and-load-packages"><span class="header-section-number">2.1</span> Install and Load Packages</a></li>
  </ul></li>
  <li><a href="#the-dataset" id="toc-the-dataset" class="nav-link" data-scroll-target="#the-dataset"><span class="header-section-number">3</span> The Dataset</a></li>
  <li><a href="#step-1-import-data-to-hdf5" id="toc-step-1-import-data-to-hdf5" class="nav-link" data-scroll-target="#step-1-import-data-to-hdf5"><span class="header-section-number">4</span> Step 1: Import Data to HDF5</a>
  <ul class="collapse">
  <li><a href="#download-and-import-rna-seq-data" id="toc-download-and-import-rna-seq-data" class="nav-link" data-scroll-target="#download-and-import-rna-seq-data"><span class="header-section-number">4.1</span> Download and Import RNA-seq Data</a></li>
  <li><a href="#import-methylation-data" id="toc-import-methylation-data" class="nav-link" data-scroll-target="#import-methylation-data"><span class="header-section-number">4.2</span> Import Methylation Data</a></li>
  </ul></li>
  <li><a href="#step-2-perform-cca" id="toc-step-2-perform-cca" class="nav-link" data-scroll-target="#step-2-perform-cca"><span class="header-section-number">5</span> Step 2: Perform CCA</a>
  <ul class="collapse">
  <li><a href="#understanding-cca-parameters" id="toc-understanding-cca-parameters" class="nav-link" data-scroll-target="#understanding-cca-parameters"><span class="header-section-number">5.1</span> Understanding CCA Parameters</a></li>
  <li><a href="#run-cca-with-block-wise-processing" id="toc-run-cca-with-block-wise-processing" class="nav-link" data-scroll-target="#run-cca-with-block-wise-processing"><span class="header-section-number">5.2</span> Run CCA with Block-Wise Processing</a></li>
  </ul></li>
  <li><a href="#step-3-load-metadata-and-results" id="toc-step-3-load-metadata-and-results" class="nav-link" data-scroll-target="#step-3-load-metadata-and-results"><span class="header-section-number">6</span> Step 3: Load Metadata and Results</a>
  <ul class="collapse">
  <li><a href="#load-sample-metadata" id="toc-load-sample-metadata" class="nav-link" data-scroll-target="#load-sample-metadata"><span class="header-section-number">6.1</span> Load Sample Metadata</a></li>
  <li><a href="#extract-cca-results" id="toc-extract-cca-results" class="nav-link" data-scroll-target="#extract-cca-results"><span class="header-section-number">6.2</span> Extract CCA Results</a></li>
  </ul></li>
  <li><a href="#step-4-visualize-canonical-variates" id="toc-step-4-visualize-canonical-variates" class="nav-link" data-scroll-target="#step-4-visualize-canonical-variates"><span class="header-section-number">7</span> Step 4: Visualize Canonical Variates</a>
  <ul class="collapse">
  <li><a href="#combine-data-for-plotting" id="toc-combine-data-for-plotting" class="nav-link" data-scroll-target="#combine-data-for-plotting"><span class="header-section-number">7.1</span> Combine Data for Plotting</a></li>
  <li><a href="#define-plot-theme-for-screen-display" id="toc-define-plot-theme-for-screen-display" class="nav-link" data-scroll-target="#define-plot-theme-for-screen-display"><span class="header-section-number">7.2</span> Define Plot Theme for Screen Display</a></li>
  <li><a href="#create-canonical-variate-scatter-plots" id="toc-create-canonical-variate-scatter-plots" class="nav-link" data-scroll-target="#create-canonical-variate-scatter-plots"><span class="header-section-number">7.3</span> Create Canonical Variate Scatter Plots</a></li>
  <li><a href="#display-combined-figure" id="toc-display-combined-figure" class="nav-link" data-scroll-target="#display-combined-figure"><span class="header-section-number">7.4</span> Display Combined Figure</a></li>
  </ul></li>
  <li><a href="#step-5-extract-feature-contributions" id="toc-step-5-extract-feature-contributions" class="nav-link" data-scroll-target="#step-5-extract-feature-contributions"><span class="header-section-number">8</span> Step 5: Extract Feature Contributions</a>
  <ul class="collapse">
  <li><a href="#identify-top-contributing-features" id="toc-identify-top-contributing-features" class="nav-link" data-scroll-target="#identify-top-contributing-features"><span class="header-section-number">8.1</span> Identify Top Contributing Features</a></li>
  </ul></li>
  <li><a href="#interactive-exercise" id="toc-interactive-exercise" class="nav-link" data-scroll-target="#interactive-exercise"><span class="header-section-number">9</span> Interactive Exercise</a>
  <ul class="collapse">
  <li><a href="#practice-exploring-cca-results" id="toc-practice-exploring-cca-results" class="nav-link" data-scroll-target="#practice-exploring-cca-results"><span class="header-section-number">9.1</span> Practice: Exploring CCA Results</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">10</span> Key Takeaways</a>
  <ul class="collapse">
  <li><a href="#essential-concepts" id="toc-essential-concepts" class="nav-link" data-scroll-target="#essential-concepts"><span class="header-section-number">10.1</span> Essential Concepts</a></li>
  <li><a href="#when-to-use-cca" id="toc-when-to-use-cca" class="nav-link" data-scroll-target="#when-to-use-cca"><span class="header-section-number">10.2</span> When to Use CCA</a></li>
  </ul></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">11</span> Next Steps</a></li>
  <li><a href="#cleanup" id="toc-cleanup" class="nav-link" data-scroll-target="#cleanup"><span class="header-section-number">12</span> Cleanup</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/edit/main/workflows/implementing-cca.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../workflows/implementing-pca.html">Complete Examples</a></li><li class="breadcrumb-item"><a href="../workflows/implementing-cca.html">Implementing CCA</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Implementing CCA</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Canonical Correlation Analysis for Multi-Omic Integration</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>Canonical Correlation Analysis (CCA) identifies coordinated relationships between two high-dimensional datasets by finding linear combinations that maximize correlation. In multi-omic studies, CCA reveals how different molecular layers interact—for instance, how gene expression patterns relate to DNA methylation profiles. This workflow demonstrates CCA on real TCGA cancer data, showing how methylation and expression coordinate across different cancer types.</p>
<p>Unlike pairwise correlation analyses that examine individual feature relationships, CCA discovers the fundamental patterns linking entire datasets. Think of it as finding the “canonical” dimensions where methylation and expression vary together most strongly. This workflow uses the <code>bdCCA_hdf5()</code> function from BDStatMethExamples to perform block-wise CCA on data stored in HDF5 format, enabling analysis of datasets too large for memory.</p>
<section id="what-youll-learn" class="level3 learning-objectives" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="what-youll-learn"><span class="header-section-number">1.1</span> What You’ll Learn</h3>
<p>By the end of this workflow, you will:</p>
<ul>
<li>Import multi-omic data directly from URLs into HDF5 format</li>
<li>Use <code>bdCCA_hdf5()</code> from BDStatMethExamples for block-wise CCA</li>
<li>Understand how block-wise processing enables large-scale CCA</li>
<li>Extract canonical correlations, coefficients, and sample scores</li>
<li>Visualize canonical variates colored by biological groups</li>
<li>Interpret CCA results in the context of cancer biology</li>
<li>Identify which canonical components separate cancer types</li>
<li>Use CCA results stored in HDF5 for downstream analyses</li>
</ul>
</section>
<hr>
</section>
<section id="prerequisites" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="prerequisites"><span class="header-section-number">2</span> Prerequisites</h2>
<section id="install-and-load-packages" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="install-and-load-packages"><span class="header-section-number">2.1</span> Install and Load Packages</h3>
<p>Check if BDStatMethExamples is already installed to avoid reinstalling:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check and install BDStatMethExamples if needed</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"BDStatMethExamples"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"devtools"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dpelegri/BDStatMethExamples"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BDStatMethExamples)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
</section>
<section id="the-dataset" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="the-dataset"><span class="header-section-number">3</span> The Dataset</h2>
<p>We’ll analyze matched methylation and RNA-seq data from TCGA (The Cancer Genome Atlas):</p>
<ul>
<li><strong>Dataset X (RNA-seq):</strong> 2,171 samples × 500 gene expression values</li>
<li><strong>Dataset Y (Methylation):</strong> Same 2,171 samples × 339 CpG methylation sites</li>
<li><strong>Metadata:</strong> Cancer type labels for each sample</li>
<li><strong>Source:</strong> TCGA multi-cancer study</li>
<li><strong>Goal:</strong> Identify methylation-expression patterns that differ by cancer type</li>
</ul>
<p>The data represents multiple cancer types (BRCA, LUAD, KIRC, COAD, PRAD), allowing us to see if canonical variates capture cancer-specific molecular signatures. Samples are pre-matched—row order is identical in both datasets, ensuring correct sample alignment for CCA.</p>
<hr>
</section>
<section id="step-1-import-data-to-hdf5" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="step-1-import-data-to-hdf5"><span class="header-section-number">4</span> Step 1: Import Data to HDF5</h2>
<section id="download-and-import-rna-seq-data" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="download-and-import-rna-seq-data"><span class="header-section-number">4.1</span> Download and Import RNA-seq Data</h3>
<p>The <code>bdImportData_hdf5()</code> function downloads, extracts, and imports data directly from a URL:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Base URL for TCGA CCA example data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>filecommon <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://raw.githubusercontent.com/isglobal-brge/"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Supplementary-Material/master/Pelegri-Siso_2025/"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"application_examples/CCA/data/"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RNA-seq expression data URL</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>Xfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(filecommon, <span class="st">"RNA_data_small.zip"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Import RNA data as X matrix in HDF5 file</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>impX <span class="ot">&lt;-</span> <span class="fu">bdImportData_hdf5</span>(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">inFile =</span> Xfile,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">destFile =</span> <span class="st">"cca_tcga_small.hdf5"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">destGroup =</span> <span class="st">"data"</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">destDataset =</span> <span class="st">"X"</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">","</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">TRUE</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ RNA-seq data imported</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ RNA-seq data imported</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Dimensions:"</span>, impX<span class="sc">$</span>dims[<span class="dv">1</span>], <span class="st">"samples ×"</span>, impX<span class="sc">$</span>dims[<span class="dv">2</span>], <span class="st">"genes</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Dimensions: samples × genes</code></pre>
</div>
</div>
<p>The function automatically: 1. Downloads <code>RNA_data_small.zip</code> from GitHub 2. Extracts the CSV file 3. Imports into HDF5 at <code>/data/X</code> 4. Cleans up temporary files</p>
</section>
<section id="import-methylation-data" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="import-methylation-data"><span class="header-section-number">4.2</span> Import Methylation Data</h3>
<p>Add methylation data to the same HDF5 file:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Methylation data URL</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Yfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(filecommon, <span class="st">"Methyl_data_small.zip"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import methylation as Y matrix (same file, different dataset)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>impY <span class="ot">&lt;-</span> <span class="fu">bdImportData_hdf5</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">inFile =</span> Yfile,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">destFile =</span> <span class="st">"cca_tcga_small.hdf5"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">destGroup =</span> <span class="st">"data"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">destDataset =</span> <span class="st">"Y"</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">","</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">FALSE</span>  <span class="co"># Don't overwrite file, just add dataset</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Methylation data imported</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Methylation data imported</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify both datasets are in the file</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              group        name       otype   dclass        dim
0                 /        data   H5I_GROUP                    
1             /data .X_dimnames   H5I_GROUP                    
2 /data/.X_dimnames           2 H5I_DATASET COMPOUND        500
3             /data .Y_dimnames   H5I_GROUP                    
4 /data/.Y_dimnames           2 H5I_DATASET COMPOUND        339
5             /data           X H5I_DATASET    FLOAT 2171 x 500
6             /data           Y H5I_DATASET    FLOAT 2171 x 339</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Sample Matching in Pre-Prepared Data
</div>
</div>
<div class="callout-body-container callout-body">
<p>The TCGA datasets used here have been pre-processed to ensure sample alignment. Rows in the RNA-seq matrix correspond exactly to rows in the methylation matrix by position. Sample names are not stored in these files—alignment is by row order.</p>
<p>In your own analyses, always verify: - Same samples present in both datasets - Identical sample order - No missing or duplicated samples</p>
<p>Misaligned samples produce mathematically valid but biologically meaningless CCA results.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-2-perform-cca" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="step-2-perform-cca"><span class="header-section-number">5</span> Step 2: Perform CCA</h2>
<section id="understanding-cca-parameters" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="understanding-cca-parameters"><span class="header-section-number">5.1</span> Understanding CCA Parameters</h3>
<p>The <code>bdCCA_hdf5()</code> function performs CCA using block-wise QR decomposition:</p>
<ul>
<li><strong>filename:</strong> HDF5 file containing both X and Y datasets</li>
<li><strong>X, Y:</strong> Paths to datasets within the file (e.g., “data/X”, “data/Y”)</li>
<li><strong>m:</strong> Number of blocks for QR decomposition</li>
<li><strong>bcenter:</strong> Center data by column means (default TRUE)</li>
<li><strong>bscale:</strong> Scale by standard deviations (default FALSE)</li>
<li><strong>overwriteResults:</strong> Overwrite existing CCA results (TRUE for reanalysis)</li>
<li><strong>keepInteResults:</strong> Keep intermediate QR steps for inspection</li>
</ul>
</section>
<section id="run-cca-with-block-wise-processing" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="run-cca-with-block-wise-processing"><span class="header-section-number">5.2</span> Run CCA with Block-Wise Processing</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of blocks for processing</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform CCA</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCCA_hdf5</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"cca_tcga_small.hdf5"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="st">"data/X"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> <span class="st">"data/Y"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> m,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">bcenter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">bscale =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteResults =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">keepInteResults =</span> <span class="cn">TRUE</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset has been splitted, results can be found in Step1/Xrows/X
XRt dataset has been recomposed from blocks
Dataset has been splitted, results can be found in Step4/splitted/XRt.Q
XQ dataset has been recomposed from blocks
Dataset has been splitted, results can be found in Step1/Yrows/Y
YRt dataset has been recomposed from blocks
Dataset has been splitted, results can be found in Step4/splitted/YRt.Q
YQ dataset has been recomposed from blocks</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ CCA complete</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ CCA complete</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Results stored in /Results/ group</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Results stored in /Results/ group</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine output structure</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      group            name       otype   dclass        dim
0                         /      NORMALIZED   H5I_GROUP                    
1               /NORMALIZED            data   H5I_GROUP                    
2          /NORMALIZED/data               X H5I_DATASET    FLOAT 2171 x 500
3          /NORMALIZED/data               Y H5I_DATASET    FLOAT 2171 x 339
4          /NORMALIZED/data          mean.X H5I_DATASET    FLOAT    500 x 1
5          /NORMALIZED/data          mean.Y H5I_DATASET    FLOAT    339 x 1
6          /NORMALIZED/data            sd.X H5I_DATASET    FLOAT    500 x 1
7          /NORMALIZED/data            sd.Y H5I_DATASET    FLOAT    339 x 1
8                         /         Results   H5I_GROUP                    
9                  /Results .xcoef_dimnames   H5I_GROUP                    
10 /Results/.xcoef_dimnames               1 H5I_DATASET COMPOUND        500
11                 /Results .ycoef_dimnames   H5I_GROUP                    
12 /Results/.ycoef_dimnames               1 H5I_DATASET COMPOUND        339
13                 /Results             cor H5I_DATASET    FLOAT      1 x 1
14                 /Results         xcenter H5I_DATASET    FLOAT    500 x 1
15                 /Results           xcoef H5I_DATASET    FLOAT  500 x 339
16                 /Results         xscores H5I_DATASET    FLOAT 2171 x 339
17                 /Results         ycenter H5I_DATASET    FLOAT    339 x 1
18                 /Results           ycoef H5I_DATASET    FLOAT  339 x 339
19                 /Results         yscores H5I_DATASET    FLOAT 2171 x 339
20                        /             SVD   H5I_GROUP                    
21                     /SVD CrossProd_XQ_YQ   H5I_GROUP                    
22     /SVD/CrossProd_XQ_YQ               d H5I_DATASET    FLOAT    1 x 339
23     /SVD/CrossProd_XQ_YQ               u H5I_DATASET    FLOAT  500 x 339
24     /SVD/CrossProd_XQ_YQ               v H5I_DATASET    FLOAT  339 x 339
25                        /            data   H5I_GROUP                    
26                    /data     .X_dimnames   H5I_GROUP                    
27        /data/.X_dimnames               2 H5I_DATASET COMPOUND        500
28                    /data     .Y_dimnames   H5I_GROUP                    
29        /data/.Y_dimnames               2 H5I_DATASET COMPOUND        339
30                    /data               X H5I_DATASET    FLOAT 2171 x 500
31                    /data               Y H5I_DATASET    FLOAT 2171 x 339</code></pre>
</div>
</div>
<p>The function internally:</p>
<ol type="1">
<li><strong>Normalizes</strong> X and Y (centers by column means)</li>
<li><strong>Splits</strong> each matrix into m blocks by rows</li>
<li><strong>Computes QR</strong> decomposition on each block</li>
<li><strong>Merges</strong> block QR results hierarchically</li>
<li><strong>Computes</strong> cross-product of Q matrices (<span class="math inline">Q_X^T Q_Y</span>)</li>
<li><strong>Performs SVD</strong> to extract canonical correlations</li>
<li><strong>Solves</strong> for canonical coefficients from QR factors</li>
<li><strong>Computes</strong> canonical variates (sample scores)</li>
</ol>
<p>All intermediate steps (Step1-Step7) are preserved because <code>keepInteResults = TRUE</code>, allowing you to inspect the block-wise computation if needed.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Choosing the Number of Blocks (m)
</div>
</div>
<div class="callout-body-container callout-body">
<p>For this dataset (2,171 samples × 500 and 339 features): - <strong>m = 4:</strong> Good balance of memory and speed - <strong>Larger m:</strong> Reduces memory usage but increases computation time - <strong>Smaller m:</strong> Faster but requires more memory</p>
<p>For genome-wide data (50,000 samples × 500,000 features), increase to m = 8-16.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-3-load-metadata-and-results" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="step-3-load-metadata-and-results"><span class="header-section-number">6</span> Step 3: Load Metadata and Results</h2>
<section id="load-sample-metadata" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="load-sample-metadata"><span class="header-section-number">6.1</span> Load Sample Metadata</h3>
<p>Metadata contains cancer type labels for visualizing results:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load metadata with cancer type annotations</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>urlfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://raw.githubusercontent.com/isglobal-brge/"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Supplementary-Material/master/Pelegri-Siso_2025/"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"application_examples/CCA/data/metadata.csv"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(urlfile)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Metadata loaded</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Metadata loaded</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Samples:"</span>, <span class="fu">nrow</span>(metadata), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Samples: 2171 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Cancer types:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Cancer types:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(metadata<span class="sc">$</span>cancer))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
BRCA COAD  LGG LUAD 
 868  296  530  477 </code></pre>
</div>
</div>
<p>The metadata contains: - Sample identifiers - Cancer type labels (BRCA, LUAD, KIRC, COAD, PRAD) - Additional clinical variables</p>
</section>
<section id="extract-cca-results" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="extract-cca-results"><span class="header-section-number">6.2</span> Extract CCA Results</h3>
<p>Load canonical correlations and sample scores from the HDF5 file:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open HDF5 file</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>h5f <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract canonical correlations matrix</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>cor)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get dimension names for labeling</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>dimnames_labels <span class="ot">&lt;-</span> (h5f<span class="sc">$</span>Results<span class="sc">$</span>.xcoef_dimnames<span class="sc">$</span><span class="st">`</span><span class="at">1</span><span class="st">`</span>)[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(cor)[<span class="dv">1</span>], <span class="dv">1</span>]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor) <span class="ot">&lt;-</span> dimnames_labels</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor) <span class="ot">&lt;-</span> dimnames_labels</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract X canonical variates (RNA scores)</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>xscores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>xscores)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xscores) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"CCAX_%s"</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(xscores)[<span class="dv">2</span>]))</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Y canonical variates (methylation scores)</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>yscores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>yscores)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(yscores) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"CCAY_%s"</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(yscores)[<span class="dv">2</span>]))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Close HDF5 file</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ CCA results extracted</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ CCA results extracted</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">  X scores dimensions:"</span>, <span class="fu">dim</span>(xscores)[<span class="dv">1</span>], <span class="st">"×"</span>, <span class="fu">dim</span>(xscores)[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  X scores dimensions: 2171 × 339 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Y scores dimensions:"</span>, <span class="fu">dim</span>(yscores)[<span class="dv">1</span>], <span class="st">"×"</span>, <span class="fu">dim</span>(yscores)[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Y scores dimensions: 2171 × 339 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Understanding Canonical Correlations
</div>
</div>
<div class="callout-body-container callout-body">
<p>The diagonal of the <code>cor</code> matrix contains canonical correlations: - First value: Strongest correlation between X and Y patterns - Subsequent values: Progressively weaker correlations - Typically only first 3-5 components are interpretable</p>
<p>For this TCGA data, expect correlations around 0.6-0.8 for the first component, representing coordinated methylation-expression patterns across cancer types.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-4-visualize-canonical-variates" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="step-4-visualize-canonical-variates"><span class="header-section-number">7</span> Step 4: Visualize Canonical Variates</h2>
<section id="combine-data-for-plotting" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="combine-data-for-plotting"><span class="header-section-number">7.1</span> Combine Data for Plotting</h3>
<p>Merge canonical variates with metadata to color points by cancer type:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine metadata with canonical scores</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(metadata, xscores, yscores)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Data prepared for plotting</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Data prepared for plotting</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Combined dimensions:"</span>, <span class="fu">dim</span>(full_data)[<span class="dv">1</span>], <span class="st">"×"</span>, <span class="fu">dim</span>(full_data)[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Combined dimensions: 2171 × 682 </code></pre>
</div>
</div>
</section>
<section id="define-plot-theme-for-screen-display" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="define-plot-theme-for-screen-display"><span class="header-section-number">7.2</span> Define Plot Theme for Screen Display</h3>
<p>Create theme optimized for on-screen viewing (smaller text than PNG export):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>screen_theme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="create-canonical-variate-scatter-plots" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="create-canonical-variate-scatter-plots"><span class="header-section-number">7.3</span> Create Canonical Variate Scatter Plots</h3>
<p>Generate three plots showing different canonical component pairs:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: CCAX_1 vs CCAY_2</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CCAX_1, <span class="at">y =</span> CCAY_2, <span class="at">color =</span> <span class="fu">as.factor</span>(cancer))) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  screen_theme <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"RNA CC1"</span>, <span class="at">y =</span> <span class="st">"Methylation CC2"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: CCAX_2 vs CCAY_1</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CCAX_2, <span class="at">y =</span> CCAY_1, <span class="at">color =</span> <span class="fu">as.factor</span>(cancer))) <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  screen_theme <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"RNA CC2"</span>, <span class="at">y =</span> <span class="st">"Methylation CC1"</span>)</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3: CCAX_3 vs CCAY_4</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CCAX_3, <span class="at">y =</span> CCAY_4, <span class="at">color =</span> <span class="fu">as.factor</span>(cancer))) <span class="sc">+</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  screen_theme <span class="sc">+</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"RNA CC3"</span>, <span class="at">y =</span> <span class="st">"Methylation CC4"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Plots created</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Plots created</code></pre>
</div>
</div>
</section>
<section id="display-combined-figure" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="display-combined-figure"><span class="header-section-number">7.4</span> Display Combined Figure</h3>
<p>Show the three plots side-by-side on screen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display on screen</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="implementing-cca_files/figure-html/display-plot-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The resulting figure shows: - <strong>Left panel (CCAX_1 vs CCAY_2):</strong> Primary RNA expression pattern vs.&nbsp;secondary methylation pattern - <strong>Middle panel (CCAX_2 vs CCAY_1):</strong> Secondary RNA pattern vs.&nbsp;primary methylation pattern<br>
- <strong>Right panel (CCAX_3 vs CCAY_4):</strong> Tertiary patterns in both omics</p>
<p>Ellipses around each cancer type reveal: - Which cancer types cluster together (similar molecular profiles) - Which canonical components best separate cancer types - Whether methylation or expression drives cancer-specific patterns</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Interpreting the Canonical Variate Plots
</div>
</div>
<div class="callout-body-container callout-body">
<p>Each point represents one sample, colored by cancer type. Ellipses show 95% confidence regions for each cancer.</p>
<p><strong>What the axes mean:</strong> - <strong>CCAX_n:</strong> RNA expression canonical variate n (linear combination of genes) - <strong>CCAY_n:</strong> Methylation canonical variate n (linear combination of CpG sites)</p>
<p><strong>What to look for:</strong> - <strong>Separated ellipses:</strong> Cancer types with distinct molecular profiles - <strong>Overlapping ellipses:</strong> Cancer types with similar profiles - <strong>Component pairs:</strong> Different components capture different biological patterns</p>
<p>If BRCA separates clearly in panel 1 but not panel 2, the first canonical components capture BRCA-specific methylation-expression coordination.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-5-extract-feature-contributions" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="step-5-extract-feature-contributions"><span class="header-section-number">8</span> Step 5: Extract Feature Contributions</h2>
<section id="identify-top-contributing-features" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="identify-top-contributing-features"><span class="header-section-number">8.1</span> Identify Top Contributing Features</h3>
<p>To understand which genes and CpG sites drive the canonical patterns, examine the canonical coefficients:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open file to get coefficients</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>h5f <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># X coefficients (gene contributions)</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>xcoef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>xcoef)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xcoef) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"CC%s"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(xcoef))</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get gene names from dimnames</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>gene_names <span class="ot">&lt;-</span> h5f<span class="sc">$</span>data<span class="sc">$</span>.X_dimnames<span class="sc">$</span><span class="st">`</span><span class="at">2</span><span class="st">`</span>[, <span class="dv">1</span>]</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(xcoef) <span class="ot">&lt;-</span> gene_names</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Y coefficients (CpG contributions)</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>ycoef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>ycoef)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ycoef) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"CC%s"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(ycoef))</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Get CpG names from dimnames</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>cpg_names <span class="ot">&lt;-</span> h5f<span class="sc">$</span>data<span class="sc">$</span>.Y_dimnames<span class="sc">$</span><span class="st">`</span><span class="at">2</span><span class="st">`</span>[, <span class="dv">1</span>]</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ycoef) <span class="ot">&lt;-</span> cpg_names</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="fu">H5Fclose</span>(h5f)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find top contributors to first canonical component</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Top 10 genes for CC1:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 10 genes for CC1:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>xcoef<span class="sc">$</span>feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(xcoef)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>x_top <span class="ot">&lt;-</span> xcoef[<span class="fu">order</span>(<span class="fu">abs</span>(xcoef<span class="sc">$</span>CC1), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(x_top[, <span class="fu">c</span>(<span class="st">"feature"</span>, <span class="st">"CC1"</span>)], <span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        feature           CC1
ACTRT2   ACTRT2  5.278068e-04
ACTL7A   ACTL7A  4.320488e-04
ACTRT1   ACTRT1 -2.620451e-04
AADACL4 AADACL4 -2.498018e-04
ADAD1     ADAD1 -2.382528e-04
ACSM4     ACSM4  1.946739e-04
ACTL9     ACTL9  1.878009e-04
ADAM3A   ADAM3A -1.686120e-04
ACCSL     ACCSL -1.316626e-04
AFM         AFM -8.923667e-05</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Top 10 CpG sites for CC1:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 10 CpG sites for CC1:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ycoef<span class="sc">$</span>feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ycoef)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>y_top <span class="ot">&lt;-</span> ycoef[<span class="fu">order</span>(<span class="fu">abs</span>(ycoef<span class="sc">$</span>CC1), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(y_top[, <span class="fu">c</span>(<span class="st">"feature"</span>, <span class="st">"CC1"</span>)], <span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              feature         CC1
cg00009970 cg00009970 -0.02123091
cg00010659 cg00010659 -0.02119275
cg00020297 cg00020297 -0.02038494
cg00011247 cg00011247  0.02036400
cg00019809 cg00019809  0.02032894
cg00004072 cg00004072 -0.01805912
cg00003784 cg00003784  0.01743918
cg00013410 cg00013410  0.01644359
cg00009412 cg00009412  0.01501612
cg00016156 cg00016156 -0.01408071</code></pre>
</div>
</div>
<p>High absolute coefficients indicate features that contribute strongly to the canonical variate. These features are candidates for: - Pathway enrichment analysis - Genomic region analysis (for CpG sites) - Mechanistic follow-up studies</p>
<hr>
</section>
</section>
<section id="interactive-exercise" class="level2 exercise" data-number="9">
<h2 class="exercise anchored" data-number="9" data-anchor-id="interactive-exercise"><span class="header-section-number">9</span> Interactive Exercise</h2>
<section id="practice-exploring-cca-results" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="practice-exploring-cca-results"><span class="header-section-number">9.1</span> Practice: Exploring CCA Results</h3>
<p>Understanding CCA output helps you apply it effectively to your own multi-omic data.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 1: Try different numbers of blocks</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-run CCA with m = 2, m = 8</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># How does computation time change?</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Do canonical correlations differ?</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCCA_hdf5</span>(<span class="st">"cca_tcga_small.hdf5"</span>, <span class="st">"data/X"</span>, <span class="st">"data/Y"</span>, </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">m =</span> <span class="dv">2</span>, <span class="at">overwriteResults =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCCA_hdf5</span>(<span class="st">"cca_tcga_small.hdf5"</span>, <span class="st">"data/X"</span>, <span class="st">"data/Y"</span>, </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">m =</span> <span class="dv">8</span>, <span class="at">overwriteResults =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 2: Explore intermediate results</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co"># keepInteResults = TRUE saved Step1-Step7</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co"># What's in each step?</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Browse Step1 through Step7 to see block-wise computation</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 3: Create additional plots</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Try other canonical component pairs</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Which components best separate specific cancer types?</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CCAX_1, <span class="at">y =</span> CCAY_1, <span class="at">color =</span> <span class="fu">as.factor</span>(cancer))) <span class="sc">+</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  screen_theme</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p4)</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 4: Examine more features</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at top 50 genes and CpGs</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Do biological pathways emerge?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Reflection Questions
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>1. Block-Wise Processing:</strong> - Why does m = 4 work well for this dataset? - What would happen if m = 1 (no blocking)? - When would you need m = 16?</p>
<p><strong>2. Canonical Components:</strong> - Why plot CCAX_1 vs CCAY_2 instead of CCAX_1 vs CCAY_1? - What does it mean if cancer types separate in CC1 but not CC2? - How many components should you examine?</p>
<p><strong>3. Biological Interpretation:</strong> - Which cancer types cluster together? Why might that be? - Do RNA patterns or methylation patterns better separate cancers? - How would you validate top contributing genes/CpGs?</p>
<p><strong>4. Method Limitations:</strong> - CCA finds correlations—does this mean causation? - What if samples weren’t pre-matched? - Could batch effects produce apparent CCA patterns?</p>
<p><strong>5. Next Steps:</strong> - How would you use canonical scores for classification? - What other multi-omic combinations could you analyze? - When would you need regularized CCA instead?</p>
<p>These questions guide thoughtful application of CCA beyond following the workflow mechanically.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="key-takeaways" class="level2 key-concept" data-number="10">
<h2 class="key-concept anchored" data-number="10" data-anchor-id="key-takeaways"><span class="header-section-number">10</span> Key Takeaways</h2>
<p>Let’s consolidate what you’ve learned about applying CCA to multi-omic cancer data.</p>
<section id="essential-concepts" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="essential-concepts"><span class="header-section-number">10.1</span> Essential Concepts</h3>
<p><strong>Block-wise processing makes large-scale CCA tractable.</strong> The TCGA dataset used here (2,171 samples × 500 and 339 features) could fit in memory, but the same <code>bdCCA_hdf5()</code> function scales to genome-wide data (50,000 samples × 500,000 features) that would overwhelm traditional CCA implementations. By splitting matrices into blocks, computing QR decomposition on each block, and merging results hierarchically, block-wise CCA achieves identical mathematical results to full-matrix CCA but with dramatically reduced memory requirements. The <code>m</code> parameter controls this trade-off—larger m means smaller memory footprint but longer computation time.</p>
<p><strong>Sample alignment is critical but often pre-handled.</strong> CCA correlates row i of X with row i of Y—if samples are mis-ordered, you’re correlating patient A’s expression with patient B’s methylation. The TCGA datasets used here have been pre-processed to ensure alignment by row position. In your own analyses, verify sample matching before running CCA. Many published datasets provide pre-aligned matrices; if not, explicitly match samples by identifier and reorder matrices accordingly. One misalignment invalidates the entire analysis, and CCA won’t warn you—it will happily find “patterns” in the noise.</p>
<p><strong>Canonical components capture different biological patterns.</strong> The first canonical component (CC1) represents the strongest coordinated methylation-expression pattern across all samples. Subsequent components capture progressively weaker, orthogonal patterns. Plotting different component pairs (CCAX_1 vs CCAY_2, CCAX_2 vs CCAY_1, etc.) reveals that different biological signatures emerge in different components. In the TCGA cancer data, specific cancer types may separate clearly in some component pairs but not others, suggesting those components capture cancer-type-specific molecular coordination. Not all components are biologically meaningful—typically only the first 3-5 warrant interpretation.</p>
<p><strong>Ellipse separation indicates molecular heterogeneity.</strong> In the canonical variate plots, well-separated ellipses for different cancer types indicate those cancers have distinct methylation-expression coordination patterns. Overlapping ellipses suggest similar molecular profiles. This visualization is powerful for exploratory analysis—it reveals which cancer types share common regulatory mechanisms (overlapping) versus having unique signatures (separated). If BRCA and LUAD separate in the first component pair but KIRC and COAD overlap, this suggests BRCA and LUAD have distinctive methylation-expression relationships while KIRC and COAD share common patterns.</p>
<p><strong>Canonical coefficients identify key molecular features.</strong> High absolute coefficients indicate features (genes or CpG sites) that contribute strongly to the canonical variate. These aren’t necessarily the features with highest individual variance or correlation—CCA identifies features whose coordinated patterns across datasets drive the canonical relationship. For the top-loading genes, pathway enrichment analysis reveals which biological processes are coordinated with methylation. For top CpG sites, genomic region analysis shows which regulatory elements are involved. These features are mechanistic starting points for understanding the biology underlying the CCA patterns.</p>
<p><strong>HDF5 storage preserves all results for downstream use.</strong> Unlike traditional CCA that returns objects in R’s workspace, <code>bdCCA_hdf5()</code> stores everything in the HDF5 file—canonical correlations, coefficients, sample scores, and intermediate steps. This enables reproducible analyses where you can return to the file months later and extract exactly what you need without re-running CCA. Other tools can read HDF5 files (Python, MATLAB, command-line tools), making results accessible across computational environments. The structured HDF5 format also documents the analysis provenance through its hierarchical organization.</p>
</section>
<section id="when-to-use-cca" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="when-to-use-cca"><span class="header-section-number">10.2</span> When to Use CCA</h3>
<p>Understanding when block-wise HDF5 CCA provides value versus when simpler approaches suffice guides effective multi-omic analysis.</p>
<p>✅ <strong>Use bdCCA_hdf5() when:</strong></p>
<ul>
<li><p><strong>Data too large for memory</strong> - When loading both X and Y matrices simultaneously causes memory errors, block-wise processing becomes essential. For TCGA-scale analyses (thousands of samples, hundreds of thousands of features), <code>bdCCA_hdf5()</code> enables CCA that would otherwise be impossible.</p></li>
<li><p><strong>Multi-cancer or multi-condition studies</strong> - When exploring how molecular coordination varies across biological groups (cancer types, developmental stages, treatment responses), CCA can reveal group-specific patterns that univariate analyses miss. The canonical variate plots with group coloring immediately show which conditions have distinct versus shared molecular signatures.</p></li>
<li><p><strong>Integrating matched multi-omic datasets</strong> - When you have methylation + expression, CNV + expression, proteomics + transcriptomics, or other paired omics from the same samples, CCA identifies the coordinated dimensions of variation. This is CCA’s primary strength—finding relationships between high-dimensional paired datasets.</p></li>
<li><p><strong>Exploratory multi-omic analysis</strong> - When you don’t have a specific hypothesis about which features relate but want to discover the main patterns of coordination, CCA provides unsupervised dimensionality reduction that respects the relationship between datasets. It’s often a first step before more targeted analyses.</p></li>
</ul>
<p>❌ <strong>Simpler approaches work better when:</strong></p>
<ul>
<li><p><strong>Data fits in memory comfortably</strong> - If R’s <code>cancor()</code> runs without issues, use it. Base R CCA is simpler, better documented, and integrates with more packages. Only add HDF5 complexity when memory constraints force it.</p></li>
<li><p><strong>You want specific feature-feature relationships</strong> - If the question is “which CpGs correlate with which genes,” compute pairwise correlations with FDR correction. CCA answers “how do CpG profiles relate to gene profiles as coordinated patterns,” which is different. For feature-level relationships, pairwise approaches are more interpretable.</p></li>
<li><p><strong>Sample size is small</strong> - With 50 samples and 10,000 features per dataset, CCA will overfit dramatically. You need many more samples than features in either dataset for stable CCA. With small samples, reduce features first (through filtering, pathway aggregation, or supervised selection) or use regularized CCA methods.</p></li>
<li><p><strong>Datasets aren’t biologically linked</strong> - If analyzing brain methylation from one cohort and liver expression from a different cohort, CCA will find correlations (it always does), but they won’t reflect biology. CCA requires matched samples measuring different aspects of the same biological system.</p></li>
<li><p><strong>You need causal inference</strong> - CCA identifies correlation, not causation. If your scientific question requires understanding whether methylation regulates expression or vice versa, you need causal inference methods (Mendelian randomization, perturbation studies, longitudinal data) not CCA.</p></li>
</ul>
<p>The key principle: use block-wise HDF5 CCA when you have large, matched multi-omic datasets and want to discover coordinated patterns across conditions. For smaller data, specific relationships, or causal questions, other approaches are more appropriate.</p>
<hr>
</section>
</section>
<section id="next-steps" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">11</span> Next Steps</h2>
<p><strong>Understand the implementation:</strong></p>
<ul>
<li><a href="../developing-methods/cca-r-implementation.html">CCA Implementation in R</a> - How bdCCA_hdf5() works internally</li>
<li><a href="../developing-methods/cca-cpp-implementation.html">CCA Implementation in C++</a> - Performance optimization</li>
</ul>
<p><strong>Extend this analysis:</strong></p>
<ul>
<li>Perform pathway enrichment on top-loading genes</li>
<li>Map top CpG sites to genomic regions and regulatory elements</li>
<li>Use canonical scores as features for cancer type classification</li>
<li>Test which canonical components predict survival outcomes</li>
</ul>
<p><strong>Advanced CCA topics:</strong></p>
<ul>
<li>Sparse CCA for automatic feature selection</li>
<li>Regularized CCA for high-dimensional settings (p &gt;&gt; n)</li>
<li>Kernel CCA for capturing nonlinear relationships</li>
<li>Multi-block CCA for integrating &gt;2 omics types</li>
</ul>
<hr>
</section>
<section id="cleanup" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="cleanup"><span class="header-section-number">12</span> Cleanup</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close any open HDF5 connections</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: All CCA results remain in cca_tcga_small.hdf5</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessible for downstream analyses without re-running CCA</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/isglobal-brge\.github\.io\/BigDataStatMeth\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Implementing CCA"</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Canonical Correlation Analysis for Multi-Omic Integration"</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>Canonical Correlation Analysis (CCA) identifies coordinated relationships between two high-dimensional datasets by finding linear combinations that maximize correlation. In multi-omic studies, CCA reveals how different molecular layers interact—for instance, how gene expression patterns relate to DNA methylation profiles. This workflow demonstrates CCA on real TCGA cancer data, showing how methylation and expression coordinate across different cancer types.</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>Unlike pairwise correlation analyses that examine individual feature relationships, CCA discovers the fundamental patterns linking entire datasets. Think of it as finding the "canonical" dimensions where methylation and expression vary together most strongly. This workflow uses the <span class="in">`bdCCA_hdf5()`</span> function from BDStatMethExamples to perform block-wise CCA on data stored in HDF5 format, enabling analysis of datasets too large for memory.</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>::: learning-objectives</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="fu">### What You'll Learn</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>By the end of this workflow, you will:</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Import multi-omic data directly from URLs into HDF5 format</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use <span class="in">`bdCCA_hdf5()`</span> from BDStatMethExamples for block-wise CCA</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Understand how block-wise processing enables large-scale CCA</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Extract canonical correlations, coefficients, and sample scores</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Visualize canonical variates colored by biological groups</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpret CCA results in the context of cancer biology</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Identify which canonical components separate cancer types</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use CCA results stored in HDF5 for downstream analyses</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prerequisites</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="fu">### Install and Load Packages</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>Check if BDStatMethExamples is already installed to avoid reinstalling:</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup-packages, eval=TRUE}</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Check and install BDStatMethExamples if needed</span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"BDStatMethExamples"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"devtools"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"dpelegri/BDStatMethExamples"</span>)</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BDStatMethExamples)</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Dataset</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>We'll analyze matched methylation and RNA-seq data from TCGA (The Cancer Genome Atlas):</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Dataset X (RNA-seq):** 2,171 samples × 500 gene expression values</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Dataset Y (Methylation):** Same 2,171 samples × 339 CpG methylation sites</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Metadata:** Cancer type labels for each sample</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Source:** TCGA multi-cancer study</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Goal:** Identify methylation-expression patterns that differ by cancer type</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>The data represents multiple cancer types (BRCA, LUAD, KIRC, COAD, PRAD), allowing us to see if canonical variates capture cancer-specific molecular signatures. Samples are pre-matched—row order is identical in both datasets, ensuring correct sample alignment for CCA.</span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1: Import Data to HDF5</span></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a><span class="fu">### Download and Import RNA-seq Data</span></span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>The <span class="in">`bdImportData_hdf5()`</span> function downloads, extracts, and imports data directly from a URL:</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import-rna, eval=TRUE}</span></span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Base URL for TCGA CCA example data</span></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>filecommon <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://raw.githubusercontent.com/isglobal-brge/"</span>,</span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Supplementary-Material/master/Pelegri-Siso_2025/"</span>,</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"application_examples/CCA/data/"</span>)</span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a><span class="co"># RNA-seq expression data URL</span></span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>Xfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(filecommon, <span class="st">"RNA_data_small.zip"</span>)</span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Import RNA data as X matrix in HDF5 file</span></span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>impX <span class="ot">&lt;-</span> <span class="fu">bdImportData_hdf5</span>(</span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">inFile =</span> Xfile,</span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">destFile =</span> <span class="st">"cca_tcga_small.hdf5"</span>,</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">destGroup =</span> <span class="st">"data"</span>,</span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">destDataset =</span> <span class="st">"X"</span>,</span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">","</span>,</span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">TRUE</span></span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-96"><a href="#cb57-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-97"><a href="#cb57-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-98"><a href="#cb57-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-rna-import, eval=TRUE}</span></span>
<span id="cb57-99"><a href="#cb57-99" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ RNA-seq data imported</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-100"><a href="#cb57-100" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Dimensions:"</span>, impX<span class="sc">$</span>dims[<span class="dv">1</span>], <span class="st">"samples ×"</span>, impX<span class="sc">$</span>dims[<span class="dv">2</span>], <span class="st">"genes</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-101"><a href="#cb57-101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-102"><a href="#cb57-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-103"><a href="#cb57-103" aria-hidden="true" tabindex="-1"></a>The function automatically: 1. Downloads <span class="in">`RNA_data_small.zip`</span> from GitHub 2. Extracts the CSV file 3. Imports into HDF5 at <span class="in">`/data/X`</span> 4. Cleans up temporary files</span>
<span id="cb57-104"><a href="#cb57-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-105"><a href="#cb57-105" aria-hidden="true" tabindex="-1"></a><span class="fu">### Import Methylation Data</span></span>
<span id="cb57-106"><a href="#cb57-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-107"><a href="#cb57-107" aria-hidden="true" tabindex="-1"></a>Add methylation data to the same HDF5 file:</span>
<span id="cb57-108"><a href="#cb57-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-109"><a href="#cb57-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import-methyl, eval=TRUE}</span></span>
<span id="cb57-110"><a href="#cb57-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Methylation data URL</span></span>
<span id="cb57-111"><a href="#cb57-111" aria-hidden="true" tabindex="-1"></a>Yfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(filecommon, <span class="st">"Methyl_data_small.zip"</span>)</span>
<span id="cb57-112"><a href="#cb57-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-113"><a href="#cb57-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Import methylation as Y matrix (same file, different dataset)</span></span>
<span id="cb57-114"><a href="#cb57-114" aria-hidden="true" tabindex="-1"></a>impY <span class="ot">&lt;-</span> <span class="fu">bdImportData_hdf5</span>(</span>
<span id="cb57-115"><a href="#cb57-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">inFile =</span> Yfile,</span>
<span id="cb57-116"><a href="#cb57-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">destFile =</span> <span class="st">"cca_tcga_small.hdf5"</span>,</span>
<span id="cb57-117"><a href="#cb57-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">destGroup =</span> <span class="st">"data"</span>,</span>
<span id="cb57-118"><a href="#cb57-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">destDataset =</span> <span class="st">"Y"</span>,</span>
<span id="cb57-119"><a href="#cb57-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-120"><a href="#cb57-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-121"><a href="#cb57-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">","</span>,</span>
<span id="cb57-122"><a href="#cb57-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-123"><a href="#cb57-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">FALSE</span>  <span class="co"># Don't overwrite file, just add dataset</span></span>
<span id="cb57-124"><a href="#cb57-124" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-125"><a href="#cb57-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-126"><a href="#cb57-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-127"><a href="#cb57-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-methyl-import, eval=TRUE}</span></span>
<span id="cb57-128"><a href="#cb57-128" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Methylation data imported</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-129"><a href="#cb57-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-130"><a href="#cb57-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify both datasets are in the file</span></span>
<span id="cb57-131"><a href="#cb57-131" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span>
<span id="cb57-132"><a href="#cb57-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-133"><a href="#cb57-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-134"><a href="#cb57-134" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb57-135"><a href="#cb57-135" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sample Matching in Pre-Prepared Data</span></span>
<span id="cb57-136"><a href="#cb57-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-137"><a href="#cb57-137" aria-hidden="true" tabindex="-1"></a>The TCGA datasets used here have been pre-processed to ensure sample alignment. Rows in the RNA-seq matrix correspond exactly to rows in the methylation matrix by position. Sample names are not stored in these files—alignment is by row order.</span>
<span id="cb57-138"><a href="#cb57-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-139"><a href="#cb57-139" aria-hidden="true" tabindex="-1"></a>In your own analyses, always verify: - Same samples present in both datasets - Identical sample order - No missing or duplicated samples</span>
<span id="cb57-140"><a href="#cb57-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-141"><a href="#cb57-141" aria-hidden="true" tabindex="-1"></a>Misaligned samples produce mathematically valid but biologically meaningless CCA results.</span>
<span id="cb57-142"><a href="#cb57-142" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb57-143"><a href="#cb57-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-144"><a href="#cb57-144" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-145"><a href="#cb57-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-146"><a href="#cb57-146" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2: Perform CCA</span></span>
<span id="cb57-147"><a href="#cb57-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-148"><a href="#cb57-148" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding CCA Parameters</span></span>
<span id="cb57-149"><a href="#cb57-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-150"><a href="#cb57-150" aria-hidden="true" tabindex="-1"></a>The <span class="in">`bdCCA_hdf5()`</span> function performs CCA using block-wise QR decomposition:</span>
<span id="cb57-151"><a href="#cb57-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-152"><a href="#cb57-152" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**filename:** HDF5 file containing both X and Y datasets</span>
<span id="cb57-153"><a href="#cb57-153" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**X, Y:** Paths to datasets within the file (e.g., "data/X", "data/Y")</span>
<span id="cb57-154"><a href="#cb57-154" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**m:** Number of blocks for QR decomposition</span>
<span id="cb57-155"><a href="#cb57-155" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**bcenter:** Center data by column means (default TRUE)</span>
<span id="cb57-156"><a href="#cb57-156" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**bscale:** Scale by standard deviations (default FALSE)</span>
<span id="cb57-157"><a href="#cb57-157" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**overwriteResults:** Overwrite existing CCA results (TRUE for reanalysis)</span>
<span id="cb57-158"><a href="#cb57-158" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**keepInteResults:** Keep intermediate QR steps for inspection</span>
<span id="cb57-159"><a href="#cb57-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-160"><a href="#cb57-160" aria-hidden="true" tabindex="-1"></a><span class="fu">### Run CCA with Block-Wise Processing</span></span>
<span id="cb57-161"><a href="#cb57-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-162"><a href="#cb57-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r run-cca, eval=TRUE}</span></span>
<span id="cb57-163"><a href="#cb57-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of blocks for processing</span></span>
<span id="cb57-164"><a href="#cb57-164" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb57-165"><a href="#cb57-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-166"><a href="#cb57-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform CCA</span></span>
<span id="cb57-167"><a href="#cb57-167" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCCA_hdf5</span>(</span>
<span id="cb57-168"><a href="#cb57-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"cca_tcga_small.hdf5"</span>,</span>
<span id="cb57-169"><a href="#cb57-169" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> <span class="st">"data/X"</span>,</span>
<span id="cb57-170"><a href="#cb57-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> <span class="st">"data/Y"</span>,</span>
<span id="cb57-171"><a href="#cb57-171" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> m,</span>
<span id="cb57-172"><a href="#cb57-172" aria-hidden="true" tabindex="-1"></a>  <span class="at">bcenter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-173"><a href="#cb57-173" aria-hidden="true" tabindex="-1"></a>  <span class="at">bscale =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-174"><a href="#cb57-174" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteResults =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-175"><a href="#cb57-175" aria-hidden="true" tabindex="-1"></a>  <span class="at">keepInteResults =</span> <span class="cn">TRUE</span></span>
<span id="cb57-176"><a href="#cb57-176" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-177"><a href="#cb57-177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-178"><a href="#cb57-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-179"><a href="#cb57-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-cca-complete, eval=TRUE}</span></span>
<span id="cb57-180"><a href="#cb57-180" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ CCA complete</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-181"><a href="#cb57-181" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Results stored in /Results/ group</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-182"><a href="#cb57-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-183"><a href="#cb57-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine output structure</span></span>
<span id="cb57-184"><a href="#cb57-184" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span>
<span id="cb57-185"><a href="#cb57-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-186"><a href="#cb57-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-187"><a href="#cb57-187" aria-hidden="true" tabindex="-1"></a>The function internally:</span>
<span id="cb57-188"><a href="#cb57-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-189"><a href="#cb57-189" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Normalizes** X and Y (centers by column means)</span>
<span id="cb57-190"><a href="#cb57-190" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Splits** each matrix into m blocks by rows</span>
<span id="cb57-191"><a href="#cb57-191" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Computes QR** decomposition on each block</span>
<span id="cb57-192"><a href="#cb57-192" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Merges** block QR results hierarchically</span>
<span id="cb57-193"><a href="#cb57-193" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Computes** cross-product of Q matrices ($Q_X^T Q_Y$)</span>
<span id="cb57-194"><a href="#cb57-194" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Performs SVD** to extract canonical correlations</span>
<span id="cb57-195"><a href="#cb57-195" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>**Solves** for canonical coefficients from QR factors</span>
<span id="cb57-196"><a href="#cb57-196" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>**Computes** canonical variates (sample scores)</span>
<span id="cb57-197"><a href="#cb57-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-198"><a href="#cb57-198" aria-hidden="true" tabindex="-1"></a>All intermediate steps (Step1-Step7) are preserved because <span class="in">`keepInteResults = TRUE`</span>, allowing you to inspect the block-wise computation if needed.</span>
<span id="cb57-199"><a href="#cb57-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-200"><a href="#cb57-200" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb57-201"><a href="#cb57-201" aria-hidden="true" tabindex="-1"></a><span class="fu">## Choosing the Number of Blocks (m)</span></span>
<span id="cb57-202"><a href="#cb57-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-203"><a href="#cb57-203" aria-hidden="true" tabindex="-1"></a>For this dataset (2,171 samples × 500 and 339 features): - **m = 4:** Good balance of memory and speed - **Larger m:** Reduces memory usage but increases computation time - **Smaller m:** Faster but requires more memory</span>
<span id="cb57-204"><a href="#cb57-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-205"><a href="#cb57-205" aria-hidden="true" tabindex="-1"></a>For genome-wide data (50,000 samples × 500,000 features), increase to m = 8-16.</span>
<span id="cb57-206"><a href="#cb57-206" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb57-207"><a href="#cb57-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-208"><a href="#cb57-208" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-209"><a href="#cb57-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-210"><a href="#cb57-210" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3: Load Metadata and Results</span></span>
<span id="cb57-211"><a href="#cb57-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-212"><a href="#cb57-212" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load Sample Metadata</span></span>
<span id="cb57-213"><a href="#cb57-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-214"><a href="#cb57-214" aria-hidden="true" tabindex="-1"></a>Metadata contains cancer type labels for visualizing results:</span>
<span id="cb57-215"><a href="#cb57-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-216"><a href="#cb57-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-metadata, eval=TRUE}</span></span>
<span id="cb57-217"><a href="#cb57-217" aria-hidden="true" tabindex="-1"></a><span class="co"># Load metadata with cancer type annotations</span></span>
<span id="cb57-218"><a href="#cb57-218" aria-hidden="true" tabindex="-1"></a>urlfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://raw.githubusercontent.com/isglobal-brge/"</span>,</span>
<span id="cb57-219"><a href="#cb57-219" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Supplementary-Material/master/Pelegri-Siso_2025/"</span>,</span>
<span id="cb57-220"><a href="#cb57-220" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"application_examples/CCA/data/metadata.csv"</span>)</span>
<span id="cb57-221"><a href="#cb57-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-222"><a href="#cb57-222" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(urlfile)</span>
<span id="cb57-223"><a href="#cb57-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-224"><a href="#cb57-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-225"><a href="#cb57-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-metadata, eval=TRUE}</span></span>
<span id="cb57-226"><a href="#cb57-226" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Metadata loaded</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-227"><a href="#cb57-227" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Samples:"</span>, <span class="fu">nrow</span>(metadata), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-228"><a href="#cb57-228" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Cancer types:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-229"><a href="#cb57-229" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(metadata<span class="sc">$</span>cancer))</span>
<span id="cb57-230"><a href="#cb57-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-231"><a href="#cb57-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-232"><a href="#cb57-232" aria-hidden="true" tabindex="-1"></a>The metadata contains: - Sample identifiers - Cancer type labels (BRCA, LUAD, KIRC, COAD, PRAD) - Additional clinical variables</span>
<span id="cb57-233"><a href="#cb57-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-234"><a href="#cb57-234" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extract CCA Results</span></span>
<span id="cb57-235"><a href="#cb57-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-236"><a href="#cb57-236" aria-hidden="true" tabindex="-1"></a>Load canonical correlations and sample scores from the HDF5 file:</span>
<span id="cb57-237"><a href="#cb57-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-238"><a href="#cb57-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-results, eval=TRUE}</span></span>
<span id="cb57-239"><a href="#cb57-239" aria-hidden="true" tabindex="-1"></a><span class="co"># Open HDF5 file</span></span>
<span id="cb57-240"><a href="#cb57-240" aria-hidden="true" tabindex="-1"></a>h5f <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span>
<span id="cb57-241"><a href="#cb57-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-242"><a href="#cb57-242" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract canonical correlations matrix</span></span>
<span id="cb57-243"><a href="#cb57-243" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>cor)</span>
<span id="cb57-244"><a href="#cb57-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-245"><a href="#cb57-245" aria-hidden="true" tabindex="-1"></a><span class="co"># Get dimension names for labeling</span></span>
<span id="cb57-246"><a href="#cb57-246" aria-hidden="true" tabindex="-1"></a>dimnames_labels <span class="ot">&lt;-</span> (h5f<span class="sc">$</span>Results<span class="sc">$</span>.xcoef_dimnames<span class="sc">$</span><span class="st">`</span><span class="at">1</span><span class="st">`</span>)[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(cor)[<span class="dv">1</span>], <span class="dv">1</span>]</span>
<span id="cb57-247"><a href="#cb57-247" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cor) <span class="ot">&lt;-</span> dimnames_labels</span>
<span id="cb57-248"><a href="#cb57-248" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(cor) <span class="ot">&lt;-</span> dimnames_labels</span>
<span id="cb57-249"><a href="#cb57-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-250"><a href="#cb57-250" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract X canonical variates (RNA scores)</span></span>
<span id="cb57-251"><a href="#cb57-251" aria-hidden="true" tabindex="-1"></a>xscores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>xscores)</span>
<span id="cb57-252"><a href="#cb57-252" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xscores) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"CCAX_%s"</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(xscores)[<span class="dv">2</span>]))</span>
<span id="cb57-253"><a href="#cb57-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-254"><a href="#cb57-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Y canonical variates (methylation scores)</span></span>
<span id="cb57-255"><a href="#cb57-255" aria-hidden="true" tabindex="-1"></a>yscores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>yscores)</span>
<span id="cb57-256"><a href="#cb57-256" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(yscores) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"CCAY_%s"</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(yscores)[<span class="dv">2</span>]))</span>
<span id="cb57-257"><a href="#cb57-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-258"><a href="#cb57-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Close HDF5 file</span></span>
<span id="cb57-259"><a href="#cb57-259" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb57-260"><a href="#cb57-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-261"><a href="#cb57-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-262"><a href="#cb57-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-results, eval=TRUE}</span></span>
<span id="cb57-263"><a href="#cb57-263" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ CCA results extracted</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-264"><a href="#cb57-264" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">  X scores dimensions:"</span>, <span class="fu">dim</span>(xscores)[<span class="dv">1</span>], <span class="st">"×"</span>, <span class="fu">dim</span>(xscores)[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-265"><a href="#cb57-265" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Y scores dimensions:"</span>, <span class="fu">dim</span>(yscores)[<span class="dv">1</span>], <span class="st">"×"</span>, <span class="fu">dim</span>(yscores)[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-266"><a href="#cb57-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-267"><a href="#cb57-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-268"><a href="#cb57-268" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb57-269"><a href="#cb57-269" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding Canonical Correlations</span></span>
<span id="cb57-270"><a href="#cb57-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-271"><a href="#cb57-271" aria-hidden="true" tabindex="-1"></a>The diagonal of the <span class="in">`cor`</span> matrix contains canonical correlations: - First value: Strongest correlation between X and Y patterns - Subsequent values: Progressively weaker correlations - Typically only first 3-5 components are interpretable</span>
<span id="cb57-272"><a href="#cb57-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-273"><a href="#cb57-273" aria-hidden="true" tabindex="-1"></a>For this TCGA data, expect correlations around 0.6-0.8 for the first component, representing coordinated methylation-expression patterns across cancer types.</span>
<span id="cb57-274"><a href="#cb57-274" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb57-275"><a href="#cb57-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-276"><a href="#cb57-276" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-277"><a href="#cb57-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-278"><a href="#cb57-278" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 4: Visualize Canonical Variates</span></span>
<span id="cb57-279"><a href="#cb57-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-280"><a href="#cb57-280" aria-hidden="true" tabindex="-1"></a><span class="fu">### Combine Data for Plotting</span></span>
<span id="cb57-281"><a href="#cb57-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-282"><a href="#cb57-282" aria-hidden="true" tabindex="-1"></a>Merge canonical variates with metadata to color points by cancer type:</span>
<span id="cb57-283"><a href="#cb57-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-284"><a href="#cb57-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prepare-plot-data, eval=TRUE}</span></span>
<span id="cb57-285"><a href="#cb57-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine metadata with canonical scores</span></span>
<span id="cb57-286"><a href="#cb57-286" aria-hidden="true" tabindex="-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(metadata, xscores, yscores)</span>
<span id="cb57-287"><a href="#cb57-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-288"><a href="#cb57-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-289"><a href="#cb57-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-combined-data, eval=TRUE}</span></span>
<span id="cb57-290"><a href="#cb57-290" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Data prepared for plotting</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-291"><a href="#cb57-291" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Combined dimensions:"</span>, <span class="fu">dim</span>(full_data)[<span class="dv">1</span>], <span class="st">"×"</span>, <span class="fu">dim</span>(full_data)[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-292"><a href="#cb57-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-293"><a href="#cb57-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-294"><a href="#cb57-294" aria-hidden="true" tabindex="-1"></a><span class="fu">### Define Plot Theme for Screen Display</span></span>
<span id="cb57-295"><a href="#cb57-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-296"><a href="#cb57-296" aria-hidden="true" tabindex="-1"></a>Create theme optimized for on-screen viewing (smaller text than PNG export):</span>
<span id="cb57-297"><a href="#cb57-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-298"><a href="#cb57-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-theme, eval=TRUE}</span></span>
<span id="cb57-299"><a href="#cb57-299" aria-hidden="true" tabindex="-1"></a>screen_theme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb57-300"><a href="#cb57-300" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb57-301"><a href="#cb57-301" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb57-302"><a href="#cb57-302" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-303"><a href="#cb57-303" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.key =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-304"><a href="#cb57-304" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb57-305"><a href="#cb57-305" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb57-306"><a href="#cb57-306" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"black"</span>),</span>
<span id="cb57-307"><a href="#cb57-307" aria-hidden="true" tabindex="-1"></a>  <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-308"><a href="#cb57-308" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-309"><a href="#cb57-309" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-310"><a href="#cb57-310" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb57-311"><a href="#cb57-311" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-312"><a href="#cb57-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-313"><a href="#cb57-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-314"><a href="#cb57-314" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create Canonical Variate Scatter Plots</span></span>
<span id="cb57-315"><a href="#cb57-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-316"><a href="#cb57-316" aria-hidden="true" tabindex="-1"></a>Generate three plots showing different canonical component pairs:</span>
<span id="cb57-317"><a href="#cb57-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-318"><a href="#cb57-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-plots, eval=TRUE}</span></span>
<span id="cb57-319"><a href="#cb57-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: CCAX_1 vs CCAY_2</span></span>
<span id="cb57-320"><a href="#cb57-320" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb57-321"><a href="#cb57-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CCAX_1, <span class="at">y =</span> CCAY_2, <span class="at">color =</span> <span class="fu">as.factor</span>(cancer))) <span class="sc">+</span></span>
<span id="cb57-322"><a href="#cb57-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb57-323"><a href="#cb57-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb57-324"><a href="#cb57-324" aria-hidden="true" tabindex="-1"></a>  screen_theme <span class="sc">+</span></span>
<span id="cb57-325"><a href="#cb57-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb57-326"><a href="#cb57-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"RNA CC1"</span>, <span class="at">y =</span> <span class="st">"Methylation CC2"</span>)</span>
<span id="cb57-327"><a href="#cb57-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-328"><a href="#cb57-328" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 2: CCAX_2 vs CCAY_1</span></span>
<span id="cb57-329"><a href="#cb57-329" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb57-330"><a href="#cb57-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CCAX_2, <span class="at">y =</span> CCAY_1, <span class="at">color =</span> <span class="fu">as.factor</span>(cancer))) <span class="sc">+</span></span>
<span id="cb57-331"><a href="#cb57-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb57-332"><a href="#cb57-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb57-333"><a href="#cb57-333" aria-hidden="true" tabindex="-1"></a>  screen_theme <span class="sc">+</span></span>
<span id="cb57-334"><a href="#cb57-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb57-335"><a href="#cb57-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"RNA CC2"</span>, <span class="at">y =</span> <span class="st">"Methylation CC1"</span>)</span>
<span id="cb57-336"><a href="#cb57-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-337"><a href="#cb57-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 3: CCAX_3 vs CCAY_4</span></span>
<span id="cb57-338"><a href="#cb57-338" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb57-339"><a href="#cb57-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CCAX_3, <span class="at">y =</span> CCAY_4, <span class="at">color =</span> <span class="fu">as.factor</span>(cancer))) <span class="sc">+</span></span>
<span id="cb57-340"><a href="#cb57-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb57-341"><a href="#cb57-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb57-342"><a href="#cb57-342" aria-hidden="true" tabindex="-1"></a>  screen_theme <span class="sc">+</span></span>
<span id="cb57-343"><a href="#cb57-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb57-344"><a href="#cb57-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"RNA CC3"</span>, <span class="at">y =</span> <span class="st">"Methylation CC4"</span>)</span>
<span id="cb57-345"><a href="#cb57-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-346"><a href="#cb57-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-347"><a href="#cb57-347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-plots, eval=TRUE}</span></span>
<span id="cb57-348"><a href="#cb57-348" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Plots created</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-349"><a href="#cb57-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-350"><a href="#cb57-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-351"><a href="#cb57-351" aria-hidden="true" tabindex="-1"></a><span class="fu">### Display Combined Figure</span></span>
<span id="cb57-352"><a href="#cb57-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-353"><a href="#cb57-353" aria-hidden="true" tabindex="-1"></a>Show the three plots side-by-side on screen:</span>
<span id="cb57-354"><a href="#cb57-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-355"><a href="#cb57-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r display-plot, eval=TRUE}</span></span>
<span id="cb57-356"><a href="#cb57-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Display on screen</span></span>
<span id="cb57-357"><a href="#cb57-357" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb57-358"><a href="#cb57-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-359"><a href="#cb57-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-360"><a href="#cb57-360" aria-hidden="true" tabindex="-1"></a>The resulting figure shows: - **Left panel (CCAX_1 vs CCAY_2):** Primary RNA expression pattern vs. secondary methylation pattern - **Middle panel (CCAX_2 vs CCAY_1):** Secondary RNA pattern vs. primary methylation pattern\</span>
<span id="cb57-361"><a href="#cb57-361" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Right panel (CCAX_3 vs CCAY_4):** Tertiary patterns in both omics</span>
<span id="cb57-362"><a href="#cb57-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-363"><a href="#cb57-363" aria-hidden="true" tabindex="-1"></a>Ellipses around each cancer type reveal: - Which cancer types cluster together (similar molecular profiles) - Which canonical components best separate cancer types - Whether methylation or expression drives cancer-specific patterns</span>
<span id="cb57-364"><a href="#cb57-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-365"><a href="#cb57-365" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb57-366"><a href="#cb57-366" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting the Canonical Variate Plots</span></span>
<span id="cb57-367"><a href="#cb57-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-368"><a href="#cb57-368" aria-hidden="true" tabindex="-1"></a>Each point represents one sample, colored by cancer type. Ellipses show 95% confidence regions for each cancer.</span>
<span id="cb57-369"><a href="#cb57-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-370"><a href="#cb57-370" aria-hidden="true" tabindex="-1"></a>**What the axes mean:** - **CCAX_n:** RNA expression canonical variate n (linear combination of genes) - **CCAY_n:** Methylation canonical variate n (linear combination of CpG sites)</span>
<span id="cb57-371"><a href="#cb57-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-372"><a href="#cb57-372" aria-hidden="true" tabindex="-1"></a>**What to look for:** - **Separated ellipses:** Cancer types with distinct molecular profiles - **Overlapping ellipses:** Cancer types with similar profiles - **Component pairs:** Different components capture different biological patterns</span>
<span id="cb57-373"><a href="#cb57-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-374"><a href="#cb57-374" aria-hidden="true" tabindex="-1"></a>If BRCA separates clearly in panel 1 but not panel 2, the first canonical components capture BRCA-specific methylation-expression coordination.</span>
<span id="cb57-375"><a href="#cb57-375" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb57-376"><a href="#cb57-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-377"><a href="#cb57-377" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-378"><a href="#cb57-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-379"><a href="#cb57-379" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 5: Extract Feature Contributions</span></span>
<span id="cb57-380"><a href="#cb57-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-381"><a href="#cb57-381" aria-hidden="true" tabindex="-1"></a><span class="fu">### Identify Top Contributing Features</span></span>
<span id="cb57-382"><a href="#cb57-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-383"><a href="#cb57-383" aria-hidden="true" tabindex="-1"></a>To understand which genes and CpG sites drive the canonical patterns, examine the canonical coefficients:</span>
<span id="cb57-384"><a href="#cb57-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-385"><a href="#cb57-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-coefficients, eval=TRUE}</span></span>
<span id="cb57-386"><a href="#cb57-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Open file to get coefficients</span></span>
<span id="cb57-387"><a href="#cb57-387" aria-hidden="true" tabindex="-1"></a>h5f <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span>
<span id="cb57-388"><a href="#cb57-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-389"><a href="#cb57-389" aria-hidden="true" tabindex="-1"></a><span class="co"># X coefficients (gene contributions)</span></span>
<span id="cb57-390"><a href="#cb57-390" aria-hidden="true" tabindex="-1"></a>xcoef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>xcoef)</span>
<span id="cb57-391"><a href="#cb57-391" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xcoef) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"CC%s"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(xcoef))</span>
<span id="cb57-392"><a href="#cb57-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-393"><a href="#cb57-393" aria-hidden="true" tabindex="-1"></a><span class="co"># Get gene names from dimnames</span></span>
<span id="cb57-394"><a href="#cb57-394" aria-hidden="true" tabindex="-1"></a>gene_names <span class="ot">&lt;-</span> h5f<span class="sc">$</span>data<span class="sc">$</span>.X_dimnames<span class="sc">$</span><span class="st">`</span><span class="at">2</span><span class="st">`</span>[, <span class="dv">1</span>]</span>
<span id="cb57-395"><a href="#cb57-395" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(xcoef) <span class="ot">&lt;-</span> gene_names</span>
<span id="cb57-396"><a href="#cb57-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-397"><a href="#cb57-397" aria-hidden="true" tabindex="-1"></a><span class="co"># Y coefficients (CpG contributions)</span></span>
<span id="cb57-398"><a href="#cb57-398" aria-hidden="true" tabindex="-1"></a>ycoef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(h5f<span class="sc">$</span>Results<span class="sc">$</span>ycoef)</span>
<span id="cb57-399"><a href="#cb57-399" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ycoef) <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"CC%s"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(ycoef))</span>
<span id="cb57-400"><a href="#cb57-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-401"><a href="#cb57-401" aria-hidden="true" tabindex="-1"></a><span class="co"># Get CpG names from dimnames</span></span>
<span id="cb57-402"><a href="#cb57-402" aria-hidden="true" tabindex="-1"></a>cpg_names <span class="ot">&lt;-</span> h5f<span class="sc">$</span>data<span class="sc">$</span>.Y_dimnames<span class="sc">$</span><span class="st">`</span><span class="at">2</span><span class="st">`</span>[, <span class="dv">1</span>]</span>
<span id="cb57-403"><a href="#cb57-403" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ycoef) <span class="ot">&lt;-</span> cpg_names</span>
<span id="cb57-404"><a href="#cb57-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-405"><a href="#cb57-405" aria-hidden="true" tabindex="-1"></a><span class="fu">H5Fclose</span>(h5f)</span>
<span id="cb57-406"><a href="#cb57-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-407"><a href="#cb57-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-408"><a href="#cb57-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-top-features, eval=TRUE}</span></span>
<span id="cb57-409"><a href="#cb57-409" aria-hidden="true" tabindex="-1"></a><span class="co"># Find top contributors to first canonical component</span></span>
<span id="cb57-410"><a href="#cb57-410" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Top 10 genes for CC1:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-411"><a href="#cb57-411" aria-hidden="true" tabindex="-1"></a>xcoef<span class="sc">$</span>feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(xcoef)</span>
<span id="cb57-412"><a href="#cb57-412" aria-hidden="true" tabindex="-1"></a>x_top <span class="ot">&lt;-</span> xcoef[<span class="fu">order</span>(<span class="fu">abs</span>(xcoef<span class="sc">$</span>CC1), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb57-413"><a href="#cb57-413" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(x_top[, <span class="fu">c</span>(<span class="st">"feature"</span>, <span class="st">"CC1"</span>)], <span class="dv">10</span>))</span>
<span id="cb57-414"><a href="#cb57-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-415"><a href="#cb57-415" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Top 10 CpG sites for CC1:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-416"><a href="#cb57-416" aria-hidden="true" tabindex="-1"></a>ycoef<span class="sc">$</span>feature <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ycoef)</span>
<span id="cb57-417"><a href="#cb57-417" aria-hidden="true" tabindex="-1"></a>y_top <span class="ot">&lt;-</span> ycoef[<span class="fu">order</span>(<span class="fu">abs</span>(ycoef<span class="sc">$</span>CC1), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb57-418"><a href="#cb57-418" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(y_top[, <span class="fu">c</span>(<span class="st">"feature"</span>, <span class="st">"CC1"</span>)], <span class="dv">10</span>))</span>
<span id="cb57-419"><a href="#cb57-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-420"><a href="#cb57-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-421"><a href="#cb57-421" aria-hidden="true" tabindex="-1"></a>High absolute coefficients indicate features that contribute strongly to the canonical variate. These features are candidates for: - Pathway enrichment analysis - Genomic region analysis (for CpG sites) - Mechanistic follow-up studies</span>
<span id="cb57-422"><a href="#cb57-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-423"><a href="#cb57-423" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-424"><a href="#cb57-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-425"><a href="#cb57-425" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactive Exercise {.exercise}</span></span>
<span id="cb57-426"><a href="#cb57-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-427"><a href="#cb57-427" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practice: Exploring CCA Results</span></span>
<span id="cb57-428"><a href="#cb57-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-429"><a href="#cb57-429" aria-hidden="true" tabindex="-1"></a>Understanding CCA output helps you apply it effectively to your own multi-omic data.</span>
<span id="cb57-430"><a href="#cb57-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-433"><a href="#cb57-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb57-434"><a href="#cb57-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb57-435"><a href="#cb57-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-436"><a href="#cb57-436" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 1: Try different numbers of blocks</span></span>
<span id="cb57-437"><a href="#cb57-437" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-run CCA with m = 2, m = 8</span></span>
<span id="cb57-438"><a href="#cb57-438" aria-hidden="true" tabindex="-1"></a><span class="co"># How does computation time change?</span></span>
<span id="cb57-439"><a href="#cb57-439" aria-hidden="true" tabindex="-1"></a><span class="co"># Do canonical correlations differ?</span></span>
<span id="cb57-440"><a href="#cb57-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-441"><a href="#cb57-441" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCCA_hdf5</span>(<span class="st">"cca_tcga_small.hdf5"</span>, <span class="st">"data/X"</span>, <span class="st">"data/Y"</span>, </span>
<span id="cb57-442"><a href="#cb57-442" aria-hidden="true" tabindex="-1"></a>           <span class="at">m =</span> <span class="dv">2</span>, <span class="at">overwriteResults =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-443"><a href="#cb57-443" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCCA_hdf5</span>(<span class="st">"cca_tcga_small.hdf5"</span>, <span class="st">"data/X"</span>, <span class="st">"data/Y"</span>, </span>
<span id="cb57-444"><a href="#cb57-444" aria-hidden="true" tabindex="-1"></a>           <span class="at">m =</span> <span class="dv">8</span>, <span class="at">overwriteResults =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-445"><a href="#cb57-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-446"><a href="#cb57-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 2: Explore intermediate results</span></span>
<span id="cb57-447"><a href="#cb57-447" aria-hidden="true" tabindex="-1"></a><span class="co"># keepInteResults = TRUE saved Step1-Step7</span></span>
<span id="cb57-448"><a href="#cb57-448" aria-hidden="true" tabindex="-1"></a><span class="co"># What's in each step?</span></span>
<span id="cb57-449"><a href="#cb57-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-450"><a href="#cb57-450" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(<span class="st">"cca_tcga_small.hdf5"</span>)</span>
<span id="cb57-451"><a href="#cb57-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Browse Step1 through Step7 to see block-wise computation</span></span>
<span id="cb57-452"><a href="#cb57-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-453"><a href="#cb57-453" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 3: Create additional plots</span></span>
<span id="cb57-454"><a href="#cb57-454" aria-hidden="true" tabindex="-1"></a><span class="co"># Try other canonical component pairs</span></span>
<span id="cb57-455"><a href="#cb57-455" aria-hidden="true" tabindex="-1"></a><span class="co"># Which components best separate specific cancer types?</span></span>
<span id="cb57-456"><a href="#cb57-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-457"><a href="#cb57-457" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> full_data <span class="sc">%&gt;%</span></span>
<span id="cb57-458"><a href="#cb57-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CCAX_1, <span class="at">y =</span> CCAY_1, <span class="at">color =</span> <span class="fu">as.factor</span>(cancer))) <span class="sc">+</span></span>
<span id="cb57-459"><a href="#cb57-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb57-460"><a href="#cb57-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb57-461"><a href="#cb57-461" aria-hidden="true" tabindex="-1"></a>  screen_theme</span>
<span id="cb57-462"><a href="#cb57-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-463"><a href="#cb57-463" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p4)</span>
<span id="cb57-464"><a href="#cb57-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-465"><a href="#cb57-465" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise 4: Examine more features</span></span>
<span id="cb57-466"><a href="#cb57-466" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at top 50 genes and CpGs</span></span>
<span id="cb57-467"><a href="#cb57-467" aria-hidden="true" tabindex="-1"></a><span class="co"># Do biological pathways emerge?</span></span>
<span id="cb57-468"><a href="#cb57-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb57-469"><a href="#cb57-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-470"><a href="#cb57-470" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb57-471"><a href="#cb57-471" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reflection Questions</span></span>
<span id="cb57-472"><a href="#cb57-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-473"><a href="#cb57-473" aria-hidden="true" tabindex="-1"></a>**1. Block-Wise Processing:** - Why does m = 4 work well for this dataset? - What would happen if m = 1 (no blocking)? - When would you need m = 16?</span>
<span id="cb57-474"><a href="#cb57-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-475"><a href="#cb57-475" aria-hidden="true" tabindex="-1"></a>**2. Canonical Components:** - Why plot CCAX_1 vs CCAY_2 instead of CCAX_1 vs CCAY_1? - What does it mean if cancer types separate in CC1 but not CC2? - How many components should you examine?</span>
<span id="cb57-476"><a href="#cb57-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-477"><a href="#cb57-477" aria-hidden="true" tabindex="-1"></a>**3. Biological Interpretation:** - Which cancer types cluster together? Why might that be? - Do RNA patterns or methylation patterns better separate cancers? - How would you validate top contributing genes/CpGs?</span>
<span id="cb57-478"><a href="#cb57-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-479"><a href="#cb57-479" aria-hidden="true" tabindex="-1"></a>**4. Method Limitations:** - CCA finds correlations—does this mean causation? - What if samples weren't pre-matched? - Could batch effects produce apparent CCA patterns?</span>
<span id="cb57-480"><a href="#cb57-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-481"><a href="#cb57-481" aria-hidden="true" tabindex="-1"></a>**5. Next Steps:** - How would you use canonical scores for classification? - What other multi-omic combinations could you analyze? - When would you need regularized CCA instead?</span>
<span id="cb57-482"><a href="#cb57-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-483"><a href="#cb57-483" aria-hidden="true" tabindex="-1"></a>These questions guide thoughtful application of CCA beyond following the workflow mechanically.</span>
<span id="cb57-484"><a href="#cb57-484" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb57-485"><a href="#cb57-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-486"><a href="#cb57-486" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-487"><a href="#cb57-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-488"><a href="#cb57-488" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Takeaways {.key-concept}</span></span>
<span id="cb57-489"><a href="#cb57-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-490"><a href="#cb57-490" aria-hidden="true" tabindex="-1"></a>Let's consolidate what you've learned about applying CCA to multi-omic cancer data.</span>
<span id="cb57-491"><a href="#cb57-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-492"><a href="#cb57-492" aria-hidden="true" tabindex="-1"></a><span class="fu">### Essential Concepts</span></span>
<span id="cb57-493"><a href="#cb57-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-494"><a href="#cb57-494" aria-hidden="true" tabindex="-1"></a>**Block-wise processing makes large-scale CCA tractable.** The TCGA dataset used here (2,171 samples × 500 and 339 features) could fit in memory, but the same <span class="in">`bdCCA_hdf5()`</span> function scales to genome-wide data (50,000 samples × 500,000 features) that would overwhelm traditional CCA implementations. By splitting matrices into blocks, computing QR decomposition on each block, and merging results hierarchically, block-wise CCA achieves identical mathematical results to full-matrix CCA but with dramatically reduced memory requirements. The <span class="in">`m`</span> parameter controls this trade-off—larger m means smaller memory footprint but longer computation time.</span>
<span id="cb57-495"><a href="#cb57-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-496"><a href="#cb57-496" aria-hidden="true" tabindex="-1"></a>**Sample alignment is critical but often pre-handled.** CCA correlates row i of X with row i of Y—if samples are mis-ordered, you're correlating patient A's expression with patient B's methylation. The TCGA datasets used here have been pre-processed to ensure alignment by row position. In your own analyses, verify sample matching before running CCA. Many published datasets provide pre-aligned matrices; if not, explicitly match samples by identifier and reorder matrices accordingly. One misalignment invalidates the entire analysis, and CCA won't warn you—it will happily find "patterns" in the noise.</span>
<span id="cb57-497"><a href="#cb57-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-498"><a href="#cb57-498" aria-hidden="true" tabindex="-1"></a>**Canonical components capture different biological patterns.** The first canonical component (CC1) represents the strongest coordinated methylation-expression pattern across all samples. Subsequent components capture progressively weaker, orthogonal patterns. Plotting different component pairs (CCAX_1 vs CCAY_2, CCAX_2 vs CCAY_1, etc.) reveals that different biological signatures emerge in different components. In the TCGA cancer data, specific cancer types may separate clearly in some component pairs but not others, suggesting those components capture cancer-type-specific molecular coordination. Not all components are biologically meaningful—typically only the first 3-5 warrant interpretation.</span>
<span id="cb57-499"><a href="#cb57-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-500"><a href="#cb57-500" aria-hidden="true" tabindex="-1"></a>**Ellipse separation indicates molecular heterogeneity.** In the canonical variate plots, well-separated ellipses for different cancer types indicate those cancers have distinct methylation-expression coordination patterns. Overlapping ellipses suggest similar molecular profiles. This visualization is powerful for exploratory analysis—it reveals which cancer types share common regulatory mechanisms (overlapping) versus having unique signatures (separated). If BRCA and LUAD separate in the first component pair but KIRC and COAD overlap, this suggests BRCA and LUAD have distinctive methylation-expression relationships while KIRC and COAD share common patterns.</span>
<span id="cb57-501"><a href="#cb57-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-502"><a href="#cb57-502" aria-hidden="true" tabindex="-1"></a>**Canonical coefficients identify key molecular features.** High absolute coefficients indicate features (genes or CpG sites) that contribute strongly to the canonical variate. These aren't necessarily the features with highest individual variance or correlation—CCA identifies features whose coordinated patterns across datasets drive the canonical relationship. For the top-loading genes, pathway enrichment analysis reveals which biological processes are coordinated with methylation. For top CpG sites, genomic region analysis shows which regulatory elements are involved. These features are mechanistic starting points for understanding the biology underlying the CCA patterns.</span>
<span id="cb57-503"><a href="#cb57-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-504"><a href="#cb57-504" aria-hidden="true" tabindex="-1"></a>**HDF5 storage preserves all results for downstream use.** Unlike traditional CCA that returns objects in R's workspace, <span class="in">`bdCCA_hdf5()`</span> stores everything in the HDF5 file—canonical correlations, coefficients, sample scores, and intermediate steps. This enables reproducible analyses where you can return to the file months later and extract exactly what you need without re-running CCA. Other tools can read HDF5 files (Python, MATLAB, command-line tools), making results accessible across computational environments. The structured HDF5 format also documents the analysis provenance through its hierarchical organization.</span>
<span id="cb57-505"><a href="#cb57-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-506"><a href="#cb57-506" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to Use CCA</span></span>
<span id="cb57-507"><a href="#cb57-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-508"><a href="#cb57-508" aria-hidden="true" tabindex="-1"></a>Understanding when block-wise HDF5 CCA provides value versus when simpler approaches suffice guides effective multi-omic analysis.</span>
<span id="cb57-509"><a href="#cb57-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-510"><a href="#cb57-510" aria-hidden="true" tabindex="-1"></a>✅ **Use bdCCA_hdf5() when:**</span>
<span id="cb57-511"><a href="#cb57-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-512"><a href="#cb57-512" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Data too large for memory** - When loading both X and Y matrices simultaneously causes memory errors, block-wise processing becomes essential. For TCGA-scale analyses (thousands of samples, hundreds of thousands of features), <span class="in">`bdCCA_hdf5()`</span> enables CCA that would otherwise be impossible.</span>
<span id="cb57-513"><a href="#cb57-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-514"><a href="#cb57-514" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Multi-cancer or multi-condition studies** - When exploring how molecular coordination varies across biological groups (cancer types, developmental stages, treatment responses), CCA can reveal group-specific patterns that univariate analyses miss. The canonical variate plots with group coloring immediately show which conditions have distinct versus shared molecular signatures.</span>
<span id="cb57-515"><a href="#cb57-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-516"><a href="#cb57-516" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Integrating matched multi-omic datasets** - When you have methylation + expression, CNV + expression, proteomics + transcriptomics, or other paired omics from the same samples, CCA identifies the coordinated dimensions of variation. This is CCA's primary strength—finding relationships between high-dimensional paired datasets.</span>
<span id="cb57-517"><a href="#cb57-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-518"><a href="#cb57-518" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Exploratory multi-omic analysis** - When you don't have a specific hypothesis about which features relate but want to discover the main patterns of coordination, CCA provides unsupervised dimensionality reduction that respects the relationship between datasets. It's often a first step before more targeted analyses.</span>
<span id="cb57-519"><a href="#cb57-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-520"><a href="#cb57-520" aria-hidden="true" tabindex="-1"></a>❌ **Simpler approaches work better when:**</span>
<span id="cb57-521"><a href="#cb57-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-522"><a href="#cb57-522" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Data fits in memory comfortably** - If R's <span class="in">`cancor()`</span> runs without issues, use it. Base R CCA is simpler, better documented, and integrates with more packages. Only add HDF5 complexity when memory constraints force it.</span>
<span id="cb57-523"><a href="#cb57-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-524"><a href="#cb57-524" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**You want specific feature-feature relationships** - If the question is "which CpGs correlate with which genes," compute pairwise correlations with FDR correction. CCA answers "how do CpG profiles relate to gene profiles as coordinated patterns," which is different. For feature-level relationships, pairwise approaches are more interpretable.</span>
<span id="cb57-525"><a href="#cb57-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-526"><a href="#cb57-526" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Sample size is small** - With 50 samples and 10,000 features per dataset, CCA will overfit dramatically. You need many more samples than features in either dataset for stable CCA. With small samples, reduce features first (through filtering, pathway aggregation, or supervised selection) or use regularized CCA methods.</span>
<span id="cb57-527"><a href="#cb57-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-528"><a href="#cb57-528" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Datasets aren't biologically linked** - If analyzing brain methylation from one cohort and liver expression from a different cohort, CCA will find correlations (it always does), but they won't reflect biology. CCA requires matched samples measuring different aspects of the same biological system.</span>
<span id="cb57-529"><a href="#cb57-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-530"><a href="#cb57-530" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**You need causal inference** - CCA identifies correlation, not causation. If your scientific question requires understanding whether methylation regulates expression or vice versa, you need causal inference methods (Mendelian randomization, perturbation studies, longitudinal data) not CCA.</span>
<span id="cb57-531"><a href="#cb57-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-532"><a href="#cb57-532" aria-hidden="true" tabindex="-1"></a>The key principle: use block-wise HDF5 CCA when you have large, matched multi-omic datasets and want to discover coordinated patterns across conditions. For smaller data, specific relationships, or causal questions, other approaches are more appropriate.</span>
<span id="cb57-533"><a href="#cb57-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-534"><a href="#cb57-534" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-535"><a href="#cb57-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-536"><a href="#cb57-536" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next Steps</span></span>
<span id="cb57-537"><a href="#cb57-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-538"><a href="#cb57-538" aria-hidden="true" tabindex="-1"></a>**Understand the implementation:**</span>
<span id="cb57-539"><a href="#cb57-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-540"><a href="#cb57-540" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">CCA Implementation in R</span><span class="co">](../developing-methods/cca-r-implementation.qmd)</span> - How bdCCA_hdf5() works internally</span>
<span id="cb57-541"><a href="#cb57-541" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">CCA Implementation in C++</span><span class="co">](../developing-methods/cca-cpp-implementation.qmd)</span> - Performance optimization</span>
<span id="cb57-542"><a href="#cb57-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-543"><a href="#cb57-543" aria-hidden="true" tabindex="-1"></a>**Extend this analysis:**</span>
<span id="cb57-544"><a href="#cb57-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-545"><a href="#cb57-545" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Perform pathway enrichment on top-loading genes</span>
<span id="cb57-546"><a href="#cb57-546" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Map top CpG sites to genomic regions and regulatory elements</span>
<span id="cb57-547"><a href="#cb57-547" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use canonical scores as features for cancer type classification</span>
<span id="cb57-548"><a href="#cb57-548" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Test which canonical components predict survival outcomes</span>
<span id="cb57-549"><a href="#cb57-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-550"><a href="#cb57-550" aria-hidden="true" tabindex="-1"></a>**Advanced CCA topics:**</span>
<span id="cb57-551"><a href="#cb57-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-552"><a href="#cb57-552" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sparse CCA for automatic feature selection</span>
<span id="cb57-553"><a href="#cb57-553" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Regularized CCA for high-dimensional settings (p <span class="sc">\&gt;\&gt;</span> n)</span>
<span id="cb57-554"><a href="#cb57-554" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Kernel CCA for capturing nonlinear relationships</span>
<span id="cb57-555"><a href="#cb57-555" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Multi-block CCA for integrating <span class="sc">\&gt;</span>2 omics types</span>
<span id="cb57-556"><a href="#cb57-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-557"><a href="#cb57-557" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb57-558"><a href="#cb57-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-559"><a href="#cb57-559" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cleanup</span></span>
<span id="cb57-560"><a href="#cb57-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-561"><a href="#cb57-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cleanup, eval=TRUE}</span></span>
<span id="cb57-562"><a href="#cb57-562" aria-hidden="true" tabindex="-1"></a><span class="co"># Close any open HDF5 connections</span></span>
<span id="cb57-563"><a href="#cb57-563" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb57-564"><a href="#cb57-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-565"><a href="#cb57-565" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: All CCA results remain in cca_tcga_small.hdf5</span></span>
<span id="cb57-566"><a href="#cb57-566" aria-hidden="true" tabindex="-1"></a><span class="co"># Accessible for downstream analyses without re-running CCA</span></span>
<span id="cb57-567"><a href="#cb57-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 BigDataStatMeth - ISGlobal BRGE</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/edit/main/workflows/implementing-cca.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/isglobal-brge/BigDataStatMeth">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
 License: GPL-3
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>