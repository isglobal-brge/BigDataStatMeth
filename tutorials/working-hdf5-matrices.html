<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Working with HDF5 Matrices – BigDataStatMeth</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-969ddfa49e00a70eb3423444dbc81f6c.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d0f1cdce0779274a5ec1152cd33adb41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-d6747531eee53fd58085a197f3afc013.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-d0f1cdce0779274a5ec1152cd33adb41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../assets/css/custom.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/images/logo.png" alt="" class="navbar-logo light-content">
    <img src="../assets/images/logo.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">BigDataStatMeth</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fundamentals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Fundamentals</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fundamentals">    
        <li>
    <a class="dropdown-item" href="../fundamentals/big-data-problem.html">
 <span class="dropdown-text">The Big Data Problem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/understanding-hdf5.html">
 <span class="dropdown-text">Understanding HDF5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/blockwise-computing.html">
 <span class="dropdown-text">Block-Wise Computing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/linear-algebra.html">
 <span class="dropdown-text">Linear Algebra Essentials</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../tutorials/getting-started.html">
 <span class="dropdown-text">Getting Started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/working-hdf5-matrices.html">
 <span class="dropdown-text">Working with HDF5 Matrices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/first-analysis.html">
 <span class="dropdown-text">Your First Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-workflows" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Workflows</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-workflows">    
        <li>
    <a class="dropdown-item" href="../workflows/implementing-pca.html">
 <span class="dropdown-text">Implementing PCA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workflows/implementing-cca.html">
 <span class="dropdown-text">Implementing CCA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workflows/cross-platform.html">
 <span class="dropdown-text">Cross-Platform Workflows</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-developing-methods" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Developing Methods</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-developing-methods">    
        <li>
    <a class="dropdown-item" href="../developing-methods/cca-r-implementation.html">
 <span class="dropdown-text">CCA in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../developing-methods/cca-cpp-implementation.html">
 <span class="dropdown-text">CCA in C++</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-api-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">API Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-api-reference">    
        <li>
    <a class="dropdown-item" href="../api-reference/r/index.html">
 <span class="dropdown-text">R Functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api-reference/cpp/index.html">
 <span class="dropdown-text">C++ API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../technical/performance.html"> 
<span class="menu-text">Technical</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/isglobal-brge/BigDataStatMeth"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://cran.r-project.org/package=BigDataStatMeth"> 
<span class="menu-text">CRAN</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/getting-started.html">Getting Started</a></li><li class="breadcrumb-item"><a href="../tutorials/working-hdf5-matrices.html">Working with HDF5 Matrices</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/working-hdf5-matrices.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Working with HDF5 Matrices</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/first-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Your First Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a>
  <ul class="collapse">
  <li><a href="#what-youll-learn" id="toc-what-youll-learn" class="nav-link" data-scroll-target="#what-youll-learn"><span class="header-section-number">1.1</span> What You’ll Learn</a></li>
  </ul></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites"><span class="header-section-number">2</span> Prerequisites</a></li>
  <li><a href="#converting-text-files-to-hdf5" id="toc-converting-text-files-to-hdf5" class="nav-link" data-scroll-target="#converting-text-files-to-hdf5"><span class="header-section-number">3</span> Converting Text Files to HDF5</a>
  <ul class="collapse">
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link" data-scroll-target="#the-problem"><span class="header-section-number">3.1</span> The Problem</a></li>
  <li><a href="#the-solution" id="toc-the-solution" class="nav-link" data-scroll-target="#the-solution"><span class="header-section-number">3.2</span> The Solution</a></li>
  <li><a href="#example-converting-a-csv-file" id="toc-example-converting-a-csv-file" class="nav-link" data-scroll-target="#example-converting-a-csv-file"><span class="header-section-number">3.3</span> Example: Converting a CSV File</a></li>
  <li><a href="#verify-the-conversion" id="toc-verify-the-conversion" class="nav-link" data-scroll-target="#verify-the-conversion"><span class="header-section-number">3.4</span> Verify the Conversion</a></li>
  <li><a href="#working-with-different-delimiters" id="toc-working-with-different-delimiters" class="nav-link" data-scroll-target="#working-with-different-delimiters"><span class="header-section-number">3.5</span> Working with Different Delimiters</a></li>
  </ul></li>
  <li><a href="#managing-multiple-datasets" id="toc-managing-multiple-datasets" class="nav-link" data-scroll-target="#managing-multiple-datasets"><span class="header-section-number">4</span> Managing Multiple Datasets</a>
  <ul class="collapse">
  <li><a href="#creating-a-multi-dataset-file" id="toc-creating-a-multi-dataset-file" class="nav-link" data-scroll-target="#creating-a-multi-dataset-file"><span class="header-section-number">4.1</span> Creating a Multi-Dataset File</a></li>
  <li><a href="#inspecting-file-contents" id="toc-inspecting-file-contents" class="nav-link" data-scroll-target="#inspecting-file-contents"><span class="header-section-number">4.2</span> Inspecting File Contents</a></li>
  </ul></li>
  <li><a href="#adding-and-removing-datasets" id="toc-adding-and-removing-datasets" class="nav-link" data-scroll-target="#adding-and-removing-datasets"><span class="header-section-number">5</span> Adding and Removing Datasets</a>
  <ul class="collapse">
  <li><a href="#adding-new-datasets" id="toc-adding-new-datasets" class="nav-link" data-scroll-target="#adding-new-datasets"><span class="header-section-number">5.1</span> Adding New Datasets</a></li>
  <li><a href="#removing-datasets" id="toc-removing-datasets" class="nav-link" data-scroll-target="#removing-datasets"><span class="header-section-number">5.2</span> Removing Datasets</a></li>
  </ul></li>
  <li><a href="#efficient-data-access" id="toc-efficient-data-access" class="nav-link" data-scroll-target="#efficient-data-access"><span class="header-section-number">6</span> Efficient Data Access</a>
  <ul class="collapse">
  <li><a href="#reading-subsets" id="toc-reading-subsets" class="nav-link" data-scroll-target="#reading-subsets"><span class="header-section-number">6.1</span> Reading Subsets</a></li>
  <li><a href="#flexible-indexing" id="toc-flexible-indexing" class="nav-link" data-scroll-target="#flexible-indexing"><span class="header-section-number">6.2</span> Flexible Indexing</a></li>
  </ul></li>
  <li><a href="#working-with-large-files" id="toc-working-with-large-files" class="nav-link" data-scroll-target="#working-with-large-files"><span class="header-section-number">7</span> Working with Large Files</a>
  <ul class="collapse">
  <li><a href="#understanding-bigdatastatmeths-internal-management" id="toc-understanding-bigdatastatmeths-internal-management" class="nav-link" data-scroll-target="#understanding-bigdatastatmeths-internal-management"><span class="header-section-number">7.1</span> Understanding BigDataStatMeth’s Internal Management</a></li>
  <li><a href="#checking-file-information" id="toc-checking-file-information" class="nav-link" data-scroll-target="#checking-file-information"><span class="header-section-number">7.2</span> Checking File Information</a></li>
  <li><a href="#document-your-structure" id="toc-document-your-structure" class="nav-link" data-scroll-target="#document-your-structure"><span class="header-section-number">7.3</span> 2. Document Your Structure</a></li>
  <li><a href="#use-consistent-dimensions" id="toc-use-consistent-dimensions" class="nav-link" data-scroll-target="#use-consistent-dimensions"><span class="header-section-number">7.4</span> 3. Use Consistent Dimensions</a></li>
  </ul></li>
  <li><a href="#interactive-exercise" id="toc-interactive-exercise" class="nav-link" data-scroll-target="#interactive-exercise"><span class="header-section-number">8</span> Interactive Exercise</a>
  <ul class="collapse">
  <li><a href="#practice-designing-your-projects-hdf5-structure" id="toc-practice-designing-your-projects-hdf5-structure" class="nav-link" data-scroll-target="#practice-designing-your-projects-hdf5-structure"><span class="header-section-number">8.1</span> Practice: Designing Your Project’s HDF5 Structure</a></li>
  </ul></li>
  <li><a href="#cleanup" id="toc-cleanup" class="nav-link" data-scroll-target="#cleanup"><span class="header-section-number">9</span> Cleanup</a></li>
  <li><a href="#what-youve-learned" id="toc-what-youve-learned" class="nav-link" data-scroll-target="#what-youve-learned"><span class="header-section-number">10</span> What You’ve Learned</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">11</span> Next Steps</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">12</span> Key Takeaways</a>
  <ul class="collapse">
  <li><a href="#essential-concepts" id="toc-essential-concepts" class="nav-link" data-scroll-target="#essential-concepts"><span class="header-section-number">12.1</span> Essential Concepts</a></li>
  <li><a href="#when-to-use-hdf5-file-management" id="toc-when-to-use-hdf5-file-management" class="nav-link" data-scroll-target="#when-to-use-hdf5-file-management"><span class="header-section-number">12.2</span> When to Use HDF5 File Management</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/edit/main/tutorials/working-hdf5-matrices.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/getting-started.html">Getting Started</a></li><li class="breadcrumb-item"><a href="../tutorials/working-hdf5-matrices.html">Working with HDF5 Matrices</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Working with HDF5 Matrices</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">File Operations, Data Conversion, and Management</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>This tutorial teaches you the practical skills for working efficiently with HDF5 files: converting data from common formats, organizing complex projects with multiple datasets, and performing routine file operations. Think of this as learning the file system before learning programming - you need to understand how to organize and access your data before diving into statistical analyses.</p>
<section id="what-youll-learn" class="level3 learning-objectives" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="what-youll-learn"><span class="header-section-number">1.1</span> What You’ll Learn</h3>
<p>By the end of this tutorial, you will:</p>
<ul>
<li>Convert text files (CSV, TSV) to HDF5 format efficiently</li>
<li>Organize multiple related datasets in one HDF5 file</li>
<li>Use hierarchical groups to structure complex projects</li>
<li>Add, inspect, and remove datasets safely</li>
<li>Read data efficiently (whole datasets vs.&nbsp;subsets)</li>
<li>Apply best practices for HDF5 file organization</li>
<li>Understand when to use rhdf5 vs.&nbsp;BigDataStatMeth functions</li>
</ul>
</section>
<hr>
</section>
<section id="prerequisites" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="prerequisites"><span class="header-section-number">2</span> Prerequisites</h2>
<p>Complete the <a href="../tutorials/getting-started.html">Getting Started</a> tutorial first. You should have:</p>
<ul>
<li>BigDataStatMeth installed and working</li>
<li>Basic understanding of HDF5 structure (groups and datasets)</li>
<li>R and rhdf5 loaded</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
<section id="converting-text-files-to-hdf5" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="converting-text-files-to-hdf5"><span class="header-section-number">3</span> Converting Text Files to HDF5</h2>
<section id="the-problem" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="the-problem"><span class="header-section-number">3.1</span> The Problem</h3>
<p>You have large text files (CSV, TSV, or custom delimiters) that won’t fit comfortably in RAM. Loading them with <code>read.csv()</code> or <code>read.table()</code> is slow or impossible.</p>
</section>
<section id="the-solution" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="the-solution"><span class="header-section-number">3.2</span> The Solution</h3>
<p>Use <code>bdImportTextFile_hdf5()</code> to convert directly to HDF5 format, processing the file in chunks.</p>
</section>
<section id="example-converting-a-csv-file" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="example-converting-a-csv-file"><span class="header-section-number">3.3</span> Example: Converting a CSV File</h3>
<p>We’ll use a real clinical dataset (<code>colesterol.csv</code>) with cholesterol and metabolic measurements:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if file exists (should be in same directory as tutorial)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"colesterol.csv"</span>)) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"colesterol.csv not found. Please ensure it's in the working directory."</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check file size</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>file_size_kb <span class="ot">&lt;-</span> <span class="fu">file.info</span>(<span class="st">"colesterol.csv"</span>)<span class="sc">$</span>size <span class="sc">/</span> <span class="dv">1024</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"File size:"</span>, <span class="fu">round</span>(file_size_kb, <span class="dv">1</span>), <span class="st">"KB</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>File size: 152.1 KB</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview first few lines</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">First few lines of the CSV:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
First few lines of the CSV:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">read.csv</span>(<span class="st">"colesterol.csv"</span>, <span class="at">nrows =</span> <span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  TCholesterol      Age  Insulin Creatinine      BUN     LLDR Triglycerides
1     223.7348 55.25039 14.90246  0.9026095 10.22067 1.450970      199.0737
2     248.1820 53.47404 25.12592  0.8710345 17.10225 1.002655      169.7877
3     180.2071 58.54268 12.95197  0.8882435 11.21530 1.073924      150.2938
     HDL_C     LDL_C Sex
1 38.37616 107.09286   0
2 36.35374  83.66443   1
3 55.91920 108.02967   1</code></pre>
</div>
</div>
<p>Now convert to HDF5:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert CSV to HDF5</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">bdImportTextFile_hdf5</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"colesterol.csv"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">","</span>,                        <span class="co"># CSV uses commas</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputfile =</span> <span class="st">"clinical_data.hdf5"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outGroup =</span> <span class="st">"clinical"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outDataset =</span> <span class="st">"measurements"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,                    <span class="co"># First row is column names</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ File converted to HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ File converted to HDF5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Output file:"</span>, result<span class="sc">$</span>fn, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Output file: clinical_data.hdf5 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Output dataset:"</span>, result<span class="sc">$</span>ds, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Output dataset: clinical/measurements </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Important: Numeric Data Only
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>bdImportTextFile_hdf5()</code> handles numeric data. The first column (if character-based IDs) is stored separately as row names. Column names are stored in a separate dataset.</p>
<p>The numeric matrix contains only the numerical measurements (Age, Cholesterol, Insulin, etc.).</p>
</div>
</div>
</section>
<section id="verify-the-conversion" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="verify-the-conversion"><span class="header-section-number">3.4</span> Verify the Conversion</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect structure</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(result<span class="sc">$</span>fn)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             group                   name       otype   dclass
0                                /               clinical   H5I_GROUP         
1                        /clinical .measurements_dimnames   H5I_GROUP         
2 /clinical/.measurements_dimnames                      2 H5I_DATASET COMPOUND
3                        /clinical           measurements H5I_DATASET    FLOAT
        dim
0          
1          
2        10
3 1000 x 10</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read back a portion</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>converted_data <span class="ot">&lt;-</span> <span class="fu">h5read</span>(result<span class="sc">$</span>fn, result<span class="sc">$</span>ds, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">index =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="cn">NULL</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>converted_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]     [,3]      [,4]     [,5]     [,6]     [,7]     [,8]
[1,] 223.7348 55.25039 14.90246 0.9026095 10.22067 1.450970 199.0737 38.37616
[2,] 248.1820 53.47404 25.12592 0.8710345 17.10225 1.002655 169.7877 36.35374
[3,] 180.2071 58.54268 12.95197 0.8882435 11.21530 1.073924 150.2938 55.91920
[4,] 200.1522 62.58284 28.27819 0.9361357 12.79399 1.129373 150.0377 51.89241
[5,] 234.3281 68.70254 13.21404 0.7775238 11.39689 1.235655 161.8820 45.25873
          [,9] [,10]
[1,] 107.09286     0
[2,]  83.66443     1
[3,] 108.02967     1
[4,] 108.83731     1
[5,]  94.98369     1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read column names</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>colnames_data <span class="ot">&lt;-</span> <span class="fu">h5read</span>(result<span class="sc">$</span>fn, result<span class="sc">$</span>ds_cols)[,<span class="dv">1</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>colnames_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "TCholesterol"  "Age"           "Insulin"       "Creatinine"   
 [5] "BUN"           "LLDR"          "Triglycerides" "HDL_C"        
 [9] "LDL_C"         "Sex"          </code></pre>
</div>
</div>
</section>
<section id="working-with-different-delimiters" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="working-with-different-delimiters"><span class="header-section-number">3.5</span> Working with Different Delimiters</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tab-separated file</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bdImportTextFile_hdf5</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"data.tsv"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputfile =</span> <span class="st">"data.hdf5"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outGroup =</span> <span class="st">"imported"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outDataset =</span> <span class="st">"data"</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom delimiter (e.g., semicolon)</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">bdImportTextFile_hdf5</span>(</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"data.txt"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">";"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputfile =</span> <span class="st">"data.hdf5"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">outGroup =</span> <span class="st">"imported"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">outDataset =</span> <span class="st">"data"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
</section>
<section id="managing-multiple-datasets" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="managing-multiple-datasets"><span class="header-section-number">4</span> Managing Multiple Datasets</h2>
<p>One HDF5 file can store multiple datasets, organized in groups. This is ideal for related analyses.</p>
<section id="creating-a-multi-dataset-file" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="creating-a-multi-dataset-file"><span class="header-section-number">4.1</span> Creating a Multi-Dataset File</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create three related datasets</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>genotype <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1000</span><span class="sc">*</span><span class="dv">500</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="dv">1000</span>, <span class="dv">500</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>phenotype <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">10</span>), <span class="dv">1000</span>, <span class="dv">10</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>covariates <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">5</span>), <span class="dv">1000</span>, <span class="dv">5</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Store in same file, different groups</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>project_file <span class="ot">&lt;-</span> <span class="st">"multi_dataset_project.hdf5"</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> project_file,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> genotype,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"genetics"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"snps"</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">TRUE</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fn
[1] "multi_dataset_project.hdf5"

$ds
[1] "genetics/snps"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> project_file,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> phenotype,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"phenotypes"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"traits"</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fn
[1] "multi_dataset_project.hdf5"

$ds
[1] "phenotypes/traits"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> project_file,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> covariates,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"phenotypes"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"covariates"</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fn
[1] "multi_dataset_project.hdf5"

$ds
[1] "phenotypes/covariates"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Multi-dataset file created</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Multi-dataset file created</code></pre>
</div>
</div>
</section>
<section id="inspecting-file-contents" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="inspecting-file-contents"><span class="header-section-number">4.2</span> Inspecting File Contents</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List all contents</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(project_file)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        group       name       otype  dclass        dim
0           /   genetics   H5I_GROUP                   
1   /genetics       snps H5I_DATASET INTEGER 1000 x 500
2           / phenotypes   H5I_GROUP                   
3 /phenotypes covariates H5I_DATASET   FLOAT   1000 x 5
4 /phenotypes     traits H5I_DATASET   FLOAT  1000 x 10</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Organizing Your Data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Good organization strategies:</p>
<p><strong>By data type:</strong> - <code>/genetics/</code> - SNP matrices, genomic data - <code>/phenotypes/</code> - Clinical measurements, traits - <code>/results/</code> - Analysis outputs (PCA, regression)</p>
<p><strong>By processing stage:</strong> - <code>/raw/</code> - Original imported data - <code>/qc/</code> - Quality-controlled data - <code>/normalized/</code> - Normalized, ready for analysis</p>
<p><strong>By analysis:</strong> - <code>/pca_analysis/</code> - PCA components, loadings - <code>/gwas_results/</code> - Association results</p>
</div>
</div>
<hr>
</section>
</section>
<section id="adding-and-removing-datasets" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="adding-and-removing-datasets"><span class="header-section-number">5</span> Adding and Removing Datasets</h2>
<section id="adding-new-datasets" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="adding-new-datasets"><span class="header-section-number">5.1</span> Adding New Datasets</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add another dataset to existing file</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>quality_scores <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">500</span>), <span class="dv">1000</span>, <span class="dv">500</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> project_file,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> quality_scores,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"quality_control"</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"scores"</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">FALSE</span>  <span class="co"># Don't overwrite the file</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fn
[1] "multi_dataset_project.hdf5"

$ds
[1] "quality_control/scores"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify it was added</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(project_file)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             group            name       otype  dclass        dim
0                /        genetics   H5I_GROUP                   
1        /genetics            snps H5I_DATASET INTEGER 1000 x 500
2                /      phenotypes   H5I_GROUP                   
3      /phenotypes      covariates H5I_DATASET   FLOAT   1000 x 5
4      /phenotypes          traits H5I_DATASET   FLOAT  1000 x 10
5                / quality_control   H5I_GROUP                   
6 /quality_control          scores H5I_DATASET   FLOAT 1000 x 500</code></pre>
</div>
</div>
</section>
<section id="removing-datasets" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="removing-datasets"><span class="header-section-number">5.2</span> Removing Datasets</h3>
<p>To remove datasets, use rhdf5 functions:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove a specific dataset</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5delete</span>(project_file, <span class="st">"/quality_control/scores"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove entire group</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">h5delete</span>(project_file, <span class="st">"/quality_control"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Careful with Deletion
</div>
</div>
<div class="callout-body-container callout-body">
<p>HDF5 doesn’t reclaim disk space immediately after deletion. The space is marked as free but the file size doesn’t shrink. To reclaim space, you need to repack the file using HDF5 command-line tools (<code>h5repack</code>).</p>
</div>
</div>
<hr>
</section>
</section>
<section id="efficient-data-access" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="efficient-data-access"><span class="header-section-number">6</span> Efficient Data Access</h2>
<p>One of the most powerful aspects of HDF5 is <strong>partial reading</strong> - you can access just the data you need without loading gigabytes into memory. This is the secret to working with datasets larger than your RAM.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Why We Use rhdf5 for Data Access
</div>
</div>
<div class="callout-body-container callout-body">
<p>You’ll notice we use rhdf5’s <code>h5read()</code> function for reading data. This is intentional! BigDataStatMeth focuses on <strong>computation</strong> (matrix operations, statistical methods, block-wise algorithms), while rhdf5 excels at <strong>file I/O</strong> (reading, writing, inspecting).</p>
<p><strong>Division of labor:</strong> - <strong>rhdf5</strong>: File operations, data access, inspection - <strong>BigDataStatMeth</strong>: Matrix algebra, statistics, block-wise processing</p>
<p>There’s no need to reimplement what rhdf5 already does perfectly.</p>
</div>
</div>
<section id="reading-subsets" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="reading-subsets"><span class="header-section-number">6.1</span> Reading Subsets</h3>
<p>Instead of loading entire matrices (which might be 100 GB), read just what you need:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read first 100 samples and first 50 SNPs</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> <span class="fu">h5read</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  project_file, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"/genetics/snps"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Subset dimensions:"</span>, <span class="fu">dim</span>(subset_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Subset dimensions: 100 50 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Preview of data (first 5×5):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preview of data (first 5×5):</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(subset_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,]    1    1    0    0    2
[2,]    2    2    1    1    1
[3,]    1    1    0    1    2
[4,]    2    2    0    2    2
[5,]    0    2    0    2    0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">✓ Loaded only"</span>, <span class="fu">prod</span>(<span class="fu">dim</span>(subset_data)), <span class="st">"values</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
✓ Loaded only 5000 values</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Full dataset would have been:"</span>, <span class="dv">1000</span> <span class="sc">*</span> <span class="dv">2000</span>, <span class="st">"values</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Full dataset would have been: 2e+06 values</code></pre>
</div>
</div>
</section>
<section id="flexible-indexing" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="flexible-indexing"><span class="header-section-number">6.2</span> Flexible Indexing</h3>
<p>You can read specific columns, skip rows, or sample randomly:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read specific columns only (useful for specific variables)</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>column_subset <span class="ot">&lt;-</span> <span class="fu">h5read</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  project_file,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"/genetics/snps"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>))  <span class="co"># Just these 5 columns</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Column subset dimensions:"</span>, <span class="fu">dim</span>(column_subset), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Column subset dimensions: 1000 5 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Selected columns: 1, 10, 20, 30, 40</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Selected columns: 1, 10, 20, 30, 40</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read every 10th row (useful for quick checks)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>sparse_sample <span class="ot">&lt;-</span> <span class="fu">h5read</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  project_file,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"/genetics/snps"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">list</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">10</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Sparse sample dimensions:"</span>, <span class="fu">dim</span>(sparse_sample), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Sparse sample dimensions: 100 10 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Reading every 10th row reduces data by 90%</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading every 10th row reduces data by 90%</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Smart Reading Strategies
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>For exploration:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h5read</span>(file, dataset, <span class="at">index =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="cn">NULL</span>))  <span class="co"># First 100 rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>For specific variables:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">h5read</span>(file, dataset, <span class="at">index =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>)))  <span class="co"># Specific columns</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>For random sampling:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="dv">500</span>)  <span class="co"># Random 500 rows</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5read</span>(file, dataset, <span class="at">index =</span> <span class="fu">list</span>(rows, <span class="cn">NULL</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>The key principle:</strong> Load only what you need. This is how you analyze 100 GB files on a 16 GB laptop.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="working-with-large-files" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="working-with-large-files"><span class="header-section-number">7</span> Working with Large Files</h2>
<section id="understanding-bigdatastatmeths-internal-management" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="understanding-bigdatastatmeths-internal-management"><span class="header-section-number">7.1</span> Understanding BigDataStatMeth’s Internal Management</h3>
<p>When you use BigDataStatMeth functions like <code>bdblockmult_hdf5()</code> or <code>bdSVD_hdf5()</code>, the package handles <strong>all the complexity internally</strong>:</p>
<ul>
<li>Opens and closes files automatically</li>
<li>Reads data in optimal block sizes</li>
<li>Writes results efficiently</li>
<li>Manages memory usage</li>
</ul>
<p>You simply call the function and let BigDataStatMeth do the work:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BigDataStatMeth handles everything internally:</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">bdblockmult_hdf5</span>(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"huge_file.hdf5"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"data"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="st">"matrix_A"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="st">"matrix_B"</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ↑ Behind the scenes:</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   - File opened</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Data read in blocks</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Computation performed</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Results written</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   - File closed</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># You don't see any of this!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Manual File Management: C++ API Only
</div>
</div>
<div class="callout-body-container callout-body">
<p>With BigDataStatMeth’s <strong>R functions</strong>, you never need to manually open/close files or manage blocks. The package does it all.</p>
<p><strong>Manual control is only available</strong> when developing new methods using the <strong>C++ API</strong>. This is for advanced users creating custom statistical methods who need fine-grained control over: - Block sizes - Memory allocation<br>
- Read/write patterns - Custom algorithms</p>
<p>For 99% of users, the automatic management is exactly what you want.</p>
</div>
</div>
</section>
<section id="checking-file-information" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="checking-file-information"><span class="header-section-number">7.2</span> Checking File Information</h3>
<p>Sometimes you just want to know about the data without reading it:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get file size</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>file_size_mb <span class="ot">&lt;-</span> <span class="fu">file.info</span>(project_file)<span class="sc">$</span>size <span class="sc">/</span> (<span class="dv">1024</span><span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"File size:"</span>, <span class="fu">round</span>(file_size_mb, <span class="dv">2</span>), <span class="st">"MB</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>File size: 2.78 MB</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get dataset dimensions without reading data</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>h5file <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(project_file)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>dim_snps <span class="ot">&lt;-</span> <span class="fu">dim</span>(h5file<span class="sc">$</span>genetics<span class="sc">$</span>snps)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">SNP matrix dimensions:"</span>, dim_snps[<span class="dv">1</span>], <span class="st">"samples ×"</span>, dim_snps[<span class="dv">2</span>], <span class="st">"SNPs</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SNP matrix dimensions: 1000 samples × 500 SNPs</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dim_traits <span class="ot">&lt;-</span> <span class="fu">dim</span>(h5file<span class="sc">$</span>phenotypes<span class="sc">$</span>traits)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Trait matrix dimensions:"</span>, dim_traits[<span class="dv">1</span>], <span class="st">"samples ×"</span>, dim_traits[<span class="dv">2</span>], <span class="st">"traits</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Trait matrix dimensions: 1000 samples × 10 traits</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">H5Fclose</span>(h5file)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This is useful for: - Planning analyses (how much memory will I need?) - Verifying dimensions before operations - Checking if files were created correctly H5Fclose(h5file)</p>
<p>cat(“SNP matrix dimensions:”, dim_snps[1], “×”, dim_snps[2], “”)</p>
<pre><code>
---

## Data Organization Best Practices

### 1. Use Descriptive Names


::: {.cell}

```{.r .cell-code}
# Good naming
bdCreate_hdf5_matrix(filename = "study.hdf5",
                     object = data,
                     group = "gwas_diabetes_2024",
                     dataset = "genotypes_qc_filtered")

# Avoid cryptic names
bdCreate_hdf5_matrix(filename = "data.hdf5",
                     object = data,
                     group = "g1",
                     dataset = "d")</code></pre>
<p>:::</p>
</section>
<section id="document-your-structure" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="document-your-structure"><span class="header-section-number">7.3</span> 2. Document Your Structure</h3>
<p>Keep a README or comments file describing your HDF5 organization:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a text description</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>structure_doc <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="st">HDF5 File Structure</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="st">==================</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="st">/genetics/snps - Genotype matrix (samples × SNPs)</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="st">/phenotypes/traits - Clinical measurements  </span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="st">/phenotypes/covariates - Age, sex, PCs</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="st">/results/pca - PCA results from genetics data</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># You could store this as an attribute or separate file</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(structure_doc, <span class="st">"project_structure.txt"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="use-consistent-dimensions" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="use-consistent-dimensions"><span class="header-section-number">7.4</span> 3. Use Consistent Dimensions</h3>
<p>Always keep samples in rows and features in columns. This is the standard convention in statistics and makes combining datasets much easier:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Consistent convention</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>genotypes  <span class="co"># n_samples × n_snps</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>phenotypes <span class="co"># n_samples × n_traits</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>results    <span class="co"># n_samples × n_components</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># All have samples in rows → easy to merge/join</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Understanding Row-Major vs Column-Major Storage
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is <strong>critical to understand</strong> when viewing HDF5 files directly!</p>
<p><strong>R uses column-major order</strong> (like Fortran): - Data is stored column by column in memory - Matrix[i, j] means: row i, column j</p>
<p><strong>HDF5 uses row-major order</strong> (like C/C++): - Data is stored row by row in memory<br>
- Dataset[i, j] means: row i, column j</p>
<section id="what-this-means-for-you" class="level3" data-number="7.5">
<h3 data-number="7.5" class="anchored" data-anchor-id="what-this-means-for-you"><span class="header-section-number">7.5</span> What This Means for You</h3>
<p>When you create a matrix in R:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In R: 3 samples (rows) × 5 SNPs (columns)</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>genotypes <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># [1,]    1    4    7   10   13</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [2,]    2    5    8   11   14</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># [3,]    3    6    9   12   15</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to HDF5</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(<span class="at">filename =</span> <span class="st">"test.hdf5"</span>, </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">object =</span> genotypes,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> <span class="st">"data"</span>, <span class="at">dataset =</span> <span class="st">"geno"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>When you view it in HDFView or h5dump</strong>, you’ll see the <strong>transpose</strong>:</p>
<pre><code># In HDFView: 5 × 3 (appears transposed!)
# [0,0] [0,1] [0,2]
#   1     2     3
# [1,0] [1,1] [1,2]  
#   4     5     6
# [2,0] [2,1] [2,2]
#   7     8     9</code></pre>
</section>
<section id="dont-panic" class="level3" data-number="7.6">
<h3 data-number="7.6" class="anchored" data-anchor-id="dont-panic"><span class="header-section-number">7.6</span> Don’t Panic!</h3>
<p><strong>This is normal and expected.</strong> BigDataStatMeth handles the conversion automatically:</p>
<p>✓ When you read with <code>h5read()</code> → You get the correct R matrix<br>
✓ When you compute with <code>bdCrossprod_hdf5()</code> → Dimensions are correct<br>
✓ When you save results → They’re stored correctly for R</p>
<p><strong>The transposition is handled transparently.</strong> You only notice it if you inspect files with external tools like HDFView.</p>
</section>
<section id="key-takeaway" class="level3" data-number="7.7">
<h3 data-number="7.7" class="anchored" data-anchor-id="key-takeaway"><span class="header-section-number">7.7</span> Key Takeaway</h3>
<p><strong>In R code:</strong> Think in R dimensions (samples × features)<br>
<strong>In HDFView:</strong> Expect to see transposed dimensions<br>
<strong>In BigDataStatMeth:</strong> Everything works correctly - dimensions match R expectations</p>
<p>The moral: Trust BigDataStatMeth to handle the storage details. Your matrices will always have the dimensions you expect in R.</p>
</section>
</div>
</div>
<hr>
</section>
</section>
<section id="interactive-exercise" class="level2 exercise" data-number="8">
<h2 class="exercise anchored" data-number="8" data-anchor-id="interactive-exercise"><span class="header-section-number">8</span> Interactive Exercise</h2>
<section id="practice-designing-your-projects-hdf5-structure" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="practice-designing-your-projects-hdf5-structure"><span class="header-section-number">8.1</span> Practice: Designing Your Project’s HDF5 Structure</h3>
<p>Effective HDF5 organization makes the difference between a maintainable project and a confusing mess six months later. This exercise helps you think through organization before starting real analyses.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise: Plan and create an HDF5 structure for your project</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario: You're analyzing a multi-omic study with:</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - Genomic data (SNPs): 50,000 individuals × 500,000 variants</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - Transcriptomic data (RNA-seq): same 50,000 individuals × 20,000 genes</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - Phenotype data: 50,000 individuals × 50 measurements</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - Sample metadata: IDs, age, sex, ancestry</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Your task: Design the HDF5 structure</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Everything in one file</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>project_file <span class="ot">&lt;-</span> <span class="st">"my_study.hdf5"</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co"># How would you organize groups?</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># /raw_data/genomics/snps</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co"># /raw_data/transcriptomics/expression</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="co"># /raw_data/phenotypes/measurements</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co"># /metadata/samples</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co"># /quality_control/filtered_snps</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="co"># /quality_control/normalized_expression</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="co"># /results/pca</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="co"># /results/associations</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Try creating this structure:</span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(project_file, dummy_data, </span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> <span class="st">"/raw_data/genomics"</span>, </span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dataset =</span> <span class="st">"snps"</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="co"># ... add more datasets</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Separate files per data type</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="co"># genomics.hdf5, transcriptomics.hdf5, phenotypes.hdf5</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="co"># When is this better? When worse?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Reflection Questions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Think through these design decisions for your actual or planned projects:</p>
<p><strong>1. File Organization Strategy:</strong> - One large file vs.&nbsp;multiple smaller files? - For your project, which approach makes more sense? - How does your team typically share data? - Will different people access different parts?</p>
<p><strong>2. Group Hierarchy:</strong> - How deep should your folder structure go? - <code>/data/type/version</code> vs.&nbsp;<code>/data_type_version</code>? - Can you navigate your structure 6 months from now? - Would a new collaborator understand it?</p>
<p><strong>3. Dataset Naming:</strong> - “matrix1” vs.&nbsp;“filtered_normalized_snps_maf05”? - Descriptive names vs.&nbsp;short names? - How do you indicate processing steps? - Do you need version numbers in names?</p>
<p><strong>4. Metadata Management:</strong> - Where do row/column names go? - How do you store processing parameters? - Document analysis dates and software versions? - Link between datasets (which samples are in which matrix)?</p>
<p><strong>5. Practical Constraints:</strong> - How much disk space do you have? - Will files be transferred between systems? - Need to share via email/FTP? (file size limits) - Backup strategy for large files?</p>
<p><strong>6. Future Expansion:</strong> - What if you add more samples next year? - New data types (proteomics, metabolomics)? - Reanalysis with different parameters? - Where does each new piece go?</p>
<p>There’s no universal “correct” organization - it depends on your project scale, team structure, and workflow. The goal is thinking through these questions before you have 50 analysis scripts depending on a particular structure.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="cleanup" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="cleanup"><span class="header-section-number">9</span> Cleanup</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close all HDF5 connections</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove generated HDF5 file</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="st">"clinical_data.hdf5"</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"multi_dataset_project.hdf5"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Tutorial cleanup complete</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Tutorial cleanup complete</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Note: colesterol.csv is kept for reference</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Note: colesterol.csv is kept for reference</code></pre>
</div>
</div>
<hr>
</section>
<section id="what-youve-learned" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="what-youve-learned"><span class="header-section-number">10</span> What You’ve Learned</h2>
<p>✅ <strong>Convert</strong> text files (CSV, TSV) to HDF5 format<br>
✅ <strong>Manage</strong> multiple datasets in one HDF5 file<br>
✅ <strong>Organize</strong> data using groups and descriptive names<br>
✅ <strong>Access</strong> data efficiently (subsets, slicing)<br>
✅ <strong>Apply</strong> best practices for file organization</p>
<hr>
</section>
<section id="next-steps" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">11</span> Next Steps</h2>
<p><strong>Continue the tutorial series:</strong></p>
<ol type="1">
<li>✅ <a href="../tutorials/getting-started.html">Getting Started</a></li>
<li>✅ <strong>Working with HDF5 Matrices</strong> (you are here)</li>
<li>→ <a href="../tutorials/first-analysis.html">Your First Analysis</a> - Complete analysis workflow</li>
</ol>
<p><strong>Ready for real analysis:</strong></p>
<ul>
<li><a href="../workflows/implementing-pca.html">Implementing PCA</a> - Full PCA workflow on genomic data</li>
<li><a href="../workflows/implementing-cca.html">Implementing CCA</a> - Canonical correlation analysis</li>
</ul>
<hr>
</section>
<section id="key-takeaways" class="level2 key-concept" data-number="12">
<h2 class="key-concept anchored" data-number="12" data-anchor-id="key-takeaways"><span class="header-section-number">12</span> Key Takeaways</h2>
<p>Let’s consolidate your understanding of HDF5 file management and organization for big data projects.</p>
<section id="essential-concepts" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="essential-concepts"><span class="header-section-number">12.1</span> Essential Concepts</h3>
<p><strong>HDF5 is a data management system, not just a file format.</strong> It provides hierarchical organization (groups and datasets), partial I/O (read only what you need), and cross-platform compatibility. This makes it fundamentally different from flat file formats like CSV. You’re not just storing data - you’re organizing an entire analysis project in a structured, queryable format.</p>
<p><strong>File conversion is a one-time investment</strong> that pays dividends throughout your project. Converting a 50 GB CSV file to HDF5 might take 20 minutes, but every subsequent analysis benefits from fast partial reads, organized structure, and efficient access patterns. The upfront cost amortizes across dozens or hundreds of analyses over the project lifetime.</p>
<p><strong>Organization decisions made early are hard to change later.</strong> Once you have 50 analysis scripts expecting data at <code>/raw_data/genomics/snps</code>, reorganizing the file breaks everything. Take time designing your structure before populating it. A bit of planning prevents substantial refactoring pain later.</p>
<p><strong>BigDataStatMeth and rhdf5 serve different purposes.</strong> BigDataStatMeth creates and operates on matrices (the computational work). rhdf5 provides file I/O and inspection (reading, writing, navigating). You need both: BigDataStatMeth for analysis, rhdf5 for file management. Understanding this division of labor prevents confusion about which tool does what.</p>
<p><strong>Row-major vs.&nbsp;column-major storage is handled automatically.</strong> R uses column-major order, HDF5 uses row-major. BigDataStatMeth manages this conversion transparently. Your matrices always have the dimensions you expect in R code, even though they’re stored differently on disk. You only notice the difference if you inspect files with external tools like HDFView - and even then, it’s just a visual curiosity, not a problem.</p>
<p><strong>Efficient HDF5 use means reading strategically.</strong> Don’t read entire 100 GB matrices to access a 1 MB subset. Use dimension slicing, work with row/column blocks, and read only required data. The ability to partially read files is HDF5’s main advantage - leverage it. This is why understanding dataset dimensions and organization matters.</p>
</section>
<section id="when-to-use-hdf5-file-management" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="when-to-use-hdf5-file-management"><span class="header-section-number">12.2</span> When to Use HDF5 File Management</h3>
<p>Understanding when HDF5’s organizational features help versus when simpler approaches suffice guides practical decisions about file structure and management.</p>
<p>✅ <strong>Use hierarchical HDF5 organization when:</strong></p>
<ul>
<li><p><strong>You have multiple related datasets</strong> - Genomics + transcriptomics + phenotypes all in one project. Groups like <code>/genetics/</code>, <code>/expression/</code>, <code>/clinical/</code> keep everything organized in a single file rather than managing dozens of separate files.</p></li>
<li><p><strong>Your project will grow over time</strong> - Starting organized prevents refactoring pain. If you’ll add more samples, time points, or data types later, hierarchical structure accommodates growth naturally.</p></li>
<li><p><strong>Multiple team members access the same data</strong> - Clear organization (<code>/raw_data/</code>, <code>/quality_control/</code>, <code>/results/</code>) makes files self-documenting. Collaborators can navigate without constant explanations.</p></li>
<li><p><strong>You need to document processing steps</strong> - Dataset names like <code>genotypes_filtered_maf005_hwe1e6</code> encode processing history. The file structure itself documents your analysis pipeline.</p></li>
</ul>
<p>✅ <strong>Use rhdf5 for file operations when:</strong></p>
<ul>
<li><p><strong>You need to inspect file contents</strong> - <code>h5ls()</code> shows structure, <code>h5read()</code> retrieves data. rhdf5 provides the file navigation and I/O tools.</p></li>
<li><p><strong>You’re managing metadata</strong> - Row names, column names, attributes, and documentation all go through rhdf5 functions.</p></li>
<li><p><strong>You need partial data access</strong> - Reading specific rows, columns, or blocks uses rhdf5’s indexing capabilities: <code>h5read(file, dataset, index = list(rows, cols))</code>.</p></li>
</ul>
<p>❌ <strong>Simpler approaches work better when:</strong></p>
<ul>
<li><p><strong>You have a single dataset</strong> - If your entire project is one matrix, elaborate HDF5 organization adds no value. A simple flat file or single-group HDF5 suffices.</p></li>
<li><p><strong>Data won’t grow or change</strong> - For static datasets that are finalized and won’t be extended, elaborate organization provides minimal benefit over simple naming.</p></li>
<li><p><strong>Quick, temporary analyses</strong> - If you’re not building a reusable analysis pipeline, the organizational overhead outweighs benefits. Use whatever gets you to results fastest.</p></li>
<li><p><strong>You never need partial reads</strong> - If you always process entire matrices, HDF5’s partial I/O advantage disappears. The organizational features may still help, but the performance benefit is minimal.</p></li>
</ul>
<p>Understanding these trade-offs helps you invest effort where it pays off - elaborate organization for complex, growing projects; simple structure for straightforward, static analyses.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/isglobal-brge\.github\.io\/BigDataStatMeth\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Working with HDF5 Matrices"</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "File Operations, Data Conversion, and Management"</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>This tutorial teaches you the practical skills for working efficiently with HDF5 files: converting data from common formats, organizing complex projects with multiple datasets, and performing routine file operations. Think of this as learning the file system before learning programming - you need to understand how to organize and access your data before diving into statistical analyses.</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>::: {.learning-objectives}</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="fu">### What You'll Learn</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>By the end of this tutorial, you will:</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Convert text files (CSV, TSV) to HDF5 format efficiently</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Organize multiple related datasets in one HDF5 file</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use hierarchical groups to structure complex projects</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Add, inspect, and remove datasets safely</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read data efficiently (whole datasets vs. subsets)</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Apply best practices for HDF5 file organization</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand when to use rhdf5 vs. BigDataStatMeth functions</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prerequisites</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>Complete the <span class="co">[</span><span class="ot">Getting Started</span><span class="co">](getting-started.qmd)</span> tutorial first. You should have:</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>BigDataStatMeth installed and working</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Basic understanding of HDF5 structure (groups and datasets)</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>R and rhdf5 loaded</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, eval=TRUE, message=FALSE}</span></span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## Converting Text Files to HDF5</span></span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Problem</span></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>You have large text files (CSV, TSV, or custom delimiters) that won't fit comfortably in RAM. Loading them with <span class="in">`read.csv()`</span> or <span class="in">`read.table()`</span> is slow or impossible.</span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Solution</span></span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`bdImportTextFile_hdf5()`</span> to convert directly to HDF5 format, processing the file in chunks.</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: Converting a CSV File</span></span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a>We'll use a real clinical dataset (<span class="in">`colesterol.csv`</span>) with cholesterol and metabolic measurements:</span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r check-csv, eval=TRUE}</span></span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if file exists (should be in same directory as tutorial)</span></span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"colesterol.csv"</span>)) {</span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"colesterol.csv not found. Please ensure it's in the working directory."</span>)</span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Check file size</span></span>
<span id="cb77-62"><a href="#cb77-62" aria-hidden="true" tabindex="-1"></a>file_size_kb <span class="ot">&lt;-</span> <span class="fu">file.info</span>(<span class="st">"colesterol.csv"</span>)<span class="sc">$</span>size <span class="sc">/</span> <span class="dv">1024</span></span>
<span id="cb77-63"><a href="#cb77-63" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"File size:"</span>, <span class="fu">round</span>(file_size_kb, <span class="dv">1</span>), <span class="st">"KB</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-64"><a href="#cb77-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-65"><a href="#cb77-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview first few lines</span></span>
<span id="cb77-66"><a href="#cb77-66" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">First few lines of the CSV:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-67"><a href="#cb77-67" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">read.csv</span>(<span class="st">"colesterol.csv"</span>, <span class="at">nrows =</span> <span class="dv">3</span>))</span>
<span id="cb77-68"><a href="#cb77-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-69"><a href="#cb77-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-70"><a href="#cb77-70" aria-hidden="true" tabindex="-1"></a>Now convert to HDF5:</span>
<span id="cb77-71"><a href="#cb77-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-72"><a href="#cb77-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r convert-csv, eval=TRUE}</span></span>
<span id="cb77-73"><a href="#cb77-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert CSV to HDF5</span></span>
<span id="cb77-74"><a href="#cb77-74" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">bdImportTextFile_hdf5</span>(</span>
<span id="cb77-75"><a href="#cb77-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"colesterol.csv"</span>,</span>
<span id="cb77-76"><a href="#cb77-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">","</span>,                        <span class="co"># CSV uses commas</span></span>
<span id="cb77-77"><a href="#cb77-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputfile =</span> <span class="st">"clinical_data.hdf5"</span>,</span>
<span id="cb77-78"><a href="#cb77-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">outGroup =</span> <span class="st">"clinical"</span>,</span>
<span id="cb77-79"><a href="#cb77-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">outDataset =</span> <span class="st">"measurements"</span>,</span>
<span id="cb77-80"><a href="#cb77-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,                    <span class="co"># First row is column names</span></span>
<span id="cb77-81"><a href="#cb77-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb77-82"><a href="#cb77-82" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-83"><a href="#cb77-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-84"><a href="#cb77-84" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ File converted to HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-85"><a href="#cb77-85" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Output file:"</span>, result<span class="sc">$</span>fn, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-86"><a href="#cb77-86" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Output dataset:"</span>, result<span class="sc">$</span>ds, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-87"><a href="#cb77-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-88"><a href="#cb77-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-89"><a href="#cb77-89" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb77-90"><a href="#cb77-90" aria-hidden="true" tabindex="-1"></a><span class="fu">## Important: Numeric Data Only</span></span>
<span id="cb77-91"><a href="#cb77-91" aria-hidden="true" tabindex="-1"></a><span class="in">`bdImportTextFile_hdf5()`</span> handles numeric data. The first column (if character-based IDs) is stored separately as row names. Column names are stored in a separate dataset.</span>
<span id="cb77-92"><a href="#cb77-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-93"><a href="#cb77-93" aria-hidden="true" tabindex="-1"></a>The numeric matrix contains only the numerical measurements (Age, Cholesterol, Insulin, etc.).</span>
<span id="cb77-94"><a href="#cb77-94" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-95"><a href="#cb77-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-96"><a href="#cb77-96" aria-hidden="true" tabindex="-1"></a><span class="fu">### Verify the Conversion</span></span>
<span id="cb77-97"><a href="#cb77-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-98"><a href="#cb77-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{r verify-conversion, eval=TRUE}</span></span>
<span id="cb77-99"><a href="#cb77-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect structure</span></span>
<span id="cb77-100"><a href="#cb77-100" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(result<span class="sc">$</span>fn)</span>
<span id="cb77-101"><a href="#cb77-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-102"><a href="#cb77-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Read back a portion</span></span>
<span id="cb77-103"><a href="#cb77-103" aria-hidden="true" tabindex="-1"></a>converted_data <span class="ot">&lt;-</span> <span class="fu">h5read</span>(result<span class="sc">$</span>fn, result<span class="sc">$</span>ds, </span>
<span id="cb77-104"><a href="#cb77-104" aria-hidden="true" tabindex="-1"></a>                         <span class="at">index =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="cn">NULL</span>))</span>
<span id="cb77-105"><a href="#cb77-105" aria-hidden="true" tabindex="-1"></a>converted_data</span>
<span id="cb77-106"><a href="#cb77-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-107"><a href="#cb77-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Read column names</span></span>
<span id="cb77-108"><a href="#cb77-108" aria-hidden="true" tabindex="-1"></a>colnames_data <span class="ot">&lt;-</span> <span class="fu">h5read</span>(result<span class="sc">$</span>fn, result<span class="sc">$</span>ds_cols)[,<span class="dv">1</span>]</span>
<span id="cb77-109"><a href="#cb77-109" aria-hidden="true" tabindex="-1"></a>colnames_data</span>
<span id="cb77-110"><a href="#cb77-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-111"><a href="#cb77-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-112"><a href="#cb77-112" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with Different Delimiters</span></span>
<span id="cb77-113"><a href="#cb77-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-114"><a href="#cb77-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r other-delimiters, eval=FALSE}</span></span>
<span id="cb77-115"><a href="#cb77-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Tab-separated file</span></span>
<span id="cb77-116"><a href="#cb77-116" aria-hidden="true" tabindex="-1"></a><span class="fu">bdImportTextFile_hdf5</span>(</span>
<span id="cb77-117"><a href="#cb77-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"data.tsv"</span>,</span>
<span id="cb77-118"><a href="#cb77-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb77-119"><a href="#cb77-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputfile =</span> <span class="st">"data.hdf5"</span>,</span>
<span id="cb77-120"><a href="#cb77-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">outGroup =</span> <span class="st">"imported"</span>,</span>
<span id="cb77-121"><a href="#cb77-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">outDataset =</span> <span class="st">"data"</span></span>
<span id="cb77-122"><a href="#cb77-122" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-123"><a href="#cb77-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-124"><a href="#cb77-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom delimiter (e.g., semicolon)</span></span>
<span id="cb77-125"><a href="#cb77-125" aria-hidden="true" tabindex="-1"></a><span class="fu">bdImportTextFile_hdf5</span>(</span>
<span id="cb77-126"><a href="#cb77-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"data.txt"</span>,</span>
<span id="cb77-127"><a href="#cb77-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">";"</span>,</span>
<span id="cb77-128"><a href="#cb77-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputfile =</span> <span class="st">"data.hdf5"</span>,</span>
<span id="cb77-129"><a href="#cb77-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">outGroup =</span> <span class="st">"imported"</span>,</span>
<span id="cb77-130"><a href="#cb77-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">outDataset =</span> <span class="st">"data"</span></span>
<span id="cb77-131"><a href="#cb77-131" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-132"><a href="#cb77-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-133"><a href="#cb77-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-134"><a href="#cb77-134" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-135"><a href="#cb77-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-136"><a href="#cb77-136" aria-hidden="true" tabindex="-1"></a><span class="fu">## Managing Multiple Datasets</span></span>
<span id="cb77-137"><a href="#cb77-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-138"><a href="#cb77-138" aria-hidden="true" tabindex="-1"></a>One HDF5 file can store multiple datasets, organized in groups. This is ideal for related analyses.</span>
<span id="cb77-139"><a href="#cb77-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-140"><a href="#cb77-140" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating a Multi-Dataset File</span></span>
<span id="cb77-141"><a href="#cb77-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-142"><a href="#cb77-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r multi-dataset, eval=TRUE}</span></span>
<span id="cb77-143"><a href="#cb77-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Create three related datasets</span></span>
<span id="cb77-144"><a href="#cb77-144" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb77-145"><a href="#cb77-145" aria-hidden="true" tabindex="-1"></a>genotype <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1000</span><span class="sc">*</span><span class="dv">500</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>), <span class="dv">1000</span>, <span class="dv">500</span>)</span>
<span id="cb77-146"><a href="#cb77-146" aria-hidden="true" tabindex="-1"></a>phenotype <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">10</span>), <span class="dv">1000</span>, <span class="dv">10</span>)</span>
<span id="cb77-147"><a href="#cb77-147" aria-hidden="true" tabindex="-1"></a>covariates <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">5</span>), <span class="dv">1000</span>, <span class="dv">5</span>)</span>
<span id="cb77-148"><a href="#cb77-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-149"><a href="#cb77-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Store in same file, different groups</span></span>
<span id="cb77-150"><a href="#cb77-150" aria-hidden="true" tabindex="-1"></a>project_file <span class="ot">&lt;-</span> <span class="st">"multi_dataset_project.hdf5"</span></span>
<span id="cb77-151"><a href="#cb77-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-152"><a href="#cb77-152" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb77-153"><a href="#cb77-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> project_file,</span>
<span id="cb77-154"><a href="#cb77-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> genotype,</span>
<span id="cb77-155"><a href="#cb77-155" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"genetics"</span>,</span>
<span id="cb77-156"><a href="#cb77-156" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"snps"</span>,</span>
<span id="cb77-157"><a href="#cb77-157" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">TRUE</span></span>
<span id="cb77-158"><a href="#cb77-158" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-159"><a href="#cb77-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-160"><a href="#cb77-160" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb77-161"><a href="#cb77-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> project_file,</span>
<span id="cb77-162"><a href="#cb77-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> phenotype,</span>
<span id="cb77-163"><a href="#cb77-163" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"phenotypes"</span>,</span>
<span id="cb77-164"><a href="#cb77-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"traits"</span></span>
<span id="cb77-165"><a href="#cb77-165" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-166"><a href="#cb77-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-167"><a href="#cb77-167" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb77-168"><a href="#cb77-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> project_file,</span>
<span id="cb77-169"><a href="#cb77-169" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> covariates,</span>
<span id="cb77-170"><a href="#cb77-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"phenotypes"</span>,</span>
<span id="cb77-171"><a href="#cb77-171" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"covariates"</span></span>
<span id="cb77-172"><a href="#cb77-172" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-173"><a href="#cb77-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-174"><a href="#cb77-174" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Multi-dataset file created</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-175"><a href="#cb77-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-176"><a href="#cb77-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-177"><a href="#cb77-177" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inspecting File Contents</span></span>
<span id="cb77-178"><a href="#cb77-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-179"><a href="#cb77-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r inspect-multi, eval=TRUE}</span></span>
<span id="cb77-180"><a href="#cb77-180" aria-hidden="true" tabindex="-1"></a><span class="co"># List all contents</span></span>
<span id="cb77-181"><a href="#cb77-181" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(project_file)</span>
<span id="cb77-182"><a href="#cb77-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-183"><a href="#cb77-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-184"><a href="#cb77-184" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb77-185"><a href="#cb77-185" aria-hidden="true" tabindex="-1"></a><span class="fu">## Organizing Your Data</span></span>
<span id="cb77-186"><a href="#cb77-186" aria-hidden="true" tabindex="-1"></a>Good organization strategies:</span>
<span id="cb77-187"><a href="#cb77-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-188"><a href="#cb77-188" aria-hidden="true" tabindex="-1"></a>**By data type:**</span>
<span id="cb77-189"><a href="#cb77-189" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`/genetics/`</span> - SNP matrices, genomic data</span>
<span id="cb77-190"><a href="#cb77-190" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`/phenotypes/`</span> - Clinical measurements, traits</span>
<span id="cb77-191"><a href="#cb77-191" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`/results/`</span> - Analysis outputs (PCA, regression)</span>
<span id="cb77-192"><a href="#cb77-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-193"><a href="#cb77-193" aria-hidden="true" tabindex="-1"></a>**By processing stage:**</span>
<span id="cb77-194"><a href="#cb77-194" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`/raw/`</span> - Original imported data</span>
<span id="cb77-195"><a href="#cb77-195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`/qc/`</span> - Quality-controlled data</span>
<span id="cb77-196"><a href="#cb77-196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`/normalized/`</span> - Normalized, ready for analysis</span>
<span id="cb77-197"><a href="#cb77-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-198"><a href="#cb77-198" aria-hidden="true" tabindex="-1"></a>**By analysis:**</span>
<span id="cb77-199"><a href="#cb77-199" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`/pca_analysis/`</span> - PCA components, loadings</span>
<span id="cb77-200"><a href="#cb77-200" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`/gwas_results/`</span> - Association results</span>
<span id="cb77-201"><a href="#cb77-201" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-202"><a href="#cb77-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-203"><a href="#cb77-203" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-204"><a href="#cb77-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-205"><a href="#cb77-205" aria-hidden="true" tabindex="-1"></a><span class="fu">## Adding and Removing Datasets</span></span>
<span id="cb77-206"><a href="#cb77-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-207"><a href="#cb77-207" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adding New Datasets</span></span>
<span id="cb77-208"><a href="#cb77-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-209"><a href="#cb77-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add-dataset, eval=TRUE}</span></span>
<span id="cb77-210"><a href="#cb77-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Add another dataset to existing file</span></span>
<span id="cb77-211"><a href="#cb77-211" aria-hidden="true" tabindex="-1"></a>quality_scores <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">1000</span><span class="sc">*</span><span class="dv">500</span>), <span class="dv">1000</span>, <span class="dv">500</span>)</span>
<span id="cb77-212"><a href="#cb77-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-213"><a href="#cb77-213" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb77-214"><a href="#cb77-214" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> project_file,</span>
<span id="cb77-215"><a href="#cb77-215" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> quality_scores,</span>
<span id="cb77-216"><a href="#cb77-216" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"quality_control"</span>,</span>
<span id="cb77-217"><a href="#cb77-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"scores"</span>,</span>
<span id="cb77-218"><a href="#cb77-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">FALSE</span>  <span class="co"># Don't overwrite the file</span></span>
<span id="cb77-219"><a href="#cb77-219" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-220"><a href="#cb77-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-221"><a href="#cb77-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify it was added</span></span>
<span id="cb77-222"><a href="#cb77-222" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(project_file)</span>
<span id="cb77-223"><a href="#cb77-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-224"><a href="#cb77-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-225"><a href="#cb77-225" aria-hidden="true" tabindex="-1"></a><span class="fu">### Removing Datasets</span></span>
<span id="cb77-226"><a href="#cb77-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-227"><a href="#cb77-227" aria-hidden="true" tabindex="-1"></a>To remove datasets, use rhdf5 functions:</span>
<span id="cb77-228"><a href="#cb77-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-229"><a href="#cb77-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove-dataset, eval=FALSE}</span></span>
<span id="cb77-230"><a href="#cb77-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove a specific dataset</span></span>
<span id="cb77-231"><a href="#cb77-231" aria-hidden="true" tabindex="-1"></a><span class="fu">h5delete</span>(project_file, <span class="st">"/quality_control/scores"</span>)</span>
<span id="cb77-232"><a href="#cb77-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-233"><a href="#cb77-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove entire group</span></span>
<span id="cb77-234"><a href="#cb77-234" aria-hidden="true" tabindex="-1"></a><span class="fu">h5delete</span>(project_file, <span class="st">"/quality_control"</span>)</span>
<span id="cb77-235"><a href="#cb77-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-236"><a href="#cb77-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-237"><a href="#cb77-237" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb77-238"><a href="#cb77-238" aria-hidden="true" tabindex="-1"></a><span class="fu">## Careful with Deletion</span></span>
<span id="cb77-239"><a href="#cb77-239" aria-hidden="true" tabindex="-1"></a>HDF5 doesn't reclaim disk space immediately after deletion. The space is marked as free but the file size doesn't shrink. To reclaim space, you need to repack the file using HDF5 command-line tools (<span class="in">`h5repack`</span>).</span>
<span id="cb77-240"><a href="#cb77-240" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-241"><a href="#cb77-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-242"><a href="#cb77-242" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-243"><a href="#cb77-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-244"><a href="#cb77-244" aria-hidden="true" tabindex="-1"></a><span class="fu">## Efficient Data Access</span></span>
<span id="cb77-245"><a href="#cb77-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-246"><a href="#cb77-246" aria-hidden="true" tabindex="-1"></a>One of the most powerful aspects of HDF5 is **partial reading** - you can access just the data you need without loading gigabytes into memory. This is the secret to working with datasets larger than your RAM.</span>
<span id="cb77-247"><a href="#cb77-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-248"><a href="#cb77-248" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb77-249"><a href="#cb77-249" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why We Use rhdf5 for Data Access</span></span>
<span id="cb77-250"><a href="#cb77-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-251"><a href="#cb77-251" aria-hidden="true" tabindex="-1"></a>You'll notice we use rhdf5's <span class="in">`h5read()`</span> function for reading data. This is intentional! BigDataStatMeth focuses on **computation** (matrix operations, statistical methods, block-wise algorithms), while rhdf5 excels at **file I/O** (reading, writing, inspecting).</span>
<span id="cb77-252"><a href="#cb77-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-253"><a href="#cb77-253" aria-hidden="true" tabindex="-1"></a>**Division of labor:**</span>
<span id="cb77-254"><a href="#cb77-254" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**rhdf5**: File operations, data access, inspection</span>
<span id="cb77-255"><a href="#cb77-255" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**BigDataStatMeth**: Matrix algebra, statistics, block-wise processing</span>
<span id="cb77-256"><a href="#cb77-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-257"><a href="#cb77-257" aria-hidden="true" tabindex="-1"></a>There's no need to reimplement what rhdf5 already does perfectly.</span>
<span id="cb77-258"><a href="#cb77-258" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-259"><a href="#cb77-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-260"><a href="#cb77-260" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reading Subsets</span></span>
<span id="cb77-261"><a href="#cb77-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-262"><a href="#cb77-262" aria-hidden="true" tabindex="-1"></a>Instead of loading entire matrices (which might be 100 GB), read just what you need:</span>
<span id="cb77-263"><a href="#cb77-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-264"><a href="#cb77-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r read-subsets, eval=TRUE}</span></span>
<span id="cb77-265"><a href="#cb77-265" aria-hidden="true" tabindex="-1"></a><span class="co"># Read first 100 samples and first 50 SNPs</span></span>
<span id="cb77-266"><a href="#cb77-266" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> <span class="fu">h5read</span>(</span>
<span id="cb77-267"><a href="#cb77-267" aria-hidden="true" tabindex="-1"></a>  project_file, </span>
<span id="cb77-268"><a href="#cb77-268" aria-hidden="true" tabindex="-1"></a>  <span class="st">"/genetics/snps"</span>,</span>
<span id="cb77-269"><a href="#cb77-269" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)</span>
<span id="cb77-270"><a href="#cb77-270" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-271"><a href="#cb77-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-272"><a href="#cb77-272" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Subset dimensions:"</span>, <span class="fu">dim</span>(subset_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-273"><a href="#cb77-273" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Preview of data (first 5×5):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-274"><a href="#cb77-274" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(subset_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb77-275"><a href="#cb77-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-276"><a href="#cb77-276" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">✓ Loaded only"</span>, <span class="fu">prod</span>(<span class="fu">dim</span>(subset_data)), <span class="st">"values</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-277"><a href="#cb77-277" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Full dataset would have been:"</span>, <span class="dv">1000</span> <span class="sc">*</span> <span class="dv">2000</span>, <span class="st">"values</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-278"><a href="#cb77-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-279"><a href="#cb77-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-280"><a href="#cb77-280" aria-hidden="true" tabindex="-1"></a><span class="fu">### Flexible Indexing</span></span>
<span id="cb77-281"><a href="#cb77-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-282"><a href="#cb77-282" aria-hidden="true" tabindex="-1"></a>You can read specific columns, skip rows, or sample randomly:</span>
<span id="cb77-283"><a href="#cb77-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-284"><a href="#cb77-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r flexible-indexing, eval=TRUE}</span></span>
<span id="cb77-285"><a href="#cb77-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Read specific columns only (useful for specific variables)</span></span>
<span id="cb77-286"><a href="#cb77-286" aria-hidden="true" tabindex="-1"></a>column_subset <span class="ot">&lt;-</span> <span class="fu">h5read</span>(</span>
<span id="cb77-287"><a href="#cb77-287" aria-hidden="true" tabindex="-1"></a>  project_file,</span>
<span id="cb77-288"><a href="#cb77-288" aria-hidden="true" tabindex="-1"></a>  <span class="st">"/genetics/snps"</span>,</span>
<span id="cb77-289"><a href="#cb77-289" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>))  <span class="co"># Just these 5 columns</span></span>
<span id="cb77-290"><a href="#cb77-290" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-291"><a href="#cb77-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-292"><a href="#cb77-292" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Column subset dimensions:"</span>, <span class="fu">dim</span>(column_subset), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-293"><a href="#cb77-293" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Selected columns: 1, 10, 20, 30, 40</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-294"><a href="#cb77-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-295"><a href="#cb77-295" aria-hidden="true" tabindex="-1"></a><span class="co"># Read every 10th row (useful for quick checks)</span></span>
<span id="cb77-296"><a href="#cb77-296" aria-hidden="true" tabindex="-1"></a>sparse_sample <span class="ot">&lt;-</span> <span class="fu">h5read</span>(</span>
<span id="cb77-297"><a href="#cb77-297" aria-hidden="true" tabindex="-1"></a>  project_file,</span>
<span id="cb77-298"><a href="#cb77-298" aria-hidden="true" tabindex="-1"></a>  <span class="st">"/genetics/snps"</span>,</span>
<span id="cb77-299"><a href="#cb77-299" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">list</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="at">by =</span> <span class="dv">10</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb77-300"><a href="#cb77-300" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-301"><a href="#cb77-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-302"><a href="#cb77-302" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Sparse sample dimensions:"</span>, <span class="fu">dim</span>(sparse_sample), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-303"><a href="#cb77-303" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Reading every 10th row reduces data by 90%</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-304"><a href="#cb77-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-305"><a href="#cb77-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-306"><a href="#cb77-306" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb77-307"><a href="#cb77-307" aria-hidden="true" tabindex="-1"></a><span class="fu">## Smart Reading Strategies</span></span>
<span id="cb77-308"><a href="#cb77-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-309"><a href="#cb77-309" aria-hidden="true" tabindex="-1"></a>**For exploration:**</span>
<span id="cb77-310"><a href="#cb77-310" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb77-311"><a href="#cb77-311" aria-hidden="true" tabindex="-1"></a><span class="fu">h5read</span>(file, dataset, <span class="at">index =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="cn">NULL</span>))  <span class="co"># First 100 rows</span></span>
<span id="cb77-312"><a href="#cb77-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-313"><a href="#cb77-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-314"><a href="#cb77-314" aria-hidden="true" tabindex="-1"></a>**For specific variables:**</span>
<span id="cb77-315"><a href="#cb77-315" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb77-316"><a href="#cb77-316" aria-hidden="true" tabindex="-1"></a><span class="fu">h5read</span>(file, dataset, <span class="at">index =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>)))  <span class="co"># Specific columns</span></span>
<span id="cb77-317"><a href="#cb77-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-318"><a href="#cb77-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-319"><a href="#cb77-319" aria-hidden="true" tabindex="-1"></a>**For random sampling:**</span>
<span id="cb77-320"><a href="#cb77-320" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb77-321"><a href="#cb77-321" aria-hidden="true" tabindex="-1"></a>rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="dv">500</span>)  <span class="co"># Random 500 rows</span></span>
<span id="cb77-322"><a href="#cb77-322" aria-hidden="true" tabindex="-1"></a><span class="fu">h5read</span>(file, dataset, <span class="at">index =</span> <span class="fu">list</span>(rows, <span class="cn">NULL</span>))</span>
<span id="cb77-323"><a href="#cb77-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-324"><a href="#cb77-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-325"><a href="#cb77-325" aria-hidden="true" tabindex="-1"></a>**The key principle:** Load only what you need. This is how you analyze 100 GB files on a 16 GB laptop.</span>
<span id="cb77-326"><a href="#cb77-326" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-327"><a href="#cb77-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-328"><a href="#cb77-328" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-329"><a href="#cb77-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-330"><a href="#cb77-330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Working with Large Files</span></span>
<span id="cb77-331"><a href="#cb77-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-332"><a href="#cb77-332" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding BigDataStatMeth's Internal Management</span></span>
<span id="cb77-333"><a href="#cb77-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-334"><a href="#cb77-334" aria-hidden="true" tabindex="-1"></a>When you use BigDataStatMeth functions like <span class="in">`bdblockmult_hdf5()`</span> or <span class="in">`bdSVD_hdf5()`</span>, the package handles **all the complexity internally**:</span>
<span id="cb77-335"><a href="#cb77-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-336"><a href="#cb77-336" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Opens and closes files automatically</span>
<span id="cb77-337"><a href="#cb77-337" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reads data in optimal block sizes</span>
<span id="cb77-338"><a href="#cb77-338" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Writes results efficiently</span>
<span id="cb77-339"><a href="#cb77-339" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Manages memory usage</span>
<span id="cb77-340"><a href="#cb77-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-341"><a href="#cb77-341" aria-hidden="true" tabindex="-1"></a>You simply call the function and let BigDataStatMeth do the work:</span>
<span id="cb77-342"><a href="#cb77-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-343"><a href="#cb77-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bigdatastatmeth-internal, eval=FALSE}</span></span>
<span id="cb77-344"><a href="#cb77-344" aria-hidden="true" tabindex="-1"></a><span class="co"># BigDataStatMeth handles everything internally:</span></span>
<span id="cb77-345"><a href="#cb77-345" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">bdblockmult_hdf5</span>(</span>
<span id="cb77-346"><a href="#cb77-346" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"huge_file.hdf5"</span>,</span>
<span id="cb77-347"><a href="#cb77-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"data"</span>,</span>
<span id="cb77-348"><a href="#cb77-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> <span class="st">"matrix_A"</span>,</span>
<span id="cb77-349"><a href="#cb77-349" aria-hidden="true" tabindex="-1"></a>  <span class="at">B =</span> <span class="st">"matrix_B"</span></span>
<span id="cb77-350"><a href="#cb77-350" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-351"><a href="#cb77-351" aria-hidden="true" tabindex="-1"></a><span class="co"># ↑ Behind the scenes:</span></span>
<span id="cb77-352"><a href="#cb77-352" aria-hidden="true" tabindex="-1"></a><span class="co">#   - File opened</span></span>
<span id="cb77-353"><a href="#cb77-353" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Data read in blocks</span></span>
<span id="cb77-354"><a href="#cb77-354" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Computation performed</span></span>
<span id="cb77-355"><a href="#cb77-355" aria-hidden="true" tabindex="-1"></a><span class="co">#   - Results written</span></span>
<span id="cb77-356"><a href="#cb77-356" aria-hidden="true" tabindex="-1"></a><span class="co">#   - File closed</span></span>
<span id="cb77-357"><a href="#cb77-357" aria-hidden="true" tabindex="-1"></a><span class="co"># You don't see any of this!</span></span>
<span id="cb77-358"><a href="#cb77-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-359"><a href="#cb77-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-360"><a href="#cb77-360" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb77-361"><a href="#cb77-361" aria-hidden="true" tabindex="-1"></a><span class="fu">## Manual File Management: C++ API Only</span></span>
<span id="cb77-362"><a href="#cb77-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-363"><a href="#cb77-363" aria-hidden="true" tabindex="-1"></a>With BigDataStatMeth's **R functions**, you never need to manually open/close files or manage blocks. The package does it all.</span>
<span id="cb77-364"><a href="#cb77-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-365"><a href="#cb77-365" aria-hidden="true" tabindex="-1"></a>**Manual control is only available** when developing new methods using the **C++ API**. This is for advanced users creating custom statistical methods who need fine-grained control over:</span>
<span id="cb77-366"><a href="#cb77-366" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Block sizes</span>
<span id="cb77-367"><a href="#cb77-367" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Memory allocation  </span>
<span id="cb77-368"><a href="#cb77-368" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read/write patterns</span>
<span id="cb77-369"><a href="#cb77-369" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Custom algorithms</span>
<span id="cb77-370"><a href="#cb77-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-371"><a href="#cb77-371" aria-hidden="true" tabindex="-1"></a>For 99% of users, the automatic management is exactly what you want.</span>
<span id="cb77-372"><a href="#cb77-372" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-373"><a href="#cb77-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-374"><a href="#cb77-374" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking File Information</span></span>
<span id="cb77-375"><a href="#cb77-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-376"><a href="#cb77-376" aria-hidden="true" tabindex="-1"></a>Sometimes you just want to know about the data without reading it:</span>
<span id="cb77-377"><a href="#cb77-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-378"><a href="#cb77-378" aria-hidden="true" tabindex="-1"></a><span class="in">```{r file-info, eval=TRUE}</span></span>
<span id="cb77-379"><a href="#cb77-379" aria-hidden="true" tabindex="-1"></a><span class="co"># Get file size</span></span>
<span id="cb77-380"><a href="#cb77-380" aria-hidden="true" tabindex="-1"></a>file_size_mb <span class="ot">&lt;-</span> <span class="fu">file.info</span>(project_file)<span class="sc">$</span>size <span class="sc">/</span> (<span class="dv">1024</span><span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb77-381"><a href="#cb77-381" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"File size:"</span>, <span class="fu">round</span>(file_size_mb, <span class="dv">2</span>), <span class="st">"MB</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-382"><a href="#cb77-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-383"><a href="#cb77-383" aria-hidden="true" tabindex="-1"></a><span class="co"># Get dataset dimensions without reading data</span></span>
<span id="cb77-384"><a href="#cb77-384" aria-hidden="true" tabindex="-1"></a>h5file <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(project_file)</span>
<span id="cb77-385"><a href="#cb77-385" aria-hidden="true" tabindex="-1"></a>dim_snps <span class="ot">&lt;-</span> <span class="fu">dim</span>(h5file<span class="sc">$</span>genetics<span class="sc">$</span>snps)</span>
<span id="cb77-386"><a href="#cb77-386" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">SNP matrix dimensions:"</span>, dim_snps[<span class="dv">1</span>], <span class="st">"samples ×"</span>, dim_snps[<span class="dv">2</span>], <span class="st">"SNPs</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-387"><a href="#cb77-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-388"><a href="#cb77-388" aria-hidden="true" tabindex="-1"></a>dim_traits <span class="ot">&lt;-</span> <span class="fu">dim</span>(h5file<span class="sc">$</span>phenotypes<span class="sc">$</span>traits)</span>
<span id="cb77-389"><a href="#cb77-389" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Trait matrix dimensions:"</span>, dim_traits[<span class="dv">1</span>], <span class="st">"samples ×"</span>, dim_traits[<span class="dv">2</span>], <span class="st">"traits</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-390"><a href="#cb77-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-391"><a href="#cb77-391" aria-hidden="true" tabindex="-1"></a><span class="fu">H5Fclose</span>(h5file)</span>
<span id="cb77-392"><a href="#cb77-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-393"><a href="#cb77-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-394"><a href="#cb77-394" aria-hidden="true" tabindex="-1"></a>This is useful for:</span>
<span id="cb77-395"><a href="#cb77-395" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Planning analyses (how much memory will I need?)</span>
<span id="cb77-396"><a href="#cb77-396" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Verifying dimensions before operations</span>
<span id="cb77-397"><a href="#cb77-397" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Checking if files were created correctly</span>
<span id="cb77-398"><a href="#cb77-398" aria-hidden="true" tabindex="-1"></a>H5Fclose(h5file)</span>
<span id="cb77-399"><a href="#cb77-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-400"><a href="#cb77-400" aria-hidden="true" tabindex="-1"></a>cat("SNP matrix dimensions:", dim_snps<span class="co">[</span><span class="ot">1</span><span class="co">]</span>, "×", dim_snps<span class="co">[</span><span class="ot">2</span><span class="co">]</span>, "\n")</span>
<span id="cb77-401"><a href="#cb77-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-402"><a href="#cb77-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-403"><a href="#cb77-403" aria-hidden="true" tabindex="-1"></a><span class="in">---</span></span>
<span id="cb77-404"><a href="#cb77-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-405"><a href="#cb77-405" aria-hidden="true" tabindex="-1"></a><span class="in">## Data Organization Best Practices</span></span>
<span id="cb77-406"><a href="#cb77-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-407"><a href="#cb77-407" aria-hidden="true" tabindex="-1"></a><span class="in">### 1. Use Descriptive Names</span></span>
<span id="cb77-408"><a href="#cb77-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-409"><a href="#cb77-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r naming, eval=FALSE}</span></span>
<span id="cb77-410"><a href="#cb77-410" aria-hidden="true" tabindex="-1"></a><span class="in"># Good naming</span></span>
<span id="cb77-411"><a href="#cb77-411" aria-hidden="true" tabindex="-1"></a><span class="in">bdCreate_hdf5_matrix(filename = "study.hdf5",</span></span>
<span id="cb77-412"><a href="#cb77-412" aria-hidden="true" tabindex="-1"></a><span class="in">                     object = data,</span></span>
<span id="cb77-413"><a href="#cb77-413" aria-hidden="true" tabindex="-1"></a><span class="in">                     group = "gwas_diabetes_2024",</span></span>
<span id="cb77-414"><a href="#cb77-414" aria-hidden="true" tabindex="-1"></a><span class="in">                     dataset = "genotypes_qc_filtered")</span></span>
<span id="cb77-415"><a href="#cb77-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-416"><a href="#cb77-416" aria-hidden="true" tabindex="-1"></a><span class="in"># Avoid cryptic names</span></span>
<span id="cb77-417"><a href="#cb77-417" aria-hidden="true" tabindex="-1"></a><span class="in">bdCreate_hdf5_matrix(filename = "data.hdf5",</span></span>
<span id="cb77-418"><a href="#cb77-418" aria-hidden="true" tabindex="-1"></a><span class="in">                     object = data,</span></span>
<span id="cb77-419"><a href="#cb77-419" aria-hidden="true" tabindex="-1"></a><span class="in">                     group = "g1",</span></span>
<span id="cb77-420"><a href="#cb77-420" aria-hidden="true" tabindex="-1"></a><span class="in">                     dataset = "d")</span></span>
<span id="cb77-421"><a href="#cb77-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-422"><a href="#cb77-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-423"><a href="#cb77-423" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Document Your Structure</span></span>
<span id="cb77-424"><a href="#cb77-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-425"><a href="#cb77-425" aria-hidden="true" tabindex="-1"></a>Keep a README or comments file describing your HDF5 organization:</span>
<span id="cb77-426"><a href="#cb77-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-427"><a href="#cb77-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r documentation, eval=FALSE}</span></span>
<span id="cb77-428"><a href="#cb77-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a text description</span></span>
<span id="cb77-429"><a href="#cb77-429" aria-hidden="true" tabindex="-1"></a>structure_doc <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb77-430"><a href="#cb77-430" aria-hidden="true" tabindex="-1"></a><span class="st">HDF5 File Structure</span></span>
<span id="cb77-431"><a href="#cb77-431" aria-hidden="true" tabindex="-1"></a><span class="st">==================</span></span>
<span id="cb77-432"><a href="#cb77-432" aria-hidden="true" tabindex="-1"></a><span class="st">/genetics/snps - Genotype matrix (samples × SNPs)</span></span>
<span id="cb77-433"><a href="#cb77-433" aria-hidden="true" tabindex="-1"></a><span class="st">/phenotypes/traits - Clinical measurements  </span></span>
<span id="cb77-434"><a href="#cb77-434" aria-hidden="true" tabindex="-1"></a><span class="st">/phenotypes/covariates - Age, sex, PCs</span></span>
<span id="cb77-435"><a href="#cb77-435" aria-hidden="true" tabindex="-1"></a><span class="st">/results/pca - PCA results from genetics data</span></span>
<span id="cb77-436"><a href="#cb77-436" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb77-437"><a href="#cb77-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-438"><a href="#cb77-438" aria-hidden="true" tabindex="-1"></a><span class="co"># You could store this as an attribute or separate file</span></span>
<span id="cb77-439"><a href="#cb77-439" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(structure_doc, <span class="st">"project_structure.txt"</span>)</span>
<span id="cb77-440"><a href="#cb77-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-441"><a href="#cb77-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-442"><a href="#cb77-442" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3. Use Consistent Dimensions</span></span>
<span id="cb77-443"><a href="#cb77-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-444"><a href="#cb77-444" aria-hidden="true" tabindex="-1"></a>Always keep samples in rows and features in columns. This is the standard convention in statistics and makes combining datasets much easier:</span>
<span id="cb77-445"><a href="#cb77-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-446"><a href="#cb77-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r dimensions, eval=FALSE}</span></span>
<span id="cb77-447"><a href="#cb77-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Consistent convention</span></span>
<span id="cb77-448"><a href="#cb77-448" aria-hidden="true" tabindex="-1"></a>genotypes  <span class="co"># n_samples × n_snps</span></span>
<span id="cb77-449"><a href="#cb77-449" aria-hidden="true" tabindex="-1"></a>phenotypes <span class="co"># n_samples × n_traits</span></span>
<span id="cb77-450"><a href="#cb77-450" aria-hidden="true" tabindex="-1"></a>results    <span class="co"># n_samples × n_components</span></span>
<span id="cb77-451"><a href="#cb77-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-452"><a href="#cb77-452" aria-hidden="true" tabindex="-1"></a><span class="co"># All have samples in rows → easy to merge/join</span></span>
<span id="cb77-453"><a href="#cb77-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-454"><a href="#cb77-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-455"><a href="#cb77-455" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb77-456"><a href="#cb77-456" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding Row-Major vs Column-Major Storage</span></span>
<span id="cb77-457"><a href="#cb77-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-458"><a href="#cb77-458" aria-hidden="true" tabindex="-1"></a>This is **critical to understand** when viewing HDF5 files directly!</span>
<span id="cb77-459"><a href="#cb77-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-460"><a href="#cb77-460" aria-hidden="true" tabindex="-1"></a>**R uses column-major order** (like Fortran):</span>
<span id="cb77-461"><a href="#cb77-461" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Data is stored column by column in memory</span>
<span id="cb77-462"><a href="#cb77-462" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Matrix<span class="co">[</span><span class="ot">i, j</span><span class="co">]</span> means: row i, column j</span>
<span id="cb77-463"><a href="#cb77-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-464"><a href="#cb77-464" aria-hidden="true" tabindex="-1"></a>**HDF5 uses row-major order** (like C/C++):</span>
<span id="cb77-465"><a href="#cb77-465" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Data is stored row by row in memory  </span>
<span id="cb77-466"><a href="#cb77-466" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dataset<span class="co">[</span><span class="ot">i, j</span><span class="co">]</span> means: row i, column j</span>
<span id="cb77-467"><a href="#cb77-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-468"><a href="#cb77-468" aria-hidden="true" tabindex="-1"></a><span class="fu">### What This Means for You</span></span>
<span id="cb77-469"><a href="#cb77-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-470"><a href="#cb77-470" aria-hidden="true" tabindex="-1"></a>When you create a matrix in R:</span>
<span id="cb77-471"><a href="#cb77-471" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb77-472"><a href="#cb77-472" aria-hidden="true" tabindex="-1"></a><span class="co"># In R: 3 samples (rows) × 5 SNPs (columns)</span></span>
<span id="cb77-473"><a href="#cb77-473" aria-hidden="true" tabindex="-1"></a>genotypes <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">5</span>)</span>
<span id="cb77-474"><a href="#cb77-474" aria-hidden="true" tabindex="-1"></a><span class="co">#      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb77-475"><a href="#cb77-475" aria-hidden="true" tabindex="-1"></a><span class="co"># [1,]    1    4    7   10   13</span></span>
<span id="cb77-476"><a href="#cb77-476" aria-hidden="true" tabindex="-1"></a><span class="co"># [2,]    2    5    8   11   14</span></span>
<span id="cb77-477"><a href="#cb77-477" aria-hidden="true" tabindex="-1"></a><span class="co"># [3,]    3    6    9   12   15</span></span>
<span id="cb77-478"><a href="#cb77-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-479"><a href="#cb77-479" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to HDF5</span></span>
<span id="cb77-480"><a href="#cb77-480" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(<span class="at">filename =</span> <span class="st">"test.hdf5"</span>, </span>
<span id="cb77-481"><a href="#cb77-481" aria-hidden="true" tabindex="-1"></a>                     <span class="at">object =</span> genotypes,</span>
<span id="cb77-482"><a href="#cb77-482" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> <span class="st">"data"</span>, <span class="at">dataset =</span> <span class="st">"geno"</span>)</span>
<span id="cb77-483"><a href="#cb77-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-484"><a href="#cb77-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-485"><a href="#cb77-485" aria-hidden="true" tabindex="-1"></a>**When you view it in HDFView or h5dump**, you'll see the **transpose**:</span>
<span id="cb77-486"><a href="#cb77-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-487"><a href="#cb77-487" aria-hidden="true" tabindex="-1"></a><span class="in"># In HDFView: 5 × 3 (appears transposed!)</span></span>
<span id="cb77-488"><a href="#cb77-488" aria-hidden="true" tabindex="-1"></a><span class="in"># [0,0] [0,1] [0,2]</span></span>
<span id="cb77-489"><a href="#cb77-489" aria-hidden="true" tabindex="-1"></a><span class="in">#   1     2     3</span></span>
<span id="cb77-490"><a href="#cb77-490" aria-hidden="true" tabindex="-1"></a><span class="in"># [1,0] [1,1] [1,2]  </span></span>
<span id="cb77-491"><a href="#cb77-491" aria-hidden="true" tabindex="-1"></a><span class="in">#   4     5     6</span></span>
<span id="cb77-492"><a href="#cb77-492" aria-hidden="true" tabindex="-1"></a><span class="in"># [2,0] [2,1] [2,2]</span></span>
<span id="cb77-493"><a href="#cb77-493" aria-hidden="true" tabindex="-1"></a><span class="in">#   7     8     9</span></span>
<span id="cb77-494"><a href="#cb77-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-495"><a href="#cb77-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-496"><a href="#cb77-496" aria-hidden="true" tabindex="-1"></a><span class="fu">### Don't Panic!</span></span>
<span id="cb77-497"><a href="#cb77-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-498"><a href="#cb77-498" aria-hidden="true" tabindex="-1"></a>**This is normal and expected.** BigDataStatMeth handles the conversion automatically:</span>
<span id="cb77-499"><a href="#cb77-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-500"><a href="#cb77-500" aria-hidden="true" tabindex="-1"></a>✓ When you read with <span class="in">`h5read()`</span> → You get the correct R matrix  </span>
<span id="cb77-501"><a href="#cb77-501" aria-hidden="true" tabindex="-1"></a>✓ When you compute with <span class="in">`bdCrossprod_hdf5()`</span> → Dimensions are correct  </span>
<span id="cb77-502"><a href="#cb77-502" aria-hidden="true" tabindex="-1"></a>✓ When you save results → They're stored correctly for R</span>
<span id="cb77-503"><a href="#cb77-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-504"><a href="#cb77-504" aria-hidden="true" tabindex="-1"></a>**The transposition is handled transparently.** You only notice it if you inspect files with external tools like HDFView.</span>
<span id="cb77-505"><a href="#cb77-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-506"><a href="#cb77-506" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Takeaway</span></span>
<span id="cb77-507"><a href="#cb77-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-508"><a href="#cb77-508" aria-hidden="true" tabindex="-1"></a>**In R code:** Think in R dimensions (samples × features)  </span>
<span id="cb77-509"><a href="#cb77-509" aria-hidden="true" tabindex="-1"></a>**In HDFView:** Expect to see transposed dimensions  </span>
<span id="cb77-510"><a href="#cb77-510" aria-hidden="true" tabindex="-1"></a>**In BigDataStatMeth:** Everything works correctly - dimensions match R expectations</span>
<span id="cb77-511"><a href="#cb77-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-512"><a href="#cb77-512" aria-hidden="true" tabindex="-1"></a>The moral: Trust BigDataStatMeth to handle the storage details. Your matrices will always have the dimensions you expect in R.</span>
<span id="cb77-513"><a href="#cb77-513" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-514"><a href="#cb77-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-515"><a href="#cb77-515" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-516"><a href="#cb77-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-517"><a href="#cb77-517" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactive Exercise {.exercise}</span></span>
<span id="cb77-518"><a href="#cb77-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-519"><a href="#cb77-519" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practice: Designing Your Project's HDF5 Structure</span></span>
<span id="cb77-520"><a href="#cb77-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-521"><a href="#cb77-521" aria-hidden="true" tabindex="-1"></a>Effective HDF5 organization makes the difference between a maintainable project and a confusing mess six months later. This exercise helps you think through organization before starting real analyses.</span>
<span id="cb77-522"><a href="#cb77-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-525"><a href="#cb77-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-526"><a href="#cb77-526" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb77-527"><a href="#cb77-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-528"><a href="#cb77-528" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise: Plan and create an HDF5 structure for your project</span></span>
<span id="cb77-529"><a href="#cb77-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-530"><a href="#cb77-530" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario: You're analyzing a multi-omic study with:</span></span>
<span id="cb77-531"><a href="#cb77-531" aria-hidden="true" tabindex="-1"></a><span class="co"># - Genomic data (SNPs): 50,000 individuals × 500,000 variants</span></span>
<span id="cb77-532"><a href="#cb77-532" aria-hidden="true" tabindex="-1"></a><span class="co"># - Transcriptomic data (RNA-seq): same 50,000 individuals × 20,000 genes</span></span>
<span id="cb77-533"><a href="#cb77-533" aria-hidden="true" tabindex="-1"></a><span class="co"># - Phenotype data: 50,000 individuals × 50 measurements</span></span>
<span id="cb77-534"><a href="#cb77-534" aria-hidden="true" tabindex="-1"></a><span class="co"># - Sample metadata: IDs, age, sex, ancestry</span></span>
<span id="cb77-535"><a href="#cb77-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-536"><a href="#cb77-536" aria-hidden="true" tabindex="-1"></a><span class="co"># Your task: Design the HDF5 structure</span></span>
<span id="cb77-537"><a href="#cb77-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-538"><a href="#cb77-538" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: Everything in one file</span></span>
<span id="cb77-539"><a href="#cb77-539" aria-hidden="true" tabindex="-1"></a>project_file <span class="ot">&lt;-</span> <span class="st">"my_study.hdf5"</span></span>
<span id="cb77-540"><a href="#cb77-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-541"><a href="#cb77-541" aria-hidden="true" tabindex="-1"></a><span class="co"># How would you organize groups?</span></span>
<span id="cb77-542"><a href="#cb77-542" aria-hidden="true" tabindex="-1"></a><span class="co"># /raw_data/genomics/snps</span></span>
<span id="cb77-543"><a href="#cb77-543" aria-hidden="true" tabindex="-1"></a><span class="co"># /raw_data/transcriptomics/expression</span></span>
<span id="cb77-544"><a href="#cb77-544" aria-hidden="true" tabindex="-1"></a><span class="co"># /raw_data/phenotypes/measurements</span></span>
<span id="cb77-545"><a href="#cb77-545" aria-hidden="true" tabindex="-1"></a><span class="co"># /metadata/samples</span></span>
<span id="cb77-546"><a href="#cb77-546" aria-hidden="true" tabindex="-1"></a><span class="co"># /quality_control/filtered_snps</span></span>
<span id="cb77-547"><a href="#cb77-547" aria-hidden="true" tabindex="-1"></a><span class="co"># /quality_control/normalized_expression</span></span>
<span id="cb77-548"><a href="#cb77-548" aria-hidden="true" tabindex="-1"></a><span class="co"># /results/pca</span></span>
<span id="cb77-549"><a href="#cb77-549" aria-hidden="true" tabindex="-1"></a><span class="co"># /results/associations</span></span>
<span id="cb77-550"><a href="#cb77-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-551"><a href="#cb77-551" aria-hidden="true" tabindex="-1"></a><span class="co"># Try creating this structure:</span></span>
<span id="cb77-552"><a href="#cb77-552" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(project_file, dummy_data, </span>
<span id="cb77-553"><a href="#cb77-553" aria-hidden="true" tabindex="-1"></a>                     <span class="at">group =</span> <span class="st">"/raw_data/genomics"</span>, </span>
<span id="cb77-554"><a href="#cb77-554" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dataset =</span> <span class="st">"snps"</span>)</span>
<span id="cb77-555"><a href="#cb77-555" aria-hidden="true" tabindex="-1"></a><span class="co"># ... add more datasets</span></span>
<span id="cb77-556"><a href="#cb77-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-557"><a href="#cb77-557" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: Separate files per data type</span></span>
<span id="cb77-558"><a href="#cb77-558" aria-hidden="true" tabindex="-1"></a><span class="co"># genomics.hdf5, transcriptomics.hdf5, phenotypes.hdf5</span></span>
<span id="cb77-559"><a href="#cb77-559" aria-hidden="true" tabindex="-1"></a><span class="co"># When is this better? When worse?</span></span>
<span id="cb77-560"><a href="#cb77-560" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-561"><a href="#cb77-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-562"><a href="#cb77-562" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb77-563"><a href="#cb77-563" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reflection Questions</span></span>
<span id="cb77-564"><a href="#cb77-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-565"><a href="#cb77-565" aria-hidden="true" tabindex="-1"></a>Think through these design decisions for your actual or planned projects:</span>
<span id="cb77-566"><a href="#cb77-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-567"><a href="#cb77-567" aria-hidden="true" tabindex="-1"></a>**1. File Organization Strategy:**</span>
<span id="cb77-568"><a href="#cb77-568" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>One large file vs. multiple smaller files?</span>
<span id="cb77-569"><a href="#cb77-569" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>For your project, which approach makes more sense?</span>
<span id="cb77-570"><a href="#cb77-570" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How does your team typically share data?</span>
<span id="cb77-571"><a href="#cb77-571" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Will different people access different parts?</span>
<span id="cb77-572"><a href="#cb77-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-573"><a href="#cb77-573" aria-hidden="true" tabindex="-1"></a>**2. Group Hierarchy:**</span>
<span id="cb77-574"><a href="#cb77-574" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How deep should your folder structure go?</span>
<span id="cb77-575"><a href="#cb77-575" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="in">`/data/type/version`</span> vs. <span class="in">`/data_type_version`</span>?</span>
<span id="cb77-576"><a href="#cb77-576" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Can you navigate your structure 6 months from now?</span>
<span id="cb77-577"><a href="#cb77-577" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Would a new collaborator understand it?</span>
<span id="cb77-578"><a href="#cb77-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-579"><a href="#cb77-579" aria-hidden="true" tabindex="-1"></a>**3. Dataset Naming:**</span>
<span id="cb77-580"><a href="#cb77-580" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>"matrix1" vs. "filtered_normalized_snps_maf05"?</span>
<span id="cb77-581"><a href="#cb77-581" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Descriptive names vs. short names?</span>
<span id="cb77-582"><a href="#cb77-582" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How do you indicate processing steps?</span>
<span id="cb77-583"><a href="#cb77-583" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Do you need version numbers in names?</span>
<span id="cb77-584"><a href="#cb77-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-585"><a href="#cb77-585" aria-hidden="true" tabindex="-1"></a>**4. Metadata Management:**</span>
<span id="cb77-586"><a href="#cb77-586" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Where do row/column names go?</span>
<span id="cb77-587"><a href="#cb77-587" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How do you store processing parameters?</span>
<span id="cb77-588"><a href="#cb77-588" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Document analysis dates and software versions?</span>
<span id="cb77-589"><a href="#cb77-589" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Link between datasets (which samples are in which matrix)?</span>
<span id="cb77-590"><a href="#cb77-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-591"><a href="#cb77-591" aria-hidden="true" tabindex="-1"></a>**5. Practical Constraints:**</span>
<span id="cb77-592"><a href="#cb77-592" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How much disk space do you have?</span>
<span id="cb77-593"><a href="#cb77-593" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Will files be transferred between systems?</span>
<span id="cb77-594"><a href="#cb77-594" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Need to share via email/FTP? (file size limits)</span>
<span id="cb77-595"><a href="#cb77-595" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Backup strategy for large files?</span>
<span id="cb77-596"><a href="#cb77-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-597"><a href="#cb77-597" aria-hidden="true" tabindex="-1"></a>**6. Future Expansion:**</span>
<span id="cb77-598"><a href="#cb77-598" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What if you add more samples next year?</span>
<span id="cb77-599"><a href="#cb77-599" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>New data types (proteomics, metabolomics)?</span>
<span id="cb77-600"><a href="#cb77-600" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Reanalysis with different parameters?</span>
<span id="cb77-601"><a href="#cb77-601" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Where does each new piece go?</span>
<span id="cb77-602"><a href="#cb77-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-603"><a href="#cb77-603" aria-hidden="true" tabindex="-1"></a>There's no universal "correct" organization - it depends on your project scale, team structure, and workflow. The goal is thinking through these questions before you have 50 analysis scripts depending on a particular structure.</span>
<span id="cb77-604"><a href="#cb77-604" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb77-605"><a href="#cb77-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-606"><a href="#cb77-606" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-607"><a href="#cb77-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-608"><a href="#cb77-608" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cleanup</span></span>
<span id="cb77-609"><a href="#cb77-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-610"><a href="#cb77-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r final-cleanup, eval=TRUE}</span></span>
<span id="cb77-611"><a href="#cb77-611" aria-hidden="true" tabindex="-1"></a><span class="co"># Close all HDF5 connections</span></span>
<span id="cb77-612"><a href="#cb77-612" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb77-613"><a href="#cb77-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-614"><a href="#cb77-614" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove generated HDF5 file</span></span>
<span id="cb77-615"><a href="#cb77-615" aria-hidden="true" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="st">"clinical_data.hdf5"</span>,</span>
<span id="cb77-616"><a href="#cb77-616" aria-hidden="true" tabindex="-1"></a>            <span class="st">"multi_dataset_project.hdf5"</span>)</span>
<span id="cb77-617"><a href="#cb77-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-618"><a href="#cb77-618" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Tutorial cleanup complete</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-619"><a href="#cb77-619" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Note: colesterol.csv is kept for reference</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb77-620"><a href="#cb77-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-621"><a href="#cb77-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-622"><a href="#cb77-622" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-623"><a href="#cb77-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-624"><a href="#cb77-624" aria-hidden="true" tabindex="-1"></a><span class="fu">## What You've Learned</span></span>
<span id="cb77-625"><a href="#cb77-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-626"><a href="#cb77-626" aria-hidden="true" tabindex="-1"></a>✅ **Convert** text files (CSV, TSV) to HDF5 format  </span>
<span id="cb77-627"><a href="#cb77-627" aria-hidden="true" tabindex="-1"></a>✅ **Manage** multiple datasets in one HDF5 file  </span>
<span id="cb77-628"><a href="#cb77-628" aria-hidden="true" tabindex="-1"></a>✅ **Organize** data using groups and descriptive names  </span>
<span id="cb77-629"><a href="#cb77-629" aria-hidden="true" tabindex="-1"></a>✅ **Access** data efficiently (subsets, slicing)  </span>
<span id="cb77-630"><a href="#cb77-630" aria-hidden="true" tabindex="-1"></a>✅ **Apply** best practices for file organization</span>
<span id="cb77-631"><a href="#cb77-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-632"><a href="#cb77-632" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-633"><a href="#cb77-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-634"><a href="#cb77-634" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next Steps</span></span>
<span id="cb77-635"><a href="#cb77-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-636"><a href="#cb77-636" aria-hidden="true" tabindex="-1"></a>**Continue the tutorial series:**</span>
<span id="cb77-637"><a href="#cb77-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-638"><a href="#cb77-638" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>✅ <span class="co">[</span><span class="ot">Getting Started</span><span class="co">](getting-started.qmd)</span> </span>
<span id="cb77-639"><a href="#cb77-639" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>✅ **Working with HDF5 Matrices** (you are here)</span>
<span id="cb77-640"><a href="#cb77-640" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>→ <span class="co">[</span><span class="ot">Your First Analysis</span><span class="co">](first-analysis.qmd)</span> - Complete analysis workflow</span>
<span id="cb77-641"><a href="#cb77-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-642"><a href="#cb77-642" aria-hidden="true" tabindex="-1"></a>**Ready for real analysis:**</span>
<span id="cb77-643"><a href="#cb77-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-644"><a href="#cb77-644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Implementing PCA</span><span class="co">](../workflows/implementing-pca.qmd)</span> - Full PCA workflow on genomic data</span>
<span id="cb77-645"><a href="#cb77-645" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Implementing CCA</span><span class="co">](../workflows/implementing-cca.qmd)</span> - Canonical correlation analysis</span>
<span id="cb77-646"><a href="#cb77-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-647"><a href="#cb77-647" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb77-648"><a href="#cb77-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-649"><a href="#cb77-649" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Takeaways {.key-concept}</span></span>
<span id="cb77-650"><a href="#cb77-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-651"><a href="#cb77-651" aria-hidden="true" tabindex="-1"></a>Let's consolidate your understanding of HDF5 file management and organization for big data projects.</span>
<span id="cb77-652"><a href="#cb77-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-653"><a href="#cb77-653" aria-hidden="true" tabindex="-1"></a><span class="fu">### Essential Concepts</span></span>
<span id="cb77-654"><a href="#cb77-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-655"><a href="#cb77-655" aria-hidden="true" tabindex="-1"></a>**HDF5 is a data management system, not just a file format.** It provides hierarchical organization (groups and datasets), partial I/O (read only what you need), and cross-platform compatibility. This makes it fundamentally different from flat file formats like CSV. You're not just storing data - you're organizing an entire analysis project in a structured, queryable format.</span>
<span id="cb77-656"><a href="#cb77-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-657"><a href="#cb77-657" aria-hidden="true" tabindex="-1"></a>**File conversion is a one-time investment** that pays dividends throughout your project. Converting a 50 GB CSV file to HDF5 might take 20 minutes, but every subsequent analysis benefits from fast partial reads, organized structure, and efficient access patterns. The upfront cost amortizes across dozens or hundreds of analyses over the project lifetime.</span>
<span id="cb77-658"><a href="#cb77-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-659"><a href="#cb77-659" aria-hidden="true" tabindex="-1"></a>**Organization decisions made early are hard to change later.** Once you have 50 analysis scripts expecting data at <span class="in">`/raw_data/genomics/snps`</span>, reorganizing the file breaks everything. Take time designing your structure before populating it. A bit of planning prevents substantial refactoring pain later.</span>
<span id="cb77-660"><a href="#cb77-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-661"><a href="#cb77-661" aria-hidden="true" tabindex="-1"></a>**BigDataStatMeth and rhdf5 serve different purposes.** BigDataStatMeth creates and operates on matrices (the computational work). rhdf5 provides file I/O and inspection (reading, writing, navigating). You need both: BigDataStatMeth for analysis, rhdf5 for file management. Understanding this division of labor prevents confusion about which tool does what.</span>
<span id="cb77-662"><a href="#cb77-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-663"><a href="#cb77-663" aria-hidden="true" tabindex="-1"></a>**Row-major vs. column-major storage is handled automatically.** R uses column-major order, HDF5 uses row-major. BigDataStatMeth manages this conversion transparently. Your matrices always have the dimensions you expect in R code, even though they're stored differently on disk. You only notice the difference if you inspect files with external tools like HDFView - and even then, it's just a visual curiosity, not a problem.</span>
<span id="cb77-664"><a href="#cb77-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-665"><a href="#cb77-665" aria-hidden="true" tabindex="-1"></a>**Efficient HDF5 use means reading strategically.** Don't read entire 100 GB matrices to access a 1 MB subset. Use dimension slicing, work with row/column blocks, and read only required data. The ability to partially read files is HDF5's main advantage - leverage it. This is why understanding dataset dimensions and organization matters.</span>
<span id="cb77-666"><a href="#cb77-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-667"><a href="#cb77-667" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to Use HDF5 File Management</span></span>
<span id="cb77-668"><a href="#cb77-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-669"><a href="#cb77-669" aria-hidden="true" tabindex="-1"></a>Understanding when HDF5's organizational features help versus when simpler approaches suffice guides practical decisions about file structure and management.</span>
<span id="cb77-670"><a href="#cb77-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-671"><a href="#cb77-671" aria-hidden="true" tabindex="-1"></a>✅ **Use hierarchical HDF5 organization when:**</span>
<span id="cb77-672"><a href="#cb77-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-673"><a href="#cb77-673" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You have multiple related datasets** - Genomics + transcriptomics + phenotypes all in one project. Groups like <span class="in">`/genetics/`</span>, <span class="in">`/expression/`</span>, <span class="in">`/clinical/`</span> keep everything organized in a single file rather than managing dozens of separate files.</span>
<span id="cb77-674"><a href="#cb77-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-675"><a href="#cb77-675" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Your project will grow over time** - Starting organized prevents refactoring pain. If you'll add more samples, time points, or data types later, hierarchical structure accommodates growth naturally.</span>
<span id="cb77-676"><a href="#cb77-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-677"><a href="#cb77-677" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Multiple team members access the same data** - Clear organization (<span class="in">`/raw_data/`</span>, <span class="in">`/quality_control/`</span>, <span class="in">`/results/`</span>) makes files self-documenting. Collaborators can navigate without constant explanations.</span>
<span id="cb77-678"><a href="#cb77-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-679"><a href="#cb77-679" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You need to document processing steps** - Dataset names like <span class="in">`genotypes_filtered_maf005_hwe1e6`</span> encode processing history. The file structure itself documents your analysis pipeline.</span>
<span id="cb77-680"><a href="#cb77-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-681"><a href="#cb77-681" aria-hidden="true" tabindex="-1"></a>✅ **Use rhdf5 for file operations when:**</span>
<span id="cb77-682"><a href="#cb77-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-683"><a href="#cb77-683" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You need to inspect file contents** - <span class="in">`h5ls()`</span> shows structure, <span class="in">`h5read()`</span> retrieves data. rhdf5 provides the file navigation and I/O tools.</span>
<span id="cb77-684"><a href="#cb77-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-685"><a href="#cb77-685" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You're managing metadata** - Row names, column names, attributes, and documentation all go through rhdf5 functions.</span>
<span id="cb77-686"><a href="#cb77-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-687"><a href="#cb77-687" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You need partial data access** - Reading specific rows, columns, or blocks uses rhdf5's indexing capabilities: <span class="in">`h5read(file, dataset, index = list(rows, cols))`</span>.</span>
<span id="cb77-688"><a href="#cb77-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-689"><a href="#cb77-689" aria-hidden="true" tabindex="-1"></a>❌ **Simpler approaches work better when:**</span>
<span id="cb77-690"><a href="#cb77-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-691"><a href="#cb77-691" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You have a single dataset** - If your entire project is one matrix, elaborate HDF5 organization adds no value. A simple flat file or single-group HDF5 suffices.</span>
<span id="cb77-692"><a href="#cb77-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-693"><a href="#cb77-693" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data won't grow or change** - For static datasets that are finalized and won't be extended, elaborate organization provides minimal benefit over simple naming.</span>
<span id="cb77-694"><a href="#cb77-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-695"><a href="#cb77-695" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Quick, temporary analyses** - If you're not building a reusable analysis pipeline, the organizational overhead outweighs benefits. Use whatever gets you to results fastest.</span>
<span id="cb77-696"><a href="#cb77-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-697"><a href="#cb77-697" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You never need partial reads** - If you always process entire matrices, HDF5's partial I/O advantage disappears. The organizational features may still help, but the performance benefit is minimal.</span>
<span id="cb77-698"><a href="#cb77-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-699"><a href="#cb77-699" aria-hidden="true" tabindex="-1"></a>Understanding these trade-offs helps you invest effort where it pays off - elaborate organization for complex, growing projects; simple structure for straightforward, static analyses.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 BigDataStatMeth - ISGlobal BRGE</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/edit/main/tutorials/working-hdf5-matrices.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/isglobal-brge/BigDataStatMeth">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
 License: GPL-3
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>