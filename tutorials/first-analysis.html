<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Your First Analysis – BigDataStatMeth</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-969ddfa49e00a70eb3423444dbc81f6c.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-065a5179aebd64318d7ea99d77b64a9e.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d0f1cdce0779274a5ec1152cd33adb41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-d6747531eee53fd58085a197f3afc013.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-d0f1cdce0779274a5ec1152cd33adb41.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../assets/css/custom.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/images/logo.png" alt="" class="navbar-logo light-content">
    <img src="../assets/images/logo.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">BigDataStatMeth</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-fundamentals" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Fundamentals</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-fundamentals">    
        <li>
    <a class="dropdown-item" href="../fundamentals/big-data-problem.html">
 <span class="dropdown-text">The Big Data Problem</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/understanding-hdf5.html">
 <span class="dropdown-text">Understanding HDF5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/blockwise-computing.html">
 <span class="dropdown-text">Block-Wise Computing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fundamentals/linear-algebra.html">
 <span class="dropdown-text">Linear Algebra Essentials</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../tutorials/getting-started.html">
 <span class="dropdown-text">Getting Started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/working-hdf5-matrices.html">
 <span class="dropdown-text">Working with HDF5 Matrices</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/first-analysis.html">
 <span class="dropdown-text">Your First Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-workflows" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Workflows</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-workflows">    
        <li>
    <a class="dropdown-item" href="../workflows/implementing-pca.html">
 <span class="dropdown-text">Implementing PCA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workflows/implementing-cca.html">
 <span class="dropdown-text">Implementing CCA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../workflows/cross-platform.html">
 <span class="dropdown-text">Cross-Platform Workflows</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-developing-methods" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Developing Methods</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-developing-methods">    
        <li>
    <a class="dropdown-item" href="../developing-methods/cca-r-implementation.html">
 <span class="dropdown-text">CCA in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../developing-methods/cca-cpp-implementation.html">
 <span class="dropdown-text">CCA in C++</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-api-reference" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">API Reference</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-api-reference">    
        <li>
    <a class="dropdown-item" href="../api-reference/r/index.html">
 <span class="dropdown-text">R Functions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../api-reference/cpp/index.html">
 <span class="dropdown-text">C++ API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../technical/performance.html"> 
<span class="menu-text">Technical</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/isglobal-brge/BigDataStatMeth"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://cran.r-project.org/package=BigDataStatMeth"> 
<span class="menu-text">CRAN</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/getting-started.html">Getting Started</a></li><li class="breadcrumb-item"><a href="../tutorials/first-analysis.html">Your First Analysis</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/working-hdf5-matrices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with HDF5 Matrices</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/first-analysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Your First Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a>
  <ul class="collapse">
  <li><a href="#what-youll-learn" id="toc-what-youll-learn" class="nav-link" data-scroll-target="#what-youll-learn"><span class="header-section-number">1.1</span> What You’ll Learn</a></li>
  </ul></li>
  <li><a href="#the-analysis-goal" id="toc-the-analysis-goal" class="nav-link" data-scroll-target="#the-analysis-goal"><span class="header-section-number">2</span> The Analysis Goal</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites"><span class="header-section-number">3</span> Prerequisites</a></li>
  <li><a href="#step-1-create-and-import-data" id="toc-step-1-create-and-import-data" class="nav-link" data-scroll-target="#step-1-create-and-import-data"><span class="header-section-number">4</span> Step 1: Create and Import Data</a>
  <ul class="collapse">
  <li><a href="#simulate-genomic-data" id="toc-simulate-genomic-data" class="nav-link" data-scroll-target="#simulate-genomic-data"><span class="header-section-number">4.1</span> Simulate Genomic Data</a></li>
  <li><a href="#import-to-hdf5" id="toc-import-to-hdf5" class="nav-link" data-scroll-target="#import-to-hdf5"><span class="header-section-number">4.2</span> Import to HDF5</a></li>
  </ul></li>
  <li><a href="#step-2-quality-control" id="toc-step-2-quality-control" class="nav-link" data-scroll-target="#step-2-quality-control"><span class="header-section-number">5</span> Step 2: Quality Control</a>
  <ul class="collapse">
  <li><a href="#remove-low-quality-samples" id="toc-remove-low-quality-samples" class="nav-link" data-scroll-target="#remove-low-quality-samples"><span class="header-section-number">5.1</span> Remove Low-Quality Samples</a></li>
  <li><a href="#remove-low-quality-snps" id="toc-remove-low-quality-snps" class="nav-link" data-scroll-target="#remove-low-quality-snps"><span class="header-section-number">5.2</span> Remove Low-Quality SNPs</a></li>
  <li><a href="#inspect-qc-results" id="toc-inspect-qc-results" class="nav-link" data-scroll-target="#inspect-qc-results"><span class="header-section-number">5.3</span> Inspect QC Results</a></li>
  </ul></li>
  <li><a href="#step-3-impute-missing-data" id="toc-step-3-impute-missing-data" class="nav-link" data-scroll-target="#step-3-impute-missing-data"><span class="header-section-number">6</span> Step 3: Impute Missing Data</a></li>
  <li><a href="#step-4-perform-svd" id="toc-step-4-perform-svd" class="nav-link" data-scroll-target="#step-4-perform-svd"><span class="header-section-number">7</span> Step 4: Perform SVD</a></li>
  <li><a href="#step-5-extract-and-examine-results" id="toc-step-5-extract-and-examine-results" class="nav-link" data-scroll-target="#step-5-extract-and-examine-results"><span class="header-section-number">8</span> Step 5: Extract and Examine Results</a>
  <ul class="collapse">
  <li><a href="#extract-principal-components" id="toc-extract-principal-components" class="nav-link" data-scroll-target="#extract-principal-components"><span class="header-section-number">8.1</span> Extract Principal Components</a></li>
  <li><a href="#variance-explained" id="toc-variance-explained" class="nav-link" data-scroll-target="#variance-explained"><span class="header-section-number">8.2</span> Variance Explained</a></li>
  </ul></li>
  <li><a href="#step-6-visualize-results" id="toc-step-6-visualize-results" class="nav-link" data-scroll-target="#step-6-visualize-results"><span class="header-section-number">9</span> Step 6: Visualize Results</a>
  <ul class="collapse">
  <li><a href="#scree-plot" id="toc-scree-plot" class="nav-link" data-scroll-target="#scree-plot"><span class="header-section-number">9.1</span> Scree Plot</a></li>
  <li><a href="#pca-plot" id="toc-pca-plot" class="nav-link" data-scroll-target="#pca-plot"><span class="header-section-number">9.2</span> PCA Plot</a></li>
  </ul></li>
  <li><a href="#step-7-save-results-for-downstream-use" id="toc-step-7-save-results-for-downstream-use" class="nav-link" data-scroll-target="#step-7-save-results-for-downstream-use"><span class="header-section-number">10</span> Step 7: Save Results for Downstream Use</a>
  <ul class="collapse">
  <li><a href="#export-pcs-for-other-tools" id="toc-export-pcs-for-other-tools" class="nav-link" data-scroll-target="#export-pcs-for-other-tools"><span class="header-section-number">10.1</span> Export PCs for Other Tools</a></li>
  <li><a href="#document-the-analysis" id="toc-document-the-analysis" class="nav-link" data-scroll-target="#document-the-analysis"><span class="header-section-number">10.2</span> Document the Analysis</a></li>
  </ul></li>
  <li><a href="#interactive-exercise" id="toc-interactive-exercise" class="nav-link" data-scroll-target="#interactive-exercise"><span class="header-section-number">11</span> Interactive Exercise</a>
  <ul class="collapse">
  <li><a href="#practice-modifying-the-analysis-workflow" id="toc-practice-modifying-the-analysis-workflow" class="nav-link" data-scroll-target="#practice-modifying-the-analysis-workflow"><span class="header-section-number">11.1</span> Practice: Modifying the Analysis Workflow</a></li>
  </ul></li>
  <li><a href="#cleanup" id="toc-cleanup" class="nav-link" data-scroll-target="#cleanup"><span class="header-section-number">12</span> Cleanup</a></li>
  <li><a href="#what-youve-learned" id="toc-what-youve-learned" class="nav-link" data-scroll-target="#what-youve-learned"><span class="header-section-number">13</span> What You’ve Learned</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">14</span> Next Steps</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">15</span> Key Takeaways</a>
  <ul class="collapse">
  <li><a href="#essential-concepts" id="toc-essential-concepts" class="nav-link" data-scroll-target="#essential-concepts"><span class="header-section-number">15.1</span> Essential Concepts</a></li>
  <li><a href="#when-to-apply-this-workflow" id="toc-when-to-apply-this-workflow" class="nav-link" data-scroll-target="#when-to-apply-this-workflow"><span class="header-section-number">15.2</span> When to Apply This Workflow</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/edit/main/tutorials/first-analysis.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../tutorials/getting-started.html">Getting Started</a></li><li class="breadcrumb-item"><a href="../tutorials/first-analysis.html">Your First Analysis</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Your First Analysis</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Complete Workflow from Raw Data to Results</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>This tutorial walks you through a complete analysis workflow, from importing raw genomic data through quality control, statistical analysis, and result visualization. Unlike previous tutorials that focused on individual operations, here you’ll see how everything fits together into a reproducible analysis pipeline.</p>
<p>Think of this as your template for real analyses. The specific dataset (simulated genomic SNPs) is less important than understanding the workflow structure: import → quality control → prepare data → analyze → validate → export. This pattern applies whether you’re analyzing genomics, climate data, or financial time series.</p>
<section id="what-youll-learn" class="level3 learning-objectives" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="what-youll-learn"><span class="header-section-number">1.1</span> What You’ll Learn</h3>
<p>By the end of this tutorial, you will:</p>
<ul>
<li>Execute a complete analysis from raw data to final results</li>
<li>Apply quality control steps systematically (sample and feature filtering)</li>
<li>Handle missing data through imputation</li>
<li>Perform SVD/PCA on large matrices using block-wise algorithms</li>
<li>Extract and interpret analysis results</li>
<li>Create publication-quality visualizations</li>
<li>Export results for downstream analyses</li>
<li>Understand how to adapt this workflow to your own data</li>
</ul>
</section>
<hr>
</section>
<section id="the-analysis-goal" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="the-analysis-goal"><span class="header-section-number">2</span> The Analysis Goal</h2>
<p>We’ll analyze a simulated genomic dataset to:</p>
<ol type="1">
<li>Identify population structure using PCA</li>
<li>Remove technical artifacts through quality control</li>
<li>Handle missing data appropriately</li>
<li>Extract principal components for downstream analyses</li>
</ol>
<p>This workflow mirrors real genomic studies but uses simulated data for tutorial purposes.</p>
<hr>
</section>
<section id="prerequisites" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="prerequisites"><span class="header-section-number">3</span> Prerequisites</h2>
<p>Complete the previous tutorials:</p>
<ol type="1">
<li><a href="../tutorials/getting-started.html">Getting Started</a></li>
<li><a href="../tutorials/working-hdf5-matrices.html">Working with HDF5 Matrices</a></li>
</ol>
<p>Load required packages:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># For visualization</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
</section>
<section id="step-1-create-and-import-data" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="step-1-create-and-import-data"><span class="header-section-number">4</span> Step 1: Create and Import Data</h2>
<section id="simulate-genomic-data" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="simulate-genomic-data"><span class="header-section-number">4.1</span> Simulate Genomic Data</h3>
<p>In real analyses, you’d load data from sequencing files. Here we simulate:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate genotype data: 500 samples × 2,000 SNPs</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (Reduced size for tutorial - real analyses use much larger datasets)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>n_snps <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create genotype matrix with some structure</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate 3 populations with different allele frequencies</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>pop1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">175</span><span class="sc">*</span>n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>)), <span class="dv">175</span>, n_snps)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>pop2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">175</span><span class="sc">*</span>n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>)), <span class="dv">175</span>, n_snps)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>pop3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">150</span><span class="sc">*</span>n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.6</span>)), <span class="dv">150</span>, n_snps)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>genotype <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pop1, pop2, pop3)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add some missing data (realistic scenario)</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>missing_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(genotype), <span class="fu">length</span>(genotype) <span class="sc">*</span> <span class="fl">0.02</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>genotype[missing_idx] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add sample and SNP IDs</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(genotype) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Sample_"</span>, <span class="dv">1</span><span class="sc">:</span>n_samples)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(genotype) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"SNP_"</span>, <span class="dv">1</span><span class="sc">:</span>n_snps)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create population labels (for visualization later)</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Pop1"</span>, <span class="dv">175</span>), <span class="fu">rep</span>(<span class="st">"Pop2"</span>, <span class="dv">175</span>), <span class="fu">rep</span>(<span class="st">"Pop3"</span>, <span class="dv">150</span>))</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Genotype matrix created:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Genotype matrix created:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Dimensions:"</span>, <span class="fu">nrow</span>(genotype), <span class="st">"samples ×"</span>, <span class="fu">ncol</span>(genotype), <span class="st">"SNPs</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Dimensions: 500 samples × 2000 SNPs</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Missing data:"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(genotype))<span class="sc">/</span><span class="fu">length</span>(genotype)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Missing data: 2 %</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>About Dataset Size
</div>
</div>
<div class="callout-body-container callout-body">
<p>This tutorial uses <strong>500 samples × 2,000 SNPs</strong> for quick execution and web performance. Real genomic studies typically analyze much larger datasets:</p>
<ul>
<li>GWAS: 10,000-1,000,000 samples × 500,000-10,000,000 SNPs</li>
<li>Whole genome: 100-10,000 samples × 3,000,000-100,000,000 variants</li>
</ul>
<p>BigDataStatMeth handles these large-scale datasets by processing data in blocks directly from HDF5 files.</p>
</div>
</div>
</section>
<section id="import-to-hdf5" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="import-to-hdf5"><span class="header-section-number">4.2</span> Import to HDF5</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create HDF5 file</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>analysis_file <span class="ot">&lt;-</span> <span class="st">"genomic_analysis.hdf5"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> genotype,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"raw"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">TRUE</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fn
[1] "genomic_analysis.hdf5"

$ds
[1] "raw/genotypes"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Data imported to HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Data imported to HDF5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check file structure</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(analysis_file)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     group                name       otype   dclass        dim
0                        /                 raw   H5I_GROUP                    
1                     /raw .genotypes_dimnames   H5I_GROUP                    
2 /raw/.genotypes_dimnames                   1 H5I_DATASET COMPOUND        500
3 /raw/.genotypes_dimnames                   2 H5I_DATASET COMPOUND       2000
4                     /raw           genotypes H5I_DATASET  INTEGER 500 x 2000</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="step-2-quality-control" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="step-2-quality-control"><span class="header-section-number">5</span> Step 2: Quality Control</h2>
<section id="remove-low-quality-samples" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="remove-low-quality-samples"><span class="header-section-number">5.1</span> Remove Low-Quality Samples</h3>
<p>Samples with too much missing data may indicate technical problems:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove samples with &gt;5% missing data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>qc_samples <span class="ot">&lt;-</span> <span class="fu">bdRemovelowdata_hdf5</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"raw"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outdataset =</span> <span class="st">"genotypes_samples_filtered"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">FALSE</span>,  <span class="co"># Work on rows (samples)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pcent =</span> <span class="fl">0.05</span>     <span class="co"># 5% threshold</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Sample QC completed</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Sample QC completed</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Samples removed:"</span>, qc_samples<span class="sc">$</span>removed_count, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Samples removed: </code></pre>
</div>
</div>
</section>
<section id="remove-low-quality-snps" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="remove-low-quality-snps"><span class="header-section-number">5.2</span> Remove Low-Quality SNPs</h3>
<p>SNPs with low minor allele frequency (MAF) or high missingness:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First remove SNPs with &gt;5% missing data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>qc_snps_missing <span class="ot">&lt;-</span> <span class="fu">bdRemovelowdata_hdf5</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes_samples_filtered"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outdataset =</span> <span class="st">"genotypes_missing_filtered"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">TRUE</span>,   <span class="co"># Work on columns (SNPs)</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pcent =</span> <span class="fl">0.05</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ SNP missing data QC completed</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ SNP missing data QC completed</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" SNPs removed:"</span>, qc_snps_missing<span class="sc">$</span>removed_count, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> SNPs removed: </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then remove SNPs with MAF &lt; 5%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>qc_snps_maf <span class="ot">&lt;-</span> <span class="fu">bdRemoveMAF_hdf5</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes_missing_filtered"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outdataset =</span> <span class="st">"genotypes_qc_complete"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">maf =</span> <span class="fl">0.05</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">blocksize =</span> <span class="dv">1000</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ MAF filtering completed</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ MAF filtering completed</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Quality Control is Critical
</div>
</div>
<div class="callout-body-container callout-body">
<p>In real genomic analyses, QC removes:</p>
<ul>
<li><strong>Technical artifacts:</strong> Failed samples, contamination</li>
<li><strong>Uninformative markers:</strong> Rare variants, high missingness</li>
<li><strong>Errors:</strong> Genotyping errors, batch effects</li>
</ul>
<p>Always perform QC before downstream analysis. The thresholds (5% missing, 5% MAF) are typical but should be adjusted based on your study design.</p>
</div>
</div>
</section>
<section id="inspect-qc-results" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="inspect-qc-results"><span class="header-section-number">5.3</span> Inspect QC Results</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check dimensions after QC</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>h5file <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(analysis_file)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>dim_raw <span class="ot">&lt;-</span> <span class="fu">dim</span>(h5file<span class="sc">$</span>raw<span class="sc">$</span>genotypes)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>dim_qc <span class="ot">&lt;-</span> <span class="fu">dim</span>(h5file<span class="sc">$</span>qc<span class="sc">$</span>genotypes_qc_complete)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">H5Fclose</span>(h5file)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Dimensions before QC:"</span>, dim_raw[<span class="dv">1</span>], <span class="st">"×"</span>, dim_raw[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Dimensions before QC: 500 × 2000 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dimensions after QC:"</span>, dim_qc[<span class="dv">1</span>], <span class="st">"×"</span>, dim_qc[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dimensions after QC: 500 × 2000 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Samples retained:"</span>, <span class="fu">round</span>(dim_qc[<span class="dv">1</span>]<span class="sc">/</span>dim_raw[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Samples retained: 100 %</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"SNPs retained:"</span>, <span class="fu">round</span>(dim_qc[<span class="dv">2</span>]<span class="sc">/</span>dim_raw[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>SNPs retained: 100 %</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="step-3-impute-missing-data" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="step-3-impute-missing-data"><span class="header-section-number">6</span> Step 3: Impute Missing Data</h2>
<p>After QC, we still have some missing data. Impute using mean genotype:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values (mean imputation by column)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bdImputeSNPs_hdf5</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes_qc_complete"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">outdataset =</span> <span class="st">"genotypes_qc_complete"</span>,  <span class="co"># Overwrite</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$fn
[1] "genomic_analysis.hdf5"

$ds
[1] "qc/genotypes_qc_complete"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Missing data imputed</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Missing data imputed</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Imputation Methods
</div>
</div>
<div class="callout-body-container callout-body">
<p>BigDataStatMeth uses mean imputation by default. For genomic data:</p>
<ul>
<li><strong>Mean imputation:</strong> Simple, fast, works for PCA/dimensionality reduction</li>
<li><strong>For association studies:</strong> Consider more sophisticated methods (BEAGLE, IMPUTE2)</li>
<li><strong>Always impute AFTER QC:</strong> Don’t impute bad data</li>
</ul>
</div>
</div>
<hr>
</section>
<section id="step-4-perform-svd" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="step-4-perform-svd"><span class="header-section-number">7</span> Step 4: Perform SVD</h2>
<p>Now perform SVD to extract principal components:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform hierarchical SVD</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>svd_result <span class="ot">&lt;-</span> <span class="fu">bdSVD_hdf5</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> analysis_file,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes_qc_complete"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bcenter =</span> <span class="cn">TRUE</span>,      <span class="co"># Center the data</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">bscale =</span> <span class="cn">FALSE</span>,      <span class="co"># Don't scale (typical for genotypes)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">4</span>,               <span class="co"># Number of blocks</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">q =</span> <span class="dv">1</span>,               <span class="co"># Number of hierarchy levels</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads =</span> <span class="dv">2</span>,         <span class="co"># Use 2 threads</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ SVD completed</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ SVD completed</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Results stored in:"</span>, svd_result<span class="sc">$</span>group, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Results stored in: </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>SVD Parameters
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>bcenter = TRUE:</strong> Essential - centers data to zero mean</li>
<li><strong>bscale = FALSE:</strong> Don’t standardize (typical for genotype data)</li>
<li><strong>k:</strong> Number of blocks (more = faster but approximation)</li>
<li><strong>q:</strong> Hierarchy levels (usually 1 or 2)</li>
<li><strong>threads:</strong> Parallel processing (adjust to your system)</li>
</ul>
<p>For huge datasets (&gt;100 GB), increase <code>k</code> and consider <code>q = 2</code>.</p>
</div>
</div>
<hr>
</section>
<section id="step-5-extract-and-examine-results" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="step-5-extract-and-examine-results"><span class="header-section-number">8</span> Step 5: Extract and Examine Results</h2>
<p>SVD produces three key outputs stored in the HDF5 file. Let’s extract them and see what they look like.</p>
<section id="extract-principal-components" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="extract-principal-components"><span class="header-section-number">8.1</span> Extract Principal Components</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the file to access SVD results</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>h5file <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(analysis_file)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get singular values (eigenvalues) - these tell us variance explained</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>d_values <span class="ot">&lt;-</span> h5file<span class="sc">$</span>SVD<span class="sc">$</span>genotypes_qc_complete<span class="sc">$</span>d</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get left singular vectors (U) - sample loadings = our principal components</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>u_matrix <span class="ot">&lt;-</span> h5file<span class="sc">$</span>SVD<span class="sc">$</span>genotypes_qc_complete<span class="sc">$</span>u</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get right singular vectors (V) - SNP loadings = feature contributions</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>v_matrix <span class="ot">&lt;-</span> h5file<span class="sc">$</span>SVD<span class="sc">$</span>genotypes_qc_complete<span class="sc">$</span>v</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="fu">H5Fclose</span>(h5file)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add meaningful column names</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(u_matrix) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(u_matrix))</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(v_matrix) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(v_matrix))</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Extracted SVD components:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Extracted SVD components:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Singular values (d):"</span>, <span class="fu">length</span>(d_values), <span class="st">"values</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Singular values (d): 500 values</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Sample loadings (U):"</span>, <span class="fu">nrow</span>(u_matrix), <span class="st">"samples ×"</span>, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ncol</span>(u_matrix), <span class="st">"components</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sample loadings (U): 500 samples × 500 components</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  SNP loadings (V):"</span>, <span class="fu">nrow</span>(v_matrix), <span class="st">"SNPs ×"</span>, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ncol</span>(v_matrix), <span class="st">"components</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  SNP loadings (V): 2000 SNPs × 500 components</code></pre>
</div>
</div>
<p>Let’s look at what these matrices actually contain:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview singular values</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">First 10 singular values:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
First 10 singular values:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(d_values[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="dv">4</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 443.6651  45.8525  45.7652  45.6761  45.3012  45.2635  45.1448  44.9551
 [9]  44.8672  44.5770</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview sample loadings (principal components)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Sample loadings (U matrix) - first 5 samples × first 5 PCs:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Sample loadings (U matrix) - first 5 samples × first 5 PCs:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(u_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>             PC1           PC2           PC3         PC4          PC5
[1,] -0.05674920 -0.0960807778  0.0008688585 -0.02656242  0.028933569
[2,] -0.05583085  0.0006901278 -0.0246730710  0.01540518 -0.012621126
[3,] -0.05799857 -0.0188249981  0.0472567892 -0.01120338 -0.045286206
[4,] -0.05701164  0.0761657948 -0.0330258052  0.07085666  0.008256376
[5,] -0.06035016 -0.0235459611  0.0327110433 -0.01996897  0.019395112</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview SNP loadings  </span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">SNP loadings (V matrix) - first 5 SNPs × first 5 PCs:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SNP loadings (V matrix) - first 5 SNPs × first 5 PCs:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(v_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>            PC1          PC2         PC3          PC4          PC5
[1,] 0.02023101  0.009783591 -0.02417201 -0.008130736  0.011707453
[2,] 0.02286006  0.005131136 -0.02201926 -0.005259815 -0.006360324
[3,] 0.02277471  0.031490093 -0.05116183 -0.002035219 -0.009526514
[4,] 0.02020268 -0.002347363  0.05582095 -0.028978655  0.032544308
[5,] 0.02327304 -0.020148580  0.02756623  0.005998072  0.042842917</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Understanding the Outputs
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Singular values (d):</strong> Larger values = more important components. These decrease rapidly - the first few PCs capture most variation.</p>
<p><strong>U matrix (sample loadings):</strong> Each row is a sample, each column is a PC. Values show how much each sample “loads on” that PC. This is what we plot for population structure.</p>
<p><strong>V matrix (SNP loadings):</strong> Each row is a SNP, each column is a PC. Values show how much each SNP contributes to that PC. High absolute values = SNPs driving that component.</p>
</div>
</div>
</section>
<section id="variance-explained" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="variance-explained"><span class="header-section-number">8.2</span> Variance Explained</h3>
<p>Now let’s see how much variance each PC captures:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportion of variance explained by each PC</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>variance_prop <span class="ot">&lt;-</span> (d_values<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>(d_values<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative variance (running total)</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>cumvar <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(variance_prop)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Variance explained by first 10 PCs:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Variance explained by first 10 PCs:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PC  | Individual | Cumulative</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>PC  | Individual | Cumulative</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"----+------------+-----------</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>----+------------+-----------</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">length</span>(variance_prop))) {</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"%-3d | %6.2f%%    | %6.2f%%</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>              i, variance_prop[i]<span class="sc">*</span><span class="dv">100</span>, cumvar[i]<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1   |  29.43%    |  29.43%
2   |   0.31%    |  29.74%
3   |   0.31%    |  30.06%
4   |   0.31%    |  30.37%
5   |   0.31%    |  30.67%
6   |   0.31%    |  30.98%
7   |   0.30%    |  31.29%
8   |   0.30%    |  31.59%
9   |   0.30%    |  31.89%
10  |   0.30%    |  32.19%</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">✓ First"</span>, <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">length</span>(variance_prop)), <span class="st">"PCs explain"</span>,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, cumvar[<span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">length</span>(cumvar))]<span class="sc">*</span><span class="dv">100</span>), </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"of total variance</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
✓ First 10 PCs explain 32.2% of total variance</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="step-6-visualize-results" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="step-6-visualize-results"><span class="header-section-number">9</span> Step 6: Visualize Results</h2>
<section id="scree-plot" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="scree-plot"><span class="header-section-number">9.1</span> Scree Plot</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare vectors for plotting</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>n_show <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(variance_prop))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>pc_nums <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n_show</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>var_pct <span class="ot">&lt;-</span> variance_prop[<span class="dv">1</span><span class="sc">:</span>n_show] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>cum_pct <span class="ot">&lt;-</span> cumvar[<span class="dv">1</span><span class="sc">:</span>n_show] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scree plot using vectors directly</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pc_nums, var_pct, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Principal Component"</span>, </span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Variance Explained (%)"</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Scree Plot: Variance Explained by Principal Components"</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(cum_pct) <span class="sc">*</span> <span class="fl">1.1</span>),</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cumulative variance line</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pc_nums, cum_pct, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"right"</span>, </span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Individual Variance"</span>, <span class="st">"Cumulative Variance"</span>),</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"steelblue"</span>, <span class="st">"darkred"</span>), </span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Add grid</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>(<span class="at">col =</span> <span class="st">"gray90"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="first-analysis_files/figure-html/scree-plot-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pca-plot" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="pca-plot"><span class="header-section-number">9.2</span> PCA Plot</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame for plotting</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Match with population labels (accounting for QC filtering)</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll use first dim_qc[1] samples</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>pca_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC1 =</span> u_matrix[,<span class="dv">1</span>],</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC2 =</span> u_matrix[,<span class="dv">2</span>],</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC3 =</span> u_matrix[,<span class="dv">3</span>],</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Population =</span> population[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(u_matrix)]</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PC1 vs PC2</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_data, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> Population)) <span class="sc">+</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pop1"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>, </span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Pop2"</span> <span class="ot">=</span> <span class="st">"#377EB8"</span>, </span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Pop3"</span> <span class="ot">=</span> <span class="st">"#4DAF4A"</span>)) <span class="sc">+</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Population Structure: PC1 vs PC2"</span>,</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"PC1: %.1f%% variance | PC2: %.1f%% variance"</span>,</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>                       variance_prop[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, variance_prop[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>),</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">sprintf</span>(<span class="st">"PC1 (%.1f%%)"</span>, variance_prop[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>),</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">sprintf</span>(<span class="st">"PC2 (%.1f%%)"</span>, variance_prop[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="first-analysis_files/figure-html/pca-plot-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Interpreting PCA Plots
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this simulated example, the three populations separate clearly on PC1 and PC2, which is expected since we simulated them with different allele frequencies.</p>
<p>In real data: - <strong>PC1/PC2 separation:</strong> Often reflects continental ancestry - <strong>Outliers:</strong> May indicate sample mix-ups or technical issues - <strong>Gradients:</strong> Reflect admixture or geographic structure - <strong>Clusters:</strong> Can represent discrete populations or family structure</p>
</div>
</div>
<hr>
</section>
</section>
<section id="step-7-save-results-for-downstream-use" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="step-7-save-results-for-downstream-use"><span class="header-section-number">10</span> Step 7: Save Results for Downstream Use</h2>
<section id="export-pcs-for-other-tools" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="export-pcs-for-other-tools"><span class="header-section-number">10.1</span> Export PCs for Other Tools</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save PCs to text file for use in other software</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>pcs_export <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">SampleID =</span> <span class="fu">paste0</span>(<span class="st">"Sample_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(u_matrix)),</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  u_matrix[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]  <span class="co"># First 10 PCs</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(pcs_export, <span class="st">"principal_components.txt"</span>,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Principal components exported to principal_components.txt</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Principal components exported to principal_components.txt</code></pre>
</div>
</div>
</section>
<section id="document-the-analysis" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="document-the-analysis"><span class="header-section-number">10.2</span> Document the Analysis</h3>
<p>Every analysis should be documented. Let’s create a summary report with all key information:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive analysis summary</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>analysis_summary <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="st">Genomic Analysis Summary</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="st">========================</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="st">Date: %s</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="st">Input Data:</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="st">- Samples: %d</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="st">- SNPs: %d  </span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="st">- Missing data: %.2f%%</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="st">Quality Control:</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="st">- Samples after QC: %d (%.1f%% retained)</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="st">- SNPs after QC: %d (%.1f%% retained)</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="st">- MAF threshold: 5%%</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="st">- Missing data threshold: 5%%</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="st">SVD Parameters:</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="st">- Centered: Yes</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="st">- Scaled: No</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="st">- Blocks (k): 4</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="st">- Levels (q): 1</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="st">- Components computed: %d</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a><span class="st">Variance Explained:</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="st">- PC1: %.2f%%</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="st">- PC2: %.2f%%</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a><span class="st">- PC1-10 cumulative: %.2f%%</span></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a><span class="st">Output Files:</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a><span class="st">- HDF5 file: %s</span></span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a><span class="st">- PCs export: principal_components.txt</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a><span class="st">- This summary: analysis_summary.txt</span></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.Date</span>(),</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>dim_raw[<span class="dv">1</span>], dim_raw[<span class="dv">2</span>], </span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(genotype))<span class="sc">/</span><span class="fu">length</span>(genotype)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>dim_qc[<span class="dv">1</span>], dim_qc[<span class="dv">1</span>]<span class="sc">/</span>dim_raw[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>dim_qc[<span class="dv">2</span>], dim_qc[<span class="dv">2</span>]<span class="sc">/</span>dim_raw[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(d_values),</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>variance_prop[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, variance_prop[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>, cumvar[<span class="dv">10</span>]<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>analysis_file</span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to file</span></span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(analysis_summary, <span class="st">"analysis_summary.txt"</span>)</span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Analysis summary saved to analysis_summary.txt</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Analysis summary saved to analysis_summary.txt</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Here's what was saved:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Here's what was saved:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">strrep</span>(<span class="st">"="</span>, <span class="dv">70</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>====================================================================== </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(analysis_summary)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Genomic Analysis Summary
========================
Date: 2025-12-15

Input Data:
- Samples: 500
- SNPs: 2000  
- Missing data: 2.00%

Quality Control:
- Samples after QC: 500 (100.0% retained)
- SNPs after QC: 2000 (100.0% retained)
- MAF threshold: 5%
- Missing data threshold: 5%

SVD Parameters:
- Centered: Yes
- Scaled: No
- Blocks (k): 4
- Levels (q): 1
- Components computed: 500

Variance Explained:
- PC1: 29.43%
- PC2: 0.31%
- PC1-10 cumulative: 32.19%

Output Files:
- HDF5 file: genomic_analysis.hdf5
- PCs export: principal_components.txt
- This summary: analysis_summary.txt</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">strrep</span>(<span class="st">"="</span>, <span class="dv">70</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>====================================================================== </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Good Documentation Practices
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Always document:</strong> - Input data characteristics (size, missing data) - QC thresholds and results - Analysis parameters - Output locations - Date performed</p>
<p><strong>Why this matters:</strong> - Reproducibility - you or others can recreate the analysis - Transparency - methods are clear - Debugging - if something’s wrong, you know what was done - Publications - you have all the details for methods sections</p>
<p>This summary file is perfect for README files or supplementary materials.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="interactive-exercise" class="level2 exercise" data-number="11">
<h2 class="exercise anchored" data-number="11" data-anchor-id="interactive-exercise"><span class="header-section-number">11</span> Interactive Exercise</h2>
<section id="practice-modifying-the-analysis-workflow" class="level3" data-number="11.1">
<h3 data-number="11.1" class="anchored" data-anchor-id="practice-modifying-the-analysis-workflow"><span class="header-section-number">11.1</span> Practice: Modifying the Analysis Workflow</h3>
<p>Understanding a workflow means being able to modify it for different scenarios. This exercise challenges you to adapt what you’ve learned to new situations.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise: Adapt this workflow for your research</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 1: Different QC thresholds</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Your dataset has higher missingness - adjust thresholds</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bdRemovelowdata_hdf5</span>(</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"genomic_data.hdf5"</span>,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"raw"</span>, <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>, <span class="at">outdataset =</span> <span class="st">"samples_qc"</span>,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">FALSE</span>, </span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">pcent =</span> <span class="fl">0.10</span>  <span class="co"># Allow 10% missing instead of 5%</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 2: More stringent MAF filtering</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="fu">bdRemoveMAF_hdf5</span>(</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"genomic_data.hdf5"</span>,</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>, <span class="at">dataset =</span> <span class="st">"snps_qc"</span>,</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>, <span class="at">outdataset =</span> <span class="st">"snps_qc_maf"</span>,</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">maf =</span> <span class="fl">0.10</span>  <span class="co"># Remove variants &lt;10% frequency</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 3: Different SVD parameters</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a><span class="co"># You want more PCs but with less accuracy for speed</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="fu">bdSVD_hdf5</span>(</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"genomic_data.hdf5"</span>,</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>, <span class="at">dataset =</span> <span class="st">"imputed"</span>,</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">10</span>,   <span class="co"># More PCs</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">q =</span> <span class="dv">1</span>,    <span class="co"># Fewer hierarchy levels (faster)</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">bcenter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">bscale =</span> <span class="cn">FALSE</span></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 4: Add your own visualization</span></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a><span class="co"># What would you plot differently?</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="co"># - Top 3 PCs in 3D?</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="co"># - Loadings to identify influential SNPs?</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a><span class="co"># - Correlation of PCs with phenotypes?</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Reflection Questions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Think about how you’d adapt this workflow to your specific needs:</p>
<p><strong>1. Quality Control Decisions:</strong> - What QC thresholds are appropriate for your data? - Do you need additional filters (Hardy-Weinberg equilibrium, relatedness)? - How do you decide what’s “low quality” vs.&nbsp;“real signal”? - When should you be more vs.&nbsp;less stringent?</p>
<p><strong>2. Missing Data Strategy:</strong> - Mean imputation is simple but crude - when is it acceptable? - What alternatives exist (mode, k-NN, matrix completion)? - How much missingness is too much to impute validly? - Should you remove high-missingness markers before imputing?</p>
<p><strong>3. SVD Parameters:</strong> - How many principal components do you need? - Trade-off: k=10 with q=2 vs.&nbsp;k=40 with q=1? - When does increased accuracy justify increased computation time? - How do you verify results are accurate enough?</p>
<p><strong>4. Validation Steps:</strong> - How do you know your QC worked correctly? - What checks confirm SVD completed properly? - How do you detect if you removed too much/little data? - When should you see red flags in the results?</p>
<p><strong>5. Scaling to Your Data:</strong> - This tutorial used 500 samples × 2,000 SNPs - What if you have 50,000 samples × 500,000 SNPs? - Which steps become bottlenecks? - Where would you adjust block sizes, threads, or parameters?</p>
<p><strong>6. Workflow Modifications:</strong> - What if you’re analyzing transcriptomics instead of genomics? - Different data types (time series, images, sensor networks)? - How would you adapt each step? - Which parts are generalizable, which are domain-specific?</p>
<p>The best way to learn is by trying. Copy this workflow, modify it step by step, see what breaks and what works. Understanding why something fails teaches as much as getting it right.</p>
</div>
</div>
<hr>
</section>
</section>
<section id="cleanup" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="cleanup"><span class="header-section-number">12</span> Cleanup</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Close HDF5 connections</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep the HDF5 file and results for review</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove intermediate exports if desired:</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co"># file.remove("principal_components.txt", "analysis_summary.txt")</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Analysis complete!</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Analysis complete!</code></pre>
</div>
</div>
<hr>
</section>
<section id="what-youve-learned" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="what-youve-learned"><span class="header-section-number">13</span> What You’ve Learned</h2>
<p>✅ <strong>Complete workflow:</strong> From raw data to interpretable results<br>
✅ <strong>Quality control:</strong> Sample and SNP filtering<br>
✅ <strong>Data preparation:</strong> Missing data imputation<br>
✅ <strong>SVD analysis:</strong> Dimensionality reduction on large matrices<br>
✅ <strong>Visualization:</strong> Scree plots and PCA plots<br>
✅ <strong>Results export:</strong> Preparing data for downstream analyses</p>
<hr>
</section>
<section id="next-steps" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">14</span> Next Steps</h2>
<p><strong>Explore advanced workflows:</strong></p>
<ul>
<li><a href="../workflows/implementing-pca.html">Implementing PCA</a> - Real genomic data, advanced visualization</li>
<li><a href="../workflows/implementing-cca.html">Implementing CCA</a> - Multi-omics integration</li>
<li><a href="../workflows/cross-platform.html">Cross-Platform Workflows</a> - Using results in Python, C++</li>
</ul>
<p><strong>Optimize for your data:</strong></p>
<ul>
<li>Adjust QC thresholds based on your study</li>
<li>Try different SVD parameters (k, q) for speed vs accuracy</li>
<li>Use more PCs if data has complex structure</li>
<li>Integrate covariates in downstream analyses</li>
</ul>
<p><strong>Learn the theory:</strong></p>
<ul>
<li><a href="../fundamentals/blockwise-computing.html">Block-Wise Computing</a> - How SVD scales to large data</li>
<li><a href="../fundamentals/linear-algebra.html">Linear Algebra Refresher</a> - Math behind PCA/SVD</li>
</ul>
<hr>
</section>
<section id="key-takeaways" class="level2 key-concept" data-number="15">
<h2 class="key-concept anchored" data-number="15" data-anchor-id="key-takeaways"><span class="header-section-number">15</span> Key Takeaways</h2>
<p>Let’s consolidate what you’ve learned about executing complete analyses with BigDataStatMeth, from raw data through final results.</p>
<section id="essential-concepts" class="level3" data-number="15.1">
<h3 data-number="15.1" class="anchored" data-anchor-id="essential-concepts"><span class="header-section-number">15.1</span> Essential Concepts</h3>
<p><strong>Analysis workflows follow a consistent structure</strong> regardless of domain or data type. Import → quality control → data preparation → analysis → validation → export. This pattern applies whether you’re analyzing genomics, climate data, financial time series, or sensor networks. The specific QC steps and analysis methods change, but the overall structure remains constant. Understanding this framework helps you design new analyses systematically rather than ad hoc, and recognize where different projects share common challenges.</p>
<p><strong>Quality control must come before analysis, not after.</strong> Running PCA on data with 30% missing values, duplicate samples, or technical artifacts produces misleading results that look mathematically valid but are scientifically meaningless. You can’t fix bad input with good algorithms - garbage in, garbage out applies universally. Investing time in QC upfront determines whether your results are interpretable or garbage. The temptation to skip QC and “just see what happens” is strong, but resist it. QC failures discovered after weeks of analysis waste far more time than doing QC correctly from the start.</p>
<p><strong>Missing data imputation has consequences</strong> that affect downstream analyses. Mean imputation (replacing missing values with column means) is computationally simple but statistically crude - it reduces variance artificially and can create patterns where none exist. It’s acceptable for low missingness (&lt;5%) where impact is minimal. Higher missingness requires more sophisticated methods (k-NN imputation, matrix completion) or removal of high-missingness features entirely. There’s no free lunch: every imputation method introduces assumptions, and those assumptions propagate through your analyses affecting final conclusions.</p>
<p><strong>Centering versus scaling matters for interpretation</strong> and affects what your principal components mean. Centering (subtracting column means) is almost always needed for PCA - it ensures PC1 doesn’t just capture mean differences between features. Scaling (dividing by standard deviations) is more controversial: it gives equal weight to all features, which helps when features have different units (mixing expression and metabolites) but can obscure real biological differences in variability. For genomic SNPs where all features are the same type, we typically center but don’t scale. Understanding these choices helps you interpret what patterns the PCs are actually capturing.</p>
<p><strong>Variance explained tells you if PCA succeeded.</strong> If PC1-PC10 only explain 20% of total variance, your data either has very high true dimensionality (many independent biological signals) or very high noise (low signal-to-noise ratio). If PC1 alone explains 80%, you have a strong dominant pattern - but verify it’s real biological structure, not a technical artifact like batch effects or ancestry. Inspecting variance explained is your first diagnostic of whether the analysis produced meaningful results or just decomposed noise.</p>
<p><strong>Block-wise processing is transparent</strong> to the user, hiding complexity while enabling scalability. You called <code>bdSVD_hdf5()</code> exactly as you would any function - one function call, simple arguments. Behind the scenes, BigDataStatMeth partitioned your matrix into blocks, computed local SVDs, hierarchically merged results, and produced final output. This happened automatically without you writing partitioning logic or managing intermediate results. This abstraction is the package’s core value: sophisticated algorithms exposed through simple interfaces.</p>
<p><strong>Documentation is part of the analysis, not an afterthought.</strong> The analysis summary you created documents everything needed to reproduce the work: data sources, QC thresholds, parameters, software versions, dates. Without this documentation, you’ll forget critical details within weeks. Future you (revisiting the analysis), collaborators (extending the work), and reviewers (verifying methods) all depend on thorough documentation. Make documentation a habit from the start, not something you do “if you have time” before submitting papers.</p>
</section>
<section id="when-to-apply-this-workflow" class="level3" data-number="15.2">
<h3 data-number="15.2" class="anchored" data-anchor-id="when-to-apply-this-workflow"><span class="header-section-number">15.2</span> When to Apply This Workflow</h3>
<p>Understanding which analyses benefit from this structured approach versus when simpler methods suffice helps you work efficiently.</p>
<p>✅ <strong>Use this complete workflow when:</strong></p>
<ul>
<li><p><strong>Your dataset exceeds memory limits</strong> - When traditional <code>prcomp()</code> or <code>svd()</code> fail with memory errors, BigDataStatMeth’s disk-based approach becomes necessary, not optional. The workflow structure (HDF5 storage, QC, analysis, export) handles data that doesn’t fit in RAM.</p></li>
<li><p><strong>Quality control is critical for validity</strong> - Genomic studies, clinical trials, sensor networks - anywhere that data quality directly affects scientific conclusions. Following QC → imputation → analysis prevents analyzing garbage and drawing false conclusions.</p></li>
<li><p><strong>You’ll run multiple analyses on the same data</strong> - Converting to HDF5 and performing QC once pays off when you subsequently run PCA, regression, association tests, and more. The upfront investment amortizes across all downstream analyses.</p></li>
<li><p><strong>Reproducibility and documentation matter</strong> - Academic research, regulatory submissions, collaborative projects - anywhere others need to understand and verify your methods. The structured workflow with documented parameters makes reproducibility natural rather than an afterthought.</p></li>
<li><p><strong>The analysis will be extended or repeated</strong> - If you’ll add more samples later, rerun with updated QC thresholds, or apply the same pipeline to new datasets, having a documented workflow saves enormous time. Copy the structure, adjust parameters, execute.</p></li>
</ul>
<p>✅ <strong>Adapt the workflow when:</strong></p>
<ul>
<li><p><strong>Analyzing different data types</strong> - Transcriptomics needs log-transformation and batch correction instead of MAF filtering. Time series needs detrending instead of missing data imputation. Climate data needs spatial autocorrelation handling. The workflow structure (import → QC → prepare → analyze) remains constant, but specific operations change.</p></li>
<li><p><strong>QC requirements differ</strong> - Exploratory analyses tolerate higher missingness than GWAS. Population structure studies need less stringent filtering than association tests. Adjust QC thresholds to match your analysis goals and acceptable false discovery rates.</p></li>
<li><p><strong>Computational resources vary</strong> - With 256 GB RAM, you might skip HDF5 for 40 GB datasets. With 16 GB RAM, you need disk-based computing for 10 GB datasets. Adjust block sizes (<code>k</code>), hierarchy levels (<code>q</code>), and threading based on your available resources.</p></li>
</ul>
<p>❌ <strong>Simpler approaches suffice when:</strong></p>
<ul>
<li><p><strong>Data fits comfortably in memory</strong> - If <code>data &lt;- read.csv(file); svd(data)</code> works without issues, the added complexity of HDF5 storage and block-wise processing provides minimal benefit. Use familiar tools that work.</p></li>
<li><p><strong>One-off exploratory analysis</strong> - Quick investigations you won’t repeat or extend don’t justify elaborate workflows. Load data, run analysis, save key results, move on. Don’t over-engineer temporary explorations.</p></li>
<li><p><strong>No quality control needed</strong> - Clean, well-curated datasets (like published benchmark data) don’t need extensive QC. Applying QC steps that aren’t necessary wastes time without improving results.</p></li>
</ul>
<p>The key insight is matching workflow complexity to problem complexity. Large-scale, quality-sensitive, repeated analyses justify this structured approach. Small-scale, one-off, exploratory work doesn’t. Choose appropriately based on your specific situation rather than applying the same workflow everywhere.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/isglobal-brge\.github\.io\/BigDataStatMeth\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb87" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Your First Analysis"</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Complete Workflow from Raw Data to Results"</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>This tutorial walks you through a complete analysis workflow, from importing raw genomic data through quality control, statistical analysis, and result visualization. Unlike previous tutorials that focused on individual operations, here you'll see how everything fits together into a reproducible analysis pipeline.</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>Think of this as your template for real analyses. The specific dataset (simulated genomic SNPs) is less important than understanding the workflow structure: import → quality control → prepare data → analyze → validate → export. This pattern applies whether you're analyzing genomics, climate data, or financial time series.</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>::: {.learning-objectives}</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="fu">### What You'll Learn</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>By the end of this tutorial, you will:</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Execute a complete analysis from raw data to final results</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Apply quality control steps systematically (sample and feature filtering)</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Handle missing data through imputation</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Perform SVD/PCA on large matrices using block-wise algorithms</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Extract and interpret analysis results</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create publication-quality visualizations</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Export results for downstream analyses</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understand how to adapt this workflow to your own data</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Analysis Goal</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>We'll analyze a simulated genomic dataset to:</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Identify population structure using PCA</span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Remove technical artifacts through quality control</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Handle missing data appropriately</span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Extract principal components for downstream analyses</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>This workflow mirrors real genomic studies but uses simulated data for tutorial purposes.</span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prerequisites</span></span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>Complete the previous tutorials:</span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="co">[</span><span class="ot">Getting Started</span><span class="co">](getting-started.qmd)</span></span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="co">[</span><span class="ot">Working with HDF5 Matrices</span><span class="co">](working-hdf5-matrices.qmd)</span></span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a>Load required packages:</span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, eval=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(BigDataStatMeth)</span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rhdf5)</span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># For visualization</span></span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-59"><a href="#cb87-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1: Create and Import Data</span></span>
<span id="cb87-60"><a href="#cb87-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-61"><a href="#cb87-61" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulate Genomic Data</span></span>
<span id="cb87-62"><a href="#cb87-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-63"><a href="#cb87-63" aria-hidden="true" tabindex="-1"></a>In real analyses, you'd load data from sequencing files. Here we simulate:</span>
<span id="cb87-64"><a href="#cb87-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-65"><a href="#cb87-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r simulate-data, eval=TRUE}</span></span>
<span id="cb87-66"><a href="#cb87-66" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb87-67"><a href="#cb87-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-68"><a href="#cb87-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate genotype data: 500 samples × 2,000 SNPs</span></span>
<span id="cb87-69"><a href="#cb87-69" aria-hidden="true" tabindex="-1"></a><span class="co"># (Reduced size for tutorial - real analyses use much larger datasets)</span></span>
<span id="cb87-70"><a href="#cb87-70" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb87-71"><a href="#cb87-71" aria-hidden="true" tabindex="-1"></a>n_snps <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb87-72"><a href="#cb87-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-73"><a href="#cb87-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Create genotype matrix with some structure</span></span>
<span id="cb87-74"><a href="#cb87-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate 3 populations with different allele frequencies</span></span>
<span id="cb87-75"><a href="#cb87-75" aria-hidden="true" tabindex="-1"></a>pop1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">175</span><span class="sc">*</span>n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>, </span>
<span id="cb87-76"><a href="#cb87-76" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>)), <span class="dv">175</span>, n_snps)</span>
<span id="cb87-77"><a href="#cb87-77" aria-hidden="true" tabindex="-1"></a>pop2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">175</span><span class="sc">*</span>n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-78"><a href="#cb87-78" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>)), <span class="dv">175</span>, n_snps)</span>
<span id="cb87-79"><a href="#cb87-79" aria-hidden="true" tabindex="-1"></a>pop3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">150</span><span class="sc">*</span>n_snps, <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-80"><a href="#cb87-80" aria-hidden="true" tabindex="-1"></a>                      <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.6</span>)), <span class="dv">150</span>, n_snps)</span>
<span id="cb87-81"><a href="#cb87-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-82"><a href="#cb87-82" aria-hidden="true" tabindex="-1"></a>genotype <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pop1, pop2, pop3)</span>
<span id="cb87-83"><a href="#cb87-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-84"><a href="#cb87-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Add some missing data (realistic scenario)</span></span>
<span id="cb87-85"><a href="#cb87-85" aria-hidden="true" tabindex="-1"></a>missing_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(genotype), <span class="fu">length</span>(genotype) <span class="sc">*</span> <span class="fl">0.02</span>)</span>
<span id="cb87-86"><a href="#cb87-86" aria-hidden="true" tabindex="-1"></a>genotype[missing_idx] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb87-87"><a href="#cb87-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-88"><a href="#cb87-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Add sample and SNP IDs</span></span>
<span id="cb87-89"><a href="#cb87-89" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(genotype) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Sample_"</span>, <span class="dv">1</span><span class="sc">:</span>n_samples)</span>
<span id="cb87-90"><a href="#cb87-90" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(genotype) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"SNP_"</span>, <span class="dv">1</span><span class="sc">:</span>n_snps)</span>
<span id="cb87-91"><a href="#cb87-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-92"><a href="#cb87-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Create population labels (for visualization later)</span></span>
<span id="cb87-93"><a href="#cb87-93" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Pop1"</span>, <span class="dv">175</span>), <span class="fu">rep</span>(<span class="st">"Pop2"</span>, <span class="dv">175</span>), <span class="fu">rep</span>(<span class="st">"Pop3"</span>, <span class="dv">150</span>))</span>
<span id="cb87-94"><a href="#cb87-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-95"><a href="#cb87-95" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Genotype matrix created:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-96"><a href="#cb87-96" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Dimensions:"</span>, <span class="fu">nrow</span>(genotype), <span class="st">"samples ×"</span>, <span class="fu">ncol</span>(genotype), <span class="st">"SNPs</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-97"><a href="#cb87-97" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Missing data:"</span>, <span class="fu">round</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(genotype))<span class="sc">/</span><span class="fu">length</span>(genotype)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-98"><a href="#cb87-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-99"><a href="#cb87-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-100"><a href="#cb87-100" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb87-101"><a href="#cb87-101" aria-hidden="true" tabindex="-1"></a><span class="fu">## About Dataset Size</span></span>
<span id="cb87-102"><a href="#cb87-102" aria-hidden="true" tabindex="-1"></a>This tutorial uses **500 samples × 2,000 SNPs** for quick execution and web performance. Real genomic studies typically analyze much larger datasets:</span>
<span id="cb87-103"><a href="#cb87-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-104"><a href="#cb87-104" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>GWAS: 10,000-1,000,000 samples × 500,000-10,000,000 SNPs</span>
<span id="cb87-105"><a href="#cb87-105" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Whole genome: 100-10,000 samples × 3,000,000-100,000,000 variants</span>
<span id="cb87-106"><a href="#cb87-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-107"><a href="#cb87-107" aria-hidden="true" tabindex="-1"></a>BigDataStatMeth handles these large-scale datasets by processing data in blocks directly from HDF5 files.</span>
<span id="cb87-108"><a href="#cb87-108" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-109"><a href="#cb87-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-110"><a href="#cb87-110" aria-hidden="true" tabindex="-1"></a><span class="fu">### Import to HDF5</span></span>
<span id="cb87-111"><a href="#cb87-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-112"><a href="#cb87-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import-hdf5, eval=TRUE}</span></span>
<span id="cb87-113"><a href="#cb87-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Create HDF5 file</span></span>
<span id="cb87-114"><a href="#cb87-114" aria-hidden="true" tabindex="-1"></a>analysis_file <span class="ot">&lt;-</span> <span class="st">"genomic_analysis.hdf5"</span></span>
<span id="cb87-115"><a href="#cb87-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-116"><a href="#cb87-116" aria-hidden="true" tabindex="-1"></a><span class="fu">bdCreate_hdf5_matrix</span>(</span>
<span id="cb87-117"><a href="#cb87-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb87-118"><a href="#cb87-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> genotype,</span>
<span id="cb87-119"><a href="#cb87-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"raw"</span>,</span>
<span id="cb87-120"><a href="#cb87-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb87-121"><a href="#cb87-121" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwriteFile =</span> <span class="cn">TRUE</span></span>
<span id="cb87-122"><a href="#cb87-122" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-123"><a href="#cb87-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-124"><a href="#cb87-124" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Data imported to HDF5</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-125"><a href="#cb87-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-126"><a href="#cb87-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Check file structure</span></span>
<span id="cb87-127"><a href="#cb87-127" aria-hidden="true" tabindex="-1"></a><span class="fu">h5ls</span>(analysis_file)</span>
<span id="cb87-128"><a href="#cb87-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-129"><a href="#cb87-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-130"><a href="#cb87-130" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-131"><a href="#cb87-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-132"><a href="#cb87-132" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2: Quality Control</span></span>
<span id="cb87-133"><a href="#cb87-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-134"><a href="#cb87-134" aria-hidden="true" tabindex="-1"></a><span class="fu">### Remove Low-Quality Samples</span></span>
<span id="cb87-135"><a href="#cb87-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-136"><a href="#cb87-136" aria-hidden="true" tabindex="-1"></a>Samples with too much missing data may indicate technical problems:</span>
<span id="cb87-137"><a href="#cb87-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-138"><a href="#cb87-138" aria-hidden="true" tabindex="-1"></a><span class="in">```{r qc-samples, eval=TRUE}</span></span>
<span id="cb87-139"><a href="#cb87-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove samples with &gt;5% missing data</span></span>
<span id="cb87-140"><a href="#cb87-140" aria-hidden="true" tabindex="-1"></a>qc_samples <span class="ot">&lt;-</span> <span class="fu">bdRemovelowdata_hdf5</span>(</span>
<span id="cb87-141"><a href="#cb87-141" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb87-142"><a href="#cb87-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"raw"</span>,</span>
<span id="cb87-143"><a href="#cb87-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb87-144"><a href="#cb87-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>,</span>
<span id="cb87-145"><a href="#cb87-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">outdataset =</span> <span class="st">"genotypes_samples_filtered"</span>,</span>
<span id="cb87-146"><a href="#cb87-146" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">FALSE</span>,  <span class="co"># Work on rows (samples)</span></span>
<span id="cb87-147"><a href="#cb87-147" aria-hidden="true" tabindex="-1"></a>  <span class="at">pcent =</span> <span class="fl">0.05</span>     <span class="co"># 5% threshold</span></span>
<span id="cb87-148"><a href="#cb87-148" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-149"><a href="#cb87-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-150"><a href="#cb87-150" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Sample QC completed</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-151"><a href="#cb87-151" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Samples removed:"</span>, qc_samples<span class="sc">$</span>removed_count, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-152"><a href="#cb87-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-153"><a href="#cb87-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-154"><a href="#cb87-154" aria-hidden="true" tabindex="-1"></a><span class="fu">### Remove Low-Quality SNPs</span></span>
<span id="cb87-155"><a href="#cb87-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-156"><a href="#cb87-156" aria-hidden="true" tabindex="-1"></a>SNPs with low minor allele frequency (MAF) or high missingness:</span>
<span id="cb87-157"><a href="#cb87-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-158"><a href="#cb87-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r qc-snps-missing, eval=TRUE}</span></span>
<span id="cb87-159"><a href="#cb87-159" aria-hidden="true" tabindex="-1"></a><span class="co"># First remove SNPs with &gt;5% missing data</span></span>
<span id="cb87-160"><a href="#cb87-160" aria-hidden="true" tabindex="-1"></a>qc_snps_missing <span class="ot">&lt;-</span> <span class="fu">bdRemovelowdata_hdf5</span>(</span>
<span id="cb87-161"><a href="#cb87-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb87-162"><a href="#cb87-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>,</span>
<span id="cb87-163"><a href="#cb87-163" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes_samples_filtered"</span>,</span>
<span id="cb87-164"><a href="#cb87-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>,</span>
<span id="cb87-165"><a href="#cb87-165" aria-hidden="true" tabindex="-1"></a>  <span class="at">outdataset =</span> <span class="st">"genotypes_missing_filtered"</span>,</span>
<span id="cb87-166"><a href="#cb87-166" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">TRUE</span>,   <span class="co"># Work on columns (SNPs)</span></span>
<span id="cb87-167"><a href="#cb87-167" aria-hidden="true" tabindex="-1"></a>  <span class="at">pcent =</span> <span class="fl">0.05</span></span>
<span id="cb87-168"><a href="#cb87-168" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-169"><a href="#cb87-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-170"><a href="#cb87-170" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ SNP missing data QC completed</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-171"><a href="#cb87-171" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" SNPs removed:"</span>, qc_snps_missing<span class="sc">$</span>removed_count, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-172"><a href="#cb87-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-173"><a href="#cb87-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-174"><a href="#cb87-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r qc-snps-maf, eval=TRUE}</span></span>
<span id="cb87-175"><a href="#cb87-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Then remove SNPs with MAF &lt; 5%</span></span>
<span id="cb87-176"><a href="#cb87-176" aria-hidden="true" tabindex="-1"></a>qc_snps_maf <span class="ot">&lt;-</span> <span class="fu">bdRemoveMAF_hdf5</span>(</span>
<span id="cb87-177"><a href="#cb87-177" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb87-178"><a href="#cb87-178" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>,</span>
<span id="cb87-179"><a href="#cb87-179" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes_missing_filtered"</span>,</span>
<span id="cb87-180"><a href="#cb87-180" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>,</span>
<span id="cb87-181"><a href="#cb87-181" aria-hidden="true" tabindex="-1"></a>  <span class="at">outdataset =</span> <span class="st">"genotypes_qc_complete"</span>,</span>
<span id="cb87-182"><a href="#cb87-182" aria-hidden="true" tabindex="-1"></a>  <span class="at">maf =</span> <span class="fl">0.05</span>,</span>
<span id="cb87-183"><a href="#cb87-183" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-184"><a href="#cb87-184" aria-hidden="true" tabindex="-1"></a>  <span class="at">blocksize =</span> <span class="dv">1000</span>,</span>
<span id="cb87-185"><a href="#cb87-185" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb87-186"><a href="#cb87-186" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-187"><a href="#cb87-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-188"><a href="#cb87-188" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ MAF filtering completed</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-189"><a href="#cb87-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-190"><a href="#cb87-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-191"><a href="#cb87-191" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb87-192"><a href="#cb87-192" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quality Control is Critical</span></span>
<span id="cb87-193"><a href="#cb87-193" aria-hidden="true" tabindex="-1"></a>In real genomic analyses, QC removes:</span>
<span id="cb87-194"><a href="#cb87-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-195"><a href="#cb87-195" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Technical artifacts:** Failed samples, contamination</span>
<span id="cb87-196"><a href="#cb87-196" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Uninformative markers:** Rare variants, high missingness</span>
<span id="cb87-197"><a href="#cb87-197" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Errors:** Genotyping errors, batch effects</span>
<span id="cb87-198"><a href="#cb87-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-199"><a href="#cb87-199" aria-hidden="true" tabindex="-1"></a>Always perform QC before downstream analysis. The thresholds (5% missing, 5% MAF) are typical but should be adjusted based on your study design.</span>
<span id="cb87-200"><a href="#cb87-200" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-201"><a href="#cb87-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-202"><a href="#cb87-202" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inspect QC Results</span></span>
<span id="cb87-203"><a href="#cb87-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-204"><a href="#cb87-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r inspect-qc, eval=TRUE}</span></span>
<span id="cb87-205"><a href="#cb87-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Check dimensions after QC</span></span>
<span id="cb87-206"><a href="#cb87-206" aria-hidden="true" tabindex="-1"></a>h5file <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(analysis_file)</span>
<span id="cb87-207"><a href="#cb87-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-208"><a href="#cb87-208" aria-hidden="true" tabindex="-1"></a>dim_raw <span class="ot">&lt;-</span> <span class="fu">dim</span>(h5file<span class="sc">$</span>raw<span class="sc">$</span>genotypes)</span>
<span id="cb87-209"><a href="#cb87-209" aria-hidden="true" tabindex="-1"></a>dim_qc <span class="ot">&lt;-</span> <span class="fu">dim</span>(h5file<span class="sc">$</span>qc<span class="sc">$</span>genotypes_qc_complete)</span>
<span id="cb87-210"><a href="#cb87-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-211"><a href="#cb87-211" aria-hidden="true" tabindex="-1"></a><span class="fu">H5Fclose</span>(h5file)</span>
<span id="cb87-212"><a href="#cb87-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-213"><a href="#cb87-213" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Dimensions before QC:"</span>, dim_raw[<span class="dv">1</span>], <span class="st">"×"</span>, dim_raw[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-214"><a href="#cb87-214" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dimensions after QC:"</span>, dim_qc[<span class="dv">1</span>], <span class="st">"×"</span>, dim_qc[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-215"><a href="#cb87-215" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Samples retained:"</span>, <span class="fu">round</span>(dim_qc[<span class="dv">1</span>]<span class="sc">/</span>dim_raw[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-216"><a href="#cb87-216" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"SNPs retained:"</span>, <span class="fu">round</span>(dim_qc[<span class="dv">2</span>]<span class="sc">/</span>dim_raw[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-217"><a href="#cb87-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-218"><a href="#cb87-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-219"><a href="#cb87-219" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-220"><a href="#cb87-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-221"><a href="#cb87-221" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3: Impute Missing Data</span></span>
<span id="cb87-222"><a href="#cb87-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-223"><a href="#cb87-223" aria-hidden="true" tabindex="-1"></a>After QC, we still have some missing data. Impute using mean genotype:</span>
<span id="cb87-224"><a href="#cb87-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-225"><a href="#cb87-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r impute, eval=TRUE}</span></span>
<span id="cb87-226"><a href="#cb87-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values (mean imputation by column)</span></span>
<span id="cb87-227"><a href="#cb87-227" aria-hidden="true" tabindex="-1"></a><span class="fu">bdImputeSNPs_hdf5</span>(</span>
<span id="cb87-228"><a href="#cb87-228" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> analysis_file,</span>
<span id="cb87-229"><a href="#cb87-229" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>,</span>
<span id="cb87-230"><a href="#cb87-230" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes_qc_complete"</span>,</span>
<span id="cb87-231"><a href="#cb87-231" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-232"><a href="#cb87-232" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>,</span>
<span id="cb87-233"><a href="#cb87-233" aria-hidden="true" tabindex="-1"></a>  <span class="at">outdataset =</span> <span class="st">"genotypes_qc_complete"</span>,  <span class="co"># Overwrite</span></span>
<span id="cb87-234"><a href="#cb87-234" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb87-235"><a href="#cb87-235" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-236"><a href="#cb87-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-237"><a href="#cb87-237" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Missing data imputed</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-238"><a href="#cb87-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-239"><a href="#cb87-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-240"><a href="#cb87-240" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb87-241"><a href="#cb87-241" aria-hidden="true" tabindex="-1"></a><span class="fu">## Imputation Methods</span></span>
<span id="cb87-242"><a href="#cb87-242" aria-hidden="true" tabindex="-1"></a>BigDataStatMeth uses mean imputation by default. For genomic data:</span>
<span id="cb87-243"><a href="#cb87-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-244"><a href="#cb87-244" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Mean imputation:** Simple, fast, works for PCA/dimensionality reduction</span>
<span id="cb87-245"><a href="#cb87-245" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**For association studies:** Consider more sophisticated methods (BEAGLE, IMPUTE2)</span>
<span id="cb87-246"><a href="#cb87-246" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Always impute AFTER QC:** Don't impute bad data</span>
<span id="cb87-247"><a href="#cb87-247" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-248"><a href="#cb87-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-249"><a href="#cb87-249" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-250"><a href="#cb87-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-251"><a href="#cb87-251" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 4: Perform SVD</span></span>
<span id="cb87-252"><a href="#cb87-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-253"><a href="#cb87-253" aria-hidden="true" tabindex="-1"></a>Now perform SVD to extract principal components:</span>
<span id="cb87-254"><a href="#cb87-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-255"><a href="#cb87-255" aria-hidden="true" tabindex="-1"></a><span class="in">```{r svd-analysis, eval=TRUE}</span></span>
<span id="cb87-256"><a href="#cb87-256" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform hierarchical SVD</span></span>
<span id="cb87-257"><a href="#cb87-257" aria-hidden="true" tabindex="-1"></a>svd_result <span class="ot">&lt;-</span> <span class="fu">bdSVD_hdf5</span>(</span>
<span id="cb87-258"><a href="#cb87-258" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> analysis_file,</span>
<span id="cb87-259"><a href="#cb87-259" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>,</span>
<span id="cb87-260"><a href="#cb87-260" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="st">"genotypes_qc_complete"</span>,</span>
<span id="cb87-261"><a href="#cb87-261" aria-hidden="true" tabindex="-1"></a>  <span class="at">bcenter =</span> <span class="cn">TRUE</span>,      <span class="co"># Center the data</span></span>
<span id="cb87-262"><a href="#cb87-262" aria-hidden="true" tabindex="-1"></a>  <span class="at">bscale =</span> <span class="cn">FALSE</span>,      <span class="co"># Don't scale (typical for genotypes)</span></span>
<span id="cb87-263"><a href="#cb87-263" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">4</span>,               <span class="co"># Number of blocks</span></span>
<span id="cb87-264"><a href="#cb87-264" aria-hidden="true" tabindex="-1"></a>  <span class="at">q =</span> <span class="dv">1</span>,               <span class="co"># Number of hierarchy levels</span></span>
<span id="cb87-265"><a href="#cb87-265" aria-hidden="true" tabindex="-1"></a>  <span class="at">threads =</span> <span class="dv">2</span>,         <span class="co"># Use 2 threads</span></span>
<span id="cb87-266"><a href="#cb87-266" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb87-267"><a href="#cb87-267" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-268"><a href="#cb87-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-269"><a href="#cb87-269" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ SVD completed</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-270"><a href="#cb87-270" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">" Results stored in:"</span>, svd_result<span class="sc">$</span>group, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-271"><a href="#cb87-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-272"><a href="#cb87-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-273"><a href="#cb87-273" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb87-274"><a href="#cb87-274" aria-hidden="true" tabindex="-1"></a><span class="fu">## SVD Parameters</span></span>
<span id="cb87-275"><a href="#cb87-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-276"><a href="#cb87-276" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**bcenter = TRUE:** Essential - centers data to zero mean</span>
<span id="cb87-277"><a href="#cb87-277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**bscale = FALSE:** Don't standardize (typical for genotype data)</span>
<span id="cb87-278"><a href="#cb87-278" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**k:** Number of blocks (more = faster but approximation)</span>
<span id="cb87-279"><a href="#cb87-279" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**q:** Hierarchy levels (usually 1 or 2)</span>
<span id="cb87-280"><a href="#cb87-280" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**threads:** Parallel processing (adjust to your system)</span>
<span id="cb87-281"><a href="#cb87-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-282"><a href="#cb87-282" aria-hidden="true" tabindex="-1"></a>For huge datasets (&gt;100 GB), increase <span class="in">`k`</span> and consider <span class="in">`q = 2`</span>.</span>
<span id="cb87-283"><a href="#cb87-283" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-284"><a href="#cb87-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-285"><a href="#cb87-285" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-286"><a href="#cb87-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-287"><a href="#cb87-287" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 5: Extract and Examine Results</span></span>
<span id="cb87-288"><a href="#cb87-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-289"><a href="#cb87-289" aria-hidden="true" tabindex="-1"></a>SVD produces three key outputs stored in the HDF5 file. Let's extract them and see what they look like.</span>
<span id="cb87-290"><a href="#cb87-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-291"><a href="#cb87-291" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extract Principal Components</span></span>
<span id="cb87-292"><a href="#cb87-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-293"><a href="#cb87-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-pcs, eval=TRUE}</span></span>
<span id="cb87-294"><a href="#cb87-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the file to access SVD results</span></span>
<span id="cb87-295"><a href="#cb87-295" aria-hidden="true" tabindex="-1"></a>h5file <span class="ot">&lt;-</span> <span class="fu">H5Fopen</span>(analysis_file)</span>
<span id="cb87-296"><a href="#cb87-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-297"><a href="#cb87-297" aria-hidden="true" tabindex="-1"></a><span class="co"># Get singular values (eigenvalues) - these tell us variance explained</span></span>
<span id="cb87-298"><a href="#cb87-298" aria-hidden="true" tabindex="-1"></a>d_values <span class="ot">&lt;-</span> h5file<span class="sc">$</span>SVD<span class="sc">$</span>genotypes_qc_complete<span class="sc">$</span>d</span>
<span id="cb87-299"><a href="#cb87-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-300"><a href="#cb87-300" aria-hidden="true" tabindex="-1"></a><span class="co"># Get left singular vectors (U) - sample loadings = our principal components</span></span>
<span id="cb87-301"><a href="#cb87-301" aria-hidden="true" tabindex="-1"></a>u_matrix <span class="ot">&lt;-</span> h5file<span class="sc">$</span>SVD<span class="sc">$</span>genotypes_qc_complete<span class="sc">$</span>u</span>
<span id="cb87-302"><a href="#cb87-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-303"><a href="#cb87-303" aria-hidden="true" tabindex="-1"></a><span class="co"># Get right singular vectors (V) - SNP loadings = feature contributions</span></span>
<span id="cb87-304"><a href="#cb87-304" aria-hidden="true" tabindex="-1"></a>v_matrix <span class="ot">&lt;-</span> h5file<span class="sc">$</span>SVD<span class="sc">$</span>genotypes_qc_complete<span class="sc">$</span>v</span>
<span id="cb87-305"><a href="#cb87-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-306"><a href="#cb87-306" aria-hidden="true" tabindex="-1"></a><span class="fu">H5Fclose</span>(h5file)</span>
<span id="cb87-307"><a href="#cb87-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-308"><a href="#cb87-308" aria-hidden="true" tabindex="-1"></a><span class="co"># Add meaningful column names</span></span>
<span id="cb87-309"><a href="#cb87-309" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(u_matrix) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(u_matrix))</span>
<span id="cb87-310"><a href="#cb87-310" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(v_matrix) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(v_matrix))</span>
<span id="cb87-311"><a href="#cb87-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-312"><a href="#cb87-312" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Extracted SVD components:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-313"><a href="#cb87-313" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Singular values (d):"</span>, <span class="fu">length</span>(d_values), <span class="st">"values</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-314"><a href="#cb87-314" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Sample loadings (U):"</span>, <span class="fu">nrow</span>(u_matrix), <span class="st">"samples ×"</span>, </span>
<span id="cb87-315"><a href="#cb87-315" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ncol</span>(u_matrix), <span class="st">"components</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-316"><a href="#cb87-316" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  SNP loadings (V):"</span>, <span class="fu">nrow</span>(v_matrix), <span class="st">"SNPs ×"</span>, </span>
<span id="cb87-317"><a href="#cb87-317" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ncol</span>(v_matrix), <span class="st">"components</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-318"><a href="#cb87-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-319"><a href="#cb87-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-320"><a href="#cb87-320" aria-hidden="true" tabindex="-1"></a>Let's look at what these matrices actually contain:</span>
<span id="cb87-321"><a href="#cb87-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-322"><a href="#cb87-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r preview-results, eval=TRUE}</span></span>
<span id="cb87-323"><a href="#cb87-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview singular values</span></span>
<span id="cb87-324"><a href="#cb87-324" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">First 10 singular values:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-325"><a href="#cb87-325" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(d_values[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], <span class="dv">4</span>))</span>
<span id="cb87-326"><a href="#cb87-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-327"><a href="#cb87-327" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview sample loadings (principal components)</span></span>
<span id="cb87-328"><a href="#cb87-328" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Sample loadings (U matrix) - first 5 samples × first 5 PCs:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-329"><a href="#cb87-329" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(u_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb87-330"><a href="#cb87-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-331"><a href="#cb87-331" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview SNP loadings  </span></span>
<span id="cb87-332"><a href="#cb87-332" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">SNP loadings (V matrix) - first 5 SNPs × first 5 PCs:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-333"><a href="#cb87-333" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(v_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb87-334"><a href="#cb87-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-335"><a href="#cb87-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-336"><a href="#cb87-336" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb87-337"><a href="#cb87-337" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding the Outputs</span></span>
<span id="cb87-338"><a href="#cb87-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-339"><a href="#cb87-339" aria-hidden="true" tabindex="-1"></a>**Singular values (d):** Larger values = more important components. These decrease rapidly - the first few PCs capture most variation.</span>
<span id="cb87-340"><a href="#cb87-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-341"><a href="#cb87-341" aria-hidden="true" tabindex="-1"></a>**U matrix (sample loadings):** Each row is a sample, each column is a PC. Values show how much each sample "loads on" that PC. This is what we plot for population structure.</span>
<span id="cb87-342"><a href="#cb87-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-343"><a href="#cb87-343" aria-hidden="true" tabindex="-1"></a>**V matrix (SNP loadings):** Each row is a SNP, each column is a PC. Values show how much each SNP contributes to that PC. High absolute values = SNPs driving that component.</span>
<span id="cb87-344"><a href="#cb87-344" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-345"><a href="#cb87-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-346"><a href="#cb87-346" aria-hidden="true" tabindex="-1"></a><span class="fu">### Variance Explained</span></span>
<span id="cb87-347"><a href="#cb87-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-348"><a href="#cb87-348" aria-hidden="true" tabindex="-1"></a>Now let's see how much variance each PC captures:</span>
<span id="cb87-349"><a href="#cb87-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-350"><a href="#cb87-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r variance, eval=TRUE}</span></span>
<span id="cb87-351"><a href="#cb87-351" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportion of variance explained by each PC</span></span>
<span id="cb87-352"><a href="#cb87-352" aria-hidden="true" tabindex="-1"></a>variance_prop <span class="ot">&lt;-</span> (d_values<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>(d_values<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb87-353"><a href="#cb87-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-354"><a href="#cb87-354" aria-hidden="true" tabindex="-1"></a><span class="co"># Cumulative variance (running total)</span></span>
<span id="cb87-355"><a href="#cb87-355" aria-hidden="true" tabindex="-1"></a>cumvar <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(variance_prop)</span>
<span id="cb87-356"><a href="#cb87-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-357"><a href="#cb87-357" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Variance explained by first 10 PCs:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-358"><a href="#cb87-358" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"PC  | Individual | Cumulative</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-359"><a href="#cb87-359" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"----+------------+-----------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-360"><a href="#cb87-360" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">length</span>(variance_prop))) {</span>
<span id="cb87-361"><a href="#cb87-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"%-3d | %6.2f%%    | %6.2f%%</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb87-362"><a href="#cb87-362" aria-hidden="true" tabindex="-1"></a>              i, variance_prop[i]<span class="sc">*</span><span class="dv">100</span>, cumvar[i]<span class="sc">*</span><span class="dv">100</span>))</span>
<span id="cb87-363"><a href="#cb87-363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-364"><a href="#cb87-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-365"><a href="#cb87-365" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">✓ First"</span>, <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">length</span>(variance_prop)), <span class="st">"PCs explain"</span>,</span>
<span id="cb87-366"><a href="#cb87-366" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">"%.1f%%"</span>, cumvar[<span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">length</span>(cumvar))]<span class="sc">*</span><span class="dv">100</span>), </span>
<span id="cb87-367"><a href="#cb87-367" aria-hidden="true" tabindex="-1"></a>    <span class="st">"of total variance</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-368"><a href="#cb87-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-369"><a href="#cb87-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-370"><a href="#cb87-370" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-371"><a href="#cb87-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-372"><a href="#cb87-372" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 6: Visualize Results</span></span>
<span id="cb87-373"><a href="#cb87-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-374"><a href="#cb87-374" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scree Plot</span></span>
<span id="cb87-375"><a href="#cb87-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-376"><a href="#cb87-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r scree-plot, eval=TRUE, fig.width=8, fig.height=5}</span></span>
<span id="cb87-377"><a href="#cb87-377" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare vectors for plotting</span></span>
<span id="cb87-378"><a href="#cb87-378" aria-hidden="true" tabindex="-1"></a>n_show <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(variance_prop))</span>
<span id="cb87-379"><a href="#cb87-379" aria-hidden="true" tabindex="-1"></a>pc_nums <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n_show</span>
<span id="cb87-380"><a href="#cb87-380" aria-hidden="true" tabindex="-1"></a>var_pct <span class="ot">&lt;-</span> variance_prop[<span class="dv">1</span><span class="sc">:</span>n_show] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb87-381"><a href="#cb87-381" aria-hidden="true" tabindex="-1"></a>cum_pct <span class="ot">&lt;-</span> cumvar[<span class="dv">1</span><span class="sc">:</span>n_show] <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb87-382"><a href="#cb87-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-383"><a href="#cb87-383" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scree plot using vectors directly</span></span>
<span id="cb87-384"><a href="#cb87-384" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pc_nums, var_pct, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb87-385"><a href="#cb87-385" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Principal Component"</span>, </span>
<span id="cb87-386"><a href="#cb87-386" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Variance Explained (%)"</span>,</span>
<span id="cb87-387"><a href="#cb87-387" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Scree Plot: Variance Explained by Principal Components"</span>,</span>
<span id="cb87-388"><a href="#cb87-388" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(cum_pct) <span class="sc">*</span> <span class="fl">1.1</span>),</span>
<span id="cb87-389"><a href="#cb87-389" aria-hidden="true" tabindex="-1"></a>     <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb87-390"><a href="#cb87-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-391"><a href="#cb87-391" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cumulative variance line</span></span>
<span id="cb87-392"><a href="#cb87-392" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pc_nums, cum_pct, <span class="at">type =</span> <span class="st">"b"</span>, <span class="at">col =</span> <span class="st">"darkred"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, </span>
<span id="cb87-393"><a href="#cb87-393" aria-hidden="true" tabindex="-1"></a>      <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb87-394"><a href="#cb87-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-395"><a href="#cb87-395" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb87-396"><a href="#cb87-396" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"right"</span>, </span>
<span id="cb87-397"><a href="#cb87-397" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Individual Variance"</span>, <span class="st">"Cumulative Variance"</span>),</span>
<span id="cb87-398"><a href="#cb87-398" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"steelblue"</span>, <span class="st">"darkred"</span>), </span>
<span id="cb87-399"><a href="#cb87-399" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb87-400"><a href="#cb87-400" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb87-401"><a href="#cb87-401" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb87-402"><a href="#cb87-402" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb87-403"><a href="#cb87-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-404"><a href="#cb87-404" aria-hidden="true" tabindex="-1"></a><span class="co"># Add grid</span></span>
<span id="cb87-405"><a href="#cb87-405" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>(<span class="at">col =</span> <span class="st">"gray90"</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb87-406"><a href="#cb87-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-407"><a href="#cb87-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-408"><a href="#cb87-408" aria-hidden="true" tabindex="-1"></a><span class="fu">### PCA Plot</span></span>
<span id="cb87-409"><a href="#cb87-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-410"><a href="#cb87-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pca-plot, eval=TRUE, fig.width=8, fig.height=6}</span></span>
<span id="cb87-411"><a href="#cb87-411" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame for plotting</span></span>
<span id="cb87-412"><a href="#cb87-412" aria-hidden="true" tabindex="-1"></a><span class="co"># Match with population labels (accounting for QC filtering)</span></span>
<span id="cb87-413"><a href="#cb87-413" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll use first dim_qc[1] samples</span></span>
<span id="cb87-414"><a href="#cb87-414" aria-hidden="true" tabindex="-1"></a>pca_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb87-415"><a href="#cb87-415" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC1 =</span> u_matrix[,<span class="dv">1</span>],</span>
<span id="cb87-416"><a href="#cb87-416" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC2 =</span> u_matrix[,<span class="dv">2</span>],</span>
<span id="cb87-417"><a href="#cb87-417" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC3 =</span> u_matrix[,<span class="dv">3</span>],</span>
<span id="cb87-418"><a href="#cb87-418" aria-hidden="true" tabindex="-1"></a>  <span class="at">Population =</span> population[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(u_matrix)]</span>
<span id="cb87-419"><a href="#cb87-419" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-420"><a href="#cb87-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-421"><a href="#cb87-421" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot PC1 vs PC2</span></span>
<span id="cb87-422"><a href="#cb87-422" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_data, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> Population)) <span class="sc">+</span></span>
<span id="cb87-423"><a href="#cb87-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb87-424"><a href="#cb87-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pop1"</span> <span class="ot">=</span> <span class="st">"#E41A1C"</span>, </span>
<span id="cb87-425"><a href="#cb87-425" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Pop2"</span> <span class="ot">=</span> <span class="st">"#377EB8"</span>, </span>
<span id="cb87-426"><a href="#cb87-426" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Pop3"</span> <span class="ot">=</span> <span class="st">"#4DAF4A"</span>)) <span class="sc">+</span></span>
<span id="cb87-427"><a href="#cb87-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb87-428"><a href="#cb87-428" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Population Structure: PC1 vs PC2"</span>,</span>
<span id="cb87-429"><a href="#cb87-429" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"PC1: %.1f%% variance | PC2: %.1f%% variance"</span>,</span>
<span id="cb87-430"><a href="#cb87-430" aria-hidden="true" tabindex="-1"></a>                       variance_prop[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, variance_prop[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>),</span>
<span id="cb87-431"><a href="#cb87-431" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">sprintf</span>(<span class="st">"PC1 (%.1f%%)"</span>, variance_prop[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>),</span>
<span id="cb87-432"><a href="#cb87-432" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">sprintf</span>(<span class="st">"PC2 (%.1f%%)"</span>, variance_prop[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb87-433"><a href="#cb87-433" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb87-434"><a href="#cb87-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-435"><a href="#cb87-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb87-436"><a href="#cb87-436" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb87-437"><a href="#cb87-437" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb87-438"><a href="#cb87-438" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb87-439"><a href="#cb87-439" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb87-440"><a href="#cb87-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb87-441"><a href="#cb87-441" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb87-442"><a href="#cb87-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-443"><a href="#cb87-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-444"><a href="#cb87-444" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb87-445"><a href="#cb87-445" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interpreting PCA Plots</span></span>
<span id="cb87-446"><a href="#cb87-446" aria-hidden="true" tabindex="-1"></a>In this simulated example, the three populations separate clearly on PC1 and PC2, which is expected since we simulated them with different allele frequencies.</span>
<span id="cb87-447"><a href="#cb87-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-448"><a href="#cb87-448" aria-hidden="true" tabindex="-1"></a>In real data:</span>
<span id="cb87-449"><a href="#cb87-449" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**PC1/PC2 separation:** Often reflects continental ancestry</span>
<span id="cb87-450"><a href="#cb87-450" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Outliers:** May indicate sample mix-ups or technical issues</span>
<span id="cb87-451"><a href="#cb87-451" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Gradients:** Reflect admixture or geographic structure</span>
<span id="cb87-452"><a href="#cb87-452" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Clusters:** Can represent discrete populations or family structure</span>
<span id="cb87-453"><a href="#cb87-453" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-454"><a href="#cb87-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-455"><a href="#cb87-455" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-456"><a href="#cb87-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-457"><a href="#cb87-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 7: Save Results for Downstream Use</span></span>
<span id="cb87-458"><a href="#cb87-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-459"><a href="#cb87-459" aria-hidden="true" tabindex="-1"></a><span class="fu">### Export PCs for Other Tools</span></span>
<span id="cb87-460"><a href="#cb87-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-461"><a href="#cb87-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r export-pcs, eval=TRUE}</span></span>
<span id="cb87-462"><a href="#cb87-462" aria-hidden="true" tabindex="-1"></a><span class="co"># Save PCs to text file for use in other software</span></span>
<span id="cb87-463"><a href="#cb87-463" aria-hidden="true" tabindex="-1"></a>pcs_export <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb87-464"><a href="#cb87-464" aria-hidden="true" tabindex="-1"></a>  <span class="at">SampleID =</span> <span class="fu">paste0</span>(<span class="st">"Sample_"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(u_matrix)),</span>
<span id="cb87-465"><a href="#cb87-465" aria-hidden="true" tabindex="-1"></a>  u_matrix[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]  <span class="co"># First 10 PCs</span></span>
<span id="cb87-466"><a href="#cb87-466" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-467"><a href="#cb87-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-468"><a href="#cb87-468" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(pcs_export, <span class="st">"principal_components.txt"</span>,</span>
<span id="cb87-469"><a href="#cb87-469" aria-hidden="true" tabindex="-1"></a>            <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb87-470"><a href="#cb87-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-471"><a href="#cb87-471" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Principal components exported to principal_components.txt</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-472"><a href="#cb87-472" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-473"><a href="#cb87-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-474"><a href="#cb87-474" aria-hidden="true" tabindex="-1"></a><span class="fu">### Document the Analysis</span></span>
<span id="cb87-475"><a href="#cb87-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-476"><a href="#cb87-476" aria-hidden="true" tabindex="-1"></a>Every analysis should be documented. Let's create a summary report with all key information:</span>
<span id="cb87-477"><a href="#cb87-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-478"><a href="#cb87-478" aria-hidden="true" tabindex="-1"></a><span class="in">```{r document, eval=TRUE}</span></span>
<span id="cb87-479"><a href="#cb87-479" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive analysis summary</span></span>
<span id="cb87-480"><a href="#cb87-480" aria-hidden="true" tabindex="-1"></a>analysis_summary <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"</span></span>
<span id="cb87-481"><a href="#cb87-481" aria-hidden="true" tabindex="-1"></a><span class="st">Genomic Analysis Summary</span></span>
<span id="cb87-482"><a href="#cb87-482" aria-hidden="true" tabindex="-1"></a><span class="st">========================</span></span>
<span id="cb87-483"><a href="#cb87-483" aria-hidden="true" tabindex="-1"></a><span class="st">Date: %s</span></span>
<span id="cb87-484"><a href="#cb87-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-485"><a href="#cb87-485" aria-hidden="true" tabindex="-1"></a><span class="st">Input Data:</span></span>
<span id="cb87-486"><a href="#cb87-486" aria-hidden="true" tabindex="-1"></a><span class="st">- Samples: %d</span></span>
<span id="cb87-487"><a href="#cb87-487" aria-hidden="true" tabindex="-1"></a><span class="st">- SNPs: %d  </span></span>
<span id="cb87-488"><a href="#cb87-488" aria-hidden="true" tabindex="-1"></a><span class="st">- Missing data: %.2f%%</span></span>
<span id="cb87-489"><a href="#cb87-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-490"><a href="#cb87-490" aria-hidden="true" tabindex="-1"></a><span class="st">Quality Control:</span></span>
<span id="cb87-491"><a href="#cb87-491" aria-hidden="true" tabindex="-1"></a><span class="st">- Samples after QC: %d (%.1f%% retained)</span></span>
<span id="cb87-492"><a href="#cb87-492" aria-hidden="true" tabindex="-1"></a><span class="st">- SNPs after QC: %d (%.1f%% retained)</span></span>
<span id="cb87-493"><a href="#cb87-493" aria-hidden="true" tabindex="-1"></a><span class="st">- MAF threshold: 5%%</span></span>
<span id="cb87-494"><a href="#cb87-494" aria-hidden="true" tabindex="-1"></a><span class="st">- Missing data threshold: 5%%</span></span>
<span id="cb87-495"><a href="#cb87-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-496"><a href="#cb87-496" aria-hidden="true" tabindex="-1"></a><span class="st">SVD Parameters:</span></span>
<span id="cb87-497"><a href="#cb87-497" aria-hidden="true" tabindex="-1"></a><span class="st">- Centered: Yes</span></span>
<span id="cb87-498"><a href="#cb87-498" aria-hidden="true" tabindex="-1"></a><span class="st">- Scaled: No</span></span>
<span id="cb87-499"><a href="#cb87-499" aria-hidden="true" tabindex="-1"></a><span class="st">- Blocks (k): 4</span></span>
<span id="cb87-500"><a href="#cb87-500" aria-hidden="true" tabindex="-1"></a><span class="st">- Levels (q): 1</span></span>
<span id="cb87-501"><a href="#cb87-501" aria-hidden="true" tabindex="-1"></a><span class="st">- Components computed: %d</span></span>
<span id="cb87-502"><a href="#cb87-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-503"><a href="#cb87-503" aria-hidden="true" tabindex="-1"></a><span class="st">Variance Explained:</span></span>
<span id="cb87-504"><a href="#cb87-504" aria-hidden="true" tabindex="-1"></a><span class="st">- PC1: %.2f%%</span></span>
<span id="cb87-505"><a href="#cb87-505" aria-hidden="true" tabindex="-1"></a><span class="st">- PC2: %.2f%%</span></span>
<span id="cb87-506"><a href="#cb87-506" aria-hidden="true" tabindex="-1"></a><span class="st">- PC1-10 cumulative: %.2f%%</span></span>
<span id="cb87-507"><a href="#cb87-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-508"><a href="#cb87-508" aria-hidden="true" tabindex="-1"></a><span class="st">Output Files:</span></span>
<span id="cb87-509"><a href="#cb87-509" aria-hidden="true" tabindex="-1"></a><span class="st">- HDF5 file: %s</span></span>
<span id="cb87-510"><a href="#cb87-510" aria-hidden="true" tabindex="-1"></a><span class="st">- PCs export: principal_components.txt</span></span>
<span id="cb87-511"><a href="#cb87-511" aria-hidden="true" tabindex="-1"></a><span class="st">- This summary: analysis_summary.txt</span></span>
<span id="cb87-512"><a href="#cb87-512" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,</span>
<span id="cb87-513"><a href="#cb87-513" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.Date</span>(),</span>
<span id="cb87-514"><a href="#cb87-514" aria-hidden="true" tabindex="-1"></a>dim_raw[<span class="dv">1</span>], dim_raw[<span class="dv">2</span>], </span>
<span id="cb87-515"><a href="#cb87-515" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(genotype))<span class="sc">/</span><span class="fu">length</span>(genotype)<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb87-516"><a href="#cb87-516" aria-hidden="true" tabindex="-1"></a>dim_qc[<span class="dv">1</span>], dim_qc[<span class="dv">1</span>]<span class="sc">/</span>dim_raw[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb87-517"><a href="#cb87-517" aria-hidden="true" tabindex="-1"></a>dim_qc[<span class="dv">2</span>], dim_qc[<span class="dv">2</span>]<span class="sc">/</span>dim_raw[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb87-518"><a href="#cb87-518" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(d_values),</span>
<span id="cb87-519"><a href="#cb87-519" aria-hidden="true" tabindex="-1"></a>variance_prop[<span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, variance_prop[<span class="dv">2</span>]<span class="sc">*</span><span class="dv">100</span>, cumvar[<span class="dv">10</span>]<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb87-520"><a href="#cb87-520" aria-hidden="true" tabindex="-1"></a>analysis_file</span>
<span id="cb87-521"><a href="#cb87-521" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-522"><a href="#cb87-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-523"><a href="#cb87-523" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to file</span></span>
<span id="cb87-524"><a href="#cb87-524" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(analysis_summary, <span class="st">"analysis_summary.txt"</span>)</span>
<span id="cb87-525"><a href="#cb87-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-526"><a href="#cb87-526" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Analysis summary saved to analysis_summary.txt</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb87-527"><a href="#cb87-527" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Here's what was saved:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-528"><a href="#cb87-528" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">strrep</span>(<span class="st">"="</span>, <span class="dv">70</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-529"><a href="#cb87-529" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(analysis_summary)</span>
<span id="cb87-530"><a href="#cb87-530" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">strrep</span>(<span class="st">"="</span>, <span class="dv">70</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-531"><a href="#cb87-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-532"><a href="#cb87-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-533"><a href="#cb87-533" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb87-534"><a href="#cb87-534" aria-hidden="true" tabindex="-1"></a><span class="fu">## Good Documentation Practices</span></span>
<span id="cb87-535"><a href="#cb87-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-536"><a href="#cb87-536" aria-hidden="true" tabindex="-1"></a>**Always document:**</span>
<span id="cb87-537"><a href="#cb87-537" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Input data characteristics (size, missing data)</span>
<span id="cb87-538"><a href="#cb87-538" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>QC thresholds and results</span>
<span id="cb87-539"><a href="#cb87-539" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Analysis parameters</span>
<span id="cb87-540"><a href="#cb87-540" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Output locations</span>
<span id="cb87-541"><a href="#cb87-541" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Date performed</span>
<span id="cb87-542"><a href="#cb87-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-543"><a href="#cb87-543" aria-hidden="true" tabindex="-1"></a>**Why this matters:**</span>
<span id="cb87-544"><a href="#cb87-544" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Reproducibility - you or others can recreate the analysis</span>
<span id="cb87-545"><a href="#cb87-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Transparency - methods are clear</span>
<span id="cb87-546"><a href="#cb87-546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Debugging - if something's wrong, you know what was done</span>
<span id="cb87-547"><a href="#cb87-547" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Publications - you have all the details for methods sections</span>
<span id="cb87-548"><a href="#cb87-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-549"><a href="#cb87-549" aria-hidden="true" tabindex="-1"></a>This summary file is perfect for README files or supplementary materials.</span>
<span id="cb87-550"><a href="#cb87-550" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-551"><a href="#cb87-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-552"><a href="#cb87-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-553"><a href="#cb87-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-554"><a href="#cb87-554" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-555"><a href="#cb87-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-556"><a href="#cb87-556" aria-hidden="true" tabindex="-1"></a><span class="fu">## Interactive Exercise {.exercise}</span></span>
<span id="cb87-557"><a href="#cb87-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-558"><a href="#cb87-558" aria-hidden="true" tabindex="-1"></a><span class="fu">### Practice: Modifying the Analysis Workflow</span></span>
<span id="cb87-559"><a href="#cb87-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-560"><a href="#cb87-560" aria-hidden="true" tabindex="-1"></a>Understanding a workflow means being able to modify it for different scenarios. This exercise challenges you to adapt what you've learned to new situations.</span>
<span id="cb87-561"><a href="#cb87-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-564"><a href="#cb87-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb87-565"><a href="#cb87-565" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb87-566"><a href="#cb87-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-567"><a href="#cb87-567" aria-hidden="true" tabindex="-1"></a><span class="co"># Exercise: Adapt this workflow for your research</span></span>
<span id="cb87-568"><a href="#cb87-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-569"><a href="#cb87-569" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 1: Different QC thresholds</span></span>
<span id="cb87-570"><a href="#cb87-570" aria-hidden="true" tabindex="-1"></a><span class="co"># Your dataset has higher missingness - adjust thresholds</span></span>
<span id="cb87-571"><a href="#cb87-571" aria-hidden="true" tabindex="-1"></a><span class="fu">bdRemovelowdata_hdf5</span>(</span>
<span id="cb87-572"><a href="#cb87-572" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"genomic_data.hdf5"</span>,</span>
<span id="cb87-573"><a href="#cb87-573" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"raw"</span>, <span class="at">dataset =</span> <span class="st">"genotypes"</span>,</span>
<span id="cb87-574"><a href="#cb87-574" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>, <span class="at">outdataset =</span> <span class="st">"samples_qc"</span>,</span>
<span id="cb87-575"><a href="#cb87-575" aria-hidden="true" tabindex="-1"></a>  <span class="at">bycols =</span> <span class="cn">FALSE</span>, </span>
<span id="cb87-576"><a href="#cb87-576" aria-hidden="true" tabindex="-1"></a>  <span class="at">pcent =</span> <span class="fl">0.10</span>  <span class="co"># Allow 10% missing instead of 5%</span></span>
<span id="cb87-577"><a href="#cb87-577" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-578"><a href="#cb87-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-579"><a href="#cb87-579" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 2: More stringent MAF filtering</span></span>
<span id="cb87-580"><a href="#cb87-580" aria-hidden="true" tabindex="-1"></a><span class="fu">bdRemoveMAF_hdf5</span>(</span>
<span id="cb87-581"><a href="#cb87-581" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"genomic_data.hdf5"</span>,</span>
<span id="cb87-582"><a href="#cb87-582" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>, <span class="at">dataset =</span> <span class="st">"snps_qc"</span>,</span>
<span id="cb87-583"><a href="#cb87-583" aria-hidden="true" tabindex="-1"></a>  <span class="at">outgroup =</span> <span class="st">"qc"</span>, <span class="at">outdataset =</span> <span class="st">"snps_qc_maf"</span>,</span>
<span id="cb87-584"><a href="#cb87-584" aria-hidden="true" tabindex="-1"></a>  <span class="at">maf =</span> <span class="fl">0.10</span>  <span class="co"># Remove variants &lt;10% frequency</span></span>
<span id="cb87-585"><a href="#cb87-585" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-586"><a href="#cb87-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-587"><a href="#cb87-587" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 3: Different SVD parameters</span></span>
<span id="cb87-588"><a href="#cb87-588" aria-hidden="true" tabindex="-1"></a><span class="co"># You want more PCs but with less accuracy for speed</span></span>
<span id="cb87-589"><a href="#cb87-589" aria-hidden="true" tabindex="-1"></a><span class="fu">bdSVD_hdf5</span>(</span>
<span id="cb87-590"><a href="#cb87-590" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"genomic_data.hdf5"</span>,</span>
<span id="cb87-591"><a href="#cb87-591" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">"qc"</span>, <span class="at">dataset =</span> <span class="st">"imputed"</span>,</span>
<span id="cb87-592"><a href="#cb87-592" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">10</span>,   <span class="co"># More PCs</span></span>
<span id="cb87-593"><a href="#cb87-593" aria-hidden="true" tabindex="-1"></a>  <span class="at">q =</span> <span class="dv">1</span>,    <span class="co"># Fewer hierarchy levels (faster)</span></span>
<span id="cb87-594"><a href="#cb87-594" aria-hidden="true" tabindex="-1"></a>  <span class="at">bcenter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb87-595"><a href="#cb87-595" aria-hidden="true" tabindex="-1"></a>  <span class="at">bscale =</span> <span class="cn">FALSE</span></span>
<span id="cb87-596"><a href="#cb87-596" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-597"><a href="#cb87-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-598"><a href="#cb87-598" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 4: Add your own visualization</span></span>
<span id="cb87-599"><a href="#cb87-599" aria-hidden="true" tabindex="-1"></a><span class="co"># What would you plot differently?</span></span>
<span id="cb87-600"><a href="#cb87-600" aria-hidden="true" tabindex="-1"></a><span class="co"># - Top 3 PCs in 3D?</span></span>
<span id="cb87-601"><a href="#cb87-601" aria-hidden="true" tabindex="-1"></a><span class="co"># - Loadings to identify influential SNPs?</span></span>
<span id="cb87-602"><a href="#cb87-602" aria-hidden="true" tabindex="-1"></a><span class="co"># - Correlation of PCs with phenotypes?</span></span>
<span id="cb87-603"><a href="#cb87-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-604"><a href="#cb87-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-605"><a href="#cb87-605" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb87-606"><a href="#cb87-606" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reflection Questions</span></span>
<span id="cb87-607"><a href="#cb87-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-608"><a href="#cb87-608" aria-hidden="true" tabindex="-1"></a>Think about how you'd adapt this workflow to your specific needs:</span>
<span id="cb87-609"><a href="#cb87-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-610"><a href="#cb87-610" aria-hidden="true" tabindex="-1"></a>**1. Quality Control Decisions:**</span>
<span id="cb87-611"><a href="#cb87-611" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What QC thresholds are appropriate for your data?</span>
<span id="cb87-612"><a href="#cb87-612" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Do you need additional filters (Hardy-Weinberg equilibrium, relatedness)?</span>
<span id="cb87-613"><a href="#cb87-613" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How do you decide what's "low quality" vs. "real signal"?</span>
<span id="cb87-614"><a href="#cb87-614" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>When should you be more vs. less stringent?</span>
<span id="cb87-615"><a href="#cb87-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-616"><a href="#cb87-616" aria-hidden="true" tabindex="-1"></a>**2. Missing Data Strategy:**</span>
<span id="cb87-617"><a href="#cb87-617" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Mean imputation is simple but crude - when is it acceptable?</span>
<span id="cb87-618"><a href="#cb87-618" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What alternatives exist (mode, k-NN, matrix completion)?</span>
<span id="cb87-619"><a href="#cb87-619" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How much missingness is too much to impute validly?</span>
<span id="cb87-620"><a href="#cb87-620" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Should you remove high-missingness markers before imputing?</span>
<span id="cb87-621"><a href="#cb87-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-622"><a href="#cb87-622" aria-hidden="true" tabindex="-1"></a>**3. SVD Parameters:**</span>
<span id="cb87-623"><a href="#cb87-623" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How many principal components do you need?</span>
<span id="cb87-624"><a href="#cb87-624" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Trade-off: k=10 with q=2 vs. k=40 with q=1?</span>
<span id="cb87-625"><a href="#cb87-625" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>When does increased accuracy justify increased computation time?</span>
<span id="cb87-626"><a href="#cb87-626" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How do you verify results are accurate enough?</span>
<span id="cb87-627"><a href="#cb87-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-628"><a href="#cb87-628" aria-hidden="true" tabindex="-1"></a>**4. Validation Steps:**</span>
<span id="cb87-629"><a href="#cb87-629" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How do you know your QC worked correctly?</span>
<span id="cb87-630"><a href="#cb87-630" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What checks confirm SVD completed properly?</span>
<span id="cb87-631"><a href="#cb87-631" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How do you detect if you removed too much/little data?</span>
<span id="cb87-632"><a href="#cb87-632" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>When should you see red flags in the results?</span>
<span id="cb87-633"><a href="#cb87-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-634"><a href="#cb87-634" aria-hidden="true" tabindex="-1"></a>**5. Scaling to Your Data:**</span>
<span id="cb87-635"><a href="#cb87-635" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>This tutorial used 500 samples × 2,000 SNPs</span>
<span id="cb87-636"><a href="#cb87-636" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What if you have 50,000 samples × 500,000 SNPs?</span>
<span id="cb87-637"><a href="#cb87-637" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Which steps become bottlenecks?</span>
<span id="cb87-638"><a href="#cb87-638" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Where would you adjust block sizes, threads, or parameters?</span>
<span id="cb87-639"><a href="#cb87-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-640"><a href="#cb87-640" aria-hidden="true" tabindex="-1"></a>**6. Workflow Modifications:**</span>
<span id="cb87-641"><a href="#cb87-641" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>What if you're analyzing transcriptomics instead of genomics?</span>
<span id="cb87-642"><a href="#cb87-642" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Different data types (time series, images, sensor networks)?</span>
<span id="cb87-643"><a href="#cb87-643" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>How would you adapt each step?</span>
<span id="cb87-644"><a href="#cb87-644" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Which parts are generalizable, which are domain-specific?</span>
<span id="cb87-645"><a href="#cb87-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-646"><a href="#cb87-646" aria-hidden="true" tabindex="-1"></a>The best way to learn is by trying. Copy this workflow, modify it step by step, see what breaks and what works. Understanding why something fails teaches as much as getting it right.</span>
<span id="cb87-647"><a href="#cb87-647" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb87-648"><a href="#cb87-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-649"><a href="#cb87-649" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-650"><a href="#cb87-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-651"><a href="#cb87-651" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cleanup</span></span>
<span id="cb87-652"><a href="#cb87-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-653"><a href="#cb87-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cleanup, eval=TRUE}</span></span>
<span id="cb87-654"><a href="#cb87-654" aria-hidden="true" tabindex="-1"></a><span class="co"># Close HDF5 connections</span></span>
<span id="cb87-655"><a href="#cb87-655" aria-hidden="true" tabindex="-1"></a><span class="fu">h5closeAll</span>()</span>
<span id="cb87-656"><a href="#cb87-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-657"><a href="#cb87-657" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep the HDF5 file and results for review</span></span>
<span id="cb87-658"><a href="#cb87-658" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove intermediate exports if desired:</span></span>
<span id="cb87-659"><a href="#cb87-659" aria-hidden="true" tabindex="-1"></a><span class="co"># file.remove("principal_components.txt", "analysis_summary.txt")</span></span>
<span id="cb87-660"><a href="#cb87-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-661"><a href="#cb87-661" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Analysis complete!</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb87-662"><a href="#cb87-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb87-663"><a href="#cb87-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-664"><a href="#cb87-664" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-665"><a href="#cb87-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-666"><a href="#cb87-666" aria-hidden="true" tabindex="-1"></a><span class="fu">## What You've Learned</span></span>
<span id="cb87-667"><a href="#cb87-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-668"><a href="#cb87-668" aria-hidden="true" tabindex="-1"></a>✅ **Complete workflow:** From raw data to interpretable results  </span>
<span id="cb87-669"><a href="#cb87-669" aria-hidden="true" tabindex="-1"></a>✅ **Quality control:** Sample and SNP filtering  </span>
<span id="cb87-670"><a href="#cb87-670" aria-hidden="true" tabindex="-1"></a>✅ **Data preparation:** Missing data imputation  </span>
<span id="cb87-671"><a href="#cb87-671" aria-hidden="true" tabindex="-1"></a>✅ **SVD analysis:** Dimensionality reduction on large matrices  </span>
<span id="cb87-672"><a href="#cb87-672" aria-hidden="true" tabindex="-1"></a>✅ **Visualization:** Scree plots and PCA plots  </span>
<span id="cb87-673"><a href="#cb87-673" aria-hidden="true" tabindex="-1"></a>✅ **Results export:** Preparing data for downstream analyses</span>
<span id="cb87-674"><a href="#cb87-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-675"><a href="#cb87-675" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-676"><a href="#cb87-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-677"><a href="#cb87-677" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next Steps</span></span>
<span id="cb87-678"><a href="#cb87-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-679"><a href="#cb87-679" aria-hidden="true" tabindex="-1"></a>**Explore advanced workflows:**</span>
<span id="cb87-680"><a href="#cb87-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-681"><a href="#cb87-681" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Implementing PCA</span><span class="co">](../workflows/implementing-pca.qmd)</span> - Real genomic data, advanced visualization</span>
<span id="cb87-682"><a href="#cb87-682" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Implementing CCA</span><span class="co">](../workflows/implementing-cca.qmd)</span> - Multi-omics integration</span>
<span id="cb87-683"><a href="#cb87-683" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Cross-Platform Workflows</span><span class="co">](../workflows/cross-platform.qmd)</span> - Using results in Python, C++</span>
<span id="cb87-684"><a href="#cb87-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-685"><a href="#cb87-685" aria-hidden="true" tabindex="-1"></a>**Optimize for your data:**</span>
<span id="cb87-686"><a href="#cb87-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-687"><a href="#cb87-687" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adjust QC thresholds based on your study</span>
<span id="cb87-688"><a href="#cb87-688" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Try different SVD parameters (k, q) for speed vs accuracy</span>
<span id="cb87-689"><a href="#cb87-689" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use more PCs if data has complex structure</span>
<span id="cb87-690"><a href="#cb87-690" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Integrate covariates in downstream analyses</span>
<span id="cb87-691"><a href="#cb87-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-692"><a href="#cb87-692" aria-hidden="true" tabindex="-1"></a>**Learn the theory:**</span>
<span id="cb87-693"><a href="#cb87-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-694"><a href="#cb87-694" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Block-Wise Computing</span><span class="co">](../fundamentals/blockwise-computing.qmd)</span> - How SVD scales to large data</span>
<span id="cb87-695"><a href="#cb87-695" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Linear Algebra Refresher</span><span class="co">](../fundamentals/linear-algebra.qmd)</span> - Math behind PCA/SVD</span>
<span id="cb87-696"><a href="#cb87-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-697"><a href="#cb87-697" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb87-698"><a href="#cb87-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-699"><a href="#cb87-699" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Takeaways {.key-concept}</span></span>
<span id="cb87-700"><a href="#cb87-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-701"><a href="#cb87-701" aria-hidden="true" tabindex="-1"></a>Let's consolidate what you've learned about executing complete analyses with BigDataStatMeth, from raw data through final results.</span>
<span id="cb87-702"><a href="#cb87-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-703"><a href="#cb87-703" aria-hidden="true" tabindex="-1"></a><span class="fu">### Essential Concepts</span></span>
<span id="cb87-704"><a href="#cb87-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-705"><a href="#cb87-705" aria-hidden="true" tabindex="-1"></a>**Analysis workflows follow a consistent structure** regardless of domain or data type. Import → quality control → data preparation → analysis → validation → export. This pattern applies whether you're analyzing genomics, climate data, financial time series, or sensor networks. The specific QC steps and analysis methods change, but the overall structure remains constant. Understanding this framework helps you design new analyses systematically rather than ad hoc, and recognize where different projects share common challenges.</span>
<span id="cb87-706"><a href="#cb87-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-707"><a href="#cb87-707" aria-hidden="true" tabindex="-1"></a>**Quality control must come before analysis, not after.** Running PCA on data with 30% missing values, duplicate samples, or technical artifacts produces misleading results that look mathematically valid but are scientifically meaningless. You can't fix bad input with good algorithms - garbage in, garbage out applies universally. Investing time in QC upfront determines whether your results are interpretable or garbage. The temptation to skip QC and "just see what happens" is strong, but resist it. QC failures discovered after weeks of analysis waste far more time than doing QC correctly from the start.</span>
<span id="cb87-708"><a href="#cb87-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-709"><a href="#cb87-709" aria-hidden="true" tabindex="-1"></a>**Missing data imputation has consequences** that affect downstream analyses. Mean imputation (replacing missing values with column means) is computationally simple but statistically crude - it reduces variance artificially and can create patterns where none exist. It's acceptable for low missingness (&lt;5%) where impact is minimal. Higher missingness requires more sophisticated methods (k-NN imputation, matrix completion) or removal of high-missingness features entirely. There's no free lunch: every imputation method introduces assumptions, and those assumptions propagate through your analyses affecting final conclusions.</span>
<span id="cb87-710"><a href="#cb87-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-711"><a href="#cb87-711" aria-hidden="true" tabindex="-1"></a>**Centering versus scaling matters for interpretation** and affects what your principal components mean. Centering (subtracting column means) is almost always needed for PCA - it ensures PC1 doesn't just capture mean differences between features. Scaling (dividing by standard deviations) is more controversial: it gives equal weight to all features, which helps when features have different units (mixing expression and metabolites) but can obscure real biological differences in variability. For genomic SNPs where all features are the same type, we typically center but don't scale. Understanding these choices helps you interpret what patterns the PCs are actually capturing.</span>
<span id="cb87-712"><a href="#cb87-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-713"><a href="#cb87-713" aria-hidden="true" tabindex="-1"></a>**Variance explained tells you if PCA succeeded.** If PC1-PC10 only explain 20% of total variance, your data either has very high true dimensionality (many independent biological signals) or very high noise (low signal-to-noise ratio). If PC1 alone explains 80%, you have a strong dominant pattern - but verify it's real biological structure, not a technical artifact like batch effects or ancestry. Inspecting variance explained is your first diagnostic of whether the analysis produced meaningful results or just decomposed noise.</span>
<span id="cb87-714"><a href="#cb87-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-715"><a href="#cb87-715" aria-hidden="true" tabindex="-1"></a>**Block-wise processing is transparent** to the user, hiding complexity while enabling scalability. You called <span class="in">`bdSVD_hdf5()`</span> exactly as you would any function - one function call, simple arguments. Behind the scenes, BigDataStatMeth partitioned your matrix into blocks, computed local SVDs, hierarchically merged results, and produced final output. This happened automatically without you writing partitioning logic or managing intermediate results. This abstraction is the package's core value: sophisticated algorithms exposed through simple interfaces.</span>
<span id="cb87-716"><a href="#cb87-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-717"><a href="#cb87-717" aria-hidden="true" tabindex="-1"></a>**Documentation is part of the analysis, not an afterthought.** The analysis summary you created documents everything needed to reproduce the work: data sources, QC thresholds, parameters, software versions, dates. Without this documentation, you'll forget critical details within weeks. Future you (revisiting the analysis), collaborators (extending the work), and reviewers (verifying methods) all depend on thorough documentation. Make documentation a habit from the start, not something you do "if you have time" before submitting papers.</span>
<span id="cb87-718"><a href="#cb87-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-719"><a href="#cb87-719" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to Apply This Workflow</span></span>
<span id="cb87-720"><a href="#cb87-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-721"><a href="#cb87-721" aria-hidden="true" tabindex="-1"></a>Understanding which analyses benefit from this structured approach versus when simpler methods suffice helps you work efficiently.</span>
<span id="cb87-722"><a href="#cb87-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-723"><a href="#cb87-723" aria-hidden="true" tabindex="-1"></a>✅ **Use this complete workflow when:**</span>
<span id="cb87-724"><a href="#cb87-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-725"><a href="#cb87-725" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Your dataset exceeds memory limits** - When traditional <span class="in">`prcomp()`</span> or <span class="in">`svd()`</span> fail with memory errors, BigDataStatMeth's disk-based approach becomes necessary, not optional. The workflow structure (HDF5 storage, QC, analysis, export) handles data that doesn't fit in RAM.</span>
<span id="cb87-726"><a href="#cb87-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-727"><a href="#cb87-727" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Quality control is critical for validity** - Genomic studies, clinical trials, sensor networks - anywhere that data quality directly affects scientific conclusions. Following QC → imputation → analysis prevents analyzing garbage and drawing false conclusions.</span>
<span id="cb87-728"><a href="#cb87-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-729"><a href="#cb87-729" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**You'll run multiple analyses on the same data** - Converting to HDF5 and performing QC once pays off when you subsequently run PCA, regression, association tests, and more. The upfront investment amortizes across all downstream analyses.</span>
<span id="cb87-730"><a href="#cb87-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-731"><a href="#cb87-731" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Reproducibility and documentation matter** - Academic research, regulatory submissions, collaborative projects - anywhere others need to understand and verify your methods. The structured workflow with documented parameters makes reproducibility natural rather than an afterthought.</span>
<span id="cb87-732"><a href="#cb87-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-733"><a href="#cb87-733" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**The analysis will be extended or repeated** - If you'll add more samples later, rerun with updated QC thresholds, or apply the same pipeline to new datasets, having a documented workflow saves enormous time. Copy the structure, adjust parameters, execute.</span>
<span id="cb87-734"><a href="#cb87-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-735"><a href="#cb87-735" aria-hidden="true" tabindex="-1"></a>✅ **Adapt the workflow when:**</span>
<span id="cb87-736"><a href="#cb87-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-737"><a href="#cb87-737" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Analyzing different data types** - Transcriptomics needs log-transformation and batch correction instead of MAF filtering. Time series needs detrending instead of missing data imputation. Climate data needs spatial autocorrelation handling. The workflow structure (import → QC → prepare → analyze) remains constant, but specific operations change.</span>
<span id="cb87-738"><a href="#cb87-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-739"><a href="#cb87-739" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**QC requirements differ** - Exploratory analyses tolerate higher missingness than GWAS. Population structure studies need less stringent filtering than association tests. Adjust QC thresholds to match your analysis goals and acceptable false discovery rates.</span>
<span id="cb87-740"><a href="#cb87-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-741"><a href="#cb87-741" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Computational resources vary** - With 256 GB RAM, you might skip HDF5 for 40 GB datasets. With 16 GB RAM, you need disk-based computing for 10 GB datasets. Adjust block sizes (<span class="in">`k`</span>), hierarchy levels (<span class="in">`q`</span>), and threading based on your available resources.</span>
<span id="cb87-742"><a href="#cb87-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-743"><a href="#cb87-743" aria-hidden="true" tabindex="-1"></a>❌ **Simpler approaches suffice when:**</span>
<span id="cb87-744"><a href="#cb87-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-745"><a href="#cb87-745" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data fits comfortably in memory** - If <span class="in">`data &lt;- read.csv(file); svd(data)`</span> works without issues, the added complexity of HDF5 storage and block-wise processing provides minimal benefit. Use familiar tools that work.</span>
<span id="cb87-746"><a href="#cb87-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-747"><a href="#cb87-747" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**One-off exploratory analysis** - Quick investigations you won't repeat or extend don't justify elaborate workflows. Load data, run analysis, save key results, move on. Don't over-engineer temporary explorations.</span>
<span id="cb87-748"><a href="#cb87-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-749"><a href="#cb87-749" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**No quality control needed** - Clean, well-curated datasets (like published benchmark data) don't need extensive QC. Applying QC steps that aren't necessary wastes time without improving results.</span>
<span id="cb87-750"><a href="#cb87-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-751"><a href="#cb87-751" aria-hidden="true" tabindex="-1"></a>The key insight is matching workflow complexity to problem complexity. Large-scale, quality-sensitive, repeated analyses justify this structured approach. Small-scale, one-off, exploratory work doesn't. Choose appropriately based on your specific situation rather than applying the same workflow everywhere.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 BigDataStatMeth - ISGlobal BRGE</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/edit/main/tutorials/first-analysis.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/isglobal-brge/BigDataStatMeth/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/isglobal-brge/BigDataStatMeth">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
 License: GPL-3
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>